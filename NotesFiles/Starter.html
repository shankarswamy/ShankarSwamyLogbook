<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<script id="versionArea" type="text/javascript">
//<![CDATA[
var version = {title: "TiddlyWiki", major: 2, minor: 8, revision: 1, date: new Date("June 23, 2013"), extensions: {}};

//]]>
</script>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="copyright" content="
TiddlyWiki created by Jeremy Ruston, (jeremy [at] osmosoft [dot] com)

Copyright (c) Jeremy Ruston 2004-2007
Copyright (c) UnaMesa Association 2007-2012

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of the UnaMesa Association nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS 'AS IS' AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.

" />
<!--PRE-HEAD-START-->
<!--{{{-->
<link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' />
<!--}}}-->

<!--PRE-HEAD-END-->
<title> Starter </title>
<style id="styleArea" type="text/css">
#saveTest {display:none;}
#messageArea {display:none;}
#copyright {display:none;}
#storeArea {display:none;}
#storeArea div {padding:0.5em; margin:1em 0em 0em 0em; border-color:#fff #666 #444 #ddd; border-style:solid; border-width:2px; overflow:auto;}
#shadowArea {display:none;}
#javascriptWarning {width:100%; text-align:center; font-weight:bold; background-color:#dd1100; color:#fff; padding:1em 0em;}

</style>
<!--POST-HEAD-START-->

<!--POST-HEAD-END-->
</head>
<body onload="main();" onunload="if(window.unload) unload();">
<!--PRE-BODY-START-->

<!--PRE-BODY-END-->
<div id="copyright">
Welcome to TiddlyWiki created by Jeremy Ruston; Copyright &copy; 2004-2007 Jeremy Ruston, Copyright &copy; 2007-2011 UnaMesa Association
</div>
<noscript>
<div id="javascriptWarning">
This page requires JavaScript to function properly.<br /><br />If you are using Microsoft Internet Explorer you may need to click on the yellow bar above and select 'Allow Blocked Content'. You must then click 'Yes' on the following security warning.
</div>

</noscript>
<div id="saveTest"></div>
<div id="backstageCloak"></div>
<div id="backstageButton"></div>
<div id="backstageArea"><div id="backstageToolbar"></div></div>
<div id="backstage">
	<div id="backstagePanel"></div>
</div>
<div id="contentWrapper"></div>
<div id="contentStash"></div>
<div id="shadowArea">
<div title="ColorPalette">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #8cf
PrimaryLight: #18f
PrimaryMid: #04b
PrimaryDark: #014
SecondaryPale: #ffc
SecondaryLight: #fe8
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #eee
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
</pre>
</div>
<div title="EditTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::EditToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit title'&gt;&lt;/div&gt;
&lt;div macro='annotations'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit text'&gt;&lt;/div&gt;
&lt;div class='editor' macro='edit tags'&gt;&lt;/div&gt;&lt;div class='editorFooter'&gt;&lt;span macro='message views.editor.tagPrompt'&gt;&lt;/span&gt;&lt;span macro='tagChooser excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="GettingStarted">
<pre>To get started with this blank [[TiddlyWiki]], you'll need to modify the following tiddlers:
* [[SiteTitle]] &amp; [[SiteSubtitle]]: The title and subtitle of the site, as shown above (after saving, they will also appear in the browser title bar)
* [[MainMenu]]: The menu (usually on the left)
* [[DefaultTiddlers]]: Contains the names of the tiddlers that you want to appear when the TiddlyWiki is opened
You'll also need to enter your username for signing your edits: &lt;&lt;option txtUserName&gt;&gt;
</pre>
</div>
<div title="ImportTiddlers">
<pre>&lt;&lt;importTiddlers&gt;&gt;
</pre>
</div>
<div title="MarkupPreHead">
<pre>&lt;!--{{{--&gt;
&lt;link rel='alternate' type='application/rss+xml' title='RSS' href='index.xml' /&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="OptionsPanel">
<pre>These [[InterfaceOptions]] for customising [[TiddlyWiki]] are saved in your browser

Your username for signing your edits. Write it as a [[WikiWord]] (eg [[JoeBloggs]])

&lt;&lt;option txtUserName&gt;&gt;
&lt;&lt;option chkSaveBackups&gt;&gt; [[SaveBackups]]
&lt;&lt;option chkAutoSave&gt;&gt; [[AutoSave]]
&lt;&lt;option chkRegExpSearch&gt;&gt; [[RegExpSearch]]
&lt;&lt;option chkCaseSensitiveSearch&gt;&gt; [[CaseSensitiveSearch]]
&lt;&lt;option chkAnimate&gt;&gt; [[EnableAnimations]]

----
Also see [[AdvancedOptions]]
</pre>
</div>
<div title="PageTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' role='banner' macro='gradient vert [[ColorPalette::PrimaryLight]] [[ColorPalette::PrimaryMid]]'&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='headerForeground'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='mainMenu' role='navigation' refresh='content' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' role='navigation' refresh='content' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' role='complementary' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea' role='main'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>
<div title="StyleSheetColors">
<pre>/*{{{*/
body {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}

a {color:[[ColorPalette::PrimaryMid]];}
a:hover {background-color:[[ColorPalette::PrimaryMid]]; color:[[ColorPalette::Background]];}
a img {border:0;}

h1,h2,h3,h4,h5,h6 {color:[[ColorPalette::SecondaryDark]]; background:transparent;}
h1 {border-bottom:2px solid [[ColorPalette::TertiaryLight]];}
h2,h3 {border-bottom:1px solid [[ColorPalette::TertiaryLight]];}

.button {color:[[ColorPalette::PrimaryDark]]; border:1px solid [[ColorPalette::Background]];}
.button:hover {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::SecondaryLight]]; border-color:[[ColorPalette::SecondaryMid]];}
.button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::SecondaryDark]];}

.header {background:[[ColorPalette::PrimaryMid]];}
.headerShadow {color:[[ColorPalette::Foreground]];}
.headerShadow a {font-weight:normal; color:[[ColorPalette::Foreground]];}
.headerForeground {color:[[ColorPalette::Background]];}
.headerForeground a {font-weight:normal; color:[[ColorPalette::PrimaryPale]];}

.tabSelected {color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::TertiaryPale]]; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

#sidebar {}
#sidebarOptions input {border:1px solid [[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel {background:[[ColorPalette::PrimaryPale]];}
#sidebarOptions .sliderPanel a {border:none;color:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:hover {color:[[ColorPalette::Background]]; background:[[ColorPalette::PrimaryMid]];}
#sidebarOptions .sliderPanel a:active {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::Background]];}

.wizard {background:[[ColorPalette::PrimaryPale]]; border:1px solid [[ColorPalette::PrimaryMid]];}
.wizard h1 {color:[[ColorPalette::PrimaryDark]]; border:none;}
.wizard h2 {color:[[ColorPalette::Foreground]]; border:none;}
.wizardStep {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];
	border:1px solid [[ColorPalette::PrimaryMid]];}
.wizardStep.wizardStepDone {background:[[ColorPalette::TertiaryLight]];}
.wizardFooter {background:[[ColorPalette::PrimaryPale]];}
.wizardFooter .status {background:[[ColorPalette::PrimaryDark]]; color:[[ColorPalette::Background]];}
.wizard .button {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryLight]]; border: 1px solid;
	border-color:[[ColorPalette::SecondaryPale]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryPale]];}
.wizard .button:hover {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Background]];}
.wizard .button:active {color:[[ColorPalette::Background]]; background:[[ColorPalette::Foreground]]; border: 1px solid;
	border-color:[[ColorPalette::PrimaryDark]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryPale]] [[ColorPalette::PrimaryDark]];}

.wizard .notChanged {background:transparent;}
.wizard .changedLocally {background:#80ff80;}
.wizard .changedServer {background:#8080ff;}
.wizard .changedBoth {background:#ff8080;}
.wizard .notFound {background:#ffff80;}
.wizard .putToServer {background:#ff80ff;}
.wizard .gotFromServer {background:#80ffff;}

#messageArea {border:1px solid [[ColorPalette::SecondaryMid]]; background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]];}
#messageArea .button {color:[[ColorPalette::PrimaryMid]]; background:[[ColorPalette::SecondaryPale]]; border:none;}

.popupTiddler {background:[[ColorPalette::TertiaryPale]]; border:2px solid [[ColorPalette::TertiaryMid]];}

.popup {background:[[ColorPalette::TertiaryPale]]; color:[[ColorPalette::TertiaryDark]]; border-left:1px solid [[ColorPalette::TertiaryMid]]; border-top:1px solid [[ColorPalette::TertiaryMid]]; border-right:2px solid [[ColorPalette::TertiaryDark]]; border-bottom:2px solid [[ColorPalette::TertiaryDark]];}
.popup hr {color:[[ColorPalette::PrimaryDark]]; background:[[ColorPalette::PrimaryDark]]; border-bottom:1px;}
.popup li.disabled {color:[[ColorPalette::TertiaryMid]];}
.popup li a, .popup li a:visited {color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border: none;}
.popup li a:active {background:[[ColorPalette::SecondaryPale]]; color:[[ColorPalette::Foreground]]; border: none;}
.popupHighlight {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
.listBreak div {border-bottom:1px solid [[ColorPalette::TertiaryDark]];}

.tiddler .defaultCommand {font-weight:bold;}

.shadow .title {color:[[ColorPalette::TertiaryDark]];}

.title {color:[[ColorPalette::SecondaryDark]];}
.subtitle {color:[[ColorPalette::TertiaryDark]];}

.toolbar {color:[[ColorPalette::PrimaryMid]];}
.toolbar a {color:[[ColorPalette::TertiaryLight]];}
.selected .toolbar a {color:[[ColorPalette::TertiaryMid]];}
.selected .toolbar a:hover {color:[[ColorPalette::Foreground]];}

.tagging, .tagged {border:1px solid [[ColorPalette::TertiaryPale]]; background-color:[[ColorPalette::TertiaryPale]];}
.selected .tagging, .selected .tagged {background-color:[[ColorPalette::TertiaryLight]]; border:1px solid [[ColorPalette::TertiaryMid]];}
.tagging .listTitle, .tagged .listTitle {color:[[ColorPalette::PrimaryDark]];}
.tagging .button, .tagged .button {border:none;}

.footer {color:[[ColorPalette::TertiaryLight]];}
.selected .footer {color:[[ColorPalette::TertiaryMid]];}

.error, .errorButton {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::Error]];}
.warning {color:[[ColorPalette::Foreground]]; background:[[ColorPalette::SecondaryPale]];}
.lowlight {background:[[ColorPalette::TertiaryLight]];}

.zoomer {background:none; color:[[ColorPalette::TertiaryMid]]; border:3px solid [[ColorPalette::TertiaryMid]];}

.imageLink, #displayArea .imageLink {background:transparent;}

.annotation {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; border:2px solid [[ColorPalette::SecondaryMid]];}

.viewer .listTitle {list-style-type:none; margin-left:-2em;}
.viewer .button {border:1px solid [[ColorPalette::SecondaryMid]];}
.viewer blockquote {border-left:3px solid [[ColorPalette::TertiaryDark]];}

.viewer table, table.twtable {border:2px solid [[ColorPalette::TertiaryDark]];}
.viewer th, .viewer thead td, .twtable th, .twtable thead td {background:[[ColorPalette::SecondaryMid]]; border:1px solid [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::Background]];}
.viewer td, .viewer tr, .twtable td, .twtable tr {border:1px solid [[ColorPalette::TertiaryDark]];}

.viewer pre {border:1px solid [[ColorPalette::SecondaryLight]]; background:[[ColorPalette::SecondaryPale]];}
.viewer code {color:[[ColorPalette::SecondaryDark]];}
.viewer hr {border:0; border-top:dashed 1px [[ColorPalette::TertiaryDark]]; color:[[ColorPalette::TertiaryDark]];}

.highlight, .marked {background:[[ColorPalette::SecondaryLight]];}

.editor input {border:1px solid [[ColorPalette::PrimaryMid]];}
.editor textarea {border:1px solid [[ColorPalette::PrimaryMid]]; width:100%;}
.editorFooter {color:[[ColorPalette::TertiaryMid]];}
.readOnly {background:[[ColorPalette::TertiaryPale]];}

#backstageArea {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::TertiaryMid]];}
#backstageArea a {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstageArea a:hover {background:[[ColorPalette::SecondaryLight]]; color:[[ColorPalette::Foreground]]; }
#backstageArea a.backstageSelTab {background:[[ColorPalette::Background]]; color:[[ColorPalette::Foreground]];}
#backstageButton a {background:none; color:[[ColorPalette::Background]]; border:none;}
#backstageButton a:hover {background:[[ColorPalette::Foreground]]; color:[[ColorPalette::Background]]; border:none;}
#backstagePanel {background:[[ColorPalette::Background]]; border-color: [[ColorPalette::Background]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]] [[ColorPalette::TertiaryDark]];}
.backstagePanelFooter .button {border:none; color:[[ColorPalette::Background]];}
.backstagePanelFooter .button:hover {color:[[ColorPalette::Foreground]];}
#backstageCloak {background:[[ColorPalette::Foreground]]; opacity:0.6; filter:alpha(opacity=60);}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLayout">
<pre>/*{{{*/
* html .tiddler {height:1%;}

body {font-size:.75em; font-family:arial,helvetica; margin:0; padding:0;}

h1,h2,h3,h4,h5,h6 {font-weight:bold; text-decoration:none;}
h1,h2,h3 {padding-bottom:1px; margin-top:1.2em;margin-bottom:0.3em;}
h4,h5,h6 {margin-top:1em;}
h1 {font-size:1.35em;}
h2 {font-size:1.25em;}
h3 {font-size:1.1em;}
h4 {font-size:1em;}
h5 {font-size:.9em;}

hr {height:1px;}

a {text-decoration:none;}

dt {font-weight:bold;}

ol {list-style-type:decimal;}
ol ol {list-style-type:lower-alpha;}
ol ol ol {list-style-type:lower-roman;}
ol ol ol ol {list-style-type:decimal;}
ol ol ol ol ol {list-style-type:lower-alpha;}
ol ol ol ol ol ol {list-style-type:lower-roman;}
ol ol ol ol ol ol ol {list-style-type:decimal;}

.txtOptionInput {width:11em;}

#contentWrapper .chkOptionInput {border:0;}

.externalLink {text-decoration:underline;}

.indent {margin-left:3em;}
.outdent {margin-left:3em; text-indent:-3em;}
code.escaped {white-space:nowrap;}

.tiddlyLinkExisting {font-weight:bold;}
.tiddlyLinkNonExisting {font-style:italic;}

/* the 'a' is required for IE, otherwise it renders the whole tiddler in bold */
a.tiddlyLinkNonExisting.shadow {font-weight:bold;}

#mainMenu .tiddlyLinkExisting,
	#mainMenu .tiddlyLinkNonExisting,
	#sidebarTabs .tiddlyLinkNonExisting {font-weight:normal; font-style:normal;}
#sidebarTabs .tiddlyLinkExisting {font-weight:bold; font-style:normal;}

.header {position:relative;}
.header a:hover {background:transparent;}
.headerShadow {position:relative; padding:4.5em 0 1em 1em; left:-1px; top:-1px;}
.headerForeground {position:absolute; padding:4.5em 0 1em 1em; left:0; top:0;}

.siteTitle {font-size:3em;}
.siteSubtitle {font-size:1.2em;}

#mainMenu {position:absolute; left:0; width:10em; text-align:right; line-height:1.6em; padding:1.5em 0.5em 0.5em 0.5em; font-size:1.1em;}

#sidebar {position:absolute; right:3px; width:16em; font-size:.9em;}
#sidebarOptions {padding-top:0.3em;}
#sidebarOptions a {margin:0 0.2em; padding:0.2em 0.3em; display:block;}
#sidebarOptions input {margin:0.4em 0.5em;}
#sidebarOptions .sliderPanel {margin-left:1em; padding:0.5em; font-size:.85em;}
#sidebarOptions .sliderPanel a {font-weight:bold; display:inline; padding:0;}
#sidebarOptions .sliderPanel input {margin:0 0 0.3em 0;}
#sidebarTabs .tabContents {width:15em; overflow:hidden;}

.wizard {padding:0.1em 1em 0 2em;}
.wizard h1 {font-size:2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizard h2 {font-size:1.2em; font-weight:bold; background:none; padding:0; margin:0.4em 0 0.2em;}
.wizardStep {padding:1em 1em 1em 1em;}
.wizard .button {margin:0.5em 0 0; font-size:1.2em;}
.wizardFooter {padding:0.8em 0.4em 0.8em 0;}
.wizardFooter .status {padding:0 0.4em; margin-left:1em;}
.wizard .button {padding:0.1em 0.2em;}

#messageArea {position:fixed; top:2em; right:0; margin:0.5em; padding:0.5em; z-index:2000; _position:absolute;}
.messageToolbar {display:block; text-align:right; padding:0.2em;}
#messageArea a {text-decoration:underline;}

.tiddlerPopupButton {padding:0.2em;}
.popupTiddler {position: absolute; z-index:300; padding:1em; margin:0;}

.popup {position:absolute; z-index:300; font-size:.9em; padding:0; list-style:none; margin:0;}
.popup .popupMessage {padding:0.4em;}
.popup hr {display:block; height:1px; width:auto; padding:0; margin:0.2em 0;}
.popup li.disabled {padding:0.4em;}
.popup li a {display:block; padding:0.4em; font-weight:normal; cursor:pointer;}
.listBreak {font-size:1px; line-height:1px;}
.listBreak div {margin:2px 0;}

.tabset {padding:1em 0 0 0.5em;}
.tab {margin:0 0 0 0.25em; padding:2px;}
.tabContents {padding:0.5em;}
.tabContents ul, .tabContents ol {margin:0; padding:0;}
.txtMainTab .tabContents li {list-style:none;}
.tabContents li.listLink { margin-left:.75em;}

#contentWrapper {display:block;}
#splashScreen {display:none;}

#displayArea {margin:1em 17em 0 14em;}

.toolbar {text-align:right; font-size:.9em;}

.tiddler {padding:1em 1em 0;}

.missing .viewer,.missing .title {font-style:italic;}

.title {font-size:1.6em; font-weight:bold;}

.missing .subtitle {display:none;}
.subtitle {font-size:1.1em;}

.tiddler .button {padding:0.2em 0.4em;}

.tagging {margin:0.5em 0.5em 0.5em 0; float:left; display:none;}
.isTag .tagging {display:block;}
.tagged {margin:0.5em; float:right;}
.tagging, .tagged {font-size:0.9em; padding:0.25em;}
.tagging ul, .tagged ul {list-style:none; margin:0.25em; padding:0;}
.tagClear {clear:both;}

.footer {font-size:.9em;}
.footer li {display:inline;}

.annotation {padding:0.5em; margin:0.5em;}

* html .viewer pre {width:99%; padding:0 0 1em 0;}
.viewer {line-height:1.4em; padding-top:0.5em;}
.viewer .button {margin:0 0.25em; padding:0 0.25em;}
.viewer blockquote {line-height:1.5em; padding-left:0.8em;margin-left:2.5em;}
.viewer ul, .viewer ol {margin-left:0.5em; padding-left:1.5em;}

.viewer table, table.twtable {border-collapse:collapse; margin:0.8em 1.0em;}
.viewer th, .viewer td, .viewer tr,.viewer caption,.twtable th, .twtable td, .twtable tr,.twtable caption {padding:3px;}
table.listView {font-size:0.85em; margin:0.8em 1.0em;}
table.listView th, table.listView td, table.listView tr {padding:0 3px 0 3px;}

.viewer pre {padding:0.5em; margin-left:0.5em; font-size:1.2em; line-height:1.4em; overflow:auto;}
.viewer code {font-size:1.2em; line-height:1.4em;}

.editor {font-size:1.1em;}
.editor input, .editor textarea {display:block; width:100%; font:inherit;}
.editorFooter {padding:0.25em 0; font-size:.9em;}
.editorFooter .button {padding-top:0; padding-bottom:0;}

.fieldsetFix {border:0; padding:0; margin:1px 0px;}

.zoomer {font-size:1.1em; position:absolute; overflow:hidden;}
.zoomer div {padding:1em;}

* html #backstage {width:99%;}
* html #backstageArea {width:99%;}
#backstageArea {display:none; position:relative; overflow: hidden; z-index:150; padding:0.3em 0.5em;}
#backstageToolbar {position:relative;}
#backstageArea a {font-weight:bold; margin-left:0.5em; padding:0.3em 0.5em;}
#backstageButton {display:none; position:absolute; z-index:175; top:0; right:0;}
#backstageButton a {padding:0.1em 0.4em; margin:0.1em;}
#backstage {position:relative; width:100%; z-index:50;}
#backstagePanel {display:none; z-index:100; position:absolute; width:90%; margin-left:3em; padding:1em;}
.backstagePanelFooter {padding-top:0.2em; float:right;}
.backstagePanelFooter a {padding:0.2em 0.4em;}
#backstageCloak {display:none; z-index:20; position:absolute; width:100%; height:100px;}

.whenBackstage {display:none;}
.backstageVisible .whenBackstage {display:block;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetLocale">
<pre>/***
StyleSheet for use when a translation requires any css style changes.
This StyleSheet can be used directly by languages such as Chinese, Japanese and Korean which need larger font sizes.
***/
/*{{{*/
body {font-size:0.8em;}
#sidebarOptions {font-size:1.05em;}
#sidebarOptions a {font-style:normal;}
#sidebarOptions .sliderPanel {font-size:0.95em;}
.subtitle {font-size:0.8em;}
.viewer table.listView {font-size:0.95em;}
/*}}}*/
</pre>
</div>
<div title="StyleSheetPrint">
<pre>/*{{{*/
@media print {
#mainMenu, #sidebar, #messageArea, .toolbar, #backstageButton, #backstageArea {display: none !important;}
#displayArea {margin: 1em 1em 0em;}
noscript {display:none;} /* Fixes a feature in Firefox 1.5.0.2 where print preview displays the noscript content */
}
/*}}}*/
</pre>
</div>
<div title="ViewTemplate">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' role='navigation' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;&lt;span macro='view modifier link'&gt;&lt;/span&gt;, &lt;span macro='view modified date'&gt;&lt;/span&gt; (&lt;span macro='message views.wikified.createdPrompt'&gt;&lt;/span&gt; &lt;span macro='view created date'&gt;&lt;/span&gt;)&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;
</pre>
</div>

</div>
<!--POST-SHADOWAREA-->
<div id="storeArea">
<div title="1445350594531" modifier="YourName" created="201510201416" tags="aaTag pinNotes excludeSearch excludeLists excludeMissing System" changecount="1">
<pre></pre>
</div>
<div title="20140327-1505 Color Palette Test Notes" modifier="YourName" created="201403272205" modified="201510202139" tags="2014-03-27 Note aaTag dayNotes excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>This file is a sample of how the color palette works.

__''Normal text''__:
The December 2013 figures, which were released last week, showed that CAD had fallen to 0.9 per cent of the GDP from 6.5 per cent in the corresponding period a year ago. For the April-December period, it was 2.3 per cent as against 5.2 per cent earlier. The actual figure which was $ 58.4 billion once fell to $ 33.2 billion in December. For the whole year it is likely to register a maximum of $ 40 billion.  By any standards it is a remarkable turnaround which has led many to doubt the veracity of the figures. But these figures are difficult to manipulate. 

''__Emphasized__'':
{{{The measures taken both by the Reserve Bank and the government on a war footing helped avert a disaster. The high CAD level had resulted in a run on the rupee which hit its historically lowest levels. The foreign exchange reserves had fallen perilously and there were even doubts of the country going to touch the 1991 position.}}} 

___''Verbatim''__:
{{{
But the depreciation of the rupee helped exports grow, 
and drastic import curbs, mainly of gold, led to a fall 
in foreign exchange outflow. High duties and other 
restrictions made gold imports unattractive. The FDI and 
FII inflows have increased in the last few months. 
Remittances and deposits from non-resident Indians also 
rose during the period from $ 8.2 billion to $ 10 
billion. All these contributed to a reversal of the 
negative trend and the country reached a safe and 
secure position in terms of foreign exchange reserves.
}}}

__''Block''__:
{{block{
The rupee is stable now and is among the few emerging market currencies which are performing. But the situation can still take a turn for the worse when imports start increasing with economic growth. Smuggling of gold, which has increased recently, can harm the economy. The government has refused to lift the import curbs, though the immediate danger has passed. The measures which helped tide over the situation are temporary and there should be a firmer footing for the changes.  Iron ore mining needs to be resumed and coal imports should be reduced.  There is the need for other measures too, which have policy implications. These can be considered only by the new government after the elections.
}}}

__''Lists''__:
# Stop Talking
# Prepare Yourself to Listen
# Put the Speaker at Ease
# Remove Distractions
# Empathise
# Be Patient
# Avoid Personal Prejudice
# Listen to the Tone
# Listen for Ideas – Not Just Words
# Wait and Watch for Non-Verbal Communication

__''Bullet Points''__:
* Gestures, 
* Facial expressions, and 
* Eye-movements 
... can all be important.  

__''Bold, Italics and Underline''__:
We don’t just listen with ''our ears but also with our eyes'' – //watch and pick up// the __additional information being transmitted via non-verbal communication__. 

__''Color Highlights''__:
{{c0{
All the world's a stage, and all the men and women merely players: they have their exits and their entrances; and one man in his time plays many parts, his acts being seven ages.
- William Shakespeare
}}}
''__c1__'':
{{c1{
Four score and seven years ago our fathers brought forth on this continent, a new nation, conceived in Liberty, and dedicated to the proposition that all men are created equal.
- Abraham Lincoln 
}}}
''__c2__'':
{{c2{
All human actions have one or more of these seven causes: chance, nature, compulsions, habit, reason, passion, desire.
- Aristotle
}}}
''__c3__'':
{{c3{
I busted a mirror and got seven years bad luck, but my lawyer thinks he can get me five.
- Steven Wright 
}}}
''__c4__'':
{{c4{
The serpent, the king, the tiger, the stinging wasp, the small child, the dog owned by other people, and the fool: these seven ought not to be awakened from sleep.
- Chanakya
}}}
''__c5__'':
{{c5{
If you laugh, you think, and you cry, that's a full day. That's a heck of a day. You do that seven days a week, you're going to have something special.
- Jim Valvano
}}}
''__c6__'':
{{c6{
This is our c6 color text! 
}}}
''__Normal Text__'':
At the age of six I wanted to be a cook. At seven I wanted to be Napoleon. And my ambition has been growing steadily ever since.
- Salvador Dali




</pre>
</div>
<div title="20140327-1506 Palette Designer" modifier="YourName" created="201403272206" modified="201403272206" tags="2014-03-27 Note aaTag dayNotes excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script&gt;
var $ = jQuery;

//--------------   helper functions  ----------------------
function FillTextAreaFromArrays()
{
    // space before new line required for proper parsing, in the
    // following
    var myPText = &quot;                      0           1          2          3 \n&quot; + 
          &quot;PRIMARY (BG)       &quot;+ P1.BGArrayNow[0] + &quot;     &quot; + 
          P1.BGArrayNow[1] + &quot;     &quot; + P1.BGArrayNow[2] + 
          &quot;     &quot; + P1.BGArrayNow[3] + &quot; \n&quot;;
    myPText += &quot;SECONDARY (Light)  &quot; + P1.FGArrayLight[0] + &quot;     &quot; + 
               P1.FGArrayLight[1] + &quot;     &quot; + P1.FGArrayLight[2] + 
               &quot;     &quot; + P1.FGArrayLight[3] + &quot; \n&quot;; 
    myPText += &quot;TERTIARY (Dark)    &quot; + P1.FGArrayDark[0] + &quot;     &quot; + 
               P1.FGArrayDark[1] + &quot;     &quot; + P1.FGArrayDark[2] + 
               &quot;     &quot; + P1.FGArrayDark[3] + &quot; &quot;; 

    $('#CPTextArea').val(myPText);
}    //  function FillTextAreaFromArrays()

function ReadTextareaToPaletteArrays()
{
    var myPText = ($('#CPTextArea').val()).trim();
    var myTArray = myPText.match(/\brgba\(([^)]+)\)|#\b[0-9A-F]{6}\b|#\b[0-9A-F]{3}\b|\btransparent\b/gi);
    
    P1.BGArrayNow   = myTArray.slice(0, 4);
    P1.FGArrayLight = myTArray.slice(4, 8);
    P1.FGArrayDark  = myTArray.slice(8);

}    //  function ReadTextareaToPaletteArrays()
//---------------  GUI Callback functions  ----------------
function ReadExistingPalette(myExistingPalette)
{
    // parse the tiddler for colors and populate the arrays in P1 object
    var myPText = store.getTiddlerText(myExistingPalette);

    var myS = myPText.indexOf(&quot;PrimaryA:&quot;);
    var myE = myPText.indexOf(&quot;\n&quot;, myPText.indexOf(&quot;TertiaryD:&quot;));
    myPText = myPText.substring(myS, myE); 
    var myTArray = myPText.match(/\brgba\(([^)]+)\)|#\b[0-9A-F]{6}\b|#\b[0-9A-F]{3}\b|\btransparent\b|\brgba\(([^)]+)\)\b/gi);
    
    P1.BGArrayNow   = myTArray.slice(0, 4);
    P1.FGArrayLight = myTArray.slice(4, 8);
    P1.FGArrayDark  = myTArray.slice(8);
    // redraw the palette
    gdeDisplayPaletteButtonCB();
    P1.dc2.clearRect(0, 0, P1.Canvas.width, P1.Canvas.height);
    alert(&quot;Current Palette is &quot; + myExistingPalette + 
          &quot;:\n&quot; + P1.BGArrayNow + 
          &quot;\n&quot; + P1.FGArrayLight + &quot;\n&quot; + P1.FGArrayDark);

}    //  function ReadExistingPalette(myExistingPalette)

gdeReadAnotherPaletteButtonCB = function()
{
    // prompt for file name with ColorPalette as the default
    p0 = (prompt(&quot;Enter text for Inline Notes (or just hit return):&quot;,&quot;ColorPalette&quot;)).trim();
    if (!p0 || !store.tiddlerExists(p0))
    {
        alert( &quot;Did not get a valid palette name. Bailing out!:-(&quot;);
        return false;
    }
    ReadExistingPalette(p0.trim());
    P1.DrawFullPalette();
    
}    //  gdeReadPaletteButtonCB = function()
gdeDisplayPaletteButtonCB = function()
{
    FillTextAreaFromArrays();
}    //  gde DisplayPaletteButtonCB = function()

gdeReadPaletteButtonCB = function()
{
    ReadTextareaToPaletteArrays();
    
    P1.dc2.clearRect(0, 0, P1.Canvas.width, P1.Canvas.height);
    alert(&quot;Current Palette:\n&quot; + P1.BGArrayNow + 
          &quot;\n&quot; + P1.FGArrayLight + &quot;\n&quot; + P1.FGArrayDark);

    P1.DrawFullPalette();

}    //  gdeReadPaletteButtonCB = function()

gdeCreatePButtonCB = function()
{
    if (!P1)
        return
    ;

    if (!store.tiddlerExists(&quot;ColorPalette&quot;))
    {
        alert(&quot;No ColorPalette Tiddler found - bailing out!&quot;);
        return;
    }    //  if (!store.tiddlerExists(&quot;ColorPalette&quot;))

    // RGB to HSV in some convenient way ...
    var myTags    = &quot;aaTag&quot;;
    var CCTiddler = &quot;Computed Colors&quot;;


    var p0 = 
      (prompt(&quot;Enter text for Inline Notes (or just hit return):&quot;,CCTiddler)).trim();
    if (!p0)
    {
        alert( &quot;Did not get a valid palette name. Bailing out!:-(&quot;);
        return false;
    } else {
        CCTiddler = p0;
    }
    
    store.saveTiddler( CCTiddler, CCTiddler, P1.myText, 
                       config.options.txtUserName, new Date(), myTags );
    autoSaveChanges(null,[CCTiddler]); 
    story.displayTiddler(null,CCTiddler);

}

gdeReplaceCPCB = function()
{
    if (!P1)
        return
    ;

    // Create the string to save
    var myString = P1.myText;
    var myTags   = &quot;aaTag colorPalette&quot;;

    // Find the name for the backup of the current ColorPalette
    var mySuffix = 0;
    var myTiddlerName = &quot;ColorPalette.&quot; + mySuffix.toString();
    while ( store.tiddlerExists(myTiddlerName) )
    {
        ++mySuffix;
        myTiddlerName = &quot;ColorPalette.&quot; + mySuffix.toString();
    }    //  while(...)

    // Save the existing the color palette
    store.saveTiddler(myTiddlerName, myTiddlerName,  
                      store.getTiddlerText(&quot;ColorPalette&quot;), 
                      config.options.txtUserName, 
                      new Date(), myTags); 
    autoSaveChanges(null,[myTiddlerName]);

    // save the new palette 
    myTiddlerName = &quot;ColorPalette&quot;;
    store.saveTiddler(myTiddlerName, myTiddlerName,  
                      myString, 
                      config.options.txtUserName, 
                      new Date(), myTags); 

    // post a message to reload the page
    alert( &quot;ColorPalette Saved!\nSave the page.&quot; + 
           &quot;Reload  the page to experience the new palette!!\n\n&quot;);

    return false;
}

gdeCreatePalettePrototype = function()
{
     p0 = (prompt(&quot;Enter Name for the Palette:&quot;,&quot;TempPalette&quot;)).trim();
     if (!p0)
     {
         return;
     }

    var tmpText  = P1.myText;
    var p1 = confirm(&quot;Add template for background images?&quot;);
debugger;
    if (p1)
    {
        var myTmp1 = &quot;BGImage: url(../BGImages/SpaceHolder-BG.jpg)\n&quot;;
        myTmp1 += &quot;EditImage: url(../BGImages/SpaceHolder-EditBG.jpg)\n&quot;;
        myTmp1 += &quot;}}}PaletteMaker:&quot;;
        tmpText = tmpText.replace(&quot;}}}PaletteMaker:&quot;, myTmp1);
    }

    if (!p1)
    {
        tmpText = tmpText.replace(/\bPrimaryA:[^\n]+\n/,   &quot;PrimaryA:     \n&quot;);
        tmpText = tmpText.replace(/\bPrimaryB:([^\n]+)\n/, &quot;PrimaryB:     \n&quot;);
    } else 
    {
        tmpText = tmpText.replace(/\bPrimaryA:[^\n]+\n/,   &quot;PrimaryA:    transparent\n&quot;);
        tmpText = tmpText.replace(/\bPrimaryB:([^\n]+)\n/, &quot;PrimaryB:    transparent\n&quot;);
    }
    tmpText = tmpText.replace(/\bPrimaryC:([^\n]+)\n/, &quot;PrimaryC:     \n&quot;);
    tmpText = tmpText.replace(/\bPrimaryD:([^\n]+)\n/, &quot;PrimaryD:     \n&quot;);

    tmpText = tmpText.replace(/\bSecondaryA:([^\n]+)\n/, &quot;SecondaryA:   \n&quot;);
    tmpText = tmpText.replace(/\bSecondaryB:([^\n]+)\n/, &quot;SecondaryB:   \n&quot;);
    tmpText = tmpText.replace(/\bSecondaryC:([^\n]+)\n/, &quot;SecondaryC:   \n&quot;);
    tmpText = tmpText.replace(/\bSecondaryD:([^\n]+)\n/, &quot;SecondaryD:   \n&quot;);

    tmpText = tmpText.replace(/\bTertiaryA:([^\n]+)\n/, &quot;TertiaryA:    \n&quot;);
    tmpText = tmpText.replace(/\bTertiaryB:([^\n]+)\n/, &quot;TertiaryB:    \n&quot;);
    tmpText = tmpText.replace(/\bTertiaryC:([^\n]+)\n/, &quot;TertiaryC:    \n&quot;);
    tmpText = tmpText.replace(/\bTertiaryD:([^\n]+)\n/, &quot;TertiaryD:    \n&quot;);
    
    store.saveTiddler( p0, p0, 
                       tmpText, config.options.txtUserName, 
                       new Date(), &quot;aaTag&quot; );
    autoSaveChanges(null, [p0]);

    if ( confirm(p0 + &quot; Saved!  Would like to display it?&quot;) )
    {
        story.displayTiddler(null, p0);
        config.commands.editTiddler.handler(null, null, p0);
    }

}    //  gdeCreatePalettePrototype = function()

gdeDisplayRGB = function()
{
    var myColors = ($('#CPTextArea').val()).trim();
    myColors.replace(/^0/, &quot;                         0&quot;);

    while( myColors.indexOf(&quot;#&quot;) &gt;= 0 )
    {   
        var myHex = myColors.match(/#[0-9A-Fa-f]{6}/);  
        var myRGB = myHex.toString().match(/[0-9A-Fa-f]{2}/g);
        for (var i=0; i &lt; 3; i++) { myRGB[i] = parseInt(myRGB[i], 16); }
        myRGB = &quot;(&quot; + myRGB[0] +&quot;,&quot; + myRGB[1] +&quot;,&quot; + myRGB[2] + &quot;)&quot;;
        myColors = myColors.replace(/#[0-9A-Fa-f]{6}/, myRGB);
    }    //  while( myColors.indexOf(&quot;#&quot;) &gt;= 0 )
    alert(myColors);
}    //  gdeDisplayRGB = function()

gdeDeleteBackups = function()
{
    var myItemNum = 0;
    if ( !confirm(&quot;Do you want to delete all the backups of\ncolorpalette?&quot;) )
    {
        return;
    }
    while (store.tiddlerExists(&quot;ColorPalette.&quot; + myItemNum.toString()))
    {
        store.removeTiddler(&quot;ColorPalette.&quot; + myItemNum.toString());
        ++myItemNum;
    }    //  while( ... )

}    //  gdeDeleteBackups = function()
//----------  GUI Elements ---------------------------------
var CreateGUIElements  = function()
{
    var CPTA = createTiddlyElement(place, 'textarea', 'CPTextArea', 'CCPTextArea', null);
    $('.CCPTextArea').css({width: '830px', height: '80px'});

    var BBTable = createTiddlyElement(place, 'table', null, 'BB', null);
    var BBTableBody = createTiddlyElement(BBTable, 'tbody');
    var row0 = createTiddlyElement(BBTable, 'tr');

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Delete Backups&quot;,
                   &quot;Delete the backup palettes created&quot;, gdeDeleteBackups, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Read Another&quot;,
                   &quot;Read in a different palette&quot;, gdeReadAnotherPaletteButtonCB, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Update Text&quot;,
                   &quot;Read the changes made to the text above&quot;, gdeDisplayPaletteButtonCB, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Use Text&quot;, 
                  &quot;Use the text palette to display below&quot;, gdeReadPaletteButtonCB, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Create Palette&quot;, 
                  &quot;Create a palette with the text palette&quot;, 
                  gdeCreatePButtonCB, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');
    var ReplaceCPButton = createTiddlyButton(td, &quot;Replace Existing&quot;, 
                  &quot;Replace the existing color palette with the text palette&quot;, 
                  gdeReplaceCPCB, &quot;customButton&quot;);

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Create Blank&quot;,
                   &quot;Create a blank palette&quot;, gdeCreatePalettePrototype, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Display RGB&quot;,
                   &quot;Display RGB colors of the text palette&quot;, gdeDisplayRGB, &quot;customButton&quot;); 

}    //  var CreateGUIElements  = function()


//--------- Color Conversion Functions ---------------------
// Return RGB decimal values from hex string
var GetR = function( myS )
{
    return  ( (parseInt(myS, 16) &amp; parseInt('FF0000', 16))&gt;&gt;16 );
}

var GetG = function( myS )
{
    return  ( (parseInt(myS, 16) &amp; parseInt('00FF00', 16))&gt;&gt;8 );
}

var GetB =  function( myS )
{
    return  ( (parseInt(myS, 16) &amp; parseInt('0000FF', 16)) );
}

function RGBToHSVConversion (myR, myG, myB) {
    var rr, gg, bb;
    r = arguments[0] / 255,
    g = arguments[1] / 255,
    b = arguments[2] / 255,
    h, s, v = Math.max(r, g, b),
    diff = v - Math.min(r, g, b),
    diffc = function(c){
            return (v - c) / 6 / diff + 1 / 2;
        };

    if (diff == 0) {
        h = s = 0;
    } else {
        s = diff / v;
        rr = diffc(r);
        gg = diffc(g);
        bb = diffc(b);

        if (r === v) {
            h = bb - gg;
        }else if (g === v) {
            h = (1 / 3) + rr - bb;
        }else if (b === v) {
            h = (2 / 3) + gg - rr;
        }
        if (h &lt; 0) {
            h += 1;
        }else if (h &gt; 1) {
            h -= 1;
        }
    }
    return {
        h: Math.round(h * 360),
        s: Math.round(s * 100),
        v: Math.round(v * 100)
    };
}

//-------------------  Palette Display Functions -----------
var P1;

function SlPalette(arg0, arg1, arg2)
{
    this.X0 = 0;
    this.Y0 = 0;
    this.cI = 0;
    this.Size = 100;  //default

    if (arguments.length)
    {
        this.Size = arg0;
    }
  
    if (arg1)
    {
        this.X0 = arg1;
    }
    if (arg2)
    {
        this.Y0 = arg2;
    }

    // we need eight default colors - render these by default:
    this.BGArrayNow   = [&quot;#2E2B36&quot;, &quot;#182e39&quot;, &quot;#1e203d&quot;, &quot;#15131d&quot;];
    this.FGArrayLight = [&quot;#bab6c3&quot;, &quot;#9ebac7&quot;, &quot;#a2b3af&quot;, &quot;#a0a1c3&quot;];
    this.FGArrayDark  = [&quot;#3c748f&quot;, &quot;#45665f&quot;, &quot;#4b529a&quot;, &quot;#5f4d59&quot;];

    this.FGArray = this.FGArrayDark;
    this.BGArray = this.BGArrayNow;

}    //  function Palette()

SlPalette.prototype.BGArray = new Array();
SlPalette.prototype.FGArray = new Array();

SlPalette.prototype.InitCanvas = function( myCanvas, myWidth, myHeight )
{
    this.Canvas  = myCanvas;
    this.dc2     = myCanvas.getContext(&quot;2d&quot;);
    this.Canvas.width  = 1400;
    this.Canvas.height = 1400;
    if( myWidth) this.Canvas.width = myWidth
    ;
    if (myHeight) this.Canvas.height = myHeight
    ;
        
}    //  SlPalette.prototype.InitCanvas( my2DContext )

SlPalette.prototype.InitOriginSize = function( orgX, orgY, mySize)
{
    this.X0   = orgX;
    this.Y0   = orgY;
    this.Size = mySize;

}    //  SlPalette.prototype.InitOriginSize = function( orgX, orgY, mySize)


SlPalette.prototype.DrawPalette = function( BgOrFg)
{
   // what are we drawing - BG or FG:
   var myCArray = this.BGArray;
   if ( BgOrFg &amp;&amp; BgOrFg == &quot;FG&quot; )
   {
        myCArray = this.FGArray;
   } 

   var cI = 0;

   this.Size = this.Size ? this.Size : 100;
      
   this.dc2.font = &quot;12px sans-serif&quot;;

   // first quadrant
   this.dc2.fillStyle = myCArray[cI];
   this.dc2.fillRect(this.X0+this.Size, this.Y0, this.Size, this.Size);
   this.dc2.fillText(myCArray[cI], this.X0+this.Size, this.Y0);
   
   // second quadrant
   this.dc2.fillStyle = myCArray[++cI];
   this.dc2.fillRect(this.X0, this.Y0, this.Size, this.Size);
   this.dc2.fillText(myCArray[cI], this.X0, this.Y0);

   // third quadrant
   this.dc2.fillStyle = myCArray[++cI];
   this.dc2.fillRect(this.X0, this.Y0+this.Size, this.Size, this.Size);
   this.dc2.fillText(myCArray[cI], this.X0, this.Y0+this.Size);

   // fourth quadrant
   this.dc2.fillStyle = myCArray[++cI];
   this.dc2.fillRect(this.X0 + this.Size, this.Y0+this.Size, 
                                        this.Size, this.Size);
   this.dc2.fillText(myCArray[cI], this.X0 + this.Size, this.Y0+this.Size);

}    //  SlPalette.prototype.DrawPalette = function()

SlPalette.prototype.DrawRotated = function( myBigSize, mySmallSize, 
                                          mySeparation, BgOrFg, pTitle )
{
    var bigSize   = 100;
    if (myBigSize) bigSize = myBigSize
    ;
    var smallSize = 50;
    if (mySmallSize) SmallSize = mySmallSize
    ;
    var myDelta   = 10;
    if (mySeparation &gt;= 0) myDelta = mySeparation
    ;

    var arrayTR = this.FGArray;
    if (BgOrFg &amp;&amp; BgOrFg.indexOf(&quot;BG&quot;)&gt;=0)
    {
        arrayTR = this.BGArray;
    }

    // First 
    var myX =  this.X0 ? this.X0 : 0; 
    var myY =  this.Y0 ? this.Y0 : 0;

    this.DrawPalette(&quot;BG&quot;);
    this.InitOriginSize(myX+smallSize, myY+smallSize, smallSize);
    this.DrawPalette(&quot;FG&quot;);

    arrayTR.push(arrayTR.shift());
    
    //  Second
    myX += bigSize*2 + myDelta;
    this.InitOriginSize(myX, myY, bigSize);
    this.DrawPalette(&quot;BG&quot;);  
    this.InitOriginSize(myX+smallSize, myY+smallSize, smallSize);
    this.DrawPalette(&quot;FG&quot;);

    arrayTR.push(arrayTR.shift());

    // Third
    myX += bigSize*2 + myDelta;
    this.InitOriginSize(myX, myY, bigSize);
    this.DrawPalette(&quot;BG&quot;);  
    this.InitOriginSize(myX+smallSize, myY+smallSize, smallSize);
    this.DrawPalette(&quot;FG&quot;);

    arrayTR.push(arrayTR.shift());

    // Fourth   
    myX += bigSize*2 + myDelta;
    this.InitOriginSize(myX, myY, bigSize);
    this.DrawPalette(&quot;BG&quot;); 
    this.InitOriginSize(myX+smallSize, myY+smallSize, smallSize);
    this.DrawPalette(&quot;FG&quot;);

    // move first item to last once more to restore the original order
    arrayTR.push(arrayTR.shift());

}    //  SlPalette.prototype.DrawRotated = function(...)

SlPalette.prototype.DrawFullPalette = function()
{
    //  If the textarea is ready, read it else read from the arrays:
    if ( ($('#CPTextArea').val()).trim() )
    {
        ReadTextareaToPaletteArrays();
    } else {
        FillTextAreaFromArrays();
    }

    // Save the color palette text before we mutate the arrays - though
    // though we don't mutate the original array
    this.myText = &quot;&quot;;
    var myTmp = this.BGArrayNow;
    if (!store.tiddlerExists(&quot;ColorPalette&quot;))
    {
        alert(&quot;No ColorPalette Tiddler found - bailing out!&quot;);
        this.myText = &quot;Palette Could not be generated!&quot;;
    } else {
        // Create the text:
        this.myText = store.getTiddlerText(&quot;ColorPalette&quot;);
        this.myText = this.myText.replace(/\bPrimaryA:[^\n]+\n/,   &quot;PrimaryA:     &quot; + myTmp[0] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bPrimaryB:([^\n]+)\n/, &quot;PrimaryB:     &quot; + myTmp[1] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bPrimaryC:([^\n]+)\n/, &quot;PrimaryC:     &quot; + myTmp[2] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bPrimaryD:([^\n]+)\n/, &quot;PrimaryD:     &quot; + myTmp[3] + &quot;\n&quot;);

        myTmp  = P1.FGArrayLight;
        this.myText = this.myText.replace(/\bSecondaryA:([^\n]+)\n/, &quot;SecondaryA:   &quot; + myTmp[0] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bSecondaryB:([^\n]+)\n/, &quot;SecondaryB:   &quot; + myTmp[1] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bSecondaryC:([^\n]+)\n/, &quot;SecondaryC:   &quot; + myTmp[2] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bSecondaryD:([^\n]+)\n/, &quot;SecondaryD:   &quot; + myTmp[3] + &quot;\n&quot;);

        myTmp = P1.FGArrayDark;
        this.myText = this.myText.replace(/\bTertiaryA:([^\n]+)\n/, &quot;TertiaryA:    &quot; + myTmp[0] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bTertiaryB:([^\n]+)\n/, &quot;TertiaryB:    &quot; + myTmp[1] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bTertiaryC:([^\n]+)\n/, &quot;TertiaryC:    &quot; + myTmp[2] + &quot;\n&quot;);
        this.myText = this.myText.replace(/\bTertiaryD:([^\n]+)\n/, &quot;TertiaryD:    &quot; + myTmp[3] + &quot;\n&quot;);
    }    //if (!store.tiddlerExists(&quot;ColorPalette&quot;)) ... else ...
  
    // FGLight on BG
    this.BGArray = this.BGArrayNow;
    this.FGArray = this.FGArrayLight;

    var locX = 0; var locY = 20;
    this.InitOriginSize(locX, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Secondary on Primary&quot;, this.X0, this.Y0);
    locY += 10;
    this.InitOriginSize(locX, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;, &quot;Secondary on Primary&quot;);

    this.BGArray = this.BGArrayNow;
    this.FGArray = this.FGArrayDark;

    locY += 210;
    this.InitOriginSize(0, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Tertiary on Primary&quot;, this.X0, this.Y0+20);
    locY += 30;
    this.InitOriginSize(0, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;);

    this.BGArray = this.FGArrayDark;
    this.FGArray = this.FGArrayLight;

    locY += 210;
    this.InitOriginSize(0, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Secondary on Tertiary&quot;, this.X0, this.Y0+20);
    locY += 30;
    this.InitOriginSize(0, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;);

    this.BGArray = this.FGArrayDark;
    this.FGArray = this.BGArrayNow;

    locY += 210;
    this.InitOriginSize(0, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Primary on Tertiary&quot;, this.X0, this.Y0+20);
    locY += 30;
    this.InitOriginSize(0, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;);

    this.BGArray = this.FGArrayLight;
    this.FGArray = this.FGArrayDark;

    locY += 210;
    this.InitOriginSize(0, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Tertiary on Secondary&quot;, this.X0, this.Y0+20);
    locY += 30;
    this.InitOriginSize(0, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;);

    this.BGArray = this.FGArrayLight;
    this.FGArray = this.BGArrayNow;
    locY += 210;
    this.InitOriginSize(0, locY, 100);
    this.dc2.font = &quot;22px sans-serif&quot;;
    this.dc2.fillText(&quot;Primary on Secondary&quot;, this.X0, this.Y0+20);
    locY += 30;
    this.InitOriginSize(0, locY, 100);
    this.DrawRotated(100, 50, 0, &quot;FG&quot;);   

    gdeDisplayPaletteButtonCB();

}    //  SlPalette.prototype.DrawFullPalette()

SlPalette.prototype.ListColors = function()
{
    return this.myText;

}    //  SlPalette.prototype.ListColors = function()

    CreateGUIElements();

    var myCanvas = document.createElement('canvas');
    var myDiv = createTiddlyElement(place,'div','myDiv');
    myDiv.appendChild(myCanvas);

    var myP = new SlPalette(100);
    P1 = myP;
    myP.InitCanvas(myCanvas);
    
    ReadExistingPalette(&quot;ColorPalette&quot;);
    myP.DrawFullPalette();
     
&lt;/script&gt;

</pre>
</div>
<div title="2015-10-10" modifier="YourName" created="201510110631" tags="2015-10 Note journal aaTag dayHeader tag excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>@@color:#B106FF;font-size:1.0em; Saturday  23:31 @@</pre>
</div>
<div title="AnnotationsPlugin" modifier="Shankar" created="200909161602" modified="200909161603" tags="systemConfig mySystem excluseSearch excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|AnnotationsPlugin|
|''Description:''|Inline annotations for tiddler text.|
|''Author:''|Saq Imtiaz ( lewcid@gmail.com )|
|''Source:''|http://tw.lewcid.org/#AnnotationsPlugin|
|''Code Repository:''|http://tw.lewcid.org/svn/plugins|
|''Version:''|2.0|
|''Date:''||
|''License:''|[[Creative Commons Attribution-ShareAlike 3.0 License|http://creativecommons.org/licenses/by-sa/3.0/]]|
|''~CoreVersion:''|2.2.3|

!!Usage:
*{{{((text to annotate(annotation goes here)}}}
* To include the text being annotated, in the popup as a title, put {{{^}}} as the first letter of the annotation text.
** {{{((text to annotate(^annotation goes here)}}}

!!Examples:
Mouse over, the text below:
* ((banana(the best fruit in the world)))
* ((banana(^ the best fruit in the world)))

***/
// /%
config.formatters.unshift({name:&quot;annotations&quot;,match:&quot;\\(\\(&quot;,lookaheadRegExp:/\(\((.*?)\((\^?)((?:.|\n)*?)\)\)\)/g,handler:function(w){
this.lookaheadRegExp.lastIndex=w.matchStart;
var _2=this.lookaheadRegExp.exec(w.source);
if(_2&amp;&amp;_2.index==w.matchStart){
var _3=createTiddlyElement(w.output,&quot;span&quot;,null,&quot;annosub&quot;,_2[1]);
_3.anno=_2[3];
if(_2[2]){
_3.subject=_2[1];
}
_3.onmouseover=this.onmouseover;
_3.onmouseout=this.onmouseout;
_3.ondblclick=this.onmouseout;
w.nextMatch=_2.index+_2[0].length;
}
},onmouseover:function(e){
popup=createTiddlyElement(document.body,&quot;div&quot;,null,&quot;anno&quot;);
this.popup=popup;
if(this.subject){
wikify(&quot;!&quot;+this.subject+&quot;\n&quot;,popup);
}
wikify(this.anno,popup);
addClass(this,&quot;annosubover&quot;);
Popup.place(this,popup,{x:25,y:7});
},onmouseout:function(e){
removeNode(this.popup);
this.popup=null;
removeClass(this,&quot;annosubover&quot;);
}});
setStylesheet(&quot;.anno{position:absolute;border:2px solid #000;background-color:#DFDFFF; color:#000;padding:0.5em;max-width:15em;width:expression(document.body.clientWidth &gt; (255/12) *parseInt(document.body.currentStyle.fontSize)?'15em':'auto' );}\n&quot;+&quot;.anno h1, .anno h2{margin-top:0;color:#000;}\n&quot;+&quot;.annosub{background:#ccc;}\n&quot;+&quot;.annosubover{z-index:25; background-color:#DFDFFF;cursor:help;}\n&quot;,&quot;AnnotationStyles&quot;);


// %/</pre>
</div>
<div title="AttachFileMIMETypes" modifier="YourName" created="200909150321" modified="200909150415" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>text/plain
.txt .text .js .vbs .asp .cgi .pl
----
text/html
.htm .html .hta .htx .mht
----
text/comma-separated-values
.csv
----
text/javascript
.js
----
text/css
.css
----
text/xml
.xml .xsl .xslt
----
image/gif
.gif
----
image/jpeg
.jpg .jpe .jpeg
----
image/png
.png
----
image/bmp
.bmp
----
image/tiff
.tif .tiff
----
audio/basic
.au .snd
----
audio/wav
.wav
----
audio/x-pn-realaudio
.ra .rm .ram
----
audio/x-midi
.mid .midi
----
audio/mp3
.mp3
----
audio/m3u
.m3u
----
video/x-ms-asf
.asf
----
video/avi
.avi
----
video/mpeg
.mpg .mpeg
----
video/quicktime
.qt .mov .qtvr
----
application/pdf
.pdf
----
application/rtf
.rtf
----
application/postscript
.ai .eps .ps
----
application/wordperfect
.wpd
----
application/mswrite
.wri
----
application/msexcel
.xls .xls3 .xls4 .xls5 .xlw
----
application/msword
.doc
----
application/mspowerpoint
.ppt .pps
----
application/x-director
.swa
----
application/x-shockwave-flash
.swf
----
application/x-zip-compressed
.zip
----
application/x-gzip
.gz
----
application/x-rar-compressed
.rar
----
application/octet-stream
.com .exe .dll .ocx
----
application/java-archive
.jar</pre>
</div>
<div title="AttachFilePlugin" modifier="Shankar" created="200512271908" modified="200909150410" tags="AttachFilePackage IconPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|AttachFilePlugin|
|Source|http://www.TiddlyTools.com/#AttachFilePlugin|
|Documentation|http://www.TiddlyTools.com/#AttachFilePluginInfo|
|Version|3.9.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires|AttachFilePluginFormatters, AttachFileMIMETypes|
|Overrides||
|Description|Store binary files as base64-encoded tiddlers with fallback links for separate local and/or remote file storage|
Store or link binary files (such as jpg, gif, pdf or even mp3) within your TiddlyWiki document and then use them as images or links from within your tiddler content.
&gt; Important note: As of version 3.6.0, in order to //render// images and other binary attachments created with this plugin, you must also install [[AttachFilePluginFormatters]], which extends the behavior of the TiddlyWiki core formatters for embedded images ({{{[img[tooltip|image]]}}}), linked embedded images ({{{[img[tooltip|image][link]]}}}), and external/&quot;pretty&quot; links ({{{[[label|link]]}}}), so that these formatter will process references to attachment tiddlers as if a normal file reference had been provided. |
!!!!!Documentation
&gt;see [[AttachFilePluginInfo]]
!!!!!Inline interface (live)
&gt;see [[AttachFile]] (shadow tiddler)
&gt;&lt;&lt;tiddler AttachFile&gt;&gt;
!!!!!Revisions
&lt;&lt;&lt;
2008.07.21 [3.9.0] Fixup for FireFox 3: use HTML with separate text+button control instead of type='file' control
|please see [[AttachFilePluginInfo]] for additional revision details|
2005.07.20 [1.0.0] Initial Release
&lt;&lt;&lt;
!!!!!Code
***/
// // version
//{{{
version.extensions.AttachFilePlugin= {major: 3, minor: 9, revision: 0, date: new Date(2008,7,21)};

// shadow tiddler
config.shadowTiddlers.AttachFile=&quot;&lt;&lt;attach inline&gt;&gt;&quot;;

// add 'attach' backstage task (insert before built-in 'importTask')
if (config.tasks) { // for TW2.2b or above
	config.tasks.attachTask = {
		text: &quot;attach&quot;,
		tooltip: &quot;Attach a binary file as a tiddler&quot;,
		content: &quot;&lt;&lt;attach inline&gt;&gt;&quot;
	}
	config.backstageTasks.splice(config.backstageTasks.indexOf(&quot;importTask&quot;),0,&quot;attachTask&quot;);
}

config.macros.attach = {
// // lingo
//{{{
	label: &quot;attach file&quot;,
	tooltip: &quot;Attach a file to this document&quot;,
	linkTooltip: &quot;Attachment: &quot;,

	typeList: &quot;AttachFileMIMETypes&quot;,

	titlePrompt: &quot; enter tiddler title...&quot;,
	MIMEPrompt: &quot;&lt;option value=''&gt;select MIME type...&lt;/option&gt;&lt;option value='editlist'&gt;[edit list...]&lt;/option&gt;&quot;,
	localPrompt: &quot; enter local path/filename...&quot;,
	URLPrompt: &quot; enter remote URL...&quot;,

	tiddlerErr: &quot;Please enter a tiddler title&quot;,
	sourceErr: &quot;Please enter a source path/filename&quot;,
	storageErr: &quot;Please select a storage method: embedded, local or remote&quot;,
	MIMEErr: &quot;Unrecognized file format.  Please select a MIME type&quot;,
	localErr: &quot;Please enter a local path/filename&quot;,
	URLErr: &quot;Please enter a remote URL&quot;,
	fileErr: &quot;Invalid path/file or file not found&quot;,

	sourceReport: &quot;| source file:|{{{%0}}}|\n&quot;,
	nosourceReport: &quot;| source file:|//none//|\n&quot;,
	dateReport: &quot;| attached on:|%0 by %1|\n&quot;,
	notesReport: &quot;| description:|%0|\n&quot;,
	dataReport: &quot;| embedded:|[[%0|%0]] - {{{type=%1, size=%2 bytes, encoded=%3 bytes}}}|\n&quot;,
	nodataReport: &quot;| embedded:|//none//|\n&quot;,
	localReport: &quot;| local file:|/%LOCAL_LINK%/[[%0|%1]]|\n&quot;,
	nolocalReport: &quot;| local file:|//none//|\n&quot;,
	URLReport: &quot;| remote link:|/%REMOTE_LINK%/[[%0|%0]]|\n&quot;,
	noURLReport: &quot;| remote link:|//none//|\n&quot;,

	imageReport: &quot;image\n&lt;&lt;&lt;\nusage: {{{[img[tooltip|%0]] or [img[tooltip|%0][link]]}}}\n[img[tooltip|%0]]\n&lt;&lt;&lt;\n&quot;,
	dataBlock: &quot;\n/% DO NOT EDIT BELOW THIS POINT\n---BEGIN_DATA---\n%0;base64,\n%1\n---END_DATA---\n%/&quot;,
//}}}
// // macro definition
//{{{
	handler:
	function(place,macroName,params) {
		if (params &amp;&amp; !params[0]) { createTiddlyButton(place,this.label,this.tooltip,this.toggleAttachPanel); return; }
		var id=params.shift();
		this.createAttachPanel(place,id+&quot;_attachPanel&quot;,params);
		document.getElementById(id+&quot;_attachPanel&quot;).style.position=&quot;static&quot;;
		document.getElementById(id+&quot;_attachPanel&quot;).style.display=&quot;block&quot;;
	},
//}}}
//{{{
	createAttachPanel:
	function(place,panel_id,params) {
		if (!panel_id || !panel_id.length) var panel_id=&quot;_attachPanel&quot;;
		// remove existing panel (if any)
		var panel=document.getElementById(panel_id); if (panel) panel.parentNode.removeChild(panel);
		// set styles for this panel
		setStylesheet(this.css,&quot;attachPanel&quot;);
		// create new panel
		var title=&quot;&quot;; if (params &amp;&amp; params[0]) title=params.shift();
		var types=this.MIMEPrompt+this.formatListOptions(store.getTiddlerText(this.typeList)); // get MIME types
		panel=createTiddlyElement(place,&quot;span&quot;,panel_id,&quot;attachPanel&quot;,null);
		var html=this.html.replace(/%id%/g,panel_id);
		html=html.replace(/%title%/g,title);
		html=html.replace(/%disabled%/g,title.length?&quot;disabled&quot;:&quot;&quot;);
		html=html.replace(/%IEdisabled%/g,config.browser.isIE?&quot;disabled&quot;:&quot;&quot;);
		html=html.replace(/%types%/g,types);
		panel.innerHTML=html;
		if (config.browser.isGecko) { // FF3 FIXUP
			document.getElementById(&quot;attachSource&quot;).style.display=&quot;none&quot;;
			document.getElementById(&quot;attachFixPanel&quot;).style.display=&quot;block&quot;;
		}
		return panel;
	},
//}}}
//{{{
	toggleAttachPanel:
	function (e) {
		if (!e) var e = window.event;
		var parent=resolveTarget(e).parentNode;
		var panel = document.getElementById(&quot;_attachPanel&quot;);
		if (panel==undefined || panel.parentNode!=parent)
			panel=config.macros.attach.createAttachPanel(parent,&quot;_attachPanel&quot;);
		var isOpen = panel.style.display==&quot;block&quot;;
		if(config.options.chkAnimate)
			anim.startAnimating(new Slider(panel,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));
		else
			panel.style.display = isOpen ? &quot;none&quot; : &quot;block&quot; ;
		e.cancelBubble = true;
		if (e.stopPropagation) e.stopPropagation();
		return(false);
	},
//}}}
//{{{
	formatListOptions:
	function(text) {
		if (!text || !text.trim().length) return &quot;&quot;;
		// get MIME list content from text
		var parts=text.split(&quot;\n----\n&quot;);
		var out=&quot;&quot;;
		for (var p=0; p&lt;parts.length; p++) {
			var lines=parts[p].split(&quot;\n&quot;);
			var label=lines.shift(); // 1st line=display text
			var value=lines.shift(); // 2nd line=item value
			out +='&lt;option value=&quot;%1&quot;&gt;%0&lt;/option&gt;'.format([label,value]);
		}
		return out;
	},
//}}}
// // interface definition
//{{{
	css:
	&quot;.attachPanel { display: none; position:absolute; z-index:10; width:35em; right:105%; top:0em;\
		background-color: #eee; color:#000; font-size: 8pt; line-height:110%;\
		border:1px solid black; border-bottom-width: 3px; border-right-width: 3px;\
		padding: 0.5em; margin:0em; -moz-border-radius:1em;-webkit-border-radius:1em; text-align:left }\
	.attachPanel form { display:inline;border:0;padding:0;margin:0; }\
	.attachPanel select { width:99%;margin:0px;font-size:8pt;line-height:110%;}\
	.attachPanel input  { width:98%;padding:0px;margin:0px;font-size:8pt;line-height:110%}\
	.attachPanel textarea { width:98%;margin:0px;height:2em;font-size:8pt;line-height:110%}\
	.attachPanel table { width:100%;border:0;margin:0;padding:0;color:inherit; }\
	.attachPanel tbody, .attachPanel tr, .attachPanel td { border:0;margin:0;padding:0;color:#000; }\
	.attachPanel .box { border:1px solid black; padding:.3em; margin:.3em 0px; background:#f8f8f8; -moz-border-radius:5px;-webkit-border-radius:5px; }\
	.attachPanel .chk { width:auto;border:0; }\
	.attachPanel .btn { width:auto; }\
	.attachPanel .btn2 { width:49%; }\
	&quot;,
//}}}
//{{{
	html:
	'&lt;form&gt;\
		attach from source file\
		&lt;input type=&quot;file&quot; id=&quot;attachSource&quot; name=&quot;source&quot; size=&quot;56&quot;\
			onChange=&quot;config.macros.attach.onChangeSource(this)&quot;&gt;\
		&lt;div id=&quot;attachFixPanel&quot; style=&quot;display:none&quot;&gt;&lt;!-- FF3 FIXUP --&gt;\
			&lt;input type=&quot;text&quot; id=&quot;attachFixSource&quot; style=&quot;width:90%&quot;\
				title=&quot;Enter a path/file to attach&quot;\
				onChange=&quot;config.macros.attach.onChangeSource(this);&quot;&gt;\
			&lt;input type=&quot;button&quot; style=&quot;width:7%&quot; value=&quot;...&quot;\
				title=&quot;Enter a path/file to attach&quot;\
				onClick=&quot;config.macros.attach.askForFilename(document.getElementById(\'attachFixSource\'));&quot;&gt;\
		&lt;/div&gt;&lt;!--end FF3 FIXUP--&gt;\
		&lt;div class=&quot;box&quot;&gt;\
		&lt;table style=&quot;border:0&quot;&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			embed data &lt;input type=checkbox class=chk name=&quot;useData&quot; %IEdisabled% \
				onclick=&quot;if (!this.form.MIMEType.value.length)\
					this.form.MIMEType.selectedIndex=this.checked?1:0; &quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;select size=1 name=&quot;MIMEType&quot; \
				onchange=&quot;this.title=this.value; if (this.value==\'editlist\')\
					{ this.selectedIndex=this.form.useData.checked?1:0; story.displayTiddler(null,config.macros.attach.typeList,2); return; }&quot;&gt;\
				&lt;option value=&quot;&quot;&gt;&lt;/option&gt;\
				%types%\
			&lt;/select&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			local link &lt;input type=checkbox class=chk name=&quot;useLocal&quot;\
				onclick=&quot;this.form.local.value=this.form.local.defaultValue=this.checked?config.macros.attach.localPrompt:\'\';&quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;local&quot; size=15 autocomplete=off value=&quot;&quot;\
				onchange=&quot;this.form.useLocal.checked=this.value.length&quot; \
				onkeyup=&quot;this.form.useLocal.checked=this.value.length&quot; \
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.localPrompt; this.select()&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			remote link &lt;input type=checkbox class=chk name=&quot;useURL&quot;\
				onclick=&quot;this.form.URL.value=this.form.URL.defaultValue=this.checked?config.macros.attach.URLPrompt:\'\';\&quot;&gt;&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;URL&quot; size=15 autocomplete=off value=&quot;&quot;\
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.URLPrompt; this.select()&quot;\
				onchange=&quot;this.form.useURL.checked=this.value.length;&quot;\
				onkeyup=&quot;this.form.useURL.checked=this.value.length;&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\
		&lt;/div&gt;\
		&lt;table style=&quot;border:0&quot;&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			attach as&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot; colspan=2&gt;\
			&lt;input type=text name=&quot;tiddlertitle&quot; size=15 autocomplete=off value=&quot;%title%&quot;\
				onkeyup=&quot;if (!this.value.length) { this.value=config.macros.attach.titlePrompt; this.select(); }&quot;\
				onfocus=&quot;if (!this.value.length) this.value=config.macros.attach.titlePrompt; this.select()&quot; %disabled%&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			description&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot; colspan=2&gt;\
			&lt;input type=text name=&quot;notes&quot; size=15 autocomplete=off&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;tr style=&quot;border:0&quot;&gt;&lt;td style=&quot;border:0;text-align:right;width:1%;white-space:nowrap&quot;&gt;\
			add tags&amp;nbsp;\
		&lt;/td&gt;&lt;td style=&quot;border:0&quot;&gt;\
			&lt;input type=text name=&quot;tags&quot; size=15 autocomplete=off value=&quot;&quot; onfocus=&quot;this.select()&quot;&gt;\
		&lt;/td&gt;&lt;td style=&quot;width:40%;text-align:right;border:0&quot;&gt;\
			&lt;input type=button class=btn2 value=&quot;attach&quot;\
				onclick=&quot;config.macros.attach.onClickAttach(this)&quot;&gt;&lt;!--\
			--&gt;&lt;input type=button class=btn2 value=&quot;close&quot;\
				onclick=&quot;var panel=document.getElementById(\'%id%\'); if (panel) panel.parentNode.removeChild(panel);&quot;&gt;\
		&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;\
	&lt;/form&gt;',
//}}}
// // control processing
//{{{
	onChangeSource:
	function(here) {
		var form=here.form;
		var list=form.MIMEType;
		var theFilename  = here.value;
		var theExtension = theFilename.substr(theFilename.lastIndexOf('.')).toLowerCase();
		// if theFilename is in current document folder, remove path prefix and use relative reference
		var h=document.location.href; folder=getLocalPath(decodeURIComponent(h.substr(0,h.lastIndexOf(&quot;/&quot;)+1)));
		if (theFilename.substr(0,folder.length)==folder) theFilename='./'+theFilename.substr(folder.length);
		else theFilename='file:///'+theFilename; // otherwise, use absolute reference
		theFilename=theFilename.replace(/\\/g,&quot;/&quot;); // fixup: change \ to /
		form.useLocal.checked = true;
		form.local.value = theFilename;
		form.useData.checked = !form.useData.disabled;
		list.selectedIndex=1;
		for (var i=0; i&lt;list.options.length; i++) // find matching MIME type
			if (list.options[i].value.indexOf(theExtension)!=-1) { list.selectedIndex = i; break; }
		if (!form.tiddlertitle.disabled)
			form.tiddlertitle.value=theFilename.substr(theFilename.lastIndexOf('/')+1); // get tiddlername from filename
	},
//}}}
//{{{
	onClickAttach:
	function (here) {
		clearMessage();
		// get input values
		var form=here.form;
		var src=form.source; if (config.browser.isGecko) src=document.getElementById(&quot;attachFixSource&quot;);
		var theDate=(new Date()).formatString(config.macros.timeline.dateFormat);
		var theSource = src.value!=src.defaultValue?src.value:&quot;&quot;;
		var theTitle=form.tiddlertitle.value;
		var theLocal = form.local.value!=form.local.defaultValue?form.local.value:&quot;&quot;;
		var theURL = form.URL.value!=form.URL.defaultValue?form.URL.value:&quot;&quot;;
		var theNotes = form.notes.value;
		var theTags = &quot;attachment excludeMissing &quot;+form.tags.value;
		var useData=form.useData.checked;
		var useLocal=form.useLocal.checked;
		var useURL=form.useURL.checked;
		var theMIMEType = form.MIMEType.value.length?form.MIMEType.options[form.MIMEType.selectedIndex].text:&quot;&quot;;
		// validate checkboxes and get filename
		if (useData) {
			if (theSource.length) { if (!theLocation) var theLocation=theSource; }
			else { alert(this.sourceErr); src.focus(); return false; }
		}
		if (useLocal) {
			if (theLocal.length) { if (!theLocation) var theLocation = theLocal; }
			else { alert(this.localErr); form.local.focus(); return false; }
		}
		if (useURL) {
			if (theURL.length) { if (!theLocation) var theLocation = theURL; }
			else { alert(this.URLErr); form.URL.focus(); return false; }
		}
		if (!(useData||useLocal||useURL))
			{ form.useData.focus(); alert(this.storageErr); return false; }
		if (!theLocation)
			{ src.focus(); alert(this.sourceErr); return false; }
		if (!theTitle || !theTitle.trim().length || theTitle==this.titlePrompt)
			{ form.tiddlertitle.focus(); alert(this.tiddlerErr); return false; }
		// if not already selected, determine MIME type based on filename extension (if any)
		if (useData &amp;&amp; !theMIMEType.length &amp;&amp; theLocation.lastIndexOf('.')!=-1) {
			var theExt = theLocation.substr(theLocation.lastIndexOf('.')).toLowerCase();
			var theList=form.MIMEType;
			for (var i=0; i&lt;theList.options.length; i++)
				if (theList.options[i].value.indexOf(theExt)!=-1)
					{ var theMIMEType=theList.options[i].text; theList.selectedIndex=i; break; }
		}
		// attach the file
		return this.createAttachmentTiddler(theSource, theDate, theNotes, theTags, theTitle,
			useData, useLocal, useURL, theLocal, theURL, theMIMEType);
	},
	getMIMEType:
	function(src,def) {
		var ext = src.substr(src.lastIndexOf('.')).toLowerCase();
		var list=store.getTiddlerText(this.typeList);
		if (!list || !list.trim().length) return def;
		// get MIME list content from tiddler
		var parts=list.split(&quot;\n----\n&quot;);
		for (var p=0; p&lt;parts.length; p++) {
			var lines=parts[p].split(&quot;\n&quot;);
			var mime=lines.shift(); // 1st line=MIME type
			var match=lines.shift(); // 2nd line=matching extensions
			if (match.indexOf(ext)!=-1) return mime;
		}
		return def;
	},
	createAttachmentTiddler:
	function (theSource, theDate, theNotes, theTags, theTitle,
		useData, useLocal, useURL, theLocal, theURL, theMIMEType, noshow) {
		// encode the data
		if (useData) {
			if (!theMIMEType.length) {
				alert(this.MIMEErr);
				form.MIMEType.selectedIndex=1; form.MIMEType.focus();
				return false;
			}
			var theData = this.readFile(theSource); if (!theData) { return false; }
			displayMessage('encoding '+theSource);
			var theEncoded = this.encodeBase64(theData);
			displayMessage('file size='+theData.length+' bytes, encoded size='+theEncoded.length+' bytes');
		}
		// generate tiddler and refresh
		var theText = &quot;&quot;;
		theText +=theSource.length?this.sourceReport.format([theSource]):this.nosourceReport;
		theText +=this.dateReport.format([theDate,config.options.txtUserName]);
		theText +=theNotes.length?this.notesReport.format([theNotes]):&quot;&quot;;
		theText +=useData?this.dataReport.format([theTitle,theMIMEType,theData.length,theEncoded.length]):this.nodataReport;
		theText +=useLocal?this.localReport.format([theLocal,theLocal.replace(/\\/g,&quot;/&quot;)]):this.nolocalReport;
		theText +=useURL?this.URLReport.format([theURL]):this.noURLReport;
		theText +=(theMIMEType.substr(0,5)==&quot;image&quot;)?this.imageReport.format([theTitle]):&quot;&quot;;
		theText +=useData?this.dataBlock.format([theMIMEType,theEncoded]):&quot;&quot;;
		store.saveTiddler(theTitle,theTitle,theText,config.options.txtUserName,new Date(),theTags);
		var panel=document.getElementById(&quot;attachPanel&quot;); if (panel) panel.style.display=&quot;none&quot;;
		if (!noshow) { story.displayTiddler(null,theTitle); story.refreshTiddler(theTitle,null,true); }
		displayMessage('attached &quot;'+theTitle+'&quot;');
		return true;
	},
//}}}
// // base64 conversion
//{{{
	encodeBase64:
	function (theData) {
		if (!theData) return null;
		// encode as base64
		var keyStr = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=&quot;;
		var out=&quot;&quot;;
		var chr1,chr2,chr3=&quot;&quot;;
		var enc1,enc2,enc3,enc4=&quot;&quot;;
		for (var count=0,i=0; i&lt;theData.length; ) {
			chr1=theData.charCodeAt(i++);
			chr2=theData.charCodeAt(i++);
			chr3=theData.charCodeAt(i++);
			enc1=chr1 &gt;&gt; 2;
			enc2=((chr1 &amp; 3) &lt;&lt; 4) | (chr2 &gt;&gt; 4);
			enc3=((chr2 &amp; 15) &lt;&lt; 2) | (chr3 &gt;&gt; 6);
			enc4=chr3 &amp; 63;
			if (isNaN(chr2)) enc3=enc4=64;
			else if (isNaN(chr3)) enc4=64;
			out+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);
			chr1=chr2=chr3=enc1=enc2=enc3=enc4=&quot;&quot;;
			count+=4; if (count&gt;60) { out+='\n'; count=0; } // add line break every 60 chars for readability
		}
		return out;
	},
	decodeBase64: function(input) {
		var out=&quot;&quot;;
		var chr1,chr2,chr3;
		var enc1,enc2,enc3,enc4;
		var i = 0;
		// remove all characters that are not A-Z, a-z, 0-9, +, /, or =
		input=input.replace(/[^A-Za-z0-9\+\/\=]/g, &quot;&quot;);
		do {
			enc1=keyStr.indexOf(input.charAt(i++));
			enc2=keyStr.indexOf(input.charAt(i++));
			enc3=keyStr.indexOf(input.charAt(i++));
			enc4=keyStr.indexOf(input.charAt(i++));
			chr1=(enc1 &lt;&lt; 2) | (enc2 &gt;&gt; 4);
			chr2=((enc2 &amp; 15) &lt;&lt; 4) | (enc3 &gt;&gt; 2);
			chr3=((enc3 &amp; 3) &lt;&lt; 6) | enc4;
			out=out+String.fromCharCode(chr1);
			if (enc3!=64) out=out+String.fromCharCode(chr2);
			if (enc4!=64) out=out+String.fromCharCode(chr3);
		} while (i&lt;input.length);
		return out;
	},
//}}}
// // I/O functions
//{{{
	readFile: // read local BINARY file data
	function(filePath) {
		if(!window.Components) { return null; }
		try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
		catch(e) { alert(&quot;access denied: &quot;+filePath); return null; }
		var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
		try { file.initWithPath(filePath); } catch(e) { alert(&quot;cannot read file - invalid path: &quot;+filePath); return null; }
		if (!file.exists()) { alert(&quot;cannot read file - not found: &quot;+filePath); return null; }
		var inputStream = Components.classes[&quot;@mozilla.org/network/file-input-stream;1&quot;].createInstance(Components.interfaces.nsIFileInputStream);
		inputStream.init(file, 0x01, 00004, null);
		var bInputStream = Components.classes[&quot;@mozilla.org/binaryinputstream;1&quot;].createInstance(Components.interfaces.nsIBinaryInputStream);
		bInputStream.setInputStream(inputStream);
		return(bInputStream.readBytes(inputStream.available()));
	},
//}}}
//{{{
	writeFile:
	function(filepath,data) {
		// TBD: decode base64 and write BINARY data to specified local path/filename
		return(false);
	},
//}}}
//{{{
	askForFilename: // for FF3 fixup
	function(target) {
		var msg=config.messages.selectFile;
		if (target &amp;&amp; target.title) msg=target.title; // use target field tooltip (if any) as dialog prompt text
		// get local path for current document
		var path=getLocalPath(document.location.href);
		var p=path.lastIndexOf(&quot;/&quot;); if (p==-1) p=path.lastIndexOf(&quot;\\&quot;); // Unix or Windows
		if (p!=-1) path=path.substr(0,p+1); // remove filename, leave trailing slash
		var file=&quot;&quot;
		var result=window.mozAskForFilename(msg,path,file,true); // FF3 FIXUP ONLY
		if (target &amp;&amp; result.length) // set target field and trigger handling
			{ target.value=result; target.onchange(); }
		return result; 
	}
};
//}}}
//{{{
if (window.mozAskForFilename===undefined) { // also defined by CoreTweaks (for ticket #604)
	window.mozAskForFilename=function(msg,path,file,mustExist) {
		if(!window.Components) return false;
		try {
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var nsIFilePicker = window.Components.interfaces.nsIFilePicker;
			var picker = Components.classes['@mozilla.org/filepicker;1'].createInstance(nsIFilePicker);
			picker.init(window, msg, mustExist?nsIFilePicker.modeOpen:nsIFilePicker.modeSave);
			var thispath = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
			thispath.initWithPath(path);
			picker.displayDirectory=thispath;
			picker.defaultExtension='';
			picker.defaultString=file;
			picker.appendFilters(nsIFilePicker.filterAll|nsIFilePicker.filterText|nsIFilePicker.filterHTML);
			if (picker.show()!=nsIFilePicker.returnCancel)
				var result=picker.file.persistentDescriptor;
		}
		catch(ex) { displayMessage(ex.toString()); }
		return result;
	}
}
//}}}</pre>
</div>
<div title="AttachFilePluginFormatters" modifier="Shankar" created="200909150320" modified="200909150409" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|AttachFilePluginFormatters|
|Source|http://www.TiddlyTools.com/#AttachFilePluginFormatters|
|Version|3.7.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1.3|
|Type|plugin|
|Requires||
|Overrides|'image' and 'prettyLink' formatters, TiddlyWiki.prototype.getRecursiveTiddlerText|
|Description|run-time library for displaying attachment tiddlers|

This plugin provides &quot;stand-alone&quot; processing for //rendering// attachment tiddlers created by [[AttachFilePlugin]].   Attachment tiddlers are tagged with&lt;&lt;tag attachment&gt;&gt;and contain binary file content (e.g., jpg, gif, pdf, mp3, etc.) that has been stored directly as base64 text-encoded data or can be loaded from external files stored on a local filesystem or remote web server.

NOTE: This plugin does not include the &quot;control panel&quot; and supporting functions needed to //create// new attachment tiddlers.  Those features are provided by [[AttachFilePlugin]], which can be installed while building your document, and then safely omitted to reduce the overall file size when you publish your finished document (assuming you don't intend to create any additional attachment tiddlers in that document)
!!!!!Formatters
&lt;&lt;&lt;
This plugin extends the behavior of the following TiddlyWiki core &quot;wikify()&quot; formatters:
* embedded images: {{{[img[tooltip|image]]}}}
* linked embedded images: {{{[img[tooltip|image][link]]}}}
* external/&quot;pretty&quot; links: {{{[[label|link]]}}}

''Please refer to AttachFilePlugin (source: http://www.TiddlyTools.com/#AttachFilePlugin) for additional information.''
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2007.12.04 [*.*.*] update for TW2.3.0: replaced deprecated core functions, regexps, and macros
2007.10.29 [3.7.0] more code reduction: removed upload handling from AttachFilePlugin (saves ~7K!)
2007.10.28 [3.6.0] removed duplicate formatter code from AttachFilePlugin (saves ~10K!) and updated documentation accordingly.  This plugin ([[AttachFilePluginFormatters]]) is now //''required''// in order to display attached images/binary files within tiddler content.
2006.05.20 [3.4.0] through 2007.03.01 [3.5.3] sync with AttachFilePlugin
2006.05.13 [3.2.0] created from AttachFilePlugin v3.2.0
&lt;&lt;&lt;
!!!!!Code
***/
// // version
//{{{
version.extensions.AttachFilePluginFormatters= {major: 3, minor: 7, revision: 0, date: new Date(2007,10,28)};
//}}}

//{{{
if (config.macros.attach==undefined) config.macros.attach= { };
//}}}
//{{{
if (config.macros.attach.isAttachment==undefined) config.macros.attach.isAttachment=function (title) {
	var tiddler = store.getTiddler(title);
	if (tiddler==undefined || tiddler.tags==undefined) return false;
	return (tiddler.tags.indexOf(&quot;attachment&quot;)!=-1);
}
//}}}

//{{{
// test for local file existence
// Returns true/false without visible error display
// Uses Components for FF and ActiveX FSO object for MSIE
if (config.macros.attach.fileExists==undefined) config.macros.attach.fileExists=function(theFile) {
	var found=false;
	// DEBUG: alert('testing fileExists('+theFile+')...');
	if(window.Components) {
		try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
		catch(e) { return false; } // security access denied
		var file = Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
		try { file.initWithPath(theFile); }
		catch(e) { return false; } // invalid directory
		found = file.exists();
	}
	else { // use ActiveX FSO object for MSIE 
		var fso = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
		found = fso.FileExists(theFile)
	}
	// DEBUG: alert(theFile+&quot; &quot;+(found?&quot;exists&quot;:&quot;not found&quot;));
	return found;
}
//}}}

//{{{
if (config.macros.attach.getAttachment==undefined) config.macros.attach.getAttachment=function(title) {

	// extract embedded data, local and remote links (if any)
	var startmarker=&quot;---BEGIN_DATA---\n&quot;;
	var endmarker=&quot;\n---END_DATA---&quot;;
	var pos=0; var endpos=0;
	var text = store.getTiddlerText(title);
	var embedded=&quot;&quot;;
	var locallink=&quot;&quot;;
	var remotelink=&quot;&quot;;

	// look for embedded data, convert to data: URI
	if ((pos=text.indexOf(startmarker))!=-1 &amp;&amp; (endpos=text.indexOf(endmarker))!=-1)
		embedded=&quot;data:&quot;+(text.substring(pos+startmarker.length,endpos)).replace(/\n/g,'');
	if (embedded.length &amp;&amp; !config.browser.isIE)
		return embedded; // use embedded data if any... except for IE, which doesn't support data URI

	// no embedded data... fallback to local/remote reference links...

	// look for 'attachment link markers'
	if ((pos=text.indexOf(&quot;/%LOCAL_LINK%/&quot;))!=-1)
		locallink=text.substring(text.indexOf(&quot;|&quot;,pos)+1,text.indexOf(&quot;]]&quot;,pos));
	if ((pos=text.indexOf(&quot;/%REMOTE_LINK%/&quot;))!=-1)
		remotelink=text.substring(text.indexOf(&quot;|&quot;,pos)+1,text.indexOf(&quot;]]&quot;,pos));

	// document is being served remotely... use remote URL (if any)  (avoids security alert)
	if (remotelink.length &amp;&amp; document.location.protocol!=&quot;file:&quot;)
		return remotelink;  

	// local link only... return link without checking file existence (avoids security alert)
	if (locallink.length &amp;&amp; !remotelink.length) 
		return locallink; 

	// local link, check for file exist... use local link if found
	if (locallink.length) { 
		if (this.fileExists(getLocalPath(locallink))) return locallink;
		// maybe local link is relative... add path from current document and try again
		var pathPrefix=document.location.href;  // get current document path and trim off filename
		var slashpos=pathPrefix.lastIndexOf(&quot;/&quot;); if (slashpos==-1) slashpos=pathPrefix.lastIndexOf(&quot;\\&quot;); 
		if (slashpos!=-1 &amp;&amp; slashpos!=pathPrefix.length-1) pathPrefix=pathPrefix.substr(0,slashpos+1);
		if (this.fileExists(getLocalPath(pathPrefix+locallink))) return locallink;
	}

	// no embedded data, no local (or not found), fallback to remote URL (if any)
	if (remotelink.length) 
		return remotelink;

	return &quot;&quot;; // attachment URL doesn't resolve
}
//}}}
//{{{
if (config.macros.attach.init_formatters==undefined) config.macros.attach.init_formatters=function() {
	if (this.initialized) return;
	// find the formatter for &quot;image&quot; and replace the handler
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;image&quot;; i++);
	if (i&lt;config.formatters.length)	config.formatters[i].handler=function(w) {
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) // Simple bracketted link
			{
			var e = w.output;
			if(lookaheadMatch[5])
				{
				var link = lookaheadMatch[5];
				// ELS -------------
				var external=config.formatterHelpers.isExternalLink(link);
				if (external)
					{
					if (config.macros.attach.isAttachment(link))
						{
						e = createExternalLink(w.output,link);
						e.href=config.macros.attach.getAttachment(link);
						e.title = config.macros.attach.linkTooltip + link;
						}
					else
						e = createExternalLink(w.output,link);
					}
				else 
					e = createTiddlyLink(w.output,link,false,null,w.isStatic);
				// ELS -------------
				addClass(e,&quot;imageLink&quot;);
				}
			var img = createTiddlyElement(e,&quot;img&quot;);
			if(lookaheadMatch[1])
				img.align = &quot;left&quot;;
			else if(lookaheadMatch[2])
				img.align = &quot;right&quot;;
			if(lookaheadMatch[3])
				img.title = lookaheadMatch[3];
			img.src = lookaheadMatch[4];
			// ELS -------------
			if (config.macros.attach.isAttachment(lookaheadMatch[4]))
				img.src=config.macros.attach.getAttachment(lookaheadMatch[4]);
			// ELS -------------
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
//}}}
//{{{
	// find the formatter for &quot;prettyLink&quot; and replace the handler
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;prettyLink&quot;; i++);
	if (i&lt;config.formatters.length)	{
		config.formatters[i].handler=function(w) {
			this.lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
				var e;
				var text = lookaheadMatch[1];
				if(lookaheadMatch[3]) {
					// Pretty bracketted link
					var link = lookaheadMatch[3];
					if (config.macros.attach.isAttachment(link)) {
						e = createExternalLink(w.output,link);
						e.href=config.macros.attach.getAttachment(link);
						e.title=config.macros.attach.linkTooltip+link;
					}
					else e = (!lookaheadMatch[2] &amp;&amp; config.formatterHelpers.isExternalLink(link))
						? createExternalLink(w.output,link)
						: createTiddlyLink(w.output,link,false,null,w.isStatic);
				} else {
					e = createTiddlyLink(w.output,text,false,null,w.isStatic);
				}
				createTiddlyText(e,text);
				w.nextMatch = this.lookaheadRegExp.lastIndex;
			}
		}
	} // if &quot;prettyLink&quot; formatter found
	this.initialized=true;
}
//}}}
//{{{
config.macros.attach.init_formatters(); // load time init
//}}}
//{{{
if (TiddlyWiki.prototype.coreGetRecursiveTiddlerText==undefined) {
	TiddlyWiki.prototype.coreGetRecursiveTiddlerText = TiddlyWiki.prototype.getRecursiveTiddlerText;
	TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth) {
		return config.macros.attach.isAttachment(title)?
			config.macros.attach.getAttachment(title):this.coreGetRecursiveTiddlerText.apply(this,arguments);
	}
}
//}}}</pre>
</div>
<div title="CSS" modifier="YourName" created="200906020946" modified="200909151253" tags="closed mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>@@color:#ffc;''&amp;raquo; &amp;raquo;'' @@   Tabs containing CSS styling code (controls layout and visual style)
----
&lt;script&gt;
// get all tiddlers tagged with &quot;CSS&quot;
var tids=store.getTaggedTiddlers(&quot;CSS&quot;);
// keep only tiddlers *also* tagged with New
var list=[];
for (var t=0; t&lt;tids.length; t++)
   if (tids[t].isTagged(&quot;CSS&quot;)) list.push(tids[t]);
// create output list of tiddler titles, one per line
var out=&quot;&quot;;
for (var t=0; t&lt;list.length; t++) out+=&quot;#[[&quot;+list[t].title+&quot;]]\n&quot;;
return out;
&lt;/script&gt; </pre>
</div>
<div title="Calendar" modifier="shankar " created="200911012015" modified="200911111320" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tiddler HideTiddlerTags&gt;&gt;
&lt;&lt;tiddler HideTiddlerTitle&gt;&gt;
&lt;&lt;calendar thismonth&gt;&gt;</pre>
</div>
<div title="CalendarPlugin" modifier="shankar " created="200602212149" modified="200910301128" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|CalendarPlugin|
|Source|http://www.TiddlyTools.com/#CalendarPlugin|
|Version|1.5.0|
|Author|Eric Shulman|
|Original Author|SteveRumsby|
|License|unknown|
|~CoreVersion|2.1|
|Type|plugin|
|Description|display monthly and yearly calendars|
NOTE: For //enhanced// date popup display, optionally install [[DatePlugin]] and [[ReminderMacros]]
!!!Usage:
&lt;&lt;&lt;
|{{{&lt;&lt;calendar&gt;&gt;}}}|full-year calendar for the current year|
|{{{&lt;&lt;calendar year&gt;&gt;}}}|full-year calendar for the specified year|
|{{{&lt;&lt;calendar year month&gt;&gt;}}}|one month calendar for the specified month and year|
|{{{&lt;&lt;calendar thismonth&gt;&gt;}}}|one month calendar for the current month|
|{{{&lt;&lt;calendar lastmonth&gt;&gt;}}}|one month calendar for last month|
|{{{&lt;&lt;calendar nextmonth&gt;&gt;}}}|one month calendar for next month|
|{{{&lt;&lt;calendar +n&gt;&gt;}}}&lt;br&gt;{{{&lt;&lt;calendar -n&gt;&gt;}}}|one month calendar for a month +/- 'n' months from now|
&lt;&lt;&lt;
!!!Configuration:
&lt;&lt;&lt;
|''First day of week:''&lt;br&gt;{{{config.options.txtCalFirstDay}}}|&lt;&lt;option txtCalFirstDay&gt;&gt;|(Monday = 0, Sunday = 6)|
|''First day of weekend:''&lt;br&gt;{{{config.options.txtCalStartOfWeekend}}}|&lt;&lt;option txtCalStartOfWeekend&gt;&gt;|(Monday = 0, Sunday = 6)|

&lt;&lt;option chkDisplayWeekNumbers&gt;&gt; Display week numbers //(note: Monday will be used as the start of the week)//
|''Week number display format:''&lt;br&gt;{{{config.options.txtWeekNumberDisplayFormat }}}|&lt;&lt;option txtWeekNumberDisplayFormat &gt;&gt;|
|''Week number link format:''&lt;br&gt;{{{config.options.txtWeekNumberLinkFormat }}}|&lt;&lt;option txtWeekNumberLinkFormat &gt;&gt;|
&lt;&lt;&lt;
!!!Revisions
&lt;&lt;&lt;
2009.04.31 [1.5.0] rewrote onClickCalendarDate() (popup handler) and added config.options.txtCalendarReminderTags.  Partial code reduction/cleanup.  Assigned true version number (1.5.0)
2008.09.10 added '+n' (and '-n') param to permit display of relative months (e.g., '+6' means 'six months from now', '-3' means 'three months ago'.  Based on suggestion from Jean.
2008.06.17 added support for config.macros.calendar.todaybg
2008.02.27 in handler(), DON'T set hard-coded default date format, so that *customized* value (pre-defined in config.macros.calendar.journalDateFmt is used.
2008.02.17 in createCalendarYear(), fix next/previous year calculation (use parseInt() to convert to numeric value).  Also, use journalDateFmt for date linking when NOT using [[DatePlugin]].
2008.02.16 in createCalendarDay(), week numbers now created as TiddlyLinks, allowing quick creation/navigation to 'weekly' journals (based on request from Kashgarinn)
2008.01.08 in createCalendarMonthHeader(), 'month year' heading is now created as TiddlyLink, allowing quick creation/navigation to 'month-at-a-time' journals
2007.11.30 added 'return false' to onclick handlers (prevent IE from opening blank pages)
2006.08.23 added handling for weeknumbers (code supplied by Martin Budden (see 'wn**' comment marks).  Also, incorporated updated by Jeremy Sheeley to add caching for reminders (see [[ReminderMacros]], if installed)
2005.10.30 in config.macros.calendar.handler(), use 'tbody' element for IE compatibility.  Also, fix year calculation for IE's getYear() function (which returns '2005' instead of '105'). Also, in createCalendarDays(), use showDate() function (see [[DatePlugin]], if installed) to render autostyled date with linked popup.  Updated calendar stylesheet definition: use .calendar class-specific selectors, add text centering and margin settings
2006.05.29 added journalDateFmt handling
&lt;&lt;&lt;
!!!Code
***/
//{{{
version.extensions.CalendarPlugin= { major: 1, minor: 5, revision: 0, date: new Date(2009,5,31)};
//}}}
//{{{
if(config.options.txtCalFirstDay == undefined)
	config.options.txtCalFirstDay = 0;
if(config.options.txtCalStartOfWeekend == undefined)
	config.options.txtCalStartOfWeekend = 5;
if(config.options.chkDisplayWeekNumbers == undefined)
	config.options.chkDisplayWeekNumbers = false;
if(config.options.chkDisplayWeekNumbers)
	config.options.txtCalFirstDay = 0;
if(config.options.txtWeekNumberDisplayFormat == undefined)
	config.options.txtWeekNumberDisplayFormat = 'w0WW';
if(config.options.txtWeekNumberLinkFormat == undefined)
	config.options.txtWeekNumberLinkFormat = 'YYYY-w0WW';
if(config.options.txtCalendarReminderTags == undefined)
	config.options.txtCalendarReminderTags = 'reminder';

config.macros.calendar = {
	monthnames:['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
	daynames:['M','T','W','T','F','S','S'],
	todaybg:'#ccccff',
	weekendbg:'#c0c0c0',
	monthbg:'#e0e0e0',
	holidaybg:'#ffc0c0',
	journalDateFmt:'DD MMM YYYY',
	monthdays:[31,28,31,30,31,30,31,31,30,31,30,31],
	holidays:[ ] // for customization see [[CalendarPluginConfig]]
};
//}}}
//{{{
function calendarIsHoliday(date)
{
	var longHoliday = date.formatString('0DD/0MM/YYYY');
	var shortHoliday = date.formatString('0DD/0MM');
	for(var i = 0; i &lt; config.macros.calendar.holidays.length; i++) {
		if(   config.macros.calendar.holidays[i]==longHoliday
		   || config.macros.calendar.holidays[i]==shortHoliday)
			return true;
	}
	return false;
}
//}}}
//{{{
config.macros.calendar.handler = function(place,macroName,params) {
	var calendar = createTiddlyElement(place, 'table', null, 'calendar', null);
	var tbody = createTiddlyElement(calendar, 'tbody');
	var today = new Date();
	var year = today.getYear();
	if (year&lt;1900) year+=1900;

 	// get journal format from SideBarOptions (ELS 5/29/06 - suggested by MartinBudden)
	var text = store.getTiddlerText('SideBarOptions');
	var re = new RegExp('&lt;&lt;(?:newJournal)([^&gt;]*)&gt;&gt;','mg'); var fm = re.exec(text);
	if (fm &amp;&amp; fm[1]!=null) { var pa=fm[1].readMacroParams(); if (pa[0]) this.journalDateFmt = pa[0]; }

	var month=-1;
	if (params[0] == 'thismonth') {
		var month=today.getMonth();
	} else if (params[0] == 'lastmonth') {
		var month = today.getMonth()-1; if (month==-1) { month=11; year--; }
	} else if (params[0] == 'nextmonth') {
		var month = today.getMonth()+1; if (month&gt;11) { month=0; year++; }
	} else if (params[0]&amp;&amp;'+-'.indexOf(params[0].substr(0,1))!=-1) {
		var month = today.getMonth()+parseInt(params[0]);
		if (month&gt;11) { year+=Math.floor(month/12); month%=12; };
		if (month&lt;0)  { year+=Math.floor(month/12); month=12+month%12; }
	} else if (params[0]) {
		year = params[0];
		if(params[1]) month=parseInt(params[1])-1;
		if (month&gt;11) month=11; if (month&lt;0) month=0;
	}

	if (month!=-1) {
		cacheReminders(new Date(year, month, 1, 0, 0), 31);
		createCalendarOneMonth(tbody, year, month);
	} else {
		cacheReminders(new Date(year, 0, 1, 0, 0), 366);
		createCalendarYear(tbody, year);
	}
	window.reminderCacheForCalendar = null;
}
//}}}
//{{{
// cache used to store reminders while the calendar is being rendered
// it will be renulled after the calendar is fully rendered.
window.reminderCacheForCalendar = null;
//}}}
//{{{
function cacheReminders(date, leadtime)
{
	if (window.findTiddlersWithReminders == null) return;
	window.reminderCacheForCalendar = {};
	var leadtimeHash = [];
	leadtimeHash [0] = 0;
	leadtimeHash [1] = leadtime;
	var t = findTiddlersWithReminders(date, leadtimeHash, null, 1);
	for(var i = 0; i &lt; t.length; i++) {
		//just tag it in the cache, so that when we're drawing days, we can bold this one.
		window.reminderCacheForCalendar[t[i]['matchedDate']] = 'reminder:' + t[i]['params']['title']; 
	}
}
//}}}
//{{{
function createCalendarOneMonth(calendar, year, mon)
{
	var row = createTiddlyElement(calendar, 'tr');
	createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon]+' '+year, true, year, mon);
	row = createTiddlyElement(calendar, 'tr');
	createCalendarDayHeader(row, 1);
	createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}
//{{{
function createCalendarMonth(calendar, year, mon)
{
	var row = createTiddlyElement(calendar, 'tr');
	createCalendarMonthHeader(calendar, row, config.macros.calendar.monthnames[mon]+' '+ year, false, year, mon);
	row = createTiddlyElement(calendar, 'tr');
	createCalendarDayHeader(row, 1);
	createCalendarDayRowsSingle(calendar, year, mon);
}
//}}}
//{{{
function createCalendarYear(calendar, year)
{
	var row;
	row = createTiddlyElement(calendar, 'tr');
	var back = createTiddlyElement(row, 'td');
	var backHandler = function() {
		removeChildren(calendar);
		createCalendarYear(calendar, parseInt(year)-1);
		return false; // consume click
	};
	createTiddlyButton(back, '&lt;', 'Previous year', backHandler);
	back.align = 'center';
	var yearHeader = createTiddlyElement(row, 'td', null, 'calendarYear', year);
	yearHeader.align = 'center';
	yearHeader.setAttribute('colSpan',config.options.chkDisplayWeekNumbers?22:19);//wn**
	var fwd = createTiddlyElement(row, 'td');
	var fwdHandler = function() {
		removeChildren(calendar);
		createCalendarYear(calendar, parseInt(year)+1);
		return false; // consume click
	};
	createTiddlyButton(fwd, '&gt;', 'Next year', fwdHandler);
	fwd.align = 'center';
	createCalendarMonthRow(calendar, year, 0);
	createCalendarMonthRow(calendar, year, 3);
	createCalendarMonthRow(calendar, year, 6);
	createCalendarMonthRow(calendar, year, 9);
}
//}}}
//{{{
function createCalendarMonthRow(cal, year, mon)
{
	var row = createTiddlyElement(cal, 'tr');
	createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon], false, year, mon);
	createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+1], false, year, mon);
	createCalendarMonthHeader(cal, row, config.macros.calendar.monthnames[mon+2], false, year, mon);
	row = createTiddlyElement(cal, 'tr');
	createCalendarDayHeader(row, 3);
	createCalendarDayRows(cal, year, mon);
}
//}}}
//{{{
function createCalendarMonthHeader(cal, row, name, nav, year, mon)
{
	var month;
	if (nav) {
		var back = createTiddlyElement(row, 'td');
		back.align = 'center';
		back.style.background = config.macros.calendar.monthbg;

		var backMonHandler = function() {
			var newyear = year;
			var newmon = mon-1;
			if(newmon == -1) { newmon = 11; newyear = newyear-1;}
			removeChildren(cal);
			cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
			createCalendarOneMonth(cal, newyear, newmon);
			return false; // consume click
		};
		createTiddlyButton(back, '&lt;', 'Previous month', backMonHandler);
		month = createTiddlyElement(row, 'td', null, 'calendarMonthname')
		createTiddlyLink(month,name,true);
		month.setAttribute('colSpan', config.options.chkDisplayWeekNumbers?6:5);//wn**
		var fwd = createTiddlyElement(row, 'td');
		fwd.align = 'center';
		fwd.style.background = config.macros.calendar.monthbg; 

		var fwdMonHandler = function() {
			var newyear = year;
			var newmon = mon+1;
			if(newmon == 12) { newmon = 0; newyear = newyear+1;}
			removeChildren(cal);
			cacheReminders(new Date(newyear, newmon , 1, 0, 0), 31);
			createCalendarOneMonth(cal, newyear, newmon);
			return false; // consume click
		};
		createTiddlyButton(fwd, '&gt;', 'Next month', fwdMonHandler);
	} else {
		month = createTiddlyElement(row, 'td', null, 'calendarMonthname', name)
		month.setAttribute('colSpan',config.options.chkDisplayWeekNumbers?8:7);//wn**
	}
	month.align = 'center';
	month.style.background = config.macros.calendar.monthbg;
}
//}}}
//{{{
function createCalendarDayHeader(row, num)
{
	var cell;
	for(var i = 0; i &lt; num; i++) {
		if (config.options.chkDisplayWeekNumbers) createTiddlyElement(row, 'td');//wn**
		for(var j = 0; j &lt; 7; j++) {
			var d = j + (config.options.txtCalFirstDay - 0);
			if(d &gt; 6) d = d - 7;
			cell = createTiddlyElement(row, 'td', null, null, config.macros.calendar.daynames[d]);
			if(d == (config.options.txtCalStartOfWeekend-0) || d == (config.options.txtCalStartOfWeekend-0+1))
				cell.style.background = config.macros.calendar.weekendbg;
		}
	}
}
//}}}
//{{{
function createCalendarDays(row, col, first, max, year, mon) {
	var i;
	if (config.options.chkDisplayWeekNumbers){
		if (first&lt;=max) {
			var ww = new Date(year,mon,first);
			var td=createTiddlyElement(row, 'td');//wn**
			var link=createTiddlyLink(td,ww.formatString(config.options.txtWeekNumberLinkFormat),false);
			link.appendChild(document.createTextNode(
				ww.formatString(config.options.txtWeekNumberDisplayFormat)));
		}
		else createTiddlyElement(row, 'td');//wn**
	}
	for(i = 0; i &lt; col; i++)
		createTiddlyElement(row, 'td');
	var day = first;
	for(i = col; i &lt; 7; i++) {
		var d = i + (config.options.txtCalFirstDay - 0);
		if(d &gt; 6) d = d - 7;
		var daycell = createTiddlyElement(row, 'td');
		var isaWeekend=((d==(config.options.txtCalStartOfWeekend-0)
			|| d==(config.options.txtCalStartOfWeekend-0+1))?true:false);
		if(day &gt; 0 &amp;&amp; day &lt;= max) {
			var celldate = new Date(year, mon, day);
			// ELS 10/30/05 - use &lt;&lt;date&gt;&gt; macro's showDate() function to create popup
			// ELS 05/29/06 - use journalDateFmt 
			if (window.showDate) showDate(daycell,celldate,'popup','DD',
				config.macros.calendar.journalDateFmt,true, isaWeekend);
			else {
				if(isaWeekend) daycell.style.background = config.macros.calendar.weekendbg;
				var title = celldate.formatString(config.macros.calendar.journalDateFmt);
				if(calendarIsHoliday(celldate))
					daycell.style.background = config.macros.calendar.holidaybg;
				var now=new Date();
				if ((now-celldate&gt;=0) &amp;&amp; (now-celldate&lt;86400000)) // is today?
					daycell.style.background = config.macros.calendar.todaybg;
				if(window.findTiddlersWithReminders == null) {
					var link = createTiddlyLink(daycell, title, false);
					link.appendChild(document.createTextNode(day));
				} else
					var button = createTiddlyButton(daycell, day, title, onClickCalendarDate);
			}
		}
		day++;
	}
}
//}}}
//{{{
// Create a pop-up containing:
// * a link to a tiddler for this date
// * a 'new tiddler' link to add a reminder for this date
// * links to current reminders for this date
// NOTE: this code is only used if [[ReminderMacros]] is installed AND [[DatePlugin]] is //not// installed.
function onClickCalendarDate(ev) { ev=ev||window.event;
	var d=new Date(this.getAttribute('title')); var date=d.formatString(config.macros.calendar.journalDateFmt);
	var p=Popup.create(this);  if (!p) return;
	createTiddlyLink(createTiddlyElement(p,'li'),date,true);
	var rem='\\n\\&lt;\\&lt;reminder day:%0 month:%1 year:%2 title: \\&gt;\\&gt;';
	rem=rem.format([d.getDate(),d.getMonth()+1,d.getYear()+1900]);
	var cmd=&quot;&lt;&lt;newTiddler label:[[new reminder...]] prompt:[[add a new reminder to '%0']]&quot;
		+&quot; title:[[%0]] text:{{store.getTiddlerText('%0','')+'%1'}} tag:%2&gt;&gt;&quot;;
	wikify(cmd.format([date,rem,config.options.txtCalendarReminderTags]),p);
	createTiddlyElement(p,'hr');
	var t=findTiddlersWithReminders(d,[0,31],null,1);
	for(var i=0; i&lt;t.length; i++) {
		var link=createTiddlyLink(createTiddlyElement(p,'li'), t[i].tiddler, false);
		link.appendChild(document.createTextNode(t[i]['params']['title']));
	}
	Popup.show(); ev.cancelBubble=true; if (ev.stopPropagation) ev.stopPropagation(); return false;
}
//}}}
//{{{
function calendarMaxDays(year, mon)
{
	var max = config.macros.calendar.monthdays[mon];
	if(mon == 1 &amp;&amp; (year % 4) == 0 &amp;&amp; ((year % 100) != 0 || (year % 400) == 0)) max++;
	return max;
}
//}}}
//{{{
function createCalendarDayRows(cal, year, mon)
{
	var row = createTiddlyElement(cal, 'tr');
	var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
	if(first1 &lt; 0) first1 = first1 + 7;
	var day1 = -first1 + 1;
	var first2 = (new Date(year, mon+1, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
	if(first2 &lt; 0) first2 = first2 + 7;
	var day2 = -first2 + 1;
	var first3 = (new Date(year, mon+2, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
	if(first3 &lt; 0) first3 = first3 + 7;
	var day3 = -first3 + 1;

	var max1 = calendarMaxDays(year, mon);
	var max2 = calendarMaxDays(year, mon+1);
	var max3 = calendarMaxDays(year, mon+2);

	while(day1 &lt;= max1 || day2 &lt;= max2 || day3 &lt;= max3) {
		row = createTiddlyElement(cal, 'tr');
		createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
		createCalendarDays(row, 0, day2, max2, year, mon+1); day2 += 7;
		createCalendarDays(row, 0, day3, max3, year, mon+2); day3 += 7;
	}
}
//}}}
//{{{
function createCalendarDayRowsSingle(cal, year, mon)
{
	var row = createTiddlyElement(cal, 'tr');
	var first1 = (new Date(year, mon, 1)).getDay() -1 - (config.options.txtCalFirstDay-0);
	if(first1 &lt; 0) first1 = first1+ 7;
	var day1 = -first1 + 1;
	var max1 = calendarMaxDays(year, mon);
	while(day1 &lt;= max1) {
		row = createTiddlyElement(cal, 'tr');
		createCalendarDays(row, 0, day1, max1, year, mon); day1 += 7;
	}
}
//}}}
//{{{
setStylesheet('.calendar, .calendar table, .calendar th, .calendar tr, .calendar td { text-align:center; } .calendar, .calendar a { margin:0px !important; padding:0px !important; }', 'calendarStyles');
//}}}</pre>
</div>
<div title="CalendarPluginConfig" modifier="shankar " created="200603072129" modified="200910301129" tags="settings systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>// // override cookie settings for CalendarPlugin:
//{{{
config.options.txtCalFirstDay=6;
config.options.txtCalStartOfWeekend=5;
//}}}

// // override internal default settings for CalendarPlugin:
//{{{
config.macros.calendar.journalDateFmt=&quot;DDD MMM 0DD YYYY&quot;;
//}}}</pre>
</div>
<div title="ChangeStylesheet" modifier="ShankarSwamy" created="200708240418" modified="200709222334" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;selectStylesheet size:1 width:30%&gt;&gt;</pre>
</div>
<div title="ClickifyPlugin" modifier="Shankar" created="200901251844" modified="201106110056" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|ClickifyPlugin|
|Source|http://www.TiddlyTools.com/#ClickifyPlugin|
|Documentation|http://www.TiddlyTools.com/#ClickifyPlugin|
|Version|1.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|re-compute parameters when a 'command link' macro is clicked|
!!!!!Usage
&lt;&lt;&lt;
Normally, when you use a //computed parameter// in a macro, it's value is determined when the macro is rendered.  The {{{&lt;&lt;clickify&gt;&gt;}}} macro can be used to force the macro parameters of an 'on-click' command link (such as created by the {{{&lt;&lt;newTiddler&gt;&gt;}}} macro) to be automatically re-computed when the command link is clicked, rather than when it is initially displayed.  This allows use of computed values that depend upon data that may change between the time the macro is rendered and when it's action is actually triggered by a click.

To apply this extended processing to any macro that creates a command link, simply insert the 'clickify' keyword in front of the usual macro name, like this:
{{{
&lt;&lt;clickify macroName param param param ...&gt;&gt;
}}}
&lt;&lt;&lt;
!!!!!Example
&lt;&lt;&lt;
When {{{&lt;&lt;newTiddler&gt;&gt;}}} is clicked, prompt for a title and set default text to current timestamp:
{{{
&lt;&lt;clickify newTiddler title:{{prompt('enter a title','NewTiddler')}} text:{{new Date()}}&gt;&gt;
}}}
&gt;&lt;&lt;clickify newTiddler title:{{prompt('enter a title','NewTiddler')}} text:{{new Date()}}&gt;&gt;
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.02.08 [1.0.1] make sure command link has been rendered before trying to modify it
2009.01.25 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.ClickifyPlugin={major: 1, minor: 0, revision: 1, date: new Date(2009,2,8)};
config.macros.clickify={
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var cmd='&lt;&lt;'+paramString+'&gt;&gt;';
		var e=createTiddlyElement(place,'span');
		wikify(cmd.replace(/alert\(|prompt\(|confirm\(/g,'isNaN('),e);
		var b=e.getElementsByTagName('a')[0]; if (!b) return;
		b.setAttribute('cmd',cmd);
		b.onclick=function(ev) {
			var cmd=this.getAttribute('cmd');
			var e=createTiddlyElement(this.parentNode,'span');
			e.style.display='none';
			wikify(cmd,e);
			e.getElementsByTagName('a')[0].onclick();
			this.parentNode.removeChild(e);
		}
	}
}
//}}}</pre>
</div>
<div title="CloseOnCancelPlugin" modifier="YourName" created="200803080053" modified="200809210416" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|CloseOnCancelPlugin|
|Description:|Closes the tiddler if you click new tiddler then cancel. Default behaviour is to leave it open|
|Version:|3.0.1 ($Rev: 3861 $)|
|Date:|$Date: 2008-03-08 10:53:09 +1000 (Sat, 08 Mar 2008) $|
|Source:|http://mptw.tiddlyspot.com/#CloseOnCancelPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License:|http://mptw.tiddlyspot.com/#TheBSDLicense|
***/
//{{{
merge(config.commands.cancelTiddler,{

	handler_mptw_orig_closeUnsaved: config.commands.cancelTiddler.handler,

	handler: function(event,src,title) {
		this.handler_mptw_orig_closeUnsaved(event,src,title);
		if (!store.tiddlerExists(title) &amp;&amp; !store.isShadowTiddler(title))
			story.closeTiddler(title,true);
	 	return false;
	}

});

//}}}</pre>
</div>
<div title="ColorPalette" modifier="YourName" created="201702190558" tags="palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:     transparent
PrimaryB:     transparent
PrimaryC:     #DEDBCC
PrimaryD:     #DAD4C8
SecondaryA:   #3E3E3E
SecondaryB:   #390121
SecondaryC:   #442B02
SecondaryD:   #013801
TertiaryA:    #464020
TertiaryB:    #AAAA00
TertiaryC:    #01142D
TertiaryD:    #48404D

TidIDEDefaultColor: [[ColorPalette::SecondaryB]]
TidIDEDefaultBackground: [[ColorPalette::PrimaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

H1: 	#3C8484
H2: 	#0E89DC
H3: 	#010DE4
H4:	#44037E
H5:	#2C8804
H6: 	#88041C

Error: #f88

BGImage: url(../BGImages/C_C++-BG.jpg)
EditImage: url(../BGImages/C_C++-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="ColorPalette-2012-01-19" modifier="Shankar Swamy" created="201201200028" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   transparent 
PrimaryB:   #3E3E3E
PrimaryC:   transparent
PrimaryD:   #1F1C21
SecondaryA: #838383
SecondaryB: #DBFFD7
SecondaryC: #FFFFFF
SecondaryD: #636363
TertiaryA:  #DBE7FF
TertiaryB:  #FFFFFF
TertiaryC:  #F0D9FF
TertiaryD:  #555

TidIDEDefaultColor: [[ColorPalette::TertiaryD]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::SecondaryB]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::SecondaryB]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::SecondaryB]]

H1: 	#BA7E2E
H2: 	#A4AB14
H3: 	#974B00
H4:	#CA9C00
H5:	#3E7164
H6: 	#3A6181

Error: #f88

BGImage: url(../BGImages/WorkBG.jpg)
EditImage: url(../BGImages/Work-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="ColorPalette-2012-02-7" modifier="Shankar Swamy" created="201202080127" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   transparent 
PrimaryB:   #3E3E3E
PrimaryC:   transparent
PrimaryD:   #1F1C21
SecondaryA: #838383
SecondaryB: #DBFFD7
SecondaryC: #224D4D	
SecondaryD: #636363
TertiaryA:  #DBE7FF
TertiaryB:  #224D4D	
TertiaryC:  #295F5F
TertiaryD:  #555

TidIDEDefaultColor: [[ColorPalette::TertiaryD]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::SecondaryB]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::SecondaryB]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::SecondaryB]]

H1: 	#BA7E2E
H2: 	#A4AB14
H3: 	#974B00
H4:	#CA9C00
H5:	#3E7164
H6: 	#3A6181

Error: #f88

BGImage: url(../BGImages/WorkBG.jpg)
EditImage: url(../BGImages/Work-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="ColorPalette-FromRelease" modifier="Shankar" created="201106102321" modified="201106102322" tags="aaTag palette mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #3C4003
PrimaryB:   #383A14
PrimaryC:   #1D1F00
PrimaryD:   #00010E
SecondaryA: #0D0E17
SecondaryB: #00010E
SecondaryC: #FDFFE7
SecondaryD: #FFE7E8
TertiaryA:  #EAECFF
TertiaryB:  #F7FF85
TertiaryC:  #969EFF
TertiaryD:  #FF858C

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="ConfigTweaks" modifier="YourName" created="200905310434" modified="200909150411" tags="systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Description:''|Configure options for this TiddlyWiki|
***/

//{{{
/***
Disabled
//AutoClearMessageMacro
//Auto closes the pop-up messages after 3 seconds.Change the 3000 to modify the time.
{{{
window.oldDisplayMessage = displayMessage;
displayMessage = function (text,linkText)
{ oldDisplayMessage(text,linkText);
setTimeout( 'clearMessage()', 3000 );}
}}}
***/

//Show wysiwyg editor buttons during edit
config.options.chkShowQuickEdit=true;


//tweak closeAll for toolbar

config.commands.closeAll ={
text:&quot;close all&quot;,
tooltip:&quot;close all&quot;};

config.commands.closeAll.handler = function(event,src,title)
{story.closeAllTiddlers();return false;}

//config TiddlersBar
config.options.chkDisableTabsBar=false;

// re-label default text for some standard UI elements
config.commands.permalink.text=&quot;link&quot;;
config.commands.references.text=&quot;references&quot;;
merge(config.macros.toolbar,{ moreLabel: 'more\u25BC', lessLabel: '\u25C4less' });

// allows custom response when tiddler does not exist (e.g. redirection to alternative tiddler)
config.shadowTiddlers.MissingTiddler=config.views.wikified.defaultText.replace(/%0/,'$1'); // default to standard message
config.views.wikified.defaultText='&lt;&lt;tiddler MissingTiddler with: [[%0]]&gt;&gt;';

// wrap AdvancedOptions and PluginManager default content in a groupbox (and use a smaller font)
config.shadowTiddlers.AdvancedOptions=
	config.shadowTiddlers.AdvancedOptions.replace(
		/&lt;&lt;options&gt;&gt;/,
		&quot;{{small groupbox{&lt;&lt;options&gt;&gt;}}}&quot;);

config.shadowTiddlers.PluginManager=
	config.shadowTiddlers.PluginManager.replace(
		/&lt;&lt;plugins&gt;&gt;/,
		&quot;{{small groupbox{&lt;&lt;plugins&gt;&gt;}}}&quot;);

// message used by ConfirmExitPlugin when no changes have been made
config.messages.confirmExit_nochanges='\tTiddlyTools... Small Tools for Big Ideas™\n\t'
	+store.getTiddlerText(&quot;SiteUrl&quot;,document.location.protocol==&quot;http&quot;?document.location.href:&quot;&quot;);
//}}}</pre>
</div>
<div title="Cookie plugin" modifier="Shankar Swamy" created="200909150316" modified="200909150416" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Description:''|Cookie plugin for Treeview Plugin Usage: (persist: &quot;cookie&quot;) means the state of the Treemenu persists and will remain where you left it between sessions.|
***/
/**
 * Cookie plugin
 *
 * Copyright (c) 2006 Klaus Hartl (stilbuero.de)
 * Dual licensed under the MIT and GPL licenses:
 * http://www.opensource.org/licenses/mit-license.php
 * http://www.gnu.org/licenses/gpl.html
 *
 */

/**
 * Create a cookie with the given name and value and other optional parameters.
 *
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Set the value of a cookie.
 * @example $.cookie('the_cookie', 'the_value', {expires: 7, path: '/', domain: 'jquery.com', secure: true});
 * @desc Create a cookie with all available options.
 * @example $.cookie('the_cookie', 'the_value');
 * @desc Create a session cookie.
 * @example $.cookie('the_cookie', null);
 * @desc Delete a cookie by passing null as value.
 *
 * @param String name The name of the cookie.
 * @param String value The value of the cookie.
 * @param Object options An object literal containing key/value pairs to provide optional cookie attributes.
 * @option Number|Date expires Either an integer specifying the expiration date from now on in days or a Date object.
 *                             If a negative value is specified (e.g. a date in the past), the cookie will be deleted.
 *                             If set to null or omitted, the cookie will be a session cookie and will not be retained
 *                             when the the browser exits.
 * @option String path The value of the path atribute of the cookie (default: path of page that created the cookie).
 * @option String domain The value of the domain attribute of the cookie (default: domain of page that created the cookie).
 * @option Boolean secure If true, the secure attribute of the cookie will be set and the cookie transmission will
 *                        require a secure protocol (like HTTPS).
 * @type undefined
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */

/**
 * Get the value of a cookie with the given name.
 *
 * @example $.cookie('the_cookie');
 * @desc Get the value of a cookie.
 *
 * @param String name The name of the cookie.
 * @return The value of the cookie.
 * @type String
 *
 * @name $.cookie
 * @cat Plugins/Cookie
 * @author Klaus Hartl/klaus.hartl@stilbuero.de
 */
jQuery.cookie = function(name, value, options) {
    if (typeof value != 'undefined') { // name and value given, set cookie
        options = options || {};
        if (value === null) {
            value = '';
            options.expires = -1;
        }
        var expires = '';
        if (options.expires &amp;&amp; (typeof options.expires == 'number' || options.expires.toUTCString)) {
            var date;
            if (typeof options.expires == 'number') {
                date = new Date();
                date.setTime(date.getTime() + (options.expires * 24 * 60 * 60 * 1000));
            } else {
                date = options.expires;
            }
            expires = '; expires=' + date.toUTCString(); // use expires attribute, max-age is not supported by IE
        }
        var path = options.path ? '; path=' + options.path : '';
        var domain = options.domain ? '; domain=' + options.domain : '';
        var secure = options.secure ? '; secure' : '';
        document.cookie = [name, '=', encodeURIComponent(value), expires, path, domain, secure].join('');
    } else { // only name given, get cookie
        var cookieValue = null;
        if (document.cookie &amp;&amp; document.cookie != '') {
            var cookies = document.cookie.split(';');
            for (var i = 0; i &lt; cookies.length; i++) {
                var cookie = jQuery.trim(cookies[i]);
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) == (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
};</pre>
</div>
<div title="CoreConfigsOverrides" modifier="YourName" created="200708241324" modified="201702182321" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>//{{{

function getPageTitle() { return &quot;Starter&quot;; } 

/*    Exclusively for treeview based */
config.options.chkHttpReadOnly = false;
config.options.chkAutoSave = true;
config.options.chkSaveBackups = false;
config.options.chkAnimate = false;
config.options.chkShowRightSidebar = true;
if (window.location.protocol!=&quot;file:&quot;) showBackstage=false; 

config.options.chkSearchTitles=true;
config.options.chkSearchText=true;
config.options.chkSearchTags=true;
config.options.chkSearchFields=true;
config.options.chkSearchTitlesFirst=false;
config.options.chkSearchList=true;
config.options.chkSearchByDate=false;
config.options.chkSearchIncremental=false;
config.options.chkSearchShadows=false; 

config.options.tagsDefault  = [&quot;aaTag&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;];

/* Missing tiddler message */
config.views.wikified.defaultText=&quot;'%0': No notes on this yet - double clik to create it!&quot;

config.options.chkShowQuickEdit=true;

merge(config.commands.saveTiddler,{
	text: &quot;Save&quot;
});

merge(config.views.wikified.tag,{
	labelTags: &quot;&quot;
});

/* -------------  End Treeview Exclusive configurations --------------------------------   */

config.options.chkDoubleClickToEdit=true;
config.options.chkAutoSave = true;
config.options.chkSaveBackups = false;

config.messages.mainSaved = &quot;***&quot;;

config.options.txtMaxEditRows = &quot;30&quot;;

/* Tags : ...Hide == false means 'don't hide'*/
config.options.chkHideTiddlerTags = true;

/* Sidebar (right) labels  */
config.macros.list.all.prompt = &quot;__All Notes - in alpha-order (excluding unlisted)__&quot;;
config.macros.list.missing.prompt = &quot;Linked from another but don't exist!&quot;;
config.macros.list.orphans.prompt = &quot;Not linked from any other&quot;;
config.macros.list.shadowed.prompt = &quot;Shadowed&quot;;

config.messages.backstage = {
	open: {text: &quot;&quot;, tooltip: &quot;Open additional options&quot;},
	close: {text: &quot;&quot;, tooltip: &quot;Close additional options&quot;},
	prompt: &quot;backstage: &quot;,
	decal: {
		edit: {text: &quot;edit&quot;, tooltip: &quot;Edit the tiddler '%0'&quot;}
	}
};



/* 1. Sort in the &quot;created order&quot; rather than &quot;modified order&quot; in the list under &quot;Timeline&quot; Sidebar 
   2. In the sidebar header, the headlines are also tiddlers - this is specific to this book.  So the 
      headers themselves are tiddly links!
*/
config.macros.timeline.handler = function(place,macroName,params)
{
        var boolWorkLog = document.title.match(/^Work/);
	var field = params[0] ? params[0] : &quot;created&quot;;
	var tiddlers = store.reverseLookup(&quot;tags&quot;,&quot;excludeLists&quot;,false,field);
	var lastDay = &quot;&quot;;
	var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1])) : 0;
	var dateFormat = params[2] ? params[2] : this.dateFormat;
	for(var t=tiddlers.length-1; t&gt;=last; t--) {
		var tiddler = tiddlers[t];
             
                //alert(&quot;tiddlers[t]: &quot; + tiddlers[t].title);
		var theDay = tiddler[field].convertToLocalYYYYMMDDHHMM().substr(0,8);
                var myLabel = tiddler[field].formatString('0MM-0DD-YYYY');
                var matchLabel = tiddler[field].formatString('YYYY-0MM-0DD');
		if(theDay != lastDay) {
			var theDateList = document.createElement(&quot;ul&quot;);
			place.appendChild(theDateList);
                        
			if( boolWorkLog ){
			    // this change is only for the files whose names begin with &quot;Work&quot; - e.g. &quot;Work-II&quot;
			    var myLink = createTiddlyLink(
					  createTiddlyElement( theDateList,&quot;h1&quot;,null,&quot;listTitle&quot;, &quot;&quot;),
                              		  tiddler[field].formatString('YYYY-0MM-0DD'), false );			
			    
                            myLink.appendChild( document.createTextNode(myLabel) );  
                            //alert(tiddler[field].formatString(dateFormat));
			}
                        else {
			    // the original headers in the sidebar
                            createTiddlyElement( theDateList,&quot;li&quot;,null,&quot;listTitle&quot;, 
                                                 tiddler[field].formatString(dateFormat) ); 
                        }
                                                
			lastDay = theDay;
		}
		var theDateListItem = createTiddlyElement(theDateList, &quot;li&quot;, null, &quot;listLink&quot;);
                
                // For &quot;WorkLog&quot; we won't show the daily header tiddlers again in the 
                // list of the tiddlers for day:
                if( boolWorkLog ){
                    
                    if( tiddler.title.match(matchLabel) )
                    {
                        //alert( &quot;Found &amp; removed: &quot; + tiddler.title + &quot;; Label: &quot; + matchLabel );
                        continue;
                    }
                    // supress the title of the tiddler here - so that we don't display in the sidebar
                    // the long string of numbers that we have in front of each tiddler name
		    var myItemTitle = theDateListItem.appendChild( createTiddlyLink(place, tiddler.title, false) );
                    // remove the date, time of creation in the tiddler names and display rest of the tiddler names, for
                    // for the tiddlers that have more than the date, time in their names
                    if( tiddler.title.match(/^\d{8}-\d{4}\s*\w/) ){
                        myItemTitle.appendChild( document.createTextNode( 
					    	 tiddler.title.replace(/^\d{8}-\d{4}/, '')) );
                    } else {
                    	myItemTitle.appendChild( document.createTextNode(tiddler.title) );
                    }    // if( tiddler.title.match(/^\d{8}-\d{4}\s*\w/) )
                }
                else {
                    theDateListItem.appendChild(createTiddlyLink(place,tiddler.title,true));
                }
	}	//for(var t=tiddlers.length-1; ...)  
}; 

config.tasks.changeSSTab = {
    text: &quot;change stylesheet&quot;,
    tooltip: &quot;&quot;,
   content: &quot;&lt;&lt;tiddler ChangeStylesheet&gt;&gt;&quot;
};
config.backstageTasks.push(&quot;changeSSTab&quot;);

merge(config.views.editor,{
	tagPrompt: &quot;Avoid polluting tag space; think before creating a new one!&quot;,
	defaultText: &quot;&quot;});

merge(config.macros.newJournal , {
 label: &quot;Journal&quot;,
 prompt: &quot;Create a new journal entry - \&quot;J\&quot;&quot;
});

merge( config.macros.newTiddler,{
label: &quot;Notes&quot;,
prompt: &quot;Create a new notes - \&quot;N\&quot;&quot;
});

merge( config.macros.closeAll,{
label: &quot;Close All&quot;,
prompt: &quot;Close all notes NOT open for edit&quot;
});

merge( config.macros.saveChanges,{
label: &quot;Save&quot;,
prompt: &quot;Save changes to the note book&quot;
});

merge( config.macros.list.all,{
prompt: &quot;All user notes in alphabetical order&quot;
});

function displayMessage(text,linkText)
{
        var msgArea = document.getElementById(&quot;messageArea&quot;);
        if(!msgArea)
                {
                alert(text);
                return;
                }
        var msg;
        if(linkText)
                {
                msg = createTiddlyElement(msgArea,&quot;div&quot;,null,null,null);
                var link = createTiddlyElement(msg,&quot;a&quot;,null,null,text);
                link.href = linkText;
                link.target = &quot;_blank&quot;;
                }
        else
                msg = createTiddlyElement(msgArea,&quot;div&quot;,null,null,text);
        msgArea.style.display = &quot;block&quot;;
        setTimeout(&quot;clearMessage();&quot;,400);
}

// hyjack &quot;store.saveTiddler(...)&quot; function and enhance it to avoid trying to save
// to tiddlers that have &quot;'&quot; character in their names
store.OldSaveTiddler = store.saveTiddler;
store.saveTiddler = function( title1, title2, p0, userName, myDate, myTags )
{
    //alert( &quot;YES, I shall save this!&quot; );
    var containsBadChar = title1.indexOf(&quot;'&quot;) &gt;= 0;
    if (containsBadChar) 
    {
        alert(&quot;Title cannot contain ' in it - try a title without it, likely using the Save As Option&quot;);
        return false;
    }


    store.OldSaveTiddler( title1, title2, p0, userName, myDate, myTags );
}

//}}}</pre>
</div>
<div title="DN Template" modifier="Shankar" created="201108262124" modified="201108271904" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>''Present'':

''Opens'':













{{c1{


}}}

{{c2{

''Action Item'':
}}}</pre>
</div>
<div title="DailyHeader" modifier="Shankar Swamy" created="201109011603" modified="201310130337" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script label=&quot; DH &quot; title=&quot;Journal Header for the Day&quot;&gt;
//Daily Notes RC2.0 Release 3.0

function gdeSaveToClipboard(textToCopy) {
	function copy(out) {
                //alert(&quot;Copied: &quot; + textToCopy);
		if(window.Components) { // FIREFOX
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var id='@mozilla.org/widget/clipboardhelper;1';
			var clip=Components.classes[id].getService(Components.interfaces.nsIClipboardHelper);
			clip.copyString(out);
		} else if(window.clipboardData) { // IE
			window.clipboardData.setData('text',out);
		} else if(document.execCommand) { // CHROME, SAFARI, IE6
			var ta=document.createElement('textarea');
			ta.style.position='absolute';
			ta.style.left='-100%';
			document.body.appendChild(ta);
			ta.value=out; ta.select();
			document.execCommand('Copy',false,null);
			document.body.removeChild(ta);
		} else throw('cannot access clipboard');
	}
	
	try	 { copy(textToCopy); }
	catch(e) { // FALLBACK
		alert('Copy to clipboard() failed - please copy the text manually.');
		}
}

var myTags=new Date().formatString('YYYY-0MM') + &quot; Note journal aaTag dayHeader&quot;

var myTitle = new Date().formatString('YYYY-0MM-0DD');
var myText =  &quot;@@color:#B106FF;font-size:1.0em; &quot; 
               + new Date().formatString('DDD  0hh:mm')
               + &quot; @@&quot;;

if(!store.tiddlerExists(myTitle)) {
  // create a new tiddler:
  store.saveTiddler( myTitle, myTitle, myText, 
                     config.options.txtUserName,
                     new Date(), myTags );
  autoSaveChanges(null,[tiddler]); 
  gdeSaveToClipboard( &quot;[[&quot; + myTitle + &quot;]]&quot; );
}
// Following line commented out to avoid displaying the daily header on its creation
//story.displayTiddler(null, myTitle);

// If the following line is commented, the tiddler will NOT be
// opened for editing.  Instead it will be displayed as saved 
// tiddler.
// config.commands.editTiddler.handler(null, null, myTitle); 

//alert( &quot;Daily Header for &quot; + (new Date().formatString('YYYY/0MM/DD')) + &quot;created!&quot; );


&lt;/script&gt; </pre>
</div>
<div title="DailyNotes" modifier="Shankar Swamy" created="201108271820" modified="201209010806" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script label=&quot; DN &quot; title=&quot;Notes During the Day&quot;&gt;
//  Daily Notes Release 2.1 from RC3.0
//
// We are using the store.saveTiddler(...) to create new tiddler here. The problem,
// is it is that we have not overloaded it to copy the tiddler name to the clipboard.
// If we did, it will copy to clipboard every time we save a tiddler.  If we use
// createTiddler which has a post-callback to copy the tiddler name, we make two 
// calls - once to create and once tosave it.  So, just locally copy the title to the
// clipboard
function gdeSaveToClipboard(textToCopy) {
	function copy(out) {
                //alert(&quot;Copied: &quot; + textToCopy);
		if(window.Components) { // FIREFOX
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var id='@mozilla.org/widget/clipboardhelper;1';
			var clip=Components.classes[id].getService(Components.interfaces.nsIClipboardHelper);
			clip.copyString(out);
		} else if(window.clipboardData) { // IE
			window.clipboardData.setData('text',out);
		} else if(document.execCommand) { // CHROME, SAFARI, IE6
			var ta=document.createElement('textarea');
			ta.style.position='absolute';
			ta.style.left='-100%';
			document.body.appendChild(ta);
			ta.value=out; ta.select();
			document.execCommand('Copy',false,null);
			document.body.removeChild(ta);
		} else throw('cannot access clipboard');
	}
	
	try	 { copy(textToCopy); }
	catch(e) { // FALLBACK
		alert('Copy to clipboard() failed - please copy the text manually.');
		}
}

var alwaysTag=new Date().formatString('YYYY-0MM-0DD') + &quot; Note aaTag dayNotes&quot;

var p0 = (prompt(&quot;Enter Suffix-Title:&quot;,&quot;&quot;)).trim();
if( !p0 || !p0.trim().length ){
	return ;
}

var p1 = new Date().formatString('YYYY0MM0DD-0hh0mm');
// Saving the prefix would be useful - to name included files ... other uses to be
// invented ... in general a distinct random string is quite useful to have around ...
//gdeSaveToClipboard( p1 );
//alert(p1);
p1 = p1 + &quot; &quot; + p0;

if (store.tiddlerExists(p1)) {
  if(!confirm(config.messages.overwriteWarning.format([p1.toString()])))
  	return null
	;
}
else {
        //gdeSaveToClipboard( p1 );
	gdeSaveToClipboard( &quot;[[&quot;+p1+&quot;]]&quot; );
//alert(p1);
}

var tags=(alwaysTag);
var title=(p1);

// prompt for keywords
p0 = &quot;&quot;;
// If user entered a space character, allow for an empty &quot;Keyword&quot; field
// to be inserted.  If nothing was entered, don't insert anything
p0 = prompt(&quot;Enter keywords for the notes ... &quot;, &quot;&quot;);
if (p0.length)
{
    p0 = p0.trim();
    p0 = &quot;\n\n\n\n\n\n&quot; + &quot;{{c1{''Keywords'': &quot; + p0 + &quot;}}}&quot; ;
}

store.saveTiddler(
  title,
  title,
  p0,
  //store.getTiddlerText(&quot;&quot;),
  //store.getTiddlerText('DN Template'),
  config.options.txtUserName,
  new Date(),
  tags);

if (!store.tiddlerExists(title))
    return
    ;

autoSaveChanges(null,[tiddler]); 

story.displayTiddler(null,title);
// If the following line is commented, the tiddler will NOT be
// opened for editing.  Instead it will be displayed as saved 
// tiddler.
config.commands.editTiddler.handler(null, null, title);
&lt;/script&gt; </pre>
</div>
<div title="DatePlugin" modifier="shankar " created="200510301759" modified="200910301127" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|[[DatePlugin]]|
|Source|http://www.TiddlyTools.com/#DatePlugin|
|Documentation|http://www.TiddlyTools.com/#DatePluginInfo|
|Version|2.7.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|formatted dates plus popup menu with 'journal' link, changes and (optional) reminders|
This plugin provides a general approach to displaying formatted dates and/or links and popups that permit easy navigation and management of tiddlers based on their creation/modification dates.
!!!!!Documentation
&gt;see [[DatePluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkDatePopupHideCreated&gt;&gt; omit 'created' section from date popups
&lt;&lt;option chkDatePopupHideChanged&gt;&gt; omit 'changed' section from date popups
&lt;&lt;option chkDatePopupHideTagged&gt;&gt; omit 'tagged' section from date popups
&lt;&lt;option chkDatePopupHideReminders&gt;&gt; omit 'reminders' section from date popups
&lt;&lt;option chkShowJulianDate&gt;&gt; display Julian day number (1-365) below current date

see [[DatePluginConfig]] for additional configuration settings, for use in calendar displays, including:
*date formats
*color-coded backgrounds
*annual fixed-date holidays
*weekends
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.05.31 [2.7.1] in addRemindersToPopup(), 'new reminder....' command now uses {{{&lt;&lt;newTiddler&gt;&gt;}}} macro.  Also, general code reduction/cleanup.
|please see [[DatePluginInfo]] for additional revision details|
2005.10.30 [0.9.0] pre-release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.DatePlugin= {major: 2, minor: 7, revision: 1, date: new Date(2009,5,31)};

config.macros.date = {
	format: 'YYYY.0MM.0DD', // default date display format
	linkformat: 'YYYY.0MM.0DD', // 'dated tiddler' link format
	linkedbg: '#babb1e', // 'babble'
	todaybg: '#ffab1e', // 'fable'
	weekendbg: '#c0c0c0', // 'cocoa'
	holidaybg: '#ffaace', // 'face'
	createdbg: '#bbeeff', // 'beef'
	modifiedsbg: '#bbeeff', // 'beef'
	remindersbg: '#c0ffee', // 'coffee'
	weekend: [ 1,0,0,0,0,0,1 ], // [ day index values: sun=0, mon=1, tue=2, wed=3, thu=4, fri=5, sat=6 ],
	holidays: [ '01/01', '07/04', '07/24', '11/24' ]
		// NewYearsDay, IndependenceDay(US), Eric's Birthday (hooray!), Thanksgiving(US)
};

config.macros.date.handler = function(place,macroName,params)
{
	// default: display current date
	var now =new Date();
	var date=now;
	var mode='display';
	if (params[0]&amp;&amp;['display','popup','link'].contains(params[0].toLowerCase()))
		{ mode=params[0]; params.shift(); }

	if (!params[0] || params[0]=='today')
		{ params.shift(); }
	else if (params[0]=='filedate')
		{ date=new Date(document.lastModified); params.shift(); }
	else if (params[0]=='tiddler')
		{ date=store.getTiddler(story.findContainingTiddler(place).id.substr(7)).modified; params.shift(); }
	else if (params[0].substr(0,8)=='tiddler:')
		{ var t; if ((t=store.getTiddler(params[0].substr(8)))) date=t.modified; params.shift(); }
	else {
		var y = eval(params.shift().replace(/Y/ig,(now.getYear()&lt;1900)?now.getYear()+1900:now.getYear()));
		var m = eval(params.shift().replace(/M/ig,now.getMonth()+1));
		var d = eval(params.shift().replace(/D/ig,now.getDate()+0));
		date = new Date(y,m-1,d);
	}
	// date format with optional custom override
	var format=this.format; if (params[0]) format=params.shift();
	var linkformat=this.linkformat; if (params[0]) linkformat=params.shift();
	showDate(place,date,mode,format,linkformat);
}

window.showDate=showDate;
function showDate(place,date,mode,format,linkformat,autostyle,weekend)
{
	mode	  =mode||'display';
	format	  =format||config.macros.date.format;
	linkformat=linkformat||config.macros.date.linkformat;

	// format the date output
	var title=date.formatString(format);
	var linkto=date.formatString(linkformat);

	// just show the formatted output
	if (mode=='display') { place.appendChild(document.createTextNode(title)); return; }

	// link to a 'dated tiddler'
	var link = createTiddlyLink(place, linkto, false);
	link.appendChild(document.createTextNode(title));
	link.title = linkto;
	link.date = date;
	link.format = format;
	link.linkformat = linkformat;

	// if using a popup menu, replace click handler for dated tiddler link
	// with handler for popup and make link text non-italic (i.e., an 'existing link' look)
	if (mode=='popup') {
		link.onclick = onClickDatePopup;
		link.style.fontStyle='normal';
	}
	// format the popup link to show what kind of info it contains (for use with calendar generators)
	if (autostyle) setDateStyle(place,link,weekend);
}
//}}}
//{{{
// NOTE: This function provides default logic for setting the date style when displayed in a calendar
// To customize the date style logic, please see[[DatePluginConfig]]
function setDateStyle(place,link,weekend) {
	// alias variable names for code readability
	var date=link.date;
	var fmt=link.linkformat;
	var linkto=date.formatString(fmt);
	var cmd=config.macros.date;

	if ((weekend!==undefined?weekend:isWeekend(date))&amp;&amp;(cmd.weekendbg!=''))
		{ place.style.background = cmd.weekendbg; }
	if (hasModifieds(date)||hasCreateds(date)||hasTagged(date,fmt))
		{ link.style.fontStyle='normal'; link.style.fontWeight='bold'; }
	if (hasReminders(date))
		{ link.style.textDecoration='underline'; }
	if (isToday(date))
		{ link.style.border='1px solid black'; }
	if (isHoliday(date)&amp;&amp;(cmd.holidaybg!=''))
		{ place.style.background = cmd.holidaybg; }
	if (hasCreateds(date)&amp;&amp;(cmd.createdbg!=''))
		{ place.style.background = cmd.createdbg; }
	if (hasModifieds(date)&amp;&amp;(cmd.modifiedsbg!=''))
		{ place.style.background = cmd.modifiedsbg; }
	if ((hasTagged(date,fmt)||store.tiddlerExists(linkto))&amp;&amp;(cmd.linkedbg!=''))
		{ place.style.background = cmd.linkedbg; }
	if (hasReminders(date)&amp;&amp;(cmd.remindersbg!=''))
		{ place.style.background = cmd.remindersbg; }
	if (isToday(date)&amp;&amp;(cmd.todaybg!=''))
		{ place.style.background = cmd.todaybg; }
	if (config.options.chkShowJulianDate) { // optional display of Julian date numbers
		var m=[0,31,59,90,120,151,181,212,243,273,304,334];
		var d=date.getDate()+m[date.getMonth()];
		var y=date.getFullYear();
		if (date.getMonth()&gt;1 &amp;&amp; (y%4==0 &amp;&amp; y%100!=0) || y%400==0)
			d++; // after February in a leap year
		wikify('@@font-size:80%;&lt;br&gt;'+d+'@@',place);
	}

}
//}}}
//{{{
function isToday(date) // returns true if date is today
	{ var now=new Date(); return ((now-date&gt;=0) &amp;&amp; (now-date&lt;86400000)); }
function isWeekend(date) // returns true if date is a weekend
	{ return (config.macros.date.weekend[date.getDay()]); }
function isHoliday(date) // returns true if date is a holiday
{
	var longHoliday = date.formatString('0MM/0DD/YYYY');
	var shortHoliday = date.formatString('0MM/0DD');
	for(var i = 0; i &lt; config.macros.date.holidays.length; i++) {
		var holiday=config.macros.date.holidays[i];
		if (holiday==longHoliday||holiday==shortHoliday) return true;
	}
	return false;
}
//}}}
//{{{
// Event handler for clicking on a day popup
function onClickDatePopup(e) { e=e||window.event;
	var p=Popup.create(this); if (!p) return false;
	// always show dated tiddler link (or just date, if readOnly) at the top...
	if (!readOnly || store.tiddlerExists(this.date.formatString(this.linkformat)))
		createTiddlyLink(createTiddlyElement(p,'li'),this.date.formatString(this.linkformat),true);
	else
		createTiddlyText(createTiddlyElement(p,'li'),this.date.formatString(this.linkformat));
	if (!config.options.chkDatePopupHideCreated)
		addCreatedsToPopup(p,this.date,this.format);
	if (!config.options.chkDatePopupHideChanged)
		addModifiedsToPopup(p,this.date,this.format);
	if (!config.options.chkDatePopupHideTagged)
		addTaggedToPopup(p,this.date,this.linkformat);
	if (!config.options.chkDatePopupHideReminders)
		addRemindersToPopup(p,this.date,this.linkformat);
	Popup.show(); e.cancelBubble=true; if(e.stopPropagation)e.stopPropagation(); return false;
}
//}}}
//{{{
function indexCreateds() // build list of tiddlers, hash indexed by creation date
{
	var createds= { };
	var tiddlers = store.getTiddlers('title','excludeLists');
	for (var t = 0; t &lt; tiddlers.length; t++) {
		var date = tiddlers[t].created.formatString('YYYY0MM0DD')
		if (!createds[date])
			createds[date]=new Array();
		createds[date].push(tiddlers[t].title);
	}
	return createds;
}
function hasCreateds(date) // returns true if date has created tiddlers
{
	if (!config.macros.date.createds) config.macros.date.createds=indexCreateds();
	return (config.macros.date.createds[date.formatString('YYYY0MM0DD')]!=undefined);
}

function addCreatedsToPopup(p,when,format)
{
	var force=(store.isDirty() &amp;&amp; when.formatString('YYYY0MM0DD')==new Date().formatString('YYYY0MM0DD'));
	if (force || !config.macros.date.createds) config.macros.date.createds=indexCreateds();
	var indent=String.fromCharCode(160)+String.fromCharCode(160);
	var createds = config.macros.date.createds[when.formatString('YYYY0MM0DD')];
	if (createds) {
		createds.sort();
		var e=createTiddlyElement(p,'div',null,null,'created ('+createds.length+')');
		for(var t=0; t&lt;createds.length; t++) {
			var link=createTiddlyLink(createTiddlyElement(p,'li'),createds[t],false);
			link.appendChild(document.createTextNode(indent+createds[t]));
		}
	}
}
//}}}
//{{{
function indexModifieds() // build list of tiddlers, hash indexed by modification date
{
	var modifieds= { };
	var tiddlers = store.getTiddlers('title','excludeLists');
	for (var t = 0; t &lt; tiddlers.length; t++) {
		var date = tiddlers[t].modified.formatString('YYYY0MM0DD')
		if (!modifieds[date])
			modifieds[date]=new Array();
		modifieds[date].push(tiddlers[t].title);
	}
	return modifieds;
}
function hasModifieds(date) // returns true if date has modified tiddlers
{
	if (!config.macros.date.modifieds) config.macros.date.modifieds = indexModifieds();
	return (config.macros.date.modifieds[date.formatString('YYYY0MM0DD')]!=undefined);
}

function addModifiedsToPopup(p,when,format)
{
	var date=when.formatString('YYYY0MM0DD');
	var force=(store.isDirty() &amp;&amp; date==new Date().formatString('YYYY0MM0DD'));
	if (force || !config.macros.date.modifieds) config.macros.date.modifieds=indexModifieds();
	var indent=String.fromCharCode(160)+String.fromCharCode(160);
	var mods = config.macros.date.modifieds[date];
	if (mods) {
		// if a tiddler was created on this date, don't list it in the 'changed' section
		if (config.macros.date.createds &amp;&amp; config.macros.date.createds[date]) {
			var temp=[];
			for(var t=0; t&lt;mods.length; t++)
				if (!config.macros.date.createds[date].contains(mods[t]))
					temp.push(mods[t]);
			mods=temp;
		}
		mods.sort();
		var e=createTiddlyElement(p,'div',null,null,'changed ('+mods.length+')');
		for(var t=0; t&lt;mods.length; t++) {
			var link=createTiddlyLink(createTiddlyElement(p,'li'),mods[t],false);
			link.appendChild(document.createTextNode(indent+mods[t]));
		}
	}
}
//}}}
//{{{
function hasTagged(date,format) // returns true if date is tagging other tiddlers
{
	return store.getTaggedTiddlers(date.formatString(format)).length&gt;0;
}

function addTaggedToPopup(p,when,format)
{
	var indent=String.fromCharCode(160)+String.fromCharCode(160);
	var tagged=store.getTaggedTiddlers(when.formatString(format));
	if (tagged.length) var e=createTiddlyElement(p,'div',null,null,'tagged ('+tagged.length+')');
	for(var t=0; t&lt;tagged.length; t++) {
		var link=createTiddlyLink(createTiddlyElement(p,'li'),tagged[t].title,false);
		link.appendChild(document.createTextNode(indent+tagged[t].title));
	}
}
//}}}
//{{{
function indexReminders(date,leadtime) // build list of tiddlers with reminders, hash indexed by reminder date
{
	var reminders = { };
	if(window.findTiddlersWithReminders!=undefined) { // reminder plugin is installed
		var t = findTiddlersWithReminders(date, [0,leadtime], null, null, 1);
		for(var i=0; i&lt;t.length; i++) reminders[t[i].matchedDate]=true;
	}
	return reminders;
}

function hasReminders(date) // returns true if date has reminders
{
	if (window.reminderCacheForCalendar)
		return window.reminderCacheForCalendar[date]; // use calendar cache
	if (!config.macros.date.reminders)
		config.macros.date.reminders = indexReminders(date,90); // create a 90-day leadtime reminder cache
	return (config.macros.date.reminders[date]);
}

function addRemindersToPopup(p,when,format)
{
	if(window.findTiddlersWithReminders==undefined) return; // reminder plugin not installed

	var indent = String.fromCharCode(160)+String.fromCharCode(160);
	var reminders=findTiddlersWithReminders(when, [0,31],null,null,1);
	createTiddlyElement(p,'div',null,null,'reminders ('+(reminders.length||'none')+')');
	for(var t=0; t&lt;reminders.length; t++) {
		link = createTiddlyLink(createTiddlyElement(p,'li'),reminders[t].tiddler,false);
		var diff=reminders[t].diff;
		diff=(diff&lt;1)?'Today':((diff==1)?'Tomorrow':diff+' days');
		var txt=(reminders[t].params['title'])?reminders[t].params['title']:reminders[t].tiddler;
		link.appendChild(document.createTextNode(indent+diff+' - '+txt));
	}
	if (readOnly) return;	// readonly... omit 'new reminder...' command
	var rem='\\&lt;\\&lt;reminder day:%0 month:%1 year:%2 title:&quot;Enter a reminder title here&quot;\\&gt;\\&gt;';
	rem=rem.format([when.getDate(),when.getMonth()+1,when.getYear()+1900]);
	var cmd=&quot;&lt;&lt;newTiddler label:[[&quot;+indent+&quot;new reminder...]] prompt:[[add a reminder to '%0']]&quot;
		+&quot; title:[[%0]] text:{{var t=store.getTiddlerText('%0','');t+(t.length?'\\n':'')+'%1'}} tag:%2&gt;&gt;&quot;;
	wikify(cmd.format([when.formatString(format),rem,config.options.txtCalendarReminderTags||'']),
		createTiddlyElement(p,'li'));
}
//}}}</pre>
</div>
<div title="DatePluginConfig" modifier="shankar " created="200607231833" modified="200910312249" tags="settings systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|DatePluginConfig|
|Source|http://www.TiddlyTools.com/#DatePluginConfig|
|Documentation|http://www.TiddlyTools.com/#DatePluginInfo|
|Version|2.6.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|formats, background colors and other optional settings for DatePlugin|
***/
// // Default popup content display options (can be overridden by cookies)
//{{{
if (config.options.chkDatePopupHideCreated===undefined)
	config.options.chkDatePopupHideCreated=false;
if (config.options.chkDatePopupHideChanged===undefined)
	config.options.chkDatePopupHideChanged=false;
if (config.options.chkDatePopupHideTagged===undefined)
	config.options.chkDatePopupHideTagged=false;
if (config.options.chkDatePopupHideReminders===undefined)
	config.options.chkDatePopupHideReminders=false;
//}}}

// // show Julian date number below regular date
//{{{
if (config.options.chkShowJulianDate===undefined)
	config.options.chkShowJulianDate=false;
//}}}

// // fixed-date annual holidays
//{{{
config.macros.date.holidays=[
	&quot;01/01&quot;, // NewYearsDay, 
	&quot;07/04&quot;, // US Independence Day
	&quot;07/24&quot;  // Eric's Birthday (hooray!)
];
//}}}

// // weekend map (1=weekend, 0=weekday)
//{{{
config.macros.date.weekend=[ 1,0,0,0,0,0,1 ]; // day index values: sun=0, mon=1, tue=2, wed=3, thu=4, fri=5, sat=6
//}}}

// // date display/link formats
//{{{
config.macros.date.format=&quot;YYYY.0MM.0DD&quot;; // default date display format
config.macros.date.linkformat=&quot;YYYY.0MM.0DD&quot;; // 'dated tiddler' link format
//}}}

// // When displaying a calendar (see [[CalendarPlugin]]), you can customize the colors/styles that are applied to the calendar dates by modifying the values and/or functions below:
//{{{
// default calendar colors
config.macros.date.weekendbg=&quot;#c0c0c0&quot;;
config.macros.date.holidaybg=&quot;#ffaace&quot;;
config.macros.date.createdbg=&quot;#bbeeff&quot;;
config.macros.date.modifiedsbg=&quot;#bbeeff&quot;;
config.macros.date.linkedbg=&quot;#babb1e&quot;;
config.macros.date.remindersbg=&quot;#c0ffee&quot;;
config.macros.calendar.monthbg = &quot;transparent&quot;;

// apply calendar styles
function setDateStyle(place,link,weekend) {
	// alias variable names for code readability
	var date=link.date;
	var fmt=link.linkformat;
	var linkto=date.formatString(fmt);
	var cmd=config.macros.date;

	if ((weekend!==undefined?weekend:isWeekend(date))&amp;&amp;(cmd.weekendbg!=&quot;&quot;))
		{ place.style.background = cmd.weekendbg; }
	if (hasModifieds(date)||hasCreateds(date)||hasTagged(date,fmt))
		{ link.style.fontStyle=&quot;normal&quot;; link.style.fontWeight=&quot;bold&quot;; }
	if (hasReminders(date))
		{ link.style.textDecoration=&quot;underline&quot;; }
	if (isToday(date))
		{ link.style.border=&quot;1px solid black&quot;; }
	if (isHoliday(date)&amp;&amp;(cmd.holidaybg!=&quot;&quot;))
		{ place.style.background = cmd.holidaybg; }
	if (hasCreateds(date)&amp;&amp;(cmd.createdbg!=&quot;&quot;))
		{ place.style.background = cmd.createdbg; }
	if (hasModifieds(date)&amp;&amp;(cmd.modifiedsbg!=&quot;&quot;))
		{ place.style.background = cmd.modifiedsbg; }
	if ((hasTagged(date,fmt)||store.tiddlerExists(linkto))&amp;&amp;(cmd.linkedbg!=&quot;&quot;))
		{ place.style.background = cmd.linkedbg; }
	if (hasReminders(date)&amp;&amp;(cmd.remindersbg!=&quot;&quot;))
		{ place.style.background = cmd.remindersbg; }
	if (isToday(date)&amp;&amp;(cmd.todaybg!=&quot;&quot;))
		{ place.style.background = cmd.todaybg; }
	if (config.options.chkShowJulianDate) {
		var m=[0,31,59,90,120,151,181,212,243,273,304,334];
		var d=date.getDate()+m[date.getMonth()];
		var y=date.getFullYear();
		if (date.getMonth()&gt;1 &amp;&amp; (y%4==0 &amp;&amp; y%100!=0) || y%400==0) d++; // after February in a leap year
		wikify(&quot;@@font-size:80%;&lt;br&gt;&quot;+d+&quot;@@&quot;,place);
	}
	var t=store.getTiddlerText(linkto,'')
	if (config.options.chkInlineCalendarJournals &amp;&amp; t.length) wikify('&lt;br&gt;'+t,place);
}
//}}}</pre>
</div>
<div title="DatePluginInfo" modifier="shankar " created="200801090131" modified="200910301138" tags="pluginInfo mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>|Name|DatePluginInfo|
|Source|http://www.TiddlyTools.com/#DatePlugin|
|Documentation|http://www.TiddlyTools.com/#DatePluginInfo|
|Version|2.7.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|documentation|
|Description|documentation for DatePlugin|
This plugin provides a general approach to displaying formatted dates and/or links and popups that permit easy navigation and management of tiddlers based on their creation/modification dates.
!!!!!Usage
&lt;&lt;&lt;
This plugin displays formatted dates, for the specified year, month, day using number values or mathematical expressions such as (Y+1) or (D+30).  Optionally, you can create a link to a 'dated tiddler' for quick blogging or create a popup menu that includes the dated tiddler link plus links to tiddlers that were created/changed on that date, or are tagged with that date and, if the RemindersPlugin is installed, any pending reminders for the coming 31 days.  There is also a public API, so other plugins can embed a variety of formatted date output, links, and/or popup menus.
{{{
&lt;&lt;date mode date format linkformat&gt;&gt;
}}}
//all parameters are optional//
*''mode''&lt;br&gt;is one of:
**''display'' (default)&lt;br&gt;shows a formatted date
**''link''&lt;br&gt;creates a link to a specific 'date titled' tiddler
**''popup''&lt;br&gt;creates a popup command containing a dated tiddler link, plus links to changes and reminders.
*''date''&lt;br&gt;lets you enter ANY date (not just today) as ''year, month, and day values or simple mathematical expressions'' using pre-defined variables, Y, M, and D for the current year, month and day, repectively.  You can display the modification date of the current tiddler by using the keyword: ''tiddler'' in place of the year, month and day parameters.  Use ''tiddler://name-of-tiddler//'' to display the modification date of a specific tiddler.  You can also use keywords ''today'' or ''filedate'' to refer to these //dynamically changing// date/time values.  
*{{block{
''format'' and ''linkformat''
uses standard ~TiddlyWiki date formatting syntax.  The default is &quot;YYYY.0MM.0DD&quot;
&gt;''DDD'' - day of week in full (eg, &quot;Monday&quot;), ''DD'' - day of month, ''0DD'' - adds leading zero
&gt;''MMM'' - month in full (eg, &quot;July&quot;), ''MM'' - month number, ''0MM'' - adds leading zero
&gt;''YYYY'' - full year, ''YY'' - two digit year, ''hh'' - hours, ''mm'' - minutes, ''ss'' - seconds
&gt;//note: use of hh, mm or ss format codes is only supported with ''tiddler'', ''today'' or ''filedate'' values//
}}}
*''linkformat''&lt;br&gt;specify an alternative date format so that the title of a 'dated tiddler' link can have a format that differs from the date's displayed format
In addition to the macro syntax, DatePlugin also provides a public javascript API so that other plugins that work with dates (such as calendar generators, etc.) can quickly incorporate date formatted links or popups into their output:
{{{
showDate(place, date, mode, format, linkformat, autostyle, weekend);
}}} 
Note that the javascript API supports two //optional// true/false parameters, in addition those provided by the macro interface:
*''autostyle''&lt;br&gt;font/background styles of formatted dates are automatically adjusted to show the date's status:  'today' is boxed, 'changes' are bold, 'reminders' are underlined, weekends, holidays, changes, and reminders each have a different background color to make them more visibly distinct from one another.
*''weekend''&lt;br&gt;true=day is a weekend, false=day is a weekday, default=automatically determine if a given date falls on a weekend.
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
The current date: &lt;&lt;date&gt;&gt;
The current time: &lt;&lt;date today &quot;0hh:0mm:0ss&quot;&gt;&gt;
Today's blog: &lt;&lt;date link today &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
Recent blogs/changes/reminders: &lt;&lt;date popup Y M D-1 &quot;yesterday&quot;&gt;&gt; &lt;&lt;date popup today &quot;today&quot;&gt;&gt; &lt;&lt;date popup Y M D+1 &quot;tomorrow&quot;&gt;&gt;
The first day of next month will be a &lt;&lt;date Y M+1 1 &quot;DDD&quot;&gt;&gt;
This tiddler (DatePlugin) was last updated on: &lt;&lt;date tiddler &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
The SiteUrl was last updated on: &lt;&lt;date tiddler:SiteUrl &quot;DDD, MMM DDth, YYYY&quot;&gt;&gt;
This document was last saved on &lt;&lt;date filedate &quot;DDD, MMM DDth, YYYY at 0hh:0mm:0ss&quot;&gt;&gt;
&lt;&lt;date 2006 07 24 &quot;MMM DDth, YYYY&quot;&gt;&gt; will be a &lt;&lt;date 2006 07 24 &quot;DDD&quot;&gt;&gt;
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.05.31 2.7.1 in addRemindersToPopup(), 'new reminder....' command now uses {{{&lt;&lt;newTiddler&gt;&gt;}}} macro.  Also, general code reduction/cleanup.
2008.03.08 2.7.0 in addModifiedsToPopup(), if a tiddler was created on the specified date, don't list it in the 'changed' section of the popup.  Based on a request from Kashgarinn
2008.01.31 2.6.0 refactored date style logic into separate setDateStyle() function so it can be overridden by a custom definition.  See [[DatePluginConfig]].
2008.01.11 2.5.0 added options to selectively suppress created/changes/tagged/reminders popup content 
2008.01.08 [*.*.*] plugin size reduction: documentation moved to DatePluginInfo
2007.11.21 2.4.0 added hasTagged() and addTaggedToPopup() to list any tiddlers that has been tagged using the title of the dated journal tiddler asa tag value (i.e., the tiddlers that will be listed in the standard &quot;tagging&quot; display when viewing the journal tiddler itself).  Based on a request from Coby.
2007.06.20 2.3.1 in onClickDatePopup(), use Popup.show() instead of deprecated ScrollToTiddlerPopup().  Fixes fatal error that prevents popups from being properly displayed
2007.05.31 2.3.0 list &quot;created&quot; tiddlers in date popup.  Also, force re-cache of created/modified indices when displaying current date and store.isDirty(), so that popup is kept in sync with tiddler changes.
2006.05.09 2.2.1 added &quot;todaybg&quot; handling to set background color of current date.  Also, honor excludeLists tag when getting lists of tiddlers.  Based on suggestions by Mark Hulme.
2006.05.05 2.2.0 added &quot;linkedbg&quot; handling to set background color when a 'dated tiddler' exists.  Based on a suggestion by Mark Hulme.
2006.03.08 2.1.2 add 'override leadtime' flag param in call to findTiddlersWithReminders(), and add &quot;Enter a title&quot; default text to new reminder handler.  Thanks to Jeremy Sheeley for these additional tweaks.
2006.03.06 2.1.0 hasReminders() nows uses window.reminderCacheForCalendar[] when present.  If calendar cache is not present, indexReminders() now uses findTiddlersWithReminders() with a 90-day look ahead to check for reminders.  Also, switched default background colors for autostyled dates: reminders are now greenish (&quot;c0ffee&quot;) and holidays are now reddish (&quot;ffaace&quot;).
2006.02.14 2.0.5 when readOnly is set (by TW core), omit &quot;new reminders...&quot; popup menu item and, if a &quot;dated tiddler&quot; does not already exist, display the date as simple text instead of a link.
2006.02.05 2.0.4 added var to variables that were unintentionally global.  Avoids FireFox 1.5.0.1 crash bug when referencing global variables
2006.01.18 2.0.3 In 1.2.x the tiddler editor's text area control was given an element ID=(&quot;tiddlerBody&quot;+title), so that it was easy to locate this field and programmatically modify its content.  With the addition of configuration templates in 2.x, the textarea no longer has an ID assigned.  To find this control we now look through all the child nodes of the tiddler editor to locate a &quot;textarea&quot; control where attribute(&quot;edit&quot;) equals &quot;text&quot;, and then append the new reminder to the contents of that control.
2006.01.11 2.0.2 correct 'weekend' override detection logic in showDate()
2006.01.10 2.0.1 allow custom-defined weekend days (default defined in config.macros.date.weekend[] array)
added flag param to showDate() API to override internal weekend[] array
2005.12.27 2.0.0 Update for TW2.0
Added parameter handling for 'linkformat'
2005.12.21 1.2.2 FF's date.getYear() function returns 105 (for the current year, 2005).  When calculating a date value from Y M and D expressions, the plugin adds 1900 to the returned year value get the current year number.  But IE's date.getYear() already returns 2005.  As a result, plugin calculated date values on IE were incorrect (e.g., 3905 instead of 2005).  Adding +1900 is now conditional so the values will be correct on both browsers.
2005.11.07 1.2.1 added support for &quot;tiddler&quot; dynamic date parameter
2005.11.06 1.2.0 added support for &quot;tiddler:title&quot; dynamic date parameter
2005.11.03 1.1.2 when a reminder doesn't have a specified title parameter, use the title of the tiddler that contains the reminder as &quot;fallback&quot; text in the popup menu.  Based on a suggestion from BenjaminKudria.
2005.11.03 1.1.1 Temporarily bypass hasReminders() logic to avoid excessive overhead from generating the indexReminders() cache.  While reminders can still appear in the popup menu, they just won't be indicated by auto-styling the date number that is displayed.  This single change saves approx. 60% overhead (5 second delay reduced to under 2 seconds).
2005.11.01 1.1.0 corrected logic in hasModifieds() and hasReminders() so caching of indexed modifieds and reminders is done just once, as intended.  This should hopefully speed up calendar generators and other plugins that render multiple dates...
2005.10.31 1.0.1 documentation and code cleanup
2005.10.31 1.0.0 initial public release
2005.10.30 0.9.0 pre-release
&lt;&lt;&lt;</pre>
</div>
<div title="DcTableOfContentsPlugin" modifier="Shankar Swamy" created="200711141727" modified="200911061325" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
&lt;&lt;showtoc&gt;&gt;
|Name|DcTableOfContentsPlugin|
|Author|[[Doug Compton|http://www.zagware.com/tw/plugins.html#DcTableOfContentsPlugin]]|
|Contributors|[[Lewcid|http://lewcid.org]], [[FND|http://devpad.tiddlyspot.com]], [[ELS|http://www.tiddlytools.com]]|
|Source|[[FND's DevPad|http://devpad.tiddlyspot.com#DcTableOfContentsPlugin]]|
|Version|0.4.1|
|~CoreVersion|2.2|
!Description
This macro inserts a table of contents for all headings used in a tiddler and automatically updates on changes. Each ToC entry can be clicked to jump to that heading. A link is placed next to each header allowing to jump to the top of the current tiddler. The appearance can be modified using CSS in the StyleSheet tiddler.
!Usage
!!Only in select tiddlers!
The table of contents at the beginning of this tiddler is an example of how to use this macro in a tiddler. Just insert {{{&lt;&lt;showtoc&gt;&gt;}}} in a tiddler on a line by itself.
It can also display the table of contents of another tiddler by using the macro with a parameter: {{{&lt;&lt;showtoc tiddlerTitle&gt;&gt;}}}
!!On every tiddler
You can also show it on every tiddler by modifying the ViewTemplate as shown below.
//{{{
&lt;div class='toolbar' macro='toolbar -closeTiddler closeOthers +editTiddler permalink references jump'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='subtitle'&gt;Created &lt;span macro='view created date DD-MM-YY'&gt;&lt;/span&gt;, updated &lt;span macro='view modified date DD-MM-YY'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div class='tagging' macro='tagging'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class=&quot;toc&quot; macro='showtoc'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
//}}}
!Code
***/
//{{{
version.extensions.DcTableOfContentsPlugin= {
	major: 0, minor: 4, revision: 0,
	type: &quot;macro&quot;,
	source: &quot;http://devpad.tiddlyspot.com#DcTableOfContentsPlugin&quot;
};

// Replace heading formatter with our own
for (var n=0; n&lt;config.formatters.length; n++) {
	var format = config.formatters[n];
	if (format.name == 'heading') {
		format.handler = function(w) {
			// following two lines is the default handler
			var e = createTiddlyElement(w.output, &quot;h&quot; + w.matchLength);
			w.subWikifyTerm(e, this.termRegExp); //updated for TW 2.2+

			// Only show [top] if current tiddler is using showtoc
			if (w.tiddler &amp;&amp; w.tiddler.isTOCInTiddler == 1) {
				// Create a container for the default CSS values
				var c = createTiddlyElement(e, &quot;div&quot;);
				c.setAttribute(&quot;style&quot;, &quot;color: blue;float:right;margin-top:-1.1em;&quot;);
				// Create the link to jump to the top
				createTiddlyButton(c, &quot;^ ToC&quot;, &quot;Go to Table of Contents&quot;, window.scrollToTop, &quot;dcTOCTop&quot;, null, null);
			}
		}
		break;
	}
}

config.macros.showtoc = {
	handler: function(place, macroName, params, wikifier, paramString, tiddler) {
		var text = &quot;&quot;;
		var title = &quot;&quot;;
		var myTiddler = null;

		// Did they pass in a tiddler?
		if (params.length) {
			title = params[0];
			myTiddler = store.getTiddler(title);
		} else {
			myTiddler = tiddler;
		}

		if (myTiddler == null) {
			wikify(&quot;ERROR: Could not find &quot; + title, place);
			return;
		}

		var lines = myTiddler .text.split(&quot;\n&quot;);
		myTiddler.isTOCInTiddler = 1;

		// Create a parent container so the TOC can be customized using CSS
		var r = createTiddlyElement(place, &quot;div&quot;, null, &quot;dcTOC&quot;);
		// create toggle button
		createTiddlyButton(r, &quot;Table of Contents...&quot;, &quot;show/collapse table of contents&quot;,
			function() { config.macros.showtoc.toggleElement(this.nextSibling); },
			&quot;toggleButton&quot;)
		// Create a container so the TOC can be customized using CSS
		var c = createTiddlyElement(r, &quot;div&quot;);

		if (lines != null) {
			for (var x=0; x&lt;lines.length; x++) {
				var line = lines[x];
				if (line.substr(0,1) == &quot;!&quot;) {
					// Find first non ! char
					for (var i=0; i&lt;line.length; i++) {
						if (line.substr(i, 1) != &quot;!&quot;) {
							break;
						}
					}
					var desc = line.substring(i);
					// Remove WikiLinks
					desc = desc.replace(/\[\[/g, &quot;&quot;);
					desc = desc.replace(/\]\]/g, &quot;&quot;);

					text += line.substr(0, i).replace(/[!]/g, '*');
					text += '&lt;html&gt;&lt;a href=&quot;javascript:;&quot; onClick=&quot;window.scrollToHeading(\'' + title + '\', \'' + desc+ '\', event)&quot;&gt;' + desc+ '&lt;/a&gt;&lt;/html&gt;\n';
				}
			}
		}
		wikify(text, c);
	}
}

config.macros.showtoc.toggleElement = function(e) {
	if(e) {
		if(e.style.display != &quot;none&quot;) {
			e.style.display = &quot;none&quot;;
		} else {
			e.style.display = &quot;&quot;;
		}
	}
};

window.scrollToTop = function(evt) {
	if (! evt)
		var evt = window.event;

	var target = resolveTarget(evt);
	var tiddler = story.findContainingTiddler(target);

	if (! tiddler)
		return false;

	window.scrollTo(0, ensureVisible(tiddler));

	return false;
};

window.scrollToHeading = function(title, anchorName, evt) {
	var tiddler = null;

	if (! evt)
		var evt = window.event;

	if (title) {
		story.displayTiddler(store.getTiddler(title), title, null, false);
		tiddler = document.getElementById(story.idPrefix + title);
	} else {
		var target = resolveTarget(evt);
		tiddler = story.findContainingTiddler(target);
	}

	if (tiddler == null)
		return false;
	
	var children1 = tiddler.getElementsByTagName(&quot;h1&quot;);
	var children2 = tiddler.getElementsByTagName(&quot;h2&quot;);
	var children3 = tiddler.getElementsByTagName(&quot;h3&quot;);
	var children4 = tiddler.getElementsByTagName(&quot;h4&quot;);
	var children5 = tiddler.getElementsByTagName(&quot;h5&quot;);

	var children = new Array();
	children = children.concat(children1, children2, children3, children4, children5);

	for (var i = 0; i &lt; children.length; i++) {
		for (var j = 0; j &lt; children[i].length; j++) {
			var heading = children[i][j].innerHTML;

			// Remove all HTML tags
			while (heading.indexOf(&quot;&lt;&quot;) &gt;= 0) {
				heading = heading.substring(0, heading.indexOf(&quot;&lt;&quot;)) + heading.substring(heading.indexOf(&quot;&gt;&quot;) + 1);
			}

			// Cut off the code added in showtoc for TOP
			heading = heading.substr(0, heading.length-5);

			if (heading == anchorName) {
				var y = findPosY(children[i][j]);
				window.scrollTo(0,y);
				return false;
			}
		}
	}
	return false
};
//}}}</pre>
</div>
<div title="DefaultTags" modifier="YourName" created="201407202258" modified="201407210437" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>[&quot;2014-07-17 Note aaTag dayNotes&quot;,&quot;aaTag&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;,&quot;&quot;]</pre>
</div>
<div title="DefaultTiddlers" modifier="YourName" created="200909150255" modified="201402171731" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>[[search]]



</pre>
</div>
<div title="DeprecatedFunctionsPlugin" modifier="YourName" created="200909150316" modified="200909150409" tags="systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name''|DeprecatedFunctionsPlugin|
|''Description''|Provides support for functions removed from the TiddlyWiki core|
|''Version''|1.0.0|
|''Status''|stable|
|''Source''|http://www.tiddlywiki.com/coreplugins.html#DeprecatedFunctionsPlugin|
|''~CodeRepository:''|http://svn.tiddlywiki.org/Trunk/association/plugins/DeprecatedFunctionsPlugin/DeprecatedFunctionsPlugin.js |
|''License''|[[BSD open source license]]|
|''~CoreVersion''|2.3.0|
|''Feedback''|[[TiddlyWiki community|http://groups.google.com/group/TiddlyWiki]] |
|''Keywords''|legacySupport|
!Code
***/
//{{{
if(!version.extensions.DeprecatedFunctionsPlugin) {
version.extensions.DeprecatedFunctionsPlugin = {installed:true};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,&quot;\r&quot;);
		createTiddlyElement(w.output,&quot;pre&quot;,null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use &lt;br&gt; or &lt;br /&gt; instead of &lt;&lt;br&gt;&gt;
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,&quot;br&quot;);
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp(&quot;\\\\n&quot;,&quot;mg&quot;);
var regexpBackSlash = new RegExp(&quot;\\\\&quot;,&quot;mg&quot;);
var regexpBackSlashEss = new RegExp(&quot;\\\\s&quot;,&quot;mg&quot;);
var regexpNewLine = new RegExp(&quot;\n&quot;,&quot;mg&quot;);
var regexpCarriageReturn = new RegExp(&quot;\r&quot;,&quot;mg&quot;);

}
//}}}</pre>
</div>
<div title="Directory Listing" modifier="shankar " created="200910220247" modified="200910301134" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tiddler ShowLocalDirectory&gt;&gt;</pre>
</div>
<div title="DisableDoubleClickOnTiddlers" modifier="shankar " created="200909181907" modified="200910301136" tags="aaTag systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>if (config.options['chkDoubleClickToEdit']===undefined)
        config.options['chkDoubleClickToEdit']=true;
if (!Story.prototype.onTiddlerDblClick_save) {

Story.prototype.onTiddlerDblClick_save=Story.prototype.onTiddlerDblClick;
        Story.prototype.onTiddlerDblClick = function(ev) {
                if (config.options['chkDoubleClickToEdit'])
                        return story.onTiddlerDblClick_save.apply(this,arguments);
        }
} </pre>
</div>
<div title="EditTemplate" modifier="shankar " created="200611240612" modified="200910150456" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;div&gt;
&lt;span class='title' macro='view title' style='margin-right: 1.0em;' &gt;&lt;/span&gt;

&lt;span class='subtitle'&gt;
&lt;span macro='message views.wikified.createdPrompt' style='margin-left:0.2em'&gt;&lt;/span&gt;
&lt;span macro='view created date MM-DD-YYYY'&gt; &lt;/span&gt;
&lt;/span&gt;

&lt;span class='toolbar' macro='toolbar +closeOthers' style='margin-left: 1.0em;'&gt;&lt;/span&gt;
&lt;span class='toolbar' macro='toolbar cancelTiddler' style='margin-left: 1.0em;'&gt;&lt;/span&gt;
&lt;span class='editor' macro='edit title'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;div class='SlTidIDEStyles' macro='tidIDE +edit:here'&gt;&lt;/div&gt;</pre>
</div>
<div title="EmbeddedImages" modifier="YourName" created="200909150403" modified="200909151230" tags="closed excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>@@color:#ccc;Tiddlers tagged with attachment@@
----
{{twocolumns{
&lt;script&gt;
// get all tiddlers tagged with &quot;attachment&quot;
var tids=store.getTaggedTiddlers(&quot;attachment&quot;);
// keep only tiddlers *also* tagged with New
var list=[];
for (var t=0; t&lt;tids.length; t++)
   if (tids[t].isTagged(&quot;attachment&quot;)) list.push(tids[t]);
// create output list of tiddler titles, one per line
var out=&quot;&quot;;
for (var t=0; t&lt;list.length; t++) out+=&quot;#[[&quot;+list[t].title+&quot;]]\n&quot;;
return out;
&lt;/script&gt;
}}} </pre>
</div>
<div title="ExtendTagButtonPlugin" modifier="Shankar Swamy" created="200803080053" modified="200809210418" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|ExtentTagButtonPlugin|
|Description:|Adds a New tiddler button in the tag drop down|
|Version:|3.2 ($Rev: 3861 $)|
|Date:|$Date: 2008-03-08 10:53:09 +1000 (Sat, 08 Mar 2008) $|
|Source:|http://mptw.tiddlyspot.com/#ExtendTagButtonPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License|http://mptw.tiddlyspot.com/#TheBSDLicense|
***/
//{{{

window.onClickTag_mptw_orig = window.onClickTag;
window.onClickTag = function(e) {
	window.onClickTag_mptw_orig.apply(this,arguments);
	var tag = this.getAttribute(&quot;tag&quot;);
	var title = this.getAttribute(&quot;tiddler&quot;);
	// Thanks Saq, you're a genius :)
	var popup = Popup.stack[Popup.stack.length-1].popup;
	createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;,null,&quot;listBreak&quot;),&quot;div&quot;);
	wikify(&quot;&lt;&lt;newTiddler label:'New tiddler' tag:'&quot;+tag+&quot;'&gt;&gt;&quot;,createTiddlyElement(popup,&quot;li&quot;));
	return false;
}

//}}}</pre>
</div>
<div title="ExtendedSidebarTabs" modifier="YourName" created="200911121358" modified="200911121855" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tabs txtMainTab &quot;Timeline&quot; &quot;Timeline&quot; TabTimeline &quot;All&quot; &quot;All tiddlers&quot; TabAll &quot;Tags&quot; &quot;All tags&quot; TabTags &quot;More&quot; &quot;More lists&quot; ExtendedTabMore&gt;&gt;</pre>
</div>
<div title="ExtendedTabMore" modifier="shankar " created="200911121854" modified="200911140451" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tabs txtMoreTab &quot;System&quot; &quot;System Components&quot; SystemList &quot;Shadowed&quot; &quot;Shadowed tiddlers&quot; TabMoreShadowed &quot;Missing&quot; &quot;Missing tiddlers&quot; TabMoreMissing &quot;Orphans&quot; &quot;Orphaned tiddlers&quot; TabMoreOrphans &quot;Unlisted&quot; tiddler ListUnlisted&gt;&gt;</pre>
</div>
<div title="FileDropPlugin" modifier="Shankar" created="200909151552" modified="200909151552" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|FileDropPlugin|
|Source|http://www.TiddlyTools.com/#FileDropPlugin|
|Version|2.0.0|
|Author|BradleyMeck and Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Requires|FireFox or mozilla-compatible browser|
|Overrides||
|Options|##Configuration|
|Description|drag-and-drop files/directories to create tiddlers|
This plugin registers window event handlers for 'dragdrop' (FireFox 3.1-) and 'drop' (FireFox3.5+) events to automatically create tiddlers from files that are dragged and dropped into an open TiddlyWiki document.  It supports extended handling for multiple files and/or directories, as well as optional handling for embedding binary files if [[AttachFilePlugin]], [[AttachFilePluginFormatters]] and [[AttachFileMIMETypes]] are installed.
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkFileDropTrimFilename&gt;&gt; Omit file extensions from tiddler titles when creating new tiddlers
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option chkFileDropTrimFilename&gt;&gt; }}}
&lt;&lt;option chkFileDropDisplay&gt;&gt; Automatically display newly created tiddlers
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option chkFileDropDisplay&gt;&gt; }}}
Tag newly created tiddlers with: &lt;&lt;option txtFileDropTags&gt;&gt;
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option txtFileDropTags&gt;&gt;}}}

__FileDrop+AttachFile configuration options:__
&lt;&lt;option chkFileDropAttachLocalLink&gt;&gt; Include reference to local path/filename
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option chkFileDropAttachLocalLink&gt;&gt; }}}
&lt;&lt;option chkFileDropAttachEncodeData&gt;&gt; Include binary file data as encoded &quot;base64&quot; text
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option chkFileDropAttachEncodeData&gt;&gt; }}}
...only if file is smaller than: &lt;&lt;option txtFileDropAttachDataLimit&gt;&gt; bytes
&amp;nbsp;&amp;nbsp;{{{usage: &lt;&lt;option txtFileDropAttachDataLimit&gt;&gt;}}}

//Note: if the plugin does not seem to work, open up the page 'about:config' (just type it in the address bar) and make sure ''signed.applets.codebase_principal_support'' is set to ''true''//
&lt;&lt;&lt;
!!!!!Examples (custom handler functions)
&lt;&lt;&lt;
Adds a single file with confirmation and prompting for title:
{{{
config.macros.fileDrop.addEventListener('application/x-moz-file',
	function(nsiFile) {
		var msg='You have dropped the file:\n'
			+nsiFile.path+'\n'
			+'onto the page, it will be imported as a tiddler. Is that ok?'
		if(confirm(msg)) {
			var newDate = new Date();
			var title = prompt('what would you like to name the tiddler?');
			store.saveTiddler(title,title,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
		}
		return true;
	});
}}}
Adds a single file without confirmation, using path/filename as tiddler title
{{{
config.macros.fileDrop.addEventListener('application/x-moz-file',
	function(nsiFile) {
		var newDate = new Date();
		store.saveTiddler(nsiFile.path,nsiFile.path,loadFile(nsiFile.path),config.options.txtUserName,newDate,[]);
		story.displayTiddler(null,nsiFile.path)
		return true;
	});
}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.08.19 2.0.0 ELS fixed event listener registration for FireFox 3.5+.  Also, merged with FileDropPluginConfig, with code cleanup/reduction.
2008.08.11 1.5.1 added chkFileDropAttachLocalLink option to allow suppression of local path/file link
2007.01.01 0.9.9 extensions for AttachFilePlugin
2006.11.04 0.1.1 initial release by Bradley Meck
Old revision notes:
*Note: this version has been 'tweaked' by Eric Shulman (http://www.TiddlyTools.com) to add suspend/resume notification handling to improve performance when multiple files are dropped at once.
*Multiple File Dropping API updated, to end all capturing events after yours return a value that makes if(myFunctionsReturnValue) evaluate to true
*Added support for multiple file drop handlers
**Use the config.macros.fileDrop.addEventListener(@@color(green):String Flavor@@, @@color(green):Function handler(nsiFile){}@@, @@color(green):Boolean addToFront@@) function
***Standard Flavor is 'application/x-moz-file'
***addToFront gives your handler priority over all others at time of add
*Old plugin would disallow drops of text between applications because it didn't check if the transfer was a file.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.FileDropPlugin={major:2, minor:0, revision:0, date: new Date(2009,8,19)};

config.macros.fileDrop = {
	customDropHandlers: [],
	addEventListener: function(paramflavor,func,inFront) {
		var obj={}; obj.flavor=paramflavor; obj.handler=func;
		if (!inFront) this.customDropHandlers.push(obj);
		else this.customDropHandlers.shift(obj);
	},
	dragDropHandler: function(evt) {
		netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
		var dragService = Components.classes['@mozilla.org/widget/dragservice;1'].getService(Components.interfaces.nsIDragService);
		var dragSession = dragService.getCurrentSession();
		var transferObject = Components.classes['@mozilla.org/widget/transferable;1'].createInstance();
		transferObject = transferObject.QueryInterface(Components.interfaces.nsITransferable);
		transferObject.addDataFlavor('application/x-moz-file');
		var numItems = dragSession.numDropItems;
		if (numItems&gt;1) {
			clearMessage();
			displayMessage('Reading '+numItems+' files...');
			store.suspendNotifications();
		}
		for (var i = 0; i &lt; numItems; i++) {
			dragSession.getData(transferObject, i);
			var dataObj = {};
			var dropSizeObj = {};
			for(var ind=0; ind&lt;config.macros.fileDrop.customDropHandlers.length; ind++) {
				var item = config.macros.fileDrop.customDropHandlers[ind];
				if(dragSession.isDataFlavorSupported(item.flavor)) {
					transferObject.getTransferData(item.flavor, dataObj, dropSizeObj);
					var droppedFile = dataObj.value.QueryInterface(Components.interfaces.nsIFile);
					var result = item.handler.call(item,droppedFile);
					evt.stopPropagation();
					evt.preventDefault();
					if (result) break;
				}
			}
		}
		if (numItems&gt;1) {
			store.resumeNotifications();
			store.notifyAll();
			displayMessage(numItems+' files have been processed');
		}
	}
}
//}}}
/***
!!!!!window event handlers
***/
//{{{
if(!window.event) {
	window.addEventListener('dragdrop', config.macros.fileDrop.dragDropHandler, true); // FireFox3.1-
	window.addEventListener('drop', config.macros.fileDrop.dragDropHandler, true); // FireFox3.5+
}
//}}}
/***
!!!!!handler for files, directories and binary attachments (see [[AttachFilePlugin]])
&lt;&lt;&lt;
* use just filename instead of whole path as tiddler title
* check for existing tiddler and prompt for new name
* handle folder drops (drops each file or creates a file list in a tiddler)
* use AttachFilePlugin if MIME type is not text/plain
* autotag created tiddlers (e.g., &quot;temporary&quot;, &quot;dropped&quot;, etc.)
* option to suppress automatic display of newly created tiddlers
* suspend/resume notifications when handling multiple files (performance improvement)
&lt;&lt;&lt;
***/
//{{{
if (config.options.chkFileDropAttachEncodeData===undefined)
	config.options.chkFileDropAttachEncodeData=true;
if (config.options.chkFileDropAttachLocalLink===undefined)
	config.options.chkFileDropAttachLocalLink=true;
if (config.options.txtFileDropAttachDataLimit===undefined)
	config.options.txtFileDropAttachDataLimit=32768;
if (config.options.txtFileDropTags===undefined)
	config.options.txtFileDropTags=&quot;&quot;;
if (config.options.chkFileDropDisplay===undefined)
	config.options.chkFileDropDisplay=true;
if (config.options.chkFileDropTrimFilename===undefined)
	config.options.chkFileDropTrimFilename=false;

config.macros.fileDrop.addEventListener(&quot;application/x-moz-file&quot;,function(nsiFile) {

	var header=&quot;Index of %0\n^^(as of %1)^^\n|!filename| !size | !modified |\n&quot;;
	var item=&quot;|[[%0|%1]]| %2|%3|\n&quot;;
	var footer=&quot;Total of %0 bytes in %1 files\n&quot;;

	var now=new Date();
	var files=[nsiFile];
	if (nsiFile.isDirectory()) {
		var folder=nsiFile.directoryEntries;
		var files=[];
		while (folder.hasMoreElements()) {
			var f=folder.getNext().QueryInterface(Components.interfaces.nsILocalFile);
			if (f instanceof Components.interfaces.nsILocalFile &amp;&amp; !f.isDirectory()) files.push(f);
		}
		var msg=nsiFile.path.replace(/\\/g,&quot;/&quot;)+&quot;\n\n&quot;;
		msg+=&quot;contains &quot;+files.length+&quot; files... &quot;;
		msg+=&quot;select OK to attach all files or CANCEL to create a list...&quot;;
		if (!confirm(msg)) { // create a list in a tiddler
			var title=nsiFile.leafName; // tiddler name is last directory name in path
			while (title &amp;&amp; title.length &amp;&amp; store.tiddlerExists(title)) {
				if (confirm(config.messages.overwriteWarning.format([title]))) break; // use existing title
				title=prompt(&quot;Please enter a different tiddler title for this file&quot;,nsiFile.path.replace(/\\/g,&quot;/&quot;));
			}
			if (!title || !title.length) return true; // aborted by user... we're done!
			var text=header.format([nsiFile.path.replace(/\\/g,&quot;/&quot;),now.toLocaleString()]);
			var total=0;
			for (var i=0; i&lt;files.length; i++) { var f=files[i];
				var name=f.leafName;
				if (config.options.chkFileDropTrimFilename)
					{ var p=name.split(&quot;.&quot;); if (p.length&gt;1) p.pop(); name=p.join(&quot;.&quot;); }
				var path=&quot;file:///&quot;+f.path.replace(/\\/g,&quot;/&quot;);
				var size=f.fileSize; total+=size;
				var when=new Date(f.lastModifiedTime).formatString(&quot;YYYY.0MM.0DD 0hh:0mm:0ss&quot;);
				text+=item.format([name,path,size,when]);
			}
			text+=footer.format([total,files.length]);
			var newtags=config.options.txtFileDropTags?config.options.txtFileDropTags.readBracketedList():[];
			store.saveTiddler(null,title,text,config.options.txtUserName,now,newtags);
			if (config.options.chkFileDropDisplay) story.displayTiddler(null,title);
			return true;
		}
	}
	if (files.length&gt;1) store.suspendNotifications();
	for (i=0; i&lt;files.length; i++) {
		var file=files[i];
		if (file.isDirectory()) continue; // skip over nested directories
		var type=&quot;text/plain&quot;;
		var title=file.leafName; // tiddler name is file name
		if (config.options.chkFileDropTrimFilename)
			{ var p=title.split(&quot;.&quot;); if (p.length&gt;1) p.pop(); title=p.join(&quot;.&quot;); }
		var path=file.path;
		var size=file.fileSize;
		while (title &amp;&amp; title.length &amp;&amp; store.tiddlerExists(title)) {
			if (confirm(config.messages.overwriteWarning.format([title]))) break; // use existing title
			title=prompt(&quot;Please enter a different tiddler title for this file&quot;,path.replace(/\\/g,&quot;/&quot;));
		}
		if (!title || !title.length) continue; // cancelled by user... skip this file
		if (config.macros.attach) {
			type=config.macros.attach.getMIMEType(file.leafName,&quot;&quot;);
			if (!type.length)
				type=prompt(&quot;Unrecognized file type.  Please enter a MIME type for this file&quot;,&quot;text/plain&quot;);
			if (!type||!type.length) continue; // cancelled by user... skip this file
		}
		var newtags=config.options.txtFileDropTags?config.options.txtFileDropTags.readBracketedList():[];
		if (type==&quot;text/plain&quot;)
			store.saveTiddler(null,title,loadFile(path),config.options.txtUserName,now,newtags);
		else {
			// only encode data if enabled and file is smaller than limit.  Default is 32768 (32K) bytes.
			var embed=config.options.chkFileDropAttachEncodeData
				&amp;&amp; file.fileSize&lt;config.options.txtFileDropAttachDataLimit;
			newtags.push(&quot;attachment&quot;); newtags.push(&quot;excludeMissing&quot;);
			var localfile=&quot;&quot;;
			if (config.options.chkFileDropAttachLocalLink) {
				// if file is in current document folder,
				// remove path prefix and use relative reference
				var localfile=path;
				var h=document.location.href;
				folder=getLocalPath(decodeURIComponent(h.substr(0,h.lastIndexOf(&quot;/&quot;)+1)));
				if (localfile.substr(0,folder.length)==folder)
					localfile='./'+localfile.substr(folder.length);
			}
			config.macros.attach.createAttachmentTiddler(path,
				now.formatString(config.macros.timeline.dateFormat),
				&quot;attached by FileDropPlugin&quot;, newtags,
				title, embed, config.options.chkFileDropAttachLocalLink, false,
				localfile, &quot;&quot;, type,!config.options.chkFileDropDisplay);
		}
		if (config.options.chkFileDropDisplay) story.displayTiddler(null,title);
	}
	if (files.length&gt;1) { store.resumeNotifications(); store.notifyAll(); }
	return true;
})
//}}}</pre>
</div>
<div title="FontSizePlugin(withgiffmex tweak for Chrome)" modifier="YourName" created="200909151516" modified="200909210414" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|FontSizePlugin|
|Created by|SaqImtiaz|
|Location|http://tw.lewcid.org/#FontSizePlugin|
|Version|1.0|
|Requires|~TW2.x|
!Description:
Resize tiddler text on the fly. The text size is remembered between sessions by use of a cookie.
You can customize the maximum and minimum allowed sizes.
(only affects tiddler content text, not any other text)

Also, you can load a TW file with a font-size specified in the url.
Eg: http://tw.lewcid.org/#font:110

!Demo:
Try using the font-size buttons in the sidebar, or in the MainMenu above.

!Installation:
Copy the contents of this tiddler to your TW, tag with systemConfig, save and reload your TW.
Then put {{{&lt;&lt;fontSize &quot;font-size:&quot;&gt;&gt;}}} in your SideBarOptions tiddler, or anywhere else that you might like.

!Usage
{{{&lt;&lt;fontSize&gt;&gt;}}} results in &lt;&lt;fontSize&gt;&gt;
{{{&lt;&lt;fontSize font-size: &gt;&gt;}}} results in &lt;&lt;fontSize font-size:&gt;&gt;

!Customizing:
The buttons and prefix text are wrapped in a span with class fontResizer, for easy css styling.
To change the default font-size, and the maximum and minimum font-size allowed, edit the config.fontSize.settings section of the code below.

!Notes:
This plugin assumes that the initial font-size is 100% and then increases or decreases the size by 10%. This stepsize of 10% can also be customized.

!History:
*27-07-06, version 1.0 : prevented double clicks from triggering editing of containing tiddler.
*25-07-06,  version 0.9

!Code
***/

//{{{
config.fontSize={};

//configuration settings
config.fontSize.settings =
{
            defaultSize : 100,  // all sizes in %
            maxSize : 200,
            minSize : 40,
            stepSize : 10
};

//startup code
var fontSettings = config.fontSize.settings;

if (!config.options.txtFontSize)
            {config.options.txtFontSize = fontSettings.defaultSize;
            saveOptionCookie(&quot;txtFontSize&quot;);}
setStylesheet(&quot;.tiddler .viewer {font-size:&quot;+config.options.txtFontSize+&quot;%;}\n&quot;,&quot;fontResizerStyles&quot;);
setStylesheet(&quot;#contentWrapper .fontResizer .button {display:inline;font-size:105%; font-weight:bold; margin:0 1px; padding: 0 3px; text-align:center !important;}\n .fontResizer {margin:0 0.5em;}&quot;,&quot;fontResizerButtonStyles&quot;);

//macro
config.macros.fontSize={};
config.macros.fontSize.handler = function (place,macroName,params,wikifier,paramString,tiddler)
{

               var sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;fontResizer&quot;);
               sp.ondblclick=this.onDblClick;
               if (params[0])
                           createTiddlyText(sp,params[0]);
               createTiddlyButton(sp,&quot;+&quot;,&quot;increase font-size&quot;,this.incFont);
               createTiddlyButton(sp,&quot;=&quot;,&quot;reset font-size&quot;,this.resetFont);
               createTiddlyButton(sp,&quot;-&quot;,&quot;decrease font-size&quot;,this.decFont);
}

config.macros.fontSize.onDblClick = function (e)
{
             if (!e) var e = window.event;
             e.cancelBubble = true;
             if (e.stopPropagation) e.stopPropagation();
             return false;
}

config.macros.fontSize.setFont = function ()
{
               saveOptionCookie(&quot;txtFontSize&quot;);
               setStylesheet(&quot;.tiddler .viewer {font-size:&quot;+config.options.txtFontSize+&quot;%;}\n&quot;,&quot;fontResizerStyles&quot;);
}

config.macros.fontSize.incFont=function()
{
               if (config.options.txtFontSize &lt; fontSettings.maxSize)
                  config.options.txtFontSize = (config.options.txtFontSize*1)+fontSettings.stepSize;
               config.macros.fontSize.setFont();
}

config.macros.fontSize.decFont=function()
{

               if (config.options.txtFontSize &gt; fontSettings.minSize)
                  config.options.txtFontSize = (config.options.txtFontSize*1) - fontSettings.stepSize;
               config.macros.fontSize.setFont();
}

config.macros.fontSize.resetFont=function()
{

               config.options.txtFontSize=fontSettings.defaultSize;
               config.macros.fontSize.setFont();
}

config.paramifiers.font =
{
               onstart: function(v)
                  {
                   config.options.txtFontSize = v;
                   config.macros.fontSize.setFont();
                  }
};
//}}}</pre>
</div>
<div title="ForEachTiddlerPlugin" modifier="Shankar" created="200909150207" modified="200909150409" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|ForEachTiddlerPlugin|
|''Version:''|1.0.8 (2007-04-12)|
|''Source:''|http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin|
|''Author:''|UdoBorkowski (ub [at] abego-software [dot] de)|
|''Licence:''|[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]|
|''Copyright:''|&amp;copy; 2005-2007 [[abego Software|http://www.abego-software.de]]|
|''TiddlyWiki:''|1.2.38+, 2.0|
|''Browser:''|Firefox 1.0.4+; Firefox 1.5; InternetExplorer 6.0|
!Description

Create customizable lists, tables etc. for your selections of tiddlers. Specify the tiddlers to include and their order through a powerful language.

''Syntax:'' 
|&gt;|{{{&lt;&lt;}}}''forEachTiddler'' [''in'' //tiddlyWikiPath//] [''where'' //whereCondition//] [''sortBy'' //sortExpression// [''ascending'' //or// ''descending'']] [''script'' //scriptText//] [//action// [//actionParameters//]]{{{&gt;&gt;}}}|
|//tiddlyWikiPath//|The filepath to the TiddlyWiki the macro should work on. When missing the current TiddlyWiki is used.|
|//whereCondition//|(quoted) JavaScript boolean expression. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|
|//sortExpression//|(quoted) JavaScript expression returning &quot;comparable&quot; objects (using '{{{&lt;}}}','{{{&gt;}}}','{{{==}}}'. May refer to the build-in variables {{{tiddler}}} and  {{{context}}}.|
|//scriptText//|(quoted) JavaScript text. Typically defines JavaScript functions that are called by the various JavaScript expressions (whereClause, sortClause, action arguments,...)|
|//action//|The action that should be performed on every selected tiddler, in the given order. By default the actions [[addToList|AddToListAction]] and [[write|WriteAction]] are supported. When no action is specified [[addToList|AddToListAction]]  is used.|
|//actionParameters//|(action specific) parameters the action may refer while processing the tiddlers (see action descriptions for details). &lt;&lt;tiddler [[JavaScript in actionParameters]]&gt;&gt;|
|&gt;|~~Syntax formatting: Keywords in ''bold'', optional parts in [...]. 'or' means that exactly one of the two alternatives must exist.~~|

See details see [[ForEachTiddlerMacro]] and [[ForEachTiddlerExamples]].

!Revision history
* v1.0.8 (2007-04-12)
** Adapted to latest TiddlyWiki 2.2 Beta importTiddlyWiki API (introduced with changeset 2004). TiddlyWiki 2.2 Beta builds prior to changeset 2004 are no longer supported (but TiddlyWiki 2.1 and earlier, of cause)
* v1.0.7 (2007-03-28)
** Also support &quot;pre&quot; formatted TiddlyWikis (introduced with TW 2.2) (when using &quot;in&quot; clause to work on external tiddlers)
* v1.0.6 (2006-09-16)
** Context provides &quot;viewerTiddler&quot;, i.e. the tiddler used to view the macro. Most times this is equal to the &quot;inTiddler&quot;, but when using the &quot;tiddler&quot; macro both may be different.
** Support &quot;begin&quot;, &quot;end&quot; and &quot;none&quot; expressions in &quot;write&quot; action
* v1.0.5 (2006-02-05)
** Pass tiddler containing the macro with wikify, context object also holds reference to tiddler containing the macro (&quot;inTiddler&quot;). Thanks to SimonBaird.
** Support Firefox 1.5.0.1
** Internal
*** Make &quot;JSLint&quot; conform
*** &quot;Only install once&quot;
* v1.0.4 (2006-01-06)
** Support TiddlyWiki 2.0
* v1.0.3 (2005-12-22)
** Features: 
*** Write output to a file supports multi-byte environments (Thanks to Bram Chen) 
*** Provide API to access the forEachTiddler functionality directly through JavaScript (see getTiddlers and performMacro)
** Enhancements:
*** Improved error messages on InternetExplorer.
* v1.0.2 (2005-12-10)
** Features: 
*** context object also holds reference to store (TiddlyWiki)
** Fixed Bugs: 
*** ForEachTiddler 1.0.1 has broken support on win32 Opera 8.51 (Thanks to BrunoSabin for reporting)
* v1.0.1 (2005-12-08)
** Features: 
*** Access tiddlers stored in separated TiddlyWikis through the &quot;in&quot; option. I.e. you are no longer limited to only work on the &quot;current TiddlyWiki&quot;.
*** Write output to an external file using the &quot;toFile&quot; option of the &quot;write&quot; action. With this option you may write your customized tiddler exports.
*** Use the &quot;script&quot; section to define &quot;helper&quot; JavaScript functions etc. to be used in the various JavaScript expressions (whereClause, sortClause, action arguments,...).
*** Access and store context information for the current forEachTiddler invocation (through the build-in &quot;context&quot; object) .
*** Improved script evaluation (for where/sort clause and write scripts).
* v1.0.0 (2005-11-20)
** initial version

!Code
***/
//{{{

	
//============================================================================
//============================================================================
//		   ForEachTiddlerPlugin
//============================================================================
//============================================================================

// Only install once
if (!version.extensions.ForEachTiddlerPlugin) {

if (!window.abego) window.abego = {};

version.extensions.ForEachTiddlerPlugin = {
	major: 1, minor: 0, revision: 8, 
	date: new Date(2007,3,12), 
	source: &quot;http://tiddlywiki.abego-software.de/#ForEachTiddlerPlugin&quot;,
	licence: &quot;[[BSD open source license (abego Software)|http://www.abego-software.de/legal/apl-v10.html]]&quot;,
	copyright: &quot;Copyright (c) abego Software GmbH, 2005-2007 (www.abego-software.de)&quot;
};

// For backward compatibility with TW 1.2.x
//
if (!TiddlyWiki.prototype.forEachTiddler) {
	TiddlyWiki.prototype.forEachTiddler = function(callback) {
		for(var t in this.tiddlers) {
			callback.call(this,t,this.tiddlers[t]);
		}
	};
}

//============================================================================
// forEachTiddler Macro
//============================================================================

version.extensions.forEachTiddler = {
	major: 1, minor: 0, revision: 8, date: new Date(2007,3,12), provider: &quot;http://tiddlywiki.abego-software.de&quot;};

// ---------------------------------------------------------------------------
// Configurations and constants 
// ---------------------------------------------------------------------------

config.macros.forEachTiddler = {
	 // Standard Properties
	 label: &quot;forEachTiddler&quot;,
	 prompt: &quot;Perform actions on a (sorted) selection of tiddlers&quot;,

	 // actions
	 actions: {
		 addToList: {},
		 write: {}
	 }
};

// ---------------------------------------------------------------------------
//  The forEachTiddler Macro Handler 
// ---------------------------------------------------------------------------

config.macros.forEachTiddler.getContainingTiddler = function(e) {
	while(e &amp;&amp; !hasClass(e,&quot;tiddler&quot;))
		e = e.parentNode;
	var title = e ? e.getAttribute(&quot;tiddler&quot;) : null; 
	return title ? store.getTiddler(title) : null;
};

config.macros.forEachTiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler) {
	// config.macros.forEachTiddler.traceMacroCall(place,macroName,params,wikifier,paramString,tiddler);

	if (!tiddler) tiddler = config.macros.forEachTiddler.getContainingTiddler(place);
	// --- Parsing ------------------------------------------

	var i = 0; // index running over the params
	// Parse the &quot;in&quot; clause
	var tiddlyWikiPath = undefined;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;in&quot;) {
		i++;
		if (i &gt;= params.length) {
			this.handleError(place, &quot;TiddlyWiki path expected behind 'in'.&quot;);
			return;
		}
		tiddlyWikiPath = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the where clause
	var whereClause =&quot;true&quot;;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;where&quot;) {
		i++;
		whereClause = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the sort stuff
	var sortClause = null;
	var sortAscending = true; 
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;sortBy&quot;) {
		i++;
		if (i &gt;= params.length) {
			this.handleError(place, &quot;sortClause missing behind 'sortBy'.&quot;);
			return;
		}
		sortClause = this.paramEncode(params[i]);
		i++;

		if ((i &lt; params.length) &amp;&amp; (params[i] == &quot;ascending&quot; || params[i] == &quot;descending&quot;)) {
			 sortAscending = params[i] == &quot;ascending&quot;;
			 i++;
		}
	}

	// Parse the script
	var scriptText = null;
	if ((i &lt; params.length) &amp;&amp; params[i] == &quot;script&quot;) {
		i++;
		scriptText = this.paramEncode((i &lt; params.length) ? params[i] : &quot;&quot;);
		i++;
	}

	// Parse the action. 
	// When we are already at the end use the default action
	var actionName = &quot;addToList&quot;;
	if (i &lt; params.length) {
	   if (!config.macros.forEachTiddler.actions[params[i]]) {
			this.handleError(place, &quot;Unknown action '&quot;+params[i]+&quot;'.&quot;);
			return;
		} else {
			actionName = params[i]; 
			i++;
		}
	} 
	
	// Get the action parameter
	// (the parsing is done inside the individual action implementation.)
	var actionParameter = params.slice(i);


	// --- Processing ------------------------------------------
	try {
		this.performMacro({
				place: place, 
				inTiddler: tiddler,
				whereClause: whereClause, 
				sortClause: sortClause, 
				sortAscending: sortAscending, 
				actionName: actionName, 
				actionParameter: actionParameter, 
				scriptText: scriptText, 
				tiddlyWikiPath: tiddlyWikiPath});

	} catch (e) {
		this.handleError(place, e);
	}
};

// Returns an object with properties &quot;tiddlers&quot; and &quot;context&quot;.
// tiddlers holds the (sorted) tiddlers selected by the parameter,
// context the context of the execution of the macro.
//
// The action is not yet performed.
//
// @parameter see performMacro
//
config.macros.forEachTiddler.getTiddlersAndContext = function(parameter) {

	var context = config.macros.forEachTiddler.createContext(parameter.place, parameter.whereClause, parameter.sortClause, parameter.sortAscending, parameter.actionName, parameter.actionParameter, parameter.scriptText, parameter.tiddlyWikiPath, parameter.inTiddler);

	var tiddlyWiki = parameter.tiddlyWikiPath ? this.loadTiddlyWiki(parameter.tiddlyWikiPath) : store;
	context[&quot;tiddlyWiki&quot;] = tiddlyWiki;
	
	// Get the tiddlers, as defined by the whereClause
	var tiddlers = this.findTiddlers(parameter.whereClause, context, tiddlyWiki);
	context[&quot;tiddlers&quot;] = tiddlers;

	// Sort the tiddlers, when sorting is required.
	if (parameter.sortClause) {
		this.sortTiddlers(tiddlers, parameter.sortClause, parameter.sortAscending, context);
	}

	return {tiddlers: tiddlers, context: context};
};

// Returns the (sorted) tiddlers selected by the parameter.
//
// The action is not yet performed.
//
// @parameter see performMacro
//
config.macros.forEachTiddler.getTiddlers = function(parameter) {
	return this.getTiddlersAndContext(parameter).tiddlers;
};

// Performs the macros with the given parameter.
//
// @param parameter holds the parameter of the macro as separate properties.
//				  The following properties are supported:
//
//						place
//						whereClause
//						sortClause
//						sortAscending
//						actionName
//						actionParameter
//						scriptText
//						tiddlyWikiPath
//
//					All properties are optional. 
//					For most actions the place property must be defined.
//
config.macros.forEachTiddler.performMacro = function(parameter) {
	var tiddlersAndContext = this.getTiddlersAndContext(parameter);

	// Perform the action
	var actionName = parameter.actionName ? parameter.actionName : &quot;addToList&quot;;
	var action = config.macros.forEachTiddler.actions[actionName];
	if (!action) {
		this.handleError(parameter.place, &quot;Unknown action '&quot;+actionName+&quot;'.&quot;);
		return;
	}

	var actionHandler = action.handler;
	actionHandler(parameter.place, tiddlersAndContext.tiddlers, parameter.actionParameter, tiddlersAndContext.context);
};

// ---------------------------------------------------------------------------
//  The actions 
// ---------------------------------------------------------------------------

// Internal.
//
// --- The addToList Action -----------------------------------------------
//
config.macros.forEachTiddler.actions.addToList.handler = function(place, tiddlers, parameter, context) {
	// Parse the parameter
	var p = 0;

	// Check for extra parameters
	if (parameter.length &gt; p) {
		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;addToList&quot;, parameter, p);
		return;
	}

	// Perform the action.
	var list = document.createElement(&quot;ul&quot;);
	place.appendChild(list);
	for (var i = 0; i &lt; tiddlers.length; i++) {
		var tiddler = tiddlers[i];
		var listItem = document.createElement(&quot;li&quot;);
		list.appendChild(listItem);
		createTiddlyLink(listItem, tiddler.title, true);
	}
};

abego.parseNamedParameter = function(name, parameter, i) {
	var beginExpression = null;
	if ((i &lt; parameter.length) &amp;&amp; parameter[i] == name) {
		i++;
		if (i &gt;= parameter.length) {
			throw &quot;Missing text behind '%0'&quot;.format([name]);
		}
		
		return config.macros.forEachTiddler.paramEncode(parameter[i]);
	}
	return null;
}

// Internal.
//
// --- The write Action ---------------------------------------------------
//
config.macros.forEachTiddler.actions.write.handler = function(place, tiddlers, parameter, context) {
	// Parse the parameter
	var p = 0;
	if (p &gt;= parameter.length) {
		this.handleError(place, &quot;Missing expression behind 'write'.&quot;);
		return;
	}

	var textExpression = config.macros.forEachTiddler.paramEncode(parameter[p]);
	p++;

	// Parse the &quot;begin&quot; option
	var beginExpression = abego.parseNamedParameter(&quot;begin&quot;, parameter, p);
	if (beginExpression !== null) 
		p += 2;
	var endExpression = abego.parseNamedParameter(&quot;end&quot;, parameter, p);
	if (endExpression !== null) 
		p += 2;
	var noneExpression = abego.parseNamedParameter(&quot;none&quot;, parameter, p);
	if (noneExpression !== null) 
		p += 2;

	// Parse the &quot;toFile&quot; option
	var filename = null;
	var lineSeparator = undefined;
	if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;toFile&quot;) {
		p++;
		if (p &gt;= parameter.length) {
			this.handleError(place, &quot;Filename expected behind 'toFile' of 'write' action.&quot;);
			return;
		}
		
		filename = config.macros.forEachTiddler.getLocalPath(config.macros.forEachTiddler.paramEncode(parameter[p]));
		p++;
		if ((p &lt; parameter.length) &amp;&amp; parameter[p] == &quot;withLineSeparator&quot;) {
			p++;
			if (p &gt;= parameter.length) {
				this.handleError(place, &quot;Line separator text expected behind 'withLineSeparator' of 'write' action.&quot;);
				return;
			}
			lineSeparator = config.macros.forEachTiddler.paramEncode(parameter[p]);
			p++;
		}
	}
	
	// Check for extra parameters
	if (parameter.length &gt; p) {
		config.macros.forEachTiddler.createExtraParameterErrorElement(place, &quot;write&quot;, parameter, p);
		return;
	}

	// Perform the action.
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(textExpression, context);
	var count = tiddlers.length;
	var text = &quot;&quot;;
	if (count &gt; 0 &amp;&amp; beginExpression)
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(beginExpression, context)(undefined, context, count, undefined);
	
	for (var i = 0; i &lt; count; i++) {
		var tiddler = tiddlers[i];
		text += func(tiddler, context, count, i);
	}
	
	if (count &gt; 0 &amp;&amp; endExpression)
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(endExpression, context)(undefined, context, count, undefined);

	if (count == 0 &amp;&amp; noneExpression) 
		text += config.macros.forEachTiddler.getEvalTiddlerFunction(noneExpression, context)(undefined, context, count, undefined);
		

	if (filename) {
		if (lineSeparator !== undefined) {
			lineSeparator = lineSeparator.replace(/\\n/mg, &quot;\n&quot;).replace(/\\r/mg, &quot;\r&quot;);
			text = text.replace(/\n/mg,lineSeparator);
		}
		saveFile(filename, convertUnicodeToUTF8(text));
	} else {
		var wrapper = createTiddlyElement(place, &quot;span&quot;);
		wikify(text, wrapper, null/* highlightRegExp */, context.inTiddler);
	}
};


// ---------------------------------------------------------------------------
//  Helpers
// ---------------------------------------------------------------------------

// Internal.
//
config.macros.forEachTiddler.createContext = function(placeParam, whereClauseParam, sortClauseParam, sortAscendingParam, actionNameParam, actionParameterParam, scriptText, tiddlyWikiPathParam, inTiddlerParam) {
	return {
		place : placeParam, 
		whereClause : whereClauseParam, 
		sortClause : sortClauseParam, 
		sortAscending : sortAscendingParam, 
		script : scriptText,
		actionName : actionNameParam, 
		actionParameter : actionParameterParam,
		tiddlyWikiPath : tiddlyWikiPathParam,
		inTiddler : inTiddlerParam, // the tiddler containing the &lt;&lt;forEachTiddler ...&gt;&gt; macro call.
		viewerTiddler : config.macros.forEachTiddler.getContainingTiddler(placeParam) // the tiddler showing the forEachTiddler result
	};
};

// Internal.
//
// Returns a TiddlyWiki with the tiddlers loaded from the TiddlyWiki of 
// the given path.
//
config.macros.forEachTiddler.loadTiddlyWiki = function(path, idPrefix) {
	if (!idPrefix) {
		idPrefix = &quot;store&quot;;
	}
	var lenPrefix = idPrefix.length;
	
	// Read the content of the given file
	var content = loadFile(this.getLocalPath(path));
	if(content === null) {
		throw &quot;TiddlyWiki '&quot;+path+&quot;' not found.&quot;;
	}
	
	var tiddlyWiki = new TiddlyWiki();

	// Starting with TW 2.2 there is a helper function to import the tiddlers
	if (tiddlyWiki.importTiddlyWiki) {
		if (!tiddlyWiki.importTiddlyWiki(content))
			throw &quot;File '&quot;+path+&quot;' is not a TiddlyWiki.&quot;;
		tiddlyWiki.dirty = false;
		return tiddlyWiki;
	}
	
	// The legacy code, for TW &lt; 2.2
	
	// Locate the storeArea div's
	var posOpeningDiv = content.indexOf(startSaveArea);
	var posClosingDiv = content.lastIndexOf(endSaveArea);
	if((posOpeningDiv == -1) || (posClosingDiv == -1)) {
		throw &quot;File '&quot;+path+&quot;' is not a TiddlyWiki.&quot;;
	}
	var storageText = content.substr(posOpeningDiv + startSaveArea.length, posClosingDiv);
	
	// Create a &quot;div&quot; element that contains the storage text
	var myStorageDiv = document.createElement(&quot;div&quot;);
	myStorageDiv.innerHTML = storageText;
	myStorageDiv.normalize();
	
	// Create all tiddlers in a new TiddlyWiki
	// (following code is modified copy of TiddlyWiki.prototype.loadFromDiv)
	var store = myStorageDiv.childNodes;
	for(var t = 0; t &lt; store.length; t++) {
		var e = store[t];
		var title = null;
		if(e.getAttribute)
			title = e.getAttribute(&quot;tiddler&quot;);
		if(!title &amp;&amp; e.id &amp;&amp; e.id.substr(0,lenPrefix) == idPrefix)
			title = e.id.substr(lenPrefix);
		if(title &amp;&amp; title !== &quot;&quot;) {
			var tiddler = tiddlyWiki.createTiddler(title);
			tiddler.loadFromDiv(e,title);
		}
	}
	tiddlyWiki.dirty = false;

	return tiddlyWiki;
};


	
// Internal.
//
// Returns a function that has a function body returning the given javaScriptExpression.
// The function has the parameters:
// 
//	 (tiddler, context, count, index)
//
config.macros.forEachTiddler.getEvalTiddlerFunction = function (javaScriptExpression, context) {
	var script = context[&quot;script&quot;];
	var functionText = &quot;var theFunction = function(tiddler, context, count, index) { return &quot;+javaScriptExpression+&quot;}&quot;;
	var fullText = (script ? script+&quot;;&quot; : &quot;&quot;)+functionText+&quot;;theFunction;&quot;;
	return eval(fullText);
};

// Internal.
//
config.macros.forEachTiddler.findTiddlers = function(whereClause, context, tiddlyWiki) {
	var result = [];
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(whereClause, context);
	tiddlyWiki.forEachTiddler(function(title,tiddler) {
		if (func(tiddler, context, undefined, undefined)) {
			result.push(tiddler);
		}
	});
	return result;
};

// Internal.
//
config.macros.forEachTiddler.createExtraParameterErrorElement = function(place, actionName, parameter, firstUnusedIndex) {
	var message = &quot;Extra parameter behind '&quot;+actionName+&quot;':&quot;;
	for (var i = firstUnusedIndex; i &lt; parameter.length; i++) {
		message += &quot; &quot;+parameter[i];
	}
	this.handleError(place, message);
};

// Internal.
//
config.macros.forEachTiddler.sortAscending = function(tiddlerA, tiddlerB) {
	var result = 
		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) 
			? 0
			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)
			   ? -1 
			   : +1; 
	return result;
};

// Internal.
//
config.macros.forEachTiddler.sortDescending = function(tiddlerA, tiddlerB) {
	var result = 
		(tiddlerA.forEachTiddlerSortValue == tiddlerB.forEachTiddlerSortValue) 
			? 0
			: (tiddlerA.forEachTiddlerSortValue &lt; tiddlerB.forEachTiddlerSortValue)
			   ? +1 
			   : -1; 
	return result;
};

// Internal.
//
config.macros.forEachTiddler.sortTiddlers = function(tiddlers, sortClause, ascending, context) {
	// To avoid evaluating the sortClause whenever two items are compared 
	// we pre-calculate the sortValue for every item in the array and store it in a 
	// temporary property (&quot;forEachTiddlerSortValue&quot;) of the tiddlers.
	var func = config.macros.forEachTiddler.getEvalTiddlerFunction(sortClause, context);
	var count = tiddlers.length;
	var i;
	for (i = 0; i &lt; count; i++) {
		var tiddler = tiddlers[i];
		tiddler.forEachTiddlerSortValue = func(tiddler,context, undefined, undefined);
	}

	// Do the sorting
	tiddlers.sort(ascending ? this.sortAscending : this.sortDescending);

	// Delete the temporary property that holds the sortValue.	
	for (i = 0; i &lt; tiddlers.length; i++) {
		delete tiddlers[i].forEachTiddlerSortValue;
	}
};


// Internal.
//
config.macros.forEachTiddler.trace = function(message) {
	displayMessage(message);
};

// Internal.
//
config.macros.forEachTiddler.traceMacroCall = function(place,macroName,params) {
	var message =&quot;&lt;&lt;&quot;+macroName;
	for (var i = 0; i &lt; params.length; i++) {
		message += &quot; &quot;+params[i];
	}
	message += &quot;&gt;&gt;&quot;;
	displayMessage(message);
};


// Internal.
//
// Creates an element that holds an error message
// 
config.macros.forEachTiddler.createErrorElement = function(place, exception) {
	var message = (exception.description) ? exception.description : exception.toString();
	return createTiddlyElement(place,&quot;span&quot;,null,&quot;forEachTiddlerError&quot;,&quot;&lt;&lt;forEachTiddler ...&gt;&gt;: &quot;+message);
};

// Internal.
//
// @param place [may be null]
//
config.macros.forEachTiddler.handleError = function(place, exception) {
	if (place) {
		this.createErrorElement(place, exception);
	} else {
		throw exception;
	}
};

// Internal.
//
// Encodes the given string.
//
// Replaces 
//	 &quot;$))&quot; to &quot;&gt;&gt;&quot;
//	 &quot;$)&quot; to &quot;&gt;&quot;
//
config.macros.forEachTiddler.paramEncode = function(s) {
	var reGTGT = new RegExp(&quot;\\$\\)\\)&quot;,&quot;mg&quot;);
	var reGT = new RegExp(&quot;\\$\\)&quot;,&quot;mg&quot;);
	return s.replace(reGTGT, &quot;&gt;&gt;&quot;).replace(reGT, &quot;&gt;&quot;);
};

// Internal.
//
// Returns the given original path (that is a file path, starting with &quot;file:&quot;)
// as a path to a local file, in the systems native file format.
//
// Location information in the originalPath (i.e. the &quot;#&quot; and stuff following)
// is stripped.
// 
config.macros.forEachTiddler.getLocalPath = function(originalPath) {
	// Remove any location part of the URL
	var hashPos = originalPath.indexOf(&quot;#&quot;);
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert to a native file format assuming
	// &quot;file:///x:/path/path/path...&quot; - pc local file --&gt; &quot;x:\path\path\path...&quot;
	// &quot;file://///server/share/path/path/path...&quot; - FireFox pc network file --&gt; &quot;\\server\share\path\path\path...&quot;
	// &quot;file:///path/path/path...&quot; - mac/unix local file --&gt; &quot;/path/path/path...&quot;
	// &quot;file://server/share/path/path/path...&quot; - pc network file --&gt; &quot;\\server\share\path\path\path...&quot;
	var localPath;
	if(originalPath.charAt(9) == &quot;:&quot;) // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
	else if(originalPath.indexOf(&quot;file://///&quot;) === 0) // FireFox pc network file
		localPath = &quot;\\\\&quot; + unescape(originalPath.substr(10)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);
	else if(originalPath.indexOf(&quot;file:///&quot;) === 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf(&quot;file:/&quot;) === 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = &quot;\\\\&quot; + unescape(originalPath.substr(7)).replace(new RegExp(&quot;/&quot;,&quot;g&quot;),&quot;\\&quot;);	
	return localPath;
};

// ---------------------------------------------------------------------------
// Stylesheet Extensions (may be overridden by local StyleSheet)
// ---------------------------------------------------------------------------
//
setStylesheet(
	&quot;.forEachTiddlerError{color: #ffffff;background-color: #880000;}&quot;,
	&quot;forEachTiddler&quot;);

//============================================================================
// End of forEachTiddler Macro
//============================================================================


//============================================================================
// String.startsWith Function
//============================================================================
//
// Returns true if the string starts with the given prefix, false otherwise.
//
version.extensions[&quot;String.startsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.startsWith = function(prefix) {
	var n =  prefix.length;
	return (this.length &gt;= n) &amp;&amp; (this.slice(0, n) == prefix);
};



//============================================================================
// String.endsWith Function
//============================================================================
//
// Returns true if the string ends with the given suffix, false otherwise.
//
version.extensions[&quot;String.endsWith&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.endsWith = function(suffix) {
	var n = suffix.length;
	return (this.length &gt;= n) &amp;&amp; (this.right(n) == suffix);
};


//============================================================================
// String.contains Function
//============================================================================
//
// Returns true when the string contains the given substring, false otherwise.
//
version.extensions[&quot;String.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
String.prototype.contains = function(substring) {
	return this.indexOf(substring) &gt;= 0;
};

//============================================================================
// Array.indexOf Function
//============================================================================
//
// Returns the index of the first occurance of the given item in the array or 
// -1 when no such item exists.
//
// @param item [may be null]
//
version.extensions[&quot;Array.indexOf&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.indexOf = function(item) {
	for (var i = 0; i &lt; this.length; i++) {
		if (this[i] == item) {
			return i;
		}
	}
	return -1;
};

//============================================================================
// Array.contains Function
//============================================================================
//
// Returns true when the array contains the given item, otherwise false. 
//
// @param item [may be null]
//
version.extensions[&quot;Array.contains&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.contains = function(item) {
	return (this.indexOf(item) &gt;= 0);
};

//============================================================================
// Array.containsAny Function
//============================================================================
//
// Returns true when the array contains at least one of the elements 
// of the item. Otherwise (or when items contains no elements) false is returned.
//
version.extensions[&quot;Array.containsAny&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.containsAny = function(items) {
	for(var i = 0; i &lt; items.length; i++) {
		if (this.contains(items[i])) {
			return true;
		}
	}
	return false;
};


//============================================================================
// Array.containsAll Function
//============================================================================
//
// Returns true when the array contains all the items, otherwise false.
// 
// When items is null false is returned (even if the array contains a null).
//
// @param items [may be null] 
//
version.extensions[&quot;Array.containsAll&quot;] = {major: 1, minor: 0, revision: 0, date: new Date(2005,11,20), provider: &quot;http://tiddlywiki.abego-software.de&quot;};
//
Array.prototype.containsAll = function(items) {
	for(var i = 0; i &lt; items.length; i++) {
		if (!this.contains(items[i])) {
			return false;
		}
	}
	return true;
};


} // of &quot;install only once&quot;

// Used Globals (for JSLint) ==============
// ... DOM
/*global 	document */
// ... TiddlyWiki Core
/*global 	convertUnicodeToUTF8, createTiddlyElement, createTiddlyLink, 
			displayMessage, endSaveArea, hasClass, loadFile, saveFile, 
			startSaveArea, store, wikify */
//}}}


/***
!Licence and Copyright
Copyright (c) abego Software ~GmbH, 2005 ([[www.abego-software.de|http://www.abego-software.de]])

Redistribution and use in source and binary forms, with or without modification,
are permitted provided that the following conditions are met:

Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.

Redistributions in binary form must reproduce the above copyright notice, this
list of conditions and the following disclaimer in the documentation and/or other
materials provided with the distribution.

Neither the name of abego Software nor the names of its contributors may be
used to endorse or promote products derived from this software without specific
prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND ANY
EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES
OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT
SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT,
INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED
TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR
BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN
ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH
DAMAGE.
***/</pre>
</div>
<div title="Formatting in NS" modifier="Shankar" created="200909161425" modified="201109070528" tags="[[How to use]] Note mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>*When any note or topic is in edit mode, you can use the buttons provided to format selected text or add links and images.
*To see how to hand-format text in ~TiddlyWiki, see the &quot;Special formatting&quot; section of [[this tutorial|http://www.giffmex.org/twfortherestofus.html]].</pre>
</div>
<div title="Global Options" modifier="Shankar Swamy" created="200910220250" modified="201112181958" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>Font Size: &lt;&lt;fontSize&gt;&gt;  - change the display font size

Recently changed: &lt;&lt;recentChanges 30 noedit 10em groupbox&gt;&gt; - display notes that changed recently

Batch edit tags: [[MultiTagEditor]]

&lt;&lt;gotoTiddler quiet search&gt;&gt; - go a particular tiddler

List all sidebars:  [[ExtendedSidebarTabs]]

&lt;&lt;tiddler ToggleSiteTitles&gt;&gt; - hide or unhide the top header

Change the colors: &lt;&lt;selectPalette&gt;&gt;  - choose a different color palette

Toggle Display Modes: [[&gt;&gt;  &lt;&lt;|ToggleTiddlersBar]] - toggle between the tabbed and sequential display modes

[[SinglePageModePlugin]] - select how multiple notes are displayed 

[[AdvancedOptions]] - built-in advanced options

[[TiddlersBarPluginMG]] Options  

[[Syntax Help]] - somewhat obsolete yet useful syntax help
 
[[Directory Listing]] - get a listing of the directory this file is located in

[[AttachFile]] - attach a file path inside a note.

Advanced System Tweaks:
&lt;&lt;tiddlerTweaker&gt;&gt;

</pre>
</div>
<div title="GotoPlugin" modifier="YourName" created="200605052341" modified="200911112016" tags="NavigationPackage systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|GotoPlugin|
|Source|http://www.TiddlyTools.com/#GotoPlugin|
|Documentation|http://www.TiddlyTools.com/#GotoPluginInfo|
|Version|1.9.2|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|view any tiddler by entering it's title - displays list of possible matches|
''View a tiddler by typing its title and pressing //enter//.''  As you type, a list of possible matches is displayed.  You can scroll-and-click (or use arrows+enter) to select/view a tiddler, or press escape to close the listbox to resume typing.  When the listbox is not displayed, pressing //escape// clears the current input.
!!!Documentation
&gt;see [[GotoPluginInfo]]
!!!Configuration
&lt;&lt;&lt;
*Match titles only after {{twochar{&lt;&lt;option txtIncrementalSearchMin&gt;&gt;}}} or more characters are entered.&lt;br&gt;Use down-arrow to start matching with shorter input.  //Note: This option value is also set/used by [[SearchOptionsPlugin]]//.
*To set the maximum height of the listbox, you can create a tiddler tagged with &lt;&lt;tag systemConfig&gt;&gt;, containing:
//{{{
config.macros.gotoTiddler.listMaxSize=10;  // change this number
//}}}
&lt;&lt;&lt;
!!!Revisions
&lt;&lt;&lt;
2009.05.22 [1.9.2] use reverseLookup() for IncludePlugin
|please see [[GotoPluginInfo]] for additional revision details|
2006.05.05 [0.0.0] started
&lt;&lt;&lt;
!!!Code
***/
//{{{
version.extensions.GotoPlugin= {major: 1, minor: 9, revision: 2, date: new Date(2009,5,22)};

// automatically tweak shadow SideBarOptions to add &lt;&lt;gotoTiddler&gt;&gt; macro above &lt;&lt;search&gt;&gt;
config.shadowTiddlers.SideBarOptions=config.shadowTiddlers.SideBarOptions.replace(/&lt;&lt;search&gt;&gt;/,&quot;{{button{goto}}}\n&lt;&lt;gotoTiddler&gt;&gt;&lt;&lt;search&gt;&gt;&quot;);

if (config.options.txtIncrementalSearchMin===undefined) config.options.txtIncrementalSearchMin=3;

config.macros.gotoTiddler= { 
	listMaxSize: 10,
	listHeading: 'Found %0 matching title%1...',
	searchItem: &quot;Search for '%0'...&quot;,
	handler:
	function(place,macroName,params,wikifier,paramString,tiddler) {
		var quiet	=params.contains(&quot;quiet&quot;);
		var showlist	=params.contains(&quot;showlist&quot;);
		var search	=params.contains(&quot;search&quot;);
		params = paramString.parseParams(&quot;anon&quot;,null,true,false,false);
		var instyle	=getParam(params,&quot;inputstyle&quot;,&quot;&quot;);
		var liststyle	=getParam(params,&quot;liststyle&quot;,&quot;&quot;);
		var filter	=getParam(params,&quot;filter&quot;,&quot;&quot;);
		var html=this.html;
		var keyevent=window.event?&quot;onkeydown&quot;:&quot;onkeypress&quot;; // IE event fixup for ESC handling
		html=html.replace(/%keyevent%/g,keyevent);
		html=html.replace(/%search%/g,search);
		html=html.replace(/%quiet%/g,quiet);
		html=html.replace(/%showlist%/g,showlist);
		html=html.replace(/%display%/g,showlist?'block':'none');
		html=html.replace(/%position%/g,showlist?'static':'absolute');
		html=html.replace(/%instyle%/g,instyle);
		html=html.replace(/%liststyle%/g,liststyle);
		html=html.replace(/%filter%/g,filter);
		if (config.browser.isIE) html=this.IEtableFixup.format([html]);
		var span=createTiddlyElement(place,'span');
		span.innerHTML=html; var form=span.getElementsByTagName(&quot;form&quot;)[0];
		if (showlist) this.fillList(form.list,'',filter,search,0);
	},
	html:
	'&lt;form onsubmit=&quot;return false&quot; style=&quot;display:inline;margin:0;padding:0&quot;&gt;\
		&lt;input name=gotoTiddler type=text autocomplete=&quot;off&quot; accesskey=&quot;G&quot; style=&quot;%instyle%&quot;\
			title=&quot;Enter title text... ENTER=goto, SHIFT-ENTER=search for text, DOWN=select from list&quot;\
			onfocus=&quot;this.select(); this.setAttribute(\'accesskey\',\'G\');&quot;\
			%keyevent%=&quot;return config.macros.gotoTiddler.inputEscKeyHandler(event,this,this.form.list,%search%,%showlist%);&quot;\
			onkeyup=&quot;return config.macros.gotoTiddler.inputKeyHandler(event,this,%quiet%,%search%,%showlist%);&quot;&gt;\
		&lt;select name=list style=&quot;display:%display%;position:%position%;%liststyle%&quot;\
			onchange=&quot;if (!this.selectedIndex) this.selectedIndex=1;&quot;\
			onblur=&quot;this.style.display=%showlist%?\'block\':\'none\';&quot;\
			%keyevent%=&quot;return config.macros.gotoTiddler.selectKeyHandler(event,this,this.form.gotoTiddler,%showlist%);&quot;\
			onclick=&quot;return config.macros.gotoTiddler.processItem(this.value,this.form.gotoTiddler,this,%showlist%);&quot;&gt;\
		&lt;/select&gt;&lt;input name=&quot;filter&quot; type=&quot;hidden&quot; value=&quot;%filter%&quot;&gt;\
	&lt;/form&gt;',
	IEtableFixup:
	&quot;&lt;table style='width:100%;display:inline;padding:0;margin:0;border:0;'&gt;\
		&lt;tr style='padding:0;margin:0;border:0;'&gt;&lt;td style='padding:0;margin:0;border:0;'&gt;\
		%0&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&quot;,
	getItems:
	function(list,val,filter) {
		if (!list.cache || !list.cache.length || val.length&lt;=config.options.txtIncrementalSearchMin) {
			// starting new search, fetch and cache list of tiddlers/shadows/tags
			list.cache=new Array();
			if (filter.length) {
				var fn=store.getMatchingTiddlers||store.getTaggedTiddlers;
				var tiddlers=store.sortTiddlers(fn.apply(store,[filter]),'title');
			} else 
				var tiddlers=store.reverseLookup('tags','excludeLists');
			for(var t=0; t&lt;tiddlers.length; t++) list.cache.push(tiddlers[t].title);
			if (!filter.length) {
				for (var t in config.shadowTiddlers) list.cache.pushUnique(t);
				var tags=store.getTags();
				for(var t=0; t&lt;tags.length; t++) list.cache.pushUnique(tags[t][0]);
			}
		}
		var found = [];
		var match=val.toLowerCase();
		for(var i=0; i&lt;list.cache.length; i++)
			if (list.cache[i].toLowerCase().indexOf(match)!=-1) found.push(list.cache[i]);
		return found;
	},
	getItemSuffix:
	function(t) {
		if (store.tiddlerExists(t)) return &quot;&quot;;  // tiddler
		if (store.isShadowTiddler(t)) return &quot; (shadow)&quot;; // shadow
		return &quot; (tag)&quot;; // tag 
	},
	fillList:
	function(list,val,filter,search,key) {
		if (list.style.display==&quot;none&quot;) return; // not visible... do nothing!
		var indent='\xa0\xa0\xa0';
		var found = this.getItems(list,val,filter); // find matching items...
		found.sort(); // alpha by title
		while (list.length &gt; 0) list.options[0]=null; // clear list
		var hdr=this.listHeading.format([found.length,found.length==1?&quot;&quot;:&quot;s&quot;]);
		list.options[0]=new Option(hdr,&quot;&quot;,false,false);
		for (var t=0; t&lt;found.length; t++) list.options[list.length]=
			new Option(indent+found[t]+this.getItemSuffix(found[t]),found[t],false,false);
		if (search)
			list.options[list.length]=new Option(this.searchItem.format([val]),&quot;*&quot;,false,false);
		list.size=(list.length&lt;this.listMaxSize?list.length:this.listMaxSize); // resize list...
		list.selectedIndex=key==38?list.length-1:key==40?1:0;
	},
	keyProcessed:
	function(ev) { // utility function
		ev.cancelBubble=true; // IE4+
		try{event.keyCode=0;}catch(e){}; // IE5
		if (window.event) ev.returnValue=false; // IE6
		if (ev.preventDefault) ev.preventDefault(); // moz/opera/konqueror
		if (ev.stopPropagation) ev.stopPropagation(); // all
		return false;
	},
	inputEscKeyHandler:
	function(event,here,list,search,showlist) {
		if (event.keyCode==27) {
			if (showlist) { // clear input, reset list
				here.value=here.defaultValue;
				this.fillList(list,'',here.form.filter.value,search,0);
			}
			else if (list.style.display==&quot;none&quot;) // clear input
				here.value=here.defaultValue;
			else list.style.display=&quot;none&quot;; // hide list
			return this.keyProcessed(event);
		}
		return true; // key bubbles up
	},
	inputKeyHandler:
	function(event,here,quiet,search,showlist) {
		var key=event.keyCode;
		var list=here.form.list;
		var filter=here.form.filter;
		// non-printing chars bubble up, except for a few:
		if (key&lt;48) switch(key) {
			// backspace=8, enter=13, space=32, up=38, down=40, delete=46
			case 8: case 13: case 32: case 38: case 40: case 46: break; default: return true;
		}
		// blank input... if down/enter... fall through (list all)... else, and hide or reset list
		if (!here.value.length &amp;&amp; !(key==40 || key==13)) {
			if (showlist) this.fillList(here.form.list,'',here.form.filter.value,search,0);
			else list.style.display=&quot;none&quot;;
			return this.keyProcessed(event);
		}
		// hide list if quiet, or below input minimum (and not showlist)
		list.style.display=(!showlist&amp;&amp;(quiet||here.value.length&lt;config.options.txtIncrementalSearchMin))?'none':'block';
		// non-blank input... enter=show/create tiddler, SHIFT-enter=search for text
		if (key==13 &amp;&amp; here.value.length) return this.processItem(event.shiftKey?'*':here.value,here,list,showlist);
		// up or down key, or enter with blank input... shows and moves to list...
		if (key==38 || key==40 || key==13) { list.style.display=&quot;block&quot;; list.focus(); }
		this.fillList(list,here.value,filter.value,search,key);
		return true; // key bubbles up
	},
	selectKeyHandler:
	function(event,list,editfield,showlist) {
		if (event.keyCode==27) // escape... hide list, move to edit field
			{ editfield.focus(); list.style.display=showlist?'block':'none'; return this.keyProcessed(event); }
		if (event.keyCode==13 &amp;&amp; list.value.length) // enter... view selected item
			{ this.processItem(list.value,editfield,list,showlist); return this.keyProcessed(event); }
		return true; // key bubbles up
	},
	processItem:
	function(title,here,list,showlist) {
		if (!title.length) return;
		list.style.display=showlist?'block':'none';
		if (title==&quot;*&quot;)	{ story.search(here.value); return false; } // do full-text search
		if (!showlist) here.value=title;
		story.displayTiddler(null,title); // show selected tiddler
		return false;
	}
}
//}}}</pre>
</div>
<div title="GotoPluginInfo" modifier="shankar " created="200801081338" modified="200910301138" tags="pluginInfo mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|GotoPluginInfo|
|Source|http://www.TiddlyTools.com/#GotoPlugin|
|Documentation|http://www.TiddlyTools.com/#GotoPluginInfo|
|Version|1.9.2|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|documentation|
|Description|Documentation for GotoPlugin|
''View a tiddler by typing its title and pressing //enter//.''  As you type, a list of possible matches is displayed.  You can scroll-and-click (or use arrows+enter) to select/view a tiddler, or press escape to close the listbox to resume typing.  When the listbox is not displayed, pressing //escape// clears the current input.
!!!!!Usage/Examples
&lt;&lt;&lt;
syntax: {{{&lt;&lt;gotoTiddler quiet search inputstyle:... liststyle:... filter:...&gt;&gt;}}}
All parameters are optional.
* ''quiet'' (//keyword//)&lt;br&gt;list will not be automatically display as each character is typed.  Use //down// or //enter// to view the list.
* ''showlist'' (//keyword//)&lt;br&gt;list will always be displayed, inline, directly below the input field.
* ''search'' (//keyword//)&lt;br&gt;adds an extra 'command item' to the list that can be used to invoke a full-text search using the entered value.  This can be especially useful when no matching tiddler titles have been found.
* ''inputstyle:'' and ''liststyle:''&lt;br&gt;are CSS declarations that modify the default input and listbox styles, respectively.  Note: the CSS styles must be surrounded by ({{{&quot;...&quot;}}} or {{{'...'}}}) or ({{{[[...]]}}}) (e.g., {{{liststyle:&quot;border:1px dotted blue;color:green;...&quot;}}}.
* ''filter:''&lt;br&gt;is a single tag value (or a boolean tag expression if MatchTagsPlugin is installed), and is used to limit the search to only those tiddlers matching the indicated tag or tag expression (e.g., {{{&lt;&lt;gotoTiddler filter:&quot;faq or help&quot;&gt;&gt;}}})
{{{&lt;&lt;gotoTiddler&gt;&gt;}}}
&lt;&lt;gotoTiddler&gt;&gt;
{{{&lt;&lt;gotoTiddler search&gt;&gt;}}}
&lt;&lt;gotoTiddler search&gt;&gt;
{{{&lt;&lt;gotoTiddler showlist filter:&quot;pluginInfo&quot; liststyle:&quot;height:10em;width:auto;&quot;&gt;&gt;}}}
&lt;&lt;gotoTiddler showlist filter:&quot;pluginInfo&quot; liststyle:&quot;height:10em;width:auto;&quot;&gt;&gt;
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
*Match titles only after {{twochar{&lt;&lt;option txtIncrementalSearchMin&gt;&gt;}}} or more characters are entered.&lt;br&gt;Use down-arrow to start matching with shorter input.  //Note: This option value is also set/used by [[SearchOptionsPlugin]]//.
*To set the maximum height of the listbox, you can create a tiddler tagged with &lt;&lt;tag systemConfig&gt;&gt;, containing:
//{{{
config.macros.gotoTiddler.listMaxSize=10;  // change this number
//}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.05.22 1.9.2 use reverseLookup() for IncludePlugin
2009.04.12 1.9.1 support multiple instances with different filters by using per-element tiddler cache instead of shared static cache
2009.04.05 1.9.0 added 'showlist' parameter for inline display with listbox always visible.
2009.03.23 1.8.0 added txtIncrementalSearchMin (default=3).  Avoids fetching long lists.  Use down arrow to force search with short input.
2008.12.15 1.7.1 up arrow from input field now moves to end of droplist (search for input).  Also, shift+enter cam now be used to quickly invoke search for text.
2008.10.16 1.7.0 in macro handler(), changed to use //named// params instead of positional params, and added optional &quot;filter:&quot; param for tag filtering.  Removed 'insert' handling (now provided by [[QuickEditPlugin]]).
2008.10.02 1.6.1 for IE, wrap controls in a table.  Corrects placement of listbox so it is below input field.
2008.10.02 1.6.0 added 'search' param for optional &quot;Search for:&quot; item that invokes full text search (especially useful when no title matches are found)
2008.02.17 1.5.0 ENTER key always displays tiddler based on current input regardless of whether input matches any existing tiddler
2007.10.31 1.4.3 removed extra trailing comma on last property of config.macros.gotoTiddler object.  This fixes an error under InternetExplorer that was introduced 6 days ago... sure, I should have found it sooner, but... WHY DON'T PEOPLE TELL ME WHEN THINGS ARE BROKEN!!!!
2007.10.25 1.4.2 added onclick handler for input field, so that clicking in field hides the listbox.
2007.10.25 1.4.1 re-wrote getItems() to cache list of tiddlers/shadows/tags and use case-folded simple text match instead of regular expression to find matching tiddlers.  This *vastly* reduces processing overhead between keystrokes, especially for documents with many (&gt;1000) tiddlers.  Also, removed local definition of replaceSelection(), now supported directly by the TW2.2+ core, as well as via backward-compatible plugin
2007.04.25 1.4.0 renamed macro from &quot;goto&quot; to &quot;gotoTiddler&quot;.  This was necessary to avoid a fatal syntax error in Opera (and other browsers) that require strict adherence to ECMAScript 1.5 standards which defines the identifier &quot;goto&quot; as &quot;reserved for FUTURE USE&quot;... *sigh*
2007.04.21 1.3.2 in html definition, removed DIV around droplist (see 1.2.6 below).  It created more layout problems then it solved. :-(
2007.04.01 1.3.1 in processItem(), ensure that correct textarea field is found by checking for edit==&quot;text&quot; attribute
2007.03.30 1.3.0 tweak SideBarOptions shadow to automatically add {{{&lt;&lt;goto&gt;&gt;}}} when using default sidebar content
2007.03.30 1.2.6 in html definition, added DIV around droplist to fix IE problem where list appears next to input field instead of below it.  
2007.03.28 1.2.5 in processItem(), set focus to text area before setting selection (needed for IE to get correct selection 'range')
2007.03.28 1.2.4 added prompt for 'pretty text' when inserting a link into tiddler content
2007.03.28 1.2.3 added local copy of core replaceSelection() and modified for different replace logic
2007.03.27 1.2.2 in processItem(), use story.getTiddlerField() to retrieve textarea control
2007.03.26 1.2.1 in html, use either 'onkeydown' (IE) or 'onkeypress' (Moz) event to process &lt;esc&gt; key sooner, to prevent &lt;esc&gt; from 'bubbling up' to the tiddler (which will close the current editor).
2007.03.26 1.2.0 added support for optional &quot;insert&quot; keyword param.
2006.05.10 1.1.2 when filling listbox, set selection to 'heading' item... auto-select first tiddler title when down/enter moves focus into listbox
2006.05.08 1.1.1 added accesskey (&quot;G&quot;) to input field html (also set when field gets focus).  Also, inputKeyHandler() skips non-printing/non-editing keys. 
2006.05.08 1.1.0 added heading to listbox for better feedback (also avoids problems with 1-line droplist)
2006.05.07 1.0.0 list matches against tiddlers/shadows/tags.  input field auto-completion... 1st enter=complete matching input (or show list)... 2nd enter=view tiddler.  &quot;quiet&quot; param controls when listbox appears.  handling for enter (13), escape(27), and down(40) keys.   Change 'ondblclick' to 'onclick' to avoid unintended triggering of tiddler editor).  Shadow titles inserted into list instead of appended to the end.
2006.05.05 0.0.0 started
&lt;&lt;&lt;</pre>
</div>
<div title="HTMLFormattingPlugin" modifier="Shankar" created="200809240814" modified="201109070346" tags="systemConfig TreeviewPackage mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|HTMLFormattingPlugin|
|Source|http://www.TiddlyTools.com/#HTMLFormattingPlugin|
|Documentation|http://www.TiddlyTools.com/#HTMLFormattingPluginInfo|
|Version|2.4.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides|'HTML' formatter|
|Description|embed wiki syntax formatting inside of HTML content|
The ~HTMLFormatting plugin allows you to ''mix wiki-style formatting syntax within HTML formatted content'' by extending the action of the standard TiddlyWiki formatting handler.
!!!!!Documentation
&gt;see [[HTMLFormattingPluginInfo]]
!!!!!Revisions
&lt;&lt;&lt;
2009.01.05 [2.4.0] in wikifyTextNodes(), pass w.highlightRegExp and w.tiddler to wikify() so that search term highlighting and tiddler-relative macro processing will work
| see [[HTMLFormattingPluginInfo]] for additional revision details |
2005.06.26 [1.0.0] Initial Release (as code adaptation - pre-dates TiddlyWiki plugin architecture!!)
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.HTMLFormattingPlugin= {major: 2, minor: 4, revision: 0, date: new Date(2009,1,5)};

// find the formatter for HTML and replace the handler
initHTMLFormatter();
function initHTMLFormatter()
{
	for (var i=0; i&lt;config.formatters.length &amp;&amp; config.formatters[i].name!=&quot;html&quot;; i++);
	if (i&lt;config.formatters.length)	config.formatters[i].handler=function(w) {
		if (!this.lookaheadRegExp)  // fixup for TW2.0.x
			this.lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
			var html=lookaheadMatch[1];
			// if &lt;nowiki&gt; is present, just let browser handle it!
			if (html.indexOf('&lt;nowiki&gt;')!=-1)
				createTiddlyElement(w.output,&quot;span&quot;).innerHTML=html;
			else {
				// if &lt;hide linebreaks&gt; is present, suppress wiki-style literal handling of newlines
				if (html.indexOf('&lt;hide linebreaks&gt;')!=-1) html=html.replace(/\n/g,' ');
				// remove all \r's added by IE textarea and mask newlines and macro brackets
				html=html.replace(/\r/g,'').replace(/\n/g,'\\n').replace(/&lt;&lt;/g,'%%(').replace(/&gt;&gt;/g,')%%');
				// create span, let browser parse HTML
				var e=createTiddlyElement(w.output,&quot;span&quot;); e.innerHTML=html;
				// then re-render text nodes as wiki-formatted content
				wikifyTextNodes(e,w);
			}
			w.nextMatch = this.lookaheadRegExp.lastIndex; // continue parsing
		}
	}
}

// wikify #text nodes that remain after HTML content is processed (pre-order recursion)
function wikifyTextNodes(theNode,w)
{
	function unmask(s) { return s.replace(/\%%\(/g,'&lt;&lt;').replace(/\)\%%/g,'&gt;&gt;').replace(/\\n/g,'\n'); }
	switch (theNode.nodeName.toLowerCase()) {
		case 'style': case 'option': case 'select':
			theNode.innerHTML=unmask(theNode.innerHTML);
			break;
		case 'textarea':
			theNode.value=unmask(theNode.value);
			break;
		case '#text':
			var txt=unmask(theNode.nodeValue);
			var newNode=createTiddlyElement(null,&quot;span&quot;);
			theNode.parentNode.replaceChild(newNode,theNode);
			wikify(txt,newNode,highlightHack,w.tiddler);
			break;
		default:
			for (var i=0;i&lt;theNode.childNodes.length;i++)
				wikifyTextNodes(theNode.childNodes.item(i),w); // recursion
			break;
	}
}
//}}}</pre>
</div>
<div title="HideTiddlerSubtitle" modifier="YourName" created="200607170718" modified="200911112016" tags="transclusion excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|HideTiddlerSubtitle|
|Source|http://www.TiddlyTools.com/#HideTiddlerSubtitle|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|hide a tiddler's subtitle (date and author)|
Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler HideTiddlerSubtitle&gt;&gt;
&lt;&lt;tiddler HideTiddlerSubtitle with: TiddlerTitle&gt;&gt;
}}}
&lt;&lt;&lt;
!end
!show
&lt;&lt;tiddler {{
	var title=&quot;$1&quot;;
	if (title=='$'+'1')
		title=(story.findContainingTiddler(place)||place).getAttribute('tiddler')||'';
	var t=story.getTiddler(title); if (t) {
		var e=t.getElementsByTagName('*');
		for (var i=0; i&lt;e.length; i++)
			if (hasClass(e[i],'subtitle')) e[i].style.display='none';
	}
'';}}&gt;&gt;
!end
%/&lt;&lt;tiddler {{
	var src='HideTiddlerSubtitle';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');}}
with: [[$1]]&gt;&gt;</pre>
</div>
<div title="HideTiddlerTags" modifier="Shankar" created="200601042022" modified="201001170608" tags="transclusion mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|HideTiddlerTags|
|Source|http://www.TiddlyTools.com/#HideTiddlerTags|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|hide a tiddler's 'tagged' and 'tagging' displays (if any)|
Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler HideTiddlerTags&gt;&gt;
&lt;&lt;tiddler HideTiddlerTags with: TiddlerTitle&gt;&gt;
}}}
&lt;&lt;&lt;
!end
!show
&lt;&lt;tiddler {{
	var title=&quot;$1&quot;;
	if (title=='$'+'1') {
		var here=story.findContainingTiddler(place);
		if (here) title=here.getAttribute('tiddler');
	}
	var t=story.getTiddler(title); if (t) {
		var e=t.getElementsByTagName('*');
		for (var i=0; i&lt;e.length; i++)
			if (hasClass(e[i],'tagging')||hasClass(e[i],'tagged'))
				e[i].style.display='none';
	}
'';}}&gt;&gt;
!end
%/&lt;&lt;tiddler {{
	var src='HideTiddlerTags';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');}}
with: [[$1]]&gt;&gt;</pre>
</div>
<div title="HideTiddlerTitle" modifier="YourName" created="200601281845" modified="200911112012" tags="transclusion excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|HideTiddlerTitle|
|Source|http://www.TiddlyTools.com/#HideTiddlerTitle|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|hide a tiddler's title and subtitle (date and author)|
Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler HideTiddlerTitle&gt;&gt;
&lt;&lt;tiddler HideTiddlerTitle with: TiddlerTitle&gt;&gt;
}}}
&lt;&lt;&lt;
!end
!show
&lt;&lt;tiddler {{
	var title=&quot;$1&quot;;
	if (title=='$'+'1')
		title=(story.findContainingTiddler(place)||place).getAttribute('tiddler')||'';
	var t=story.getTiddler(title); if (t) {
		var e=t.getElementsByTagName('*');
		for (var i=0; i&lt;e.length; i++)
			if (hasClass(e[i],'title')||hasClass(e[i],'subtitle')) e[i].style.display='none';
	}
'';}}&gt;&gt;
!end
%/&lt;&lt;tiddler {{
	var src='HideTiddlerTitle';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');}}
with: [[$1]]&gt;&gt;</pre>
</div>
<div title="HideTiddlerToolbar" modifier="YourName" created="200602231314" modified="200911112012" tags="transclusion excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|HideTiddlerToolbar|
|Source|http://www.TiddlyTools.com/#HideTiddlerToolbar|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|hide a tiddler's toolbar (menu commands)|
Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler HideTiddlerToolbar&gt;&gt;
&lt;&lt;tiddler HideTiddlerToolbar with: TiddlerTitle&gt;&gt;
}}}
&lt;&lt;&lt;
!end

!show
&lt;&lt;tiddler {{
	var title=&quot;$1&quot;;
	if (title=='$'+'1')
		title=(story.findContainingTiddler(place)||place).getAttribute('tiddler')||'';
	var t=story.getTiddler(title); if (t) {
		var e=t.getElementsByTagName('*');
		for (var i=0; i&lt;e.length; i++)
			if (hasClass(e[i],'toolbar')) e[i].style.display='none';
	}
'';}}&gt;&gt;
%/&lt;&lt;tiddler {{
	var src='HideTiddlerToolbar';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');
}} with [[$1]]&gt;&gt;</pre>
</div>
<div title="HideTiddlersPlugin" modifier="YourName" created="200910041945" modified="200911112014" tags="systemConfig noClose excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|HideTiddlersPlugin|
|Source|http://www.TiddlyTools.com/#HideTiddlersPlugin|
|Documentation|http://www.TiddlyTools.com/#HideTiddlersPlugin|
|Version|1.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|hide/show tiddlers instead of closing/re-opening them|
|Status|ALPHA EXPERIMENTAL - use with caution|
!!!!!Documentation
&lt;&lt;&lt;
This plugin hijacks the core's displayTiddler() and closeTiddler() functions so that closing a tiddler //hides// it rather than removing it from the story column.  When the tiddler is re-opened, it is made visible again without needing to be re-rendered, which can significantly reduce the processing required by tiddlers that generate their content through use of complex macros or scripts.

Notes:
*hidden tiddlers are still re-rendered as needed when underlying information is changed or other page-wide refresh events occur, so that they will still be up-to-date if re-displayed.  This can, in some cases, trigger side-effect actions associated with those tiddlers that would normally not occur had they actually been closed, rather than merely hidden from view
*Using &lt;&lt;closeAll&gt;&gt; (or invoking the core {{{restart()}}} function) will always //close// the tiddlers rather than hiding them, regardless of the current plugin settings or tiddler tags
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
hide tiddlers instead of closing them:
&lt;&lt;option chkNoClose&gt;&gt;tiddlers tagged with &lt;&lt;option txtNoCloseTag&gt;&gt;
&lt;&lt;option chkNoCloseAll&gt;&gt;all tiddlers, regardless of tags
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.10.04 [1.0.0] initial release.  Much thanks to Shviller for original concept.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.HideTiddlersPlugin= {major: 1, minor: 0, revision: 0, date: new Date(2009,10,4)};

var co=config.options; //abbrev
if (co.chkNoClose===undefined)	  co.chkNoClose=true;
if (co.txtNoCloseTag===undefined) co.txtNoCloseTag='noClose';

if (Story.prototype.displayTiddler_save===undefined)
	Story.prototype.displayTiddler_save=Story.prototype.displayTiddler;
Story.prototype.displayTiddler=function(place,title) {
	var here=story.getTiddler(title);
	if (here) here.style.display='block';
	this.displayTiddler_save.apply(this,arguments);
}

if (Story.prototype.closeTiddler_save===undefined)
	Story.prototype.closeTiddler_save=Story.prototype.closeTiddler;
Story.prototype.closeTiddler=function(title) {
	var co=config.options; //abbrev
	var t=store.getTiddler(title);
	if (co.chkNoCloseAll || co.chkNoClose&amp;&amp;t&amp;&amp;t.isTagged(co.txtNoCloseTag)) {
		var here=story.getTiddler(title);
		if (here) here.style.display='none';
		forceReflow();
	} else this.closeTiddler_save.apply(this,arguments);
}

if (Story.prototype.closeAllTiddlers_save===undefined)
	Story.prototype.closeAllTiddlers_save=Story.prototype.closeAllTiddlers;
Story.prototype.closeAllTiddlers=function(title) {
	var co=config.options; //abbrev
	var t=co.chkNoClose;
	co.chkNoClose=false;
	this.closeAllTiddlers_save.apply(this,arguments);
	co.chkNoClose=t;
}
//}}}</pre>
</div>
<div title="HideWhenPlugin" modifier="Shankar Swamy" created="200803121603" modified="201201170122" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|HideWhenPlugin|
|Description:|Allows conditional inclusion/exclusion in templates|
|Version:|3.1 ($Rev: 3919 $)|
|Date:|$Date: 2008-03-13 02:03:12 +1000 (Thu, 13 Mar 2008) $|
|Source:|http://mptw.tiddlyspot.com/#HideWhenPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License:|http://mptw.tiddlyspot.com/#TheBSDLicense|
For use in ViewTemplate and EditTemplate. Example usage:
{{{&lt;div macro=&quot;showWhenTagged Task&quot;&gt;[[TaskToolbar]]&lt;/div&gt;}}}
{{{&lt;div macro=&quot;showWhen tiddler.modifier == 'BartSimpson'&quot;&gt;&lt;img src=&quot;bart.gif&quot;/&gt;&lt;/div&gt;}}}
***/
//{{{

window.hideWhenLastTest = false;

window.removeElementWhen = function(test,place) {
	window.hideWhenLastTest = test;
	if (test) {
		removeChildren(place);
		place.parentNode.removeChild(place);
	}
};


merge(config.macros,{

	hideWhen: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( eval(paramString), place);
	}},

	showWhen: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !eval(paramString), place);
	}},

	hideWhenTagged: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( tiddler.tags.containsAll(params), place);
	}},

	showWhenTagged: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !tiddler.tags.containsAll(params), place);
	}},

	hideWhenTaggedAny: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( tiddler.tags.containsAny(params), place);
	}},

	showWhenTaggedAny: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !tiddler.tags.containsAny(params), place);
	}},

	hideWhenTaggedAll: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( tiddler.tags.containsAll(params), place);
	}},

	showWhenTaggedAll: { handler: function (place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !tiddler.tags.containsAll(params), place);
	}},

	hideWhenExists: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( store.tiddlerExists(params[0]) || store.isShadowTiddler(params[0]), place);
	}},

	showWhenExists: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !(store.tiddlerExists(params[0]) || store.isShadowTiddler(params[0])), place);
	}},

	hideWhenTitleIs: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( tiddler.title == params[0], place);
	}},

	showWhenTitleIs: { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( tiddler.title != params[0], place);
	}},

	'else': { handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		removeElementWhen( !window.hideWhenLastTest, place);
	}}

});

//}}}</pre>
</div>
<div title="ImageSizePlugin" modifier="Shankar Swamy" created="200801180032" modified="201210220802" tags="IconPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|ImageSizePlugin|
|Source|http://www.TiddlyTools.com/#ImageSizePlugin|
|Version|1.2.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|adds support for resizing images|
This plugin adds optional syntax to scale an image to a specified width and height and/or interactively resize the image with the mouse.
!!!!!Usage
&lt;&lt;&lt;
The extended image syntax is:
{{{
[img(w+,h+)[...][...]]
}}}
where ''(w,h)'' indicates the desired width and height (in CSS units, e.g., px, em, cm, in, or %). Use ''auto'' (or a blank value) for either dimension to scale that dimension proportionally (i.e., maintain the aspect ratio). You can also calculate a CSS value 'on-the-fly' by using a //javascript expression// enclosed between &quot;&quot;&quot;{{&quot;&quot;&quot; and &quot;&quot;&quot;}}&quot;&quot;&quot;. Appending a plus sign (+) to a dimension enables interactive resizing in that dimension (by dragging the mouse inside the image). Use ~SHIFT-click to show the full-sized (un-scaled) image. Use ~CTRL-click to restore the starting size (either scaled or full-sized).
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
{{{
[img(100px+,75px+)[images/meow2.jpg]]
}}}
[img(100px+,75px+)[images/meow2.jpg]]
{{{
[&lt;img(34%+,+)[images/meow.gif]]
[&lt;img(21% ,+)[images/meow.gif]]
[&lt;img(13%+, )[images/meow.gif]]
[&lt;img( 8%+, )[images/meow.gif]]
[&lt;img( 5% , )[images/meow.gif]]
[&lt;img( 3% , )[images/meow.gif]]
[&lt;img( 2% , )[images/meow.gif]]
[img(  1%+,+)[images/meow.gif]]
}}}
[&lt;img(34%+,+)[images/meow.gif]]
[&lt;img(21% ,+)[images/meow.gif]]
[&lt;img(13%+, )[images/meow.gif]]
[&lt;img( 8%+, )[images/meow.gif]]
[&lt;img( 5% , )[images/meow.gif]]
[&lt;img( 3% , )[images/meow.gif]]
[&lt;img( 2% , )[images/meow.gif]]
[img(  1%+,+)[images/meow.gif]]
{{tagClear{
}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.02.24 [1.2.1] cleanup width/height regexp, use '+' suffix for resizing
2009.02.22 [1.2.0] added stretchable images
2008.01.19 [1.1.0] added evaluated width/height values
2008.01.18 [1.0.1] regexp for &quot;(width,height)&quot; now passes all CSS values to browser for validation
2008.01.17 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.ImageSizePlugin= {major: 1, minor: 2, revision: 1, date: new Date(2009,2,24)};
//}}}
//{{{
var f=config.formatters[config.formatters.findByField(&quot;name&quot;,&quot;image&quot;)];
f.match=&quot;\\[[&lt;&gt;]?[Ii][Mm][Gg](?:\\([^,]*,[^\\)]*\\))?\\[&quot;;
f.lookaheadRegExp=/\[([&lt;]?)(&gt;?)[Ii][Mm][Gg](?:\(([^,]*),([^\)]*)\))?\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg;
f.handler=function(w) {
	this.lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = this.lookaheadRegExp.exec(w.source)
	if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
		var floatLeft=lookaheadMatch[1];
		var floatRight=lookaheadMatch[2];
		var width=lookaheadMatch[3];
		var height=lookaheadMatch[4];
		var tooltip=lookaheadMatch[5];
		var src=lookaheadMatch[6];
		var link=lookaheadMatch[7];

		// Simple bracketted link
		var e = w.output;
		if(link) { // LINKED IMAGE
			if (config.formatterHelpers.isExternalLink(link)) {
				if (config.macros.attach &amp;&amp; config.macros.attach.isAttachment(link)) {
					// see [[AttachFilePluginFormatters]]
					e = createExternalLink(w.output,link);
					e.href=config.macros.attach.getAttachment(link);
					e.title = config.macros.attach.linkTooltip + link;
				} else
					e = createExternalLink(w.output,link);
			} else 
				e = createTiddlyLink(w.output,link,false,null,w.isStatic);
			addClass(e,&quot;imageLink&quot;);
		}

		var img = createTiddlyElement(e,&quot;img&quot;);
		if(floatLeft) img.align=&quot;left&quot;; else if(floatRight) img.align=&quot;right&quot;;
		if(width||height) {
			var x=width.trim(); var y=height.trim();
			var stretchW=(x.substr(x.length-1,1)=='+'); if (stretchW) x=x.substr(0,x.length-1);
			var stretchH=(y.substr(y.length-1,1)=='+'); if (stretchH) y=y.substr(0,y.length-1);
			if (x.substr(0,2)==&quot;{{&quot;)
				{ try{x=eval(x.substr(2,x.length-4))} catch(e){displayMessage(e.description||e.toString())} }
			if (y.substr(0,2)==&quot;{{&quot;)
				{ try{y=eval(y.substr(2,y.length-4))} catch(e){displayMessage(e.description||e.toString())} }
			img.style.width=x.trim(); img.style.height=y.trim();
			config.formatterHelpers.addStretchHandlers(img,stretchW,stretchH);
		}
		if(tooltip) img.title = tooltip;

		// GET IMAGE SOURCE
		if (config.macros.attach &amp;&amp; config.macros.attach.isAttachment(src))
			src=config.macros.attach.getAttachment(src); // see [[AttachFilePluginFormatters]]
		else if (config.formatterHelpers.resolvePath) { // see [[ImagePathPlugin]]
			if (config.browser.isIE || config.browser.isSafari) {
				img.onerror=(function(){
					this.src=config.formatterHelpers.resolvePath(this.src,false);
					return false;
				});
			} else
				src=config.formatterHelpers.resolvePath(src,true);
		}
		img.src=src;
		w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
}

config.formatterHelpers.addStretchHandlers=function(e,stretchW,stretchH) {
	e.title=((stretchW||stretchH)?'DRAG=stretch/shrink, ':'')
		+'SHIFT-CLICK=show full size, CTRL-CLICK=restore initial size';
	e.statusMsg='width=%0, height=%1';
	e.style.cursor='move';
	e.originalW=e.style.width;
	e.originalH=e.style.height;
	e.minW=Math.max(e.offsetWidth/20,10);
	e.minH=Math.max(e.offsetHeight/20,10);
	e.stretchW=stretchW;
	e.stretchH=stretchH;
	e.onmousedown=function(ev) { var ev=ev||window.event;
		this.sizing=true;
		this.startX=!config.browser.isIE?ev.pageX:(ev.clientX+findScrollX());
		this.startY=!config.browser.isIE?ev.pageY:(ev.clientY+findScrollY());
		this.startW=this.offsetWidth;
		this.startH=this.offsetHeight;
                e.title = 'CURRENT SIZE: (' + this.style.width + ', ' + this.style.height + ')';
		return false;
	};
	e.onmousemove=function(ev) { var ev=ev||window.event;
		if (this.sizing) {
			var s=this.style;
			var currX=!config.browser.isIE?ev.pageX:(ev.clientX+findScrollX());
			var currY=!config.browser.isIE?ev.pageY:(ev.clientY+findScrollY());
			var newW=(currX-this.offsetLeft)/(this.startX-this.offsetLeft)*this.startW;
			var newH=(currY-this.offsetTop )/(this.startY-this.offsetTop )*this.startH;
			if (this.stretchW) s.width =Math.floor(Math.max(newW,this.minW))+'px';
			if (this.stretchH) s.height=Math.floor(Math.max(newH,this.minH))+'px';
			clearMessage(); displayMessage(this.statusMsg.format([s.width,s.height]));
		}
		return false;
	};
	e.onmouseup=function(ev) { var ev=ev||window.event;
		if (ev.shiftKey) { this.style.width=this.style.height=''; }
		if (ev.ctrlKey)  { this.style.width=this.originalW; this.style.height=this.originalH; }
		this.sizing=false;
		clearMessage();
		return false;
	};
	e.onmouseout=function(ev) { var ev=ev||window.event;
		this.sizing=false;
		clearMessage();
		return false;
	};
}
//}}}</pre>
</div>
<div title="ImportedTiddlers" modifier="Shankar" created="200909152052" modified="201003131847" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre></pre>
</div>
<div title="InlineJavascriptPlugin" modifier="Shankar" created="200909150240" modified="201109070345" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|InlineJavascriptPlugin|
|Source|http://www.TiddlyTools.com/#InlineJavascriptPlugin|
|Documentation|http://www.TiddlyTools.com/#InlineJavascriptPluginInfo|
|Version|1.9.2|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|Insert Javascript executable code directly into your tiddler content.|
''Call directly into TW core utility routines, define new functions, calculate values, add dynamically-generated TiddlyWiki-formatted output'' into tiddler content, or perform any other programmatic actions each time the tiddler is rendered.
!!!!!Documentation
&gt;see [[InlineJavascriptPluginInfo]]
!!!!!Revisions
&lt;&lt;&lt;
2008.03.03 [1.9.2] corrected declaration of wikifyPlainText() for 'TW 2.1.x compatibility fallback' (fixes Safari &quot;parse error&quot;)
2008.02.23 [1.9.1] in onclick function, use string instead of array for 'bufferedHTML' attribute on link element (fixes IE errors)
2008.02.21 [1.9.0] 'onclick' scripts now allow returned text (or document.write() calls) to be wikified into a span that immediately follows the onclick link.  Also, added default 'return false' handling if no return value provided (prevents HREF from being triggered -- return TRUE to allow HREF to be processed).  Thanks to Xavier Verges for suggestion and preliminary code.
|please see [[InlineJavascriptPluginInfo]] for additional revision details|
2005.11.08 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.inlineJavascript= {major: 1, minor: 9, revision: 2, date: new Date(2008,3,3)};

config.formatters.push( {
	name: &quot;inlineJavascript&quot;,
	match: &quot;\\&lt;script&quot;,
	lookahead: &quot;\\&lt;script(?: src=\\\&quot;((?:.|\\n)*?)\\\&quot;)?(?: label=\\\&quot;((?:.|\\n)*?)\\\&quot;)?(?: title=\\\&quot;((?:.|\\n)*?)\\\&quot;)?(?: key=\\\&quot;((?:.|\\n)*?)\\\&quot;)?( show)?\\&gt;((?:.|\\n)*?)\\&lt;/script\\&gt;&quot;,

	handler: function(w) {
		var lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
		lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = lookaheadRegExp.exec(w.source)
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
			var src=lookaheadMatch[1];
			var label=lookaheadMatch[2];
			var tip=lookaheadMatch[3];
			var key=lookaheadMatch[4];
			var show=lookaheadMatch[5];
			var code=lookaheadMatch[6];
			if (src) { // load a script library
				// make script tag, set src, add to body to execute, then remove for cleanup
				var script = document.createElement(&quot;script&quot;); script.src = src;
				document.body.appendChild(script); document.body.removeChild(script);
			}
			if (code) { // there is script code
				if (show) // show inline script code in tiddler output
					wikify(&quot;{{{\n&quot;+lookaheadMatch[0]+&quot;\n}}}\n&quot;,w.output);
				if (label) { // create a link to an 'onclick' script
					// add a link, define click handler, save code in link (pass 'place'), set link attributes
					var link=createTiddlyElement(w.output,&quot;a&quot;,null,&quot;tiddlyLinkExisting&quot;,wikifyPlainText(label));
					var fixup=code.replace(/document.write\s*\(/gi,'place.bufferedHTML+=(');
					link.code=&quot;function _out(place){&quot;+fixup+&quot;\n};_out(this);&quot;
					link.tiddler=w.tiddler;
					link.onclick=function(){
						this.bufferedHTML=&quot;&quot;;
						try{ var r=eval(this.code);
							if(this.bufferedHTML.length || (typeof(r)===&quot;string&quot;)&amp;&amp;r.length)
								var s=this.parentNode.insertBefore(document.createElement(&quot;span&quot;),this.nextSibling);
							if(this.bufferedHTML.length)
								s.innerHTML=this.bufferedHTML;
							if((typeof(r)===&quot;string&quot;)&amp;&amp;r.length) {
								wikify(r,s,null,this.tiddler);
								return false;
							} else return r!==undefined?r:false;
						} catch(e){alert(e.description||e.toString());return false;}
					};
					link.setAttribute(&quot;title&quot;,tip||&quot;&quot;);
					var URIcode='javascript:void(eval(decodeURIComponent(%22(function(){try{';
					URIcode+=encodeURIComponent(encodeURIComponent(code.replace(/\n/g,' ')));
					URIcode+='}catch(e){alert(e.description||e.toString())}})()%22)))';
					link.setAttribute(&quot;href&quot;,URIcode);
					link.style.cursor=&quot;pointer&quot;;
					if (key) link.accessKey=key.substr(0,1); // single character only
				}
				else { // run inline script code
					var fixup=code.replace(/document.write\s*\(/gi,'place.innerHTML+=(');
					var code=&quot;function _out(place){&quot;+fixup+&quot;\n};_out(w.output);&quot;
					try { var out=eval(code); } catch(e) { out=e.description?e.description:e.toString(); }
					if (out &amp;&amp; out.length) wikify(out,w.output,w.highlightRegExp,w.tiddler);
				}
			}
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	}
} )
//}}}

// // Backward-compatibility for TW2.1.x and earlier
//{{{
if (typeof(wikifyPlainText)==&quot;undefined&quot;) window.wikifyPlainText=function(text,limit,tiddler) {
	if(limit &gt; 0) text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}
//}}}</pre>
</div>
<div title="Journal Entries" modifier="Shankar" created="200909221509" modified="201108302334" tags="Topics mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre></pre>
</div>
<div title="JqueryTreeviewCSS-T" modifier="YourName" created="200909150317" modified="200909151332" tags="CSS excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
!!!&lt;&lt;gradient horiz #4EB93E #fff &gt;&gt;&lt;&lt;tiddler RefreshStyles&gt;&gt;&amp;nbsp;StyleSheetTiddlersBar&gt;&gt;/%==================================================%/
***/

 .treeview, .treeview ul { 
	padding: 0;
	margin: 0;
	list-style: none;
}

.treeview ul {
	background-color:transparent;
	margin-top: 2px;
}

.treeview .hitarea {
	background: url([[treeview-gold.gif]]) -64px -25px no-repeat;
	height: 16px;
	width: 16px;
	margin-left: -16px;
	float: left;
	cursor: pointer;
}
/* fix for IE6 */
* html .hitarea {
	display: inline;
	float:none;
}

.treeview li { 
	margin: 0;
	padding: 3px 0pt 3px 16px;
}

.treeview a.selected {
	background-color: #eee;
}

#treecontrol { margin: 1em 0; display: none; }

.treeview .hover { color: red; cursor: pointer; }

.treeview li { background: url([[treeview-gold-line.gif]]) 0 0 no-repeat; }
.treeview li.collapsable, .treeview li.expandable { background-position: 0 -176px; }

.treeview .expandable-hitarea { background-position: -80px -3px; }

.treeview li.last { background-position: 0 -1766px }
.treeview li.lastCollapsable, .treeview li.lastExpandable { background-image: url([[treeview-gold.gif]]); }  
.treeview li.lastCollapsable { background-position: 0 -111px }
.treeview li.lastExpandable { background-position: -32px -67px }

.treeview div.lastCollapsable-hitarea, .treeview div.lastExpandable-hitarea { background-position: 0; }

.treeview-red li { background-image: url([[treeview-red-line.gif]]); }
.treeview-red .hitarea, .treeview-red li.lastCollapsable, .treeview-red li.lastExpandable { background-image: url([[treeview-red.gif]]); } 

.treeview-gold li { background-image: url([[treeview-gold-line.gif]]); }
.treeview-gold .hitarea, .treeview-gold li.lastCollapsable, .treeview-gold li.lastExpandable { background-image: url([[treeview-gold.gif]]); } 


.treeview-black li { background-image: url([[treeview-black-line.gif]]); }
.treeview-black .hitarea, .treeview-black li.lastCollapsable, .treeview-black li.lastExpandable { background-image: url([[treeview-black.gif]]); }  

.treeview-gray li { background-image: url([[treeview-gray-line.gif]]); }
.treeview-gray .hitarea, .treeview-gray li.lastCollapsable, .treeview-gray li.lastExpandable { background-image: url([[treeview-gray.gif]]); } 

.treeview-famfamfam li { background-image: url([[treeview-famfamfam-line.gif]]); }
.treeview-famfamfam .hitarea, .treeview-famfamfam li.lastCollapsable, .treeview-famfamfam li.lastExpandable { background-image: url([[treeview-famfamfam.gif]]); } 


.filetree li { padding: 3px 0 2px 16px; }
.filetree span.folder, .filetree span.file { padding: 1px 0 1px 16px; display: block; }
.filetree span.folder { background: url([[folder.gif]]) 0 0 no-repeat; }
.filetree li.expandable span.folder { background: url([[folder-closed.gif]]) 0 0 no-repeat; }
.filetree span.file { background: url([[file.gif]]) 0 0 no-repeat; }</pre>
</div>
<div title="KB" modifier="YourName" created="201510191932" modified="201510192013" tags="aaTag excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script&gt;
// Version: from KBOpt-1 created 10-3-2015 
var $ = jQuery;

var PINColors = [ '#FFFFF3', '#EFEEEC', '#E5E4E2', '#DBDAD8', 
    '#45BF55', '#168039', '#044D29', '#000F0B', '#F2CB00', '#F27405', 
    '#E82C0C', '#FF0000', '#FFFFCC', '#CCFFCC', '#CCCCFF', '#B4F9FF'];
var PINTextColors = ['#08010A', '#08010A', '#08010A2', '#08010A', 
    '#A0522D', '#DCEAF2', '#DCEAF2', '#B0CED0', '#000000', '#FAEBD7', 
    '#FAEBD7', '#FAEBD7', '#0000BB', '#800000', '#006400', '#A0522D'];

//------------  PINProject  ----------------------------------
var GProject =
{
    Name                  : &quot;&quot;,
    LastSelectID          : undefined,
    PINArray              : [],
    CurrentIndex          : &quot;&quot;, 
    NeedToSave            : false,
    RootDIV               : &quot;&quot;,
    Init                  : function() 
                            {this.RootDIV = createTiddlyElement(place, 'div', 'RootDiv', 'myDivClass', null);},    
    SetCurrentIndexFromID : function(myID)
    {
        var myIndex = -1;
        myIndex = (GProject.PINArray).map(function(obj, index)
         { if(obj.ID === myID) return index; }).filter(isFinite)[0]; 
        this.CurrentIndex = (myIndex === undefined) ? -1 : myIndex;
        return myIndex;
    },    //  SetCurrentIndexFromID : function(myID)
    SaveToDisk           : function(nameToSave){
        if (!nameToSave)
        {
            nameToSave = this.Name;
        }    //  if (!nameToSave)
        var myTags = &quot;aaTag savedPIN mySystem &quot; + 
                     &quot;excludeLists excludeMissing excludeSearch&quot;;
        while (!this.Name)
        {
            nameToSave = 
                     this.Name = (prompt(&quot;Project Name?:&quot;, this.Name)).trim();
        }    //  while (!this.Name)
        //  We are better off saving only data, as far as possible.  Restoring
        //  or creating object methods with JSON array is feasible but complex
        var myStoredName = &quot;PIN.&quot; + nameToSave + &quot;.JSON&quot;;
        store.saveTiddler(myStoredName, myStoredName, 
                          JSON.stringify(GProject.PINArray),
                          config.options.txtUserName, new Date(), myTags);
                          autoSaveChanges(null, [myStoredName]);
        return false;    
    },     //  SaveToDisk : function()  
    LoadFromDisk          :  function(loadName) {
        // This function does not remove the existing notes from the DOM.  
        GProject.PINArray = JSON.parse(store.getTiddlerText(&quot;PIN.&quot; + loadName + &quot;.JSON&quot;)); 
        GProject.Name = loadName;
        
        if (GProject.PINArray &amp;&amp; GProject.PINArray.length)
        {
            //  Swizzle the dynamic properties that need to be recreated:
            //  apparently a 'for loop' is fater than using Array.forEach(...)
//console.time(&quot;LoadProject&quot;);
            for (var i=0; i &lt; GProject.PINArray.length;  ++i)
            {
                 GProject.PINArray[i].CPTA =  
                 GProject.PINArray[i].DIV = 
                 GProject.PINArray[i].myDivID
                 GProject.PINArray[i].myTextboxID = undefined;

                 CreatePIN(i);                 
            }    //  for (var i=0; i &lt; GProject.PINArray.length;  ++i)
//console.timeEnd(&quot;LoadProject&quot;);
        }    //  if (GProject.PINArray &amp;&amp; GProject.PINArray.length)
        //  the following has to be set in the end - other fuctions will
        //  have set this to true during load process:
        GProject.NeedToSave = false;
    },    //  LoadFromDisk  : functionj(loadName)
    ChangeNotesColor : function(myID, newColor)   
    {
        // Locate the object in the PINArray
        var myIndex = (GProject.PINArray).map(function(obj, index)
               {if(obj.ID === myID) return index; }).filter(isFinite)[0]; 
        
        // Change the color in the DIV
        if (myIndex &gt;= 0 &amp;&amp; myIndex &lt; GProject.PINArray.length)
        {
             $(GProject.PINArray[myIndex].DIV).css({background: newColor, border: '0px'});
             $(GProject.PINArray[myIndex].CPTA).css({
                      background: newColor, border: '0px',
                          color: PINTextColors[PINColors.indexOf(newColor)]});
             GProject.PINArray[myIndex].background = newColor;
             GProject.PINArray[myIndex].color = PINTextColors[PINColors.indexOf(myRef.color)];
        }    //  if (myIndex &gt;= 0 &amp;&amp; ...)
       
    },    //  ChangeNotesColor : function(myID, newColor)
    OpenENotes : function(myNoteID) {
        var myIndex = (GProject.PINArray).map(function(obj, index)
                    { if(obj.ID === myNoteID) return index; }).filter(isFinite)[0]; 
        if (myIndex &gt;= 0 &amp;&amp; myIndex &lt; GProject.PINArray.length)
        {
            var myENotes = GProject.Name + GProject.PINArray[myIndex].ID.toString();
            if ( store.tiddlerExists(myENotes) )
            {
                story.displayTiddler(null, myENotes);
            }    //  if ( store.tiddlerExists( myENotes )
            else {
                //  Create the tiddler:
                store.saveTiddler(
                              myENotes,
                              myENotes,
                              &quot;&quot;,
                              config.options.txtUserName,
                              new Date(),
                              &quot;aaTag pinNotes excludeLists excludeMissing&quot;);
                if (!store.tiddlerExists(myENotes))
                {
                    alert(&quot;Could not create a tiddler; try again :-(&quot;);                  
                    return;
                }
                autoSaveChanges(null,[myENotes]); 
                story.displayTiddler(null, myENotes);
                
                GProject.PINArray[myIndex].ENotesLink = myENotes;
                // since user requested a non-existing one, likely the user wants
                // to enter something now: display it in the edit mode
                config.commands.editTiddler.handler(null, null, myENotes);   
            }    //  if ( store.tiddlerExists( myENotes ) ... else ...
        }    //  if (myIndex &gt;= 0 &amp;&amp; ...)
    },    //  OpenENotes : function(myNoteID)

    DeleteENotes : function (myNoteID) {
        var myIndex = (GProject.PINArray).map(function(obj, index)
         { if(obj.ID === myLSID) return index; }).filter(isFinite)[0];
        var myENotes = GProject.PINArray[myIndex].ENotesLink;
        store.tiddlerExists(myENotes) &amp;&amp; store.deleteTiddler(myENotes);
    },
    //  This removes the DIVs from the DOM so that a new project can be
    //  displayed
    RemoveNotesDIVs              : function() {
        $('.myDivClass').remove();
        this.Init();
    },    //  RemoveNotesDIVs              : function() 
    //  This deletes all the notes and the associated ENotes
    DeleteAllPINsEnotes          : function(){
        if (GProject.PINArray &amp;&amp; GProject.PINArray.length)
        {
            $('.myDivClass').empty();
            this.Init();
            for (var myI = 0; myI &lt; this.PINArray.length; ++myI)
            {
                // Delete the ENotes tiddlers that may exist:
                if ( this.PINArray[myI].ENotesLink &amp;&amp;
                     store.tiddlerExists(this.PINArray[myI].ENotesLink) )
                {
                    store.deleteTiddler(this.PINArray[myI].ENotesLink);
                }
            }    //  for (var myI = 0; ...)
        }    //  if (victimIndex &lt; GProject.PINArray.length)
        
        this.PINArray.splice(0, this.PINArray.length);
        // not sure why 'SideBarTabs' tiddler is not updating 
        // on its own - it is required per PageTemplate tiddler
        refreshAll();

    }    //  DeleteAllPINsEnotes          : function()    
};    //  var GProject = ...

//-------------  PINObject ----------------------------------
// The PINObject is kept exclusively data only to maintain a clean
// isolation of the data saved.  This is also the object that is 
// streamed in and out of the disk as a JSON object.
function PINObject()
{
    // ID - creation time in sec since the epoch.  This uniquely identifies each PIN Object
    // Once assigned, this will NOT change when the project is re-loaded:
    this.ID          = (function() { return (new Date()).getTime().toString(); })();      
    this.color;
    this.width;
    this.height;
    this.originX;
    this.originY;
    this.zIndex;
    this.CPTA;   //PIN Text Area - changes each time the project is loaded
    this.DIV;    // This the DIV itself - changes each time the project is loaded
    this.myDivID; // This is the ID associated with the DIV - not the PINObject
    this.myTextboxID; // ID with the textbox - changes each time project is reloaded
    this.headerText;  // currently not used!
    this.bodyText;
    this.fontSize;
    // Name the tiddler after the time of creation of the note, counting since epoch:
    this.ENotesLink;
}    //  function PINObject( ... ... ... )

//------------------  CreatePIN  ----------------------------------------------------------
// Create a DIV, add it to the document.  The DIV is created based on the already
// created PINObject.  Details of the DIV are saved in that PINObject.

// myAIndex is the index into the GProject.PINArray where this PIN will be saved at:
function CreatePIN(myAIndex)
{
    var myRef = GProject.PINArray[myAIndex];
    if (!myRef.ID)
    {
         alert(&quot;Bummer! Got a PINObject without a unique ID! Bailing out!&quot;);
         return;
    }
    
    myRef.myDivID = &quot;DivID&quot; + (myRef.ID).toString();
    myRef.DIV = createTiddlyElement(place, 'div', myRef.myDivID, 'myDivClass', null);

    $(myRef.DIV).css({ width: myRef.width, height: myRef.height, 
                   background: myRef.color, border: '0px', 
                   position: 'absolute', 
                   left: (myRef.originX).toString()+&quot;px&quot;, 
                   top:  (myRef.originY).toString()+&quot;px&quot; });

    myRef.myTextboxID = &quot;TB&quot; + myRef.ID.toString();
    myRef.CPTA = createTiddlyElement(myRef.DIV, 'textarea', myRef.myTextboxID, 'classCPTA', null);

    // to access the PINObject from the DIV:
    myRef.CPTA.ID = myRef.ID;
    $(myRef.CPTA).css({width: myRef.width, height: myRef.height, 
                 background: myRef.color, 
                 color: PINTextColors[PINColors.indexOf(myRef.color)],
                 border: '0px', 'font-size': myRef.fontSize })
           .resizable()
           .click(function() { if ($(myRef.CPTA).is(':focus'))
                                 {
                                     GProject.LastSelectID =  0;
                                     $(myRef.CPTA).blur();
                                 } else {
                                     $(myRef.CPTA).focus();  
                                     //GProject.LastSelectID =  myRef.ID;
                                 }
                              })
           .dblclick(function() {GProject.OpenENotes(myRef.ID);})  
           .focusin( function() { $(myRef.DIV).css({ border: '2px solid #6CFAF4' });
                                  // set this note as selected in the GProject.PINArray[]
                                  GProject.LastSelectID =  myRef.ID;
                                  GProject.NeedToSave = true;
                                  //console.log( GProject.LastSelectID + &quot;   focus in  &quot;); 
                                })
           .focusout(function() { $(myRef.DIV).css({ border: '0px'});
                                  var myOffset = $('#'+myRef.myDivID).position(); 
                                  myRef.originX = myOffset.left;  myRef.originY = myOffset.top;
                                  //console.log(&quot;^^^^  &quot; + myOffset.left + &quot;, &quot; + myOffset.top);
                                  myRef.bodyText = $('#'+ myRef.myTextboxID).val();
                                  //console.log(&quot;Body text: &quot; + myRef.bodyText);
                                  // console.log( myRef.ID + &quot;focus out&quot;);
                                  //  This is convoluted.  Say we hit &quot;delete PIN&quot; or &quot;color select&quot;
                                  // after selecting a PIN.  The PIN immeidately goes out of focus 
                                  // but we still want the respective callback to read the selected
                                  // LastSelectID.  But if the user clicked elsewhere, just to unselect,
                                  // we would like to unselect quickly.  So we set a reasonable timeout
                                  // period here before resetting the GProject.LastSelectID:
                                  setTimeout(function(){ GProject.LastSelectID = 0; }, 300);
                                });

    $(myRef.DIV).draggable({
             cancel: &quot;text&quot;, cursor: &quot;move&quot;,
             start: function (){ $('#CPTextArea').focus();
                                 // set this note as selected in the GProject.PINArray[]
                                 GProject.SetCurrentIndexFromID(myRef.CPTA.ID);
                               },
             stop: function (){ $('#CPTextArea').focus();
                                var myOffset = $('#'+myRef.myDivID).position(); 
                                GProject.SetCurrentIndexFromID(myRef.CPTA.ID);
                                //console.log(&quot;***  &quot; + myOffset.left + &quot;, &quot; + myOffset.top);
                                GProject.CurrentIndex = -1; } })
            .resizable();

    // jQuery introduced class ui-wrapper is adding a right side padding == width of the textbox
    // - either jQuery bug or my bug; but this is the work around:
    if ($(myRef.DIV).hasClass('ui-resizable')) 
    {
        $('.ui-wrapper').css({padding: '0px'});
    }    //  if ($(myRef.DIV).hasClass('ui-resizable'))
      
   // restore text in the very end, to be safe:
   if (myRef.bodyText)
   {
       $('#'+ myRef.myTextboxID).val(myRef.bodyText);
   }

   GProject.NeedToSave = true;

   return myRef.DIV;
    
}  //    var CreatePIN(myColor, myW, myH)

//----------------------  Color Click Callback  ------------------------
// If the GProject.LastSelectID != 0, then we are changing the color 
// of an existing PIN object.  Else, we are creating a new PINObject
function gdeColorClick(myColor)
{
console.profile(&quot;LoadProjectProfile&quot;);
    var myTargetID = GProject.LastSelectID;
    if (!myTargetID)
    {
        CreateNewPINItem(myColor);
    }
    else {
        // console.log(&quot;Change &quot; + myTargetID + &quot; to &quot; + myColor + &quot; color&quot;);
        GProject.ChangeNotesColor(myTargetID, myColor);
    }    //  if (!myTargetID)
    
console.profileEnd(&quot;LoadProjectProfile&quot;);
}    //  function gdeColorClick(myColor)


function CreateNewPINItem(myColor)
{
    var k = 0;
    if (GProject.PINArray)
    {
        k = GProject.PINArray.length;
    }
    
    GProject.PINArray.push(new PINObject());   
    var mySizeString = $('#SelectSizeID option:selected').text();
    GProject.PINArray[k].width  = parseInt(mySizeString.match(/^\d+/));
    GProject.PINArray[k].height = parseInt(mySizeString.match(/\d+$/));
 
    GProject.PINArray[k].fontSize = '18pt';  //default

    if ($('#FontSizeID option:selected').val() &gt;0)
    {
         GProject.PINArray[k].fontSize = 
             parseInt($('#FontSizeID option:selected').text());
    }

    // if nothing selected,  either pick the previously selected size
    // or if this is the first PIN, give a default of 200px x 200px
    if (!k)
    {
        if (!GProject.PINArray[k].width)
        {    
             GProject.PINArray[k].width     = 200; 
             GProject.PINArray[k].height    = 200;
        }  //  if (!GProject.PINArray[k].width)
        GProject.PINArray[k].originX = 50;
        GProject.PINArray[k].originY = 150;
        GProject.PINArray[k].zIndex  = 1.0;

     } else {   
        if (!GProject.PINArray[k].width)
        {    
             GProject.PINArray[k].width  = GProject.PINArray[k-1].width;
             GProject.PINArray[k].height = GProject.PINArray[k-1].height;
        }  //  if (!GProject.PINArray[k].width)
        GProject.PINArray[k].originX =  GProject.PINArray[k-1].originX 
                                      + GProject.PINArray[k-1].width + 5;
        GProject.PINArray[k].originY =  GProject.PINArray[k-1].originY;
        GProject.PINArray[k].zIndex  = GProject.PINArray[k-1].zIndex + 1.0;
     }  //  if (!k) ... else ...
 
    GProject.PINArray[k].color = myColor;
    CreatePIN( k );
    // if we reached here, we know we succeeded -&gt; set the CurrentIndex
    GProject.CurrentIndex = k;
    //console.log(&quot;ID: &quot; + GProject.PINArray[k].ID + &quot;, Index: &quot; + GProject.CurrentIndex); 

}    //  function CreateNewPINItem(myColor)

//----------  Callbacks for GUI Elements -------------------

// This function is called only when the selection changes.  If the
// selection is activated but the same item that was selected before
// was again selected, this function does NOT get called.
function gdeSelectProjectCB()
{  
    //console.log(&quot;Old: &quot; + AvailableProjects.lastSelectValue 
    //              + &quot;,  new: &quot; + $('#SelectID :selected').val());
    // Save the old project:
    if (GProject.PINArray &amp;&amp; GProject.PINArray.length)
    {
        if ( GProject.NeedToSave &amp;&amp; confirm(&quot;Would you like to save the current project first?&quot;))
        {
            if (GProject.Name)
            {
                GProject.SaveToDisk();
            } else 
            {
                GProject.Name = prompt(&quot;Enter a name for the project&quot;).trim();
                GProject.SaveToDisk();
                AvailableProjects.updateList();
            }
        }    // if  (confirm ...))
    }    //  if (GProject.PINArray &amp;&amp; GProject.PINArray.length)
        
    // Clear the existing project
    GProject.RemoveNotesDIVs();
    // Load the new project - if one is selected or just ...
    if ( $('#SelectID :selected').val() &gt; 0 )
    {
        GProject.LoadFromDisk( $('#SelectID :selected').text() );
    }    //  if ( $('#SelectID :selected').val() &gt; 0 )
}    //  function gdeSelectProjectCB()

// find the element that is selected and remove it
function gdeDeleteNoteCB()
{
    var myLSID = GProject.LastSelectID;

    if (!myLSID)
    {
        alert(&quot;Select the note to delete and try again!&quot;);
    }
    else if ( confirm(&quot;Would you like to delete the selected note?&quot;) )
    {
        var victimIndex = (GProject.PINArray).map(function(obj, index)
              { if(obj.ID === myLSID) return index; }).filter(isFinite)[0];      
        if (victimIndex &lt; GProject.PINArray.length)
        {
            $(GProject.PINArray[victimIndex].DIV).remove();
            
            if (GProject.PINArray[victimIndex].ENotesLink)
            { 
                var myENotes = GProject.PINArray[victimIndex].ENotesLink;
                if (store.tiddlerExists(myENotes))
                {
                    store.deleteTiddler(myENotes);
                    // not sure why 'SideBarTabs' tiddler is not updating 
                    // on its own - it is required per PageTemplate tiddler
                    refreshAll();
                }    //  if (store.tiddlerExists(myENotes))
            }    //  if (GProject.PINArray[victimIndex].ENotesLink)
             
            // purge item from the array:
            GProject.PINArray.splice(victimIndex, 1);

            GProject.NeedToSave = true;
        }    //  if (victimIndex &lt; GProject.PINArray.length)

    }   //  else if (GProject.LastSelectID &amp;&amp; confirm(...) ) 

}    //  function gdeDeleteNoteCB()

// Delete the current project
function gdeDeleteProjectCB()
{
    // Remove the DIV elements:
    GProject.DeleteAllPINsEnotes();

    // See if the loaded project is saved: look for GProject.Name
    if (GProject.Name)
    {
        store.deleteTiddler(&quot;PIN.&quot; + GProject.Name +  &quot;.JSON&quot;);
    }
    AvailableProjects.updateList();
    AvailableProjects.populateSelectBox();
    
    return true;
}    //  function gdeDeleteProjectCB()

function gdeSaveCB()
{
    GProject.SaveToDisk();
    GProject.NeedToSave = false;
}    //  function gdeSaveCB()

function gdeCopyProjectCB()
{
    // save current project
    gdeSaveCB();
    var newPName;

    newPName = (prompt(&quot;Project Name?:&quot;, this.Name)).trim();
    if (newPName)
    {
        GProject.SaveToDisk(newPName);
        AvailableProjects.updateList();
        AvailableProjects.populateSelectBox();

        alert(&quot;Current project copy saved at: &quot; + newPName);
        
    }    //  if (newPName)
    else {
        alert (&quot;Did not get a valida name for the copy - bailed out!&quot;);
    }    //  if (newPName) ... else
    
}    //  function gdeCopyProjectCB()

//  This is needed to populate the &quot;Load&quot; Selection box with all the
// available PIN tiddlers

var AvailableProjects =  {
    myList :        [],
    lastSelectValue: 0,  // save the previous selection value here

    updateList:     function() {
                        var tmpList = store.getTiddlers();
                        var tmpItem;
                        this.myList.splice(0, this.myList.length);
                        for (var t=0; t&lt;tmpList.length; t++){
                            if ( tmpList[t].isTagged('savedPIN') &amp;&amp;
                                 ((tmpList[t].title).indexOf(&quot;PIN.&quot;) === 0) &amp;&amp;
                                 ((tmpList[t].title).indexOf(&quot;.JSON&quot;) &gt;= 0) ) 
                            {    
                                tmpItem = tmpList[t].title;
                                //console.log(&quot;*** &quot; + tmpItem);
                                tmpItem = (tmpItem.replace(/^PIN./, '')).replace(/.JSON$/, '');
                                this.myList.pushUnique(tmpItem);
                            }    //  if (tmpList[t].isTagged('savedPIN')) 
                        }    //  for (var t=0; t&lt;myList.length; t++)

                        this.myList.sort();
                        return this.myList;
    },
    populateSelectBox : function() {
                             // remove any pre-existing items:
                             $(&quot;#SelectID option[value!='-1']&quot;).remove();
           
                             $('#SelectID').append($('&lt;option&gt;', {
                                    value: 0,
                                    text: 'Load' }));
                             for (var myItem = 0; myItem &lt; this.myList.length; ++myItem)
                             {
                                 $('#SelectID').append($('&lt;option&gt;', {
                                 value: myItem+1, text: this.myList[myItem] }));
                             }    //  for ( ... )

    },

    setSelectionByNumber:  function(itemNumber) {

    },

    setSelectionByValue:   function(myValue) {

    }
};    //  var AvailableProjects = 

// Invoke this immediately - we would like to show the GUI on launch!
var CreateGUIElements = function()
{
    var BBTable = createTiddlyElement(place, 'table', null, 'BB', null);
    var BBTableBody = createTiddlyElement(BBTable, 'tbody');
    var row0 = createTiddlyElement(BBTable, 'tr');

    //  Select box:
    var td = createTiddlyElement(row0, 'td');        
    ProjectSelect = createTiddlyElement(td, 'select', 'SelectID', 'selectClass');
    AvailableProjects.updateList();
    AvailableProjects.populateSelectBox();  
//xxxxx  
    jQuery.noConflict();
    $('#SelectID').change(gdeSelectProjectCB);
    
    $('#SelectID').on('focus', function(){ 
                    AvailableProjects.lastSelectValue = this.value;});


    //$('#SelectID').on('focus', function(){ 
    //                 AvailableProjects.lastSelectValue = this.value;});
    //  Color Picker
    PINColors.forEach( function(item) {
           td = createTiddlyElement(row0, 'td'); 
           myCDiv = createTiddlyElement(td, 'div', 'rectangle', 'myCDivClass'); 
           $(myCDiv).css({background: item})
           .click(function() { gdeColorClick(item); });
    }); 
    
    //  Select Note Size:
    var td = createTiddlyElement(row0, 'td');        
    SizeSelect = createTiddlyElement(td, 'select', 'SelectSizeID', 'selectClass');
    var i = 0;
    ['Size', '200 x 150', '200 x 75', '200 x 200', '400 x 200', '400 x 400'].
        forEach(function( item ){
              $('#SelectSizeID').append($('&lt;option&gt;', { value: i++, text: item}))});

    // Font Size
    var td = createTiddlyElement(row0, 'td');        
    SizeSelect = createTiddlyElement(td, 'select', 'FontSizeID', 'selectClass');
    var i = 0;
    ['Font', '8', '12', '14', '18', '22', '28', '30'].
        forEach(function( item ){
              $('#FontSizeID').append($('&lt;option&gt;', { value: i++, text: item}))});

    // Delete selected PIN
    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;X_Note&quot;,
                   &quot;Delete the selected item&quot;, gdeDeleteNoteCB, &quot;customButton&quot;); 
    // Delete Project
    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;X_Project&quot;,
                   &quot;Delete the project&quot;, gdeDeleteProjectCB, &quot;customButton&quot;);  

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Save&quot;,
                   &quot;Create a new item&quot;, gdeSaveCB, &quot;customButton&quot;); 

    var td = createTiddlyElement(row0, 'td');        
    var CreatePButton = createTiddlyButton(td, &quot;Copy&quot;,
                   &quot;Make a copy of this project&quot;, gdeCopyProjectCB, &quot;customButton&quot;); 
 
}    //  var CreateGUIElements  = function()

//------------------  Init PINProjects ----------------------------------
GProject.Init();
CreateGUIElements();
//------------------------------------------------------------------------
&lt;/script&gt;
&lt;HTML&gt;
&lt;HEADER&gt;&lt;style&gt;
#rectangle{
    width:25px;
    height:20px;
}
&lt;/style&gt;&lt;/HEADER&gt;
&lt;/HTML&gt;
&lt;&lt;tiddler jQueryUI-1.11.4&gt;&gt;
&lt;&lt;tiddler HideTiddlerTags&gt;&gt;
&lt;&lt;tiddler HideTiddlerSubtitle&gt;&gt;
&lt;&lt;tiddler HideTiddlerTitle&gt;&gt;</pre>
</div>
<div title="ListUnlisted" modifier="shankar " created="200911121428" modified="200911121549" tags="Note aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;forEachTiddler
         where
         'tiddler.tags.contains(&quot;excludeLists&quot;)'
         &gt;&gt; </pre>
</div>
<div title="MainMenu" modifier="YourName" created="200909150210" modified="200909210505" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;forEachTiddler where 'tiddler.tags.contains(&quot;Topics&quot;)' write
 '&quot;&lt;&lt;tiddler TopicsTemplate1 with: [[&quot;+tiddler.title+&quot;]]$))&quot;'&gt;&gt;</pre>
</div>
<div title="MarkupPostBody" modifier="Shankar" created="200909150313" modified="201108302329" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script&gt;
/*
 * Treeview 1.4 - jQuery plugin to hide and show branches of a tree
 * 
 * http://bassistance.de/jquery-plugins/jquery-plugin-treeview/
 * http://docs.jquery.com/Plugins/Treeview
 *
 * Copyright (c) 2007 JÃ¶rn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id: jquery.treeview.js 4684 2008-02-07 19:08:06Z joern.zaefferer $
 *
 */


;(function($) {

	$.extend($.fn, {
		swapClass: function(c1, c2) {
			var c1Elements = this.filter('.' + c1);
			this.filter('.' + c2).removeClass(c2).addClass(c1);
			c1Elements.removeClass(c1).addClass(c2);
			return this;
		},
		replaceClass: function(c1, c2) {
			return this.filter('.' + c1).removeClass(c1).addClass(c2).end();
		},
		hoverClass: function(className) {
			className = className || &quot;hover&quot;;
			return this.hover(function() {
				$(this).addClass(className);
			}, function() {
				$(this).removeClass(className);
			});
		},
		heightToggle: function(animated, callback) {
			animated ?
				this.animate({ height: &quot;toggle&quot; }, animated, callback) :
				this.each(function(){
					jQuery(this)[ jQuery(this).is(&quot;:hidden&quot;) ? &quot;show&quot; : &quot;hide&quot; ]();
					if(callback)
						callback.apply(this, arguments);
				});
		},
		heightHide: function(animated, callback) {
			if (animated) {
				this.animate({ height: &quot;hide&quot; }, animated, callback);
			} else {
				this.hide();
				if (callback)
					this.each(callback);				
			}
		},
		prepareBranches: function(settings) {
			if (!settings.prerendered) {
				// mark last tree items
				this.filter(&quot;:last-child:not(ul)&quot;).addClass(CLASSES.last);
				// collapse whole tree, or only those marked as closed, anyway except those marked as open
				this.filter((settings.collapsed ? &quot;&quot; : &quot;.&quot; + CLASSES.closed) + &quot;:not(.&quot; + CLASSES.open + &quot;)&quot;).find(&quot;&gt;ul&quot;).hide();
			}
			// return all items with sublists
			return this.filter(&quot;:has(&gt;ul)&quot;);
		},
		applyClasses: function(settings, toggler) {
			this.filter(&quot;:has(&gt;ul):not(:has(&gt;a))&quot;).find(&quot;&gt;span&quot;).click(function(event) {
				toggler.apply($(this).next());
			}).add( $(&quot;a&quot;, this) ).hoverClass();
			
			if (!settings.prerendered) {
				// handle closed ones first
				this.filter(&quot;:has(&gt;ul:hidden)&quot;)
						.addClass(CLASSES.expandable)
						.replaceClass(CLASSES.last, CLASSES.lastExpandable);
						
				// handle open ones
				this.not(&quot;:has(&gt;ul:hidden)&quot;)
						.addClass(CLASSES.collapsable)
						.replaceClass(CLASSES.last, CLASSES.lastCollapsable);
						
	            // create hitarea
				this.prepend(&quot;&lt;div class=\&quot;&quot; + CLASSES.hitarea + &quot;\&quot;/&gt;&quot;).find(&quot;div.&quot; + CLASSES.hitarea).each(function() {
					var classes = &quot;&quot;;
					$.each($(this).parent().attr(&quot;class&quot;).split(&quot; &quot;), function() {
						classes += this + &quot;-hitarea &quot;;
					});
					$(this).addClass( classes );
				});
			}
			
			// apply event to hitarea
			this.find(&quot;div.&quot; + CLASSES.hitarea).click( toggler );
		},
		treeview: function(settings) {
			
			settings = $.extend({
				cookieId: &quot;treeview&quot;
			}, settings);
			
			if (settings.add) {
				return this.trigger(&quot;add&quot;, [settings.add]);
			}
			
			if ( settings.toggle ) {
				var callback = settings.toggle;
				settings.toggle = function() {
					return callback.apply($(this).parent()[0], arguments);
				};
			}
		
			// factory for treecontroller
			function treeController(tree, control) {
				// factory for click handlers
				function handler(filter) {
					return function() {
						// reuse toggle event handler, applying the elements to toggle
						// start searching for all hitareas
						toggler.apply( $(&quot;div.&quot; + CLASSES.hitarea, tree).filter(function() {
							// for plain toggle, no filter is provided, otherwise we need to check the parent element
							return filter ? $(this).parent(&quot;.&quot; + filter).length : true;
						}) );
						return false;
					};
				}
				// click on first element to collapse tree
				$(&quot;a:eq(0)&quot;, control).click( handler(CLASSES.collapsable) );
				// click on second to expand tree
				$(&quot;a:eq(1)&quot;, control).click( handler(CLASSES.expandable) );
				// click on third to toggle tree
				$(&quot;a:eq(2)&quot;, control).click( handler() ); 
			}
		
			// handle toggle event
			function toggler() {
				$(this)
					.parent()
					// swap classes for hitarea
					.find(&quot;&gt;.hitarea&quot;)
						.swapClass( CLASSES.collapsableHitarea, CLASSES.expandableHitarea )
						.swapClass( CLASSES.lastCollapsableHitarea, CLASSES.lastExpandableHitarea )
					.end()
					// swap classes for parent li
					.swapClass( CLASSES.collapsable, CLASSES.expandable )
					.swapClass( CLASSES.lastCollapsable, CLASSES.lastExpandable )
					// find child lists
					.find( &quot;&gt;ul&quot; )
					// toggle them
					.heightToggle( settings.animated, settings.toggle );
				if ( settings.unique ) {
					$(this).parent()
						.siblings()
						// swap classes for hitarea
						.find(&quot;&gt;.hitarea&quot;)
							.replaceClass( CLASSES.collapsableHitarea, CLASSES.expandableHitarea )
							.replaceClass( CLASSES.lastCollapsableHitarea, CLASSES.lastExpandableHitarea )
						.end()
						.replaceClass( CLASSES.collapsable, CLASSES.expandable )
						.replaceClass( CLASSES.lastCollapsable, CLASSES.lastExpandable )
						.find( &quot;&gt;ul&quot; )
						.heightHide( settings.animated, settings.toggle );
				}
			}
			
			function serialize() {
				function binary(arg) {
					return arg ? 1 : 0;
				}
				var data = [];
				branches.each(function(i, e) {
					data[i] = $(e).is(&quot;:has(&gt;ul:visible)&quot;) ? 1 : 0;
				});
				$.cookie(settings.cookieId, data.join(&quot;&quot;) );
			}
			
			function deserialize() {
				var stored = $.cookie(settings.cookieId);
				if ( stored ) {
					var data = stored.split(&quot;&quot;);
					branches.each(function(i, e) {
						$(e).find(&quot;&gt;ul&quot;)[ parseInt(data[i]) ? &quot;show&quot; : &quot;hide&quot; ]();
					});
				}
			}
			
			// add treeview class to activate styles
			this.addClass(&quot;treeview&quot;);
			
			// prepare branches and find all tree items with child lists
			var branches = this.find(&quot;li&quot;).prepareBranches(settings);
			
			switch(settings.persist) {
			case &quot;cookie&quot;:
				var toggleCallback = settings.toggle;
				settings.toggle = function() {
					serialize();
					if (toggleCallback) {
						toggleCallback.apply(this, arguments);
					}
				};
				deserialize();
				break;
			case &quot;location&quot;:
				var current = this.find(&quot;a&quot;).filter(function() { return this.href.toLowerCase() == location.href.toLowerCase(); });
				if ( current.length ) {
					current.addClass(&quot;selected&quot;).parents(&quot;ul, li&quot;).add( current.next() ).show();
				}
				break;
			}
			
			branches.applyClasses(settings, toggler);
				
			// if control option is set, create the treecontroller and show it
			if ( settings.control ) {
				treeController(this, settings.control);
				$(settings.control).show();
			}
			
			return this.bind(&quot;add&quot;, function(event, branches) {
				$(branches).prev()
					.removeClass(CLASSES.last)
					.removeClass(CLASSES.lastCollapsable)
					.removeClass(CLASSES.lastExpandable)
				.find(&quot;&gt;.hitarea&quot;)
					.removeClass(CLASSES.lastCollapsableHitarea)
					.removeClass(CLASSES.lastExpandableHitarea);
				$(branches).find(&quot;li&quot;).andSelf().prepareBranches(settings).applyClasses(settings, toggler);
			});
		}
	});



	// classes used by the plugin
	// need to be styled via external stylesheet, see first example
	var CLASSES = $.fn.treeview.classes = {
		open: &quot;open&quot;,
		closed: &quot;closed&quot;,
		expandable: &quot;expandable&quot;,
		expandableHitarea: &quot;expandable-hitarea&quot;,
		lastExpandableHitarea: &quot;lastExpandable-hitarea&quot;,
		collapsable: &quot;collapsable&quot;,
		collapsableHitarea: &quot;collapsable-hitarea&quot;,
		lastCollapsableHitarea: &quot;lastCollapsable-hitarea&quot;,
		lastCollapsable: &quot;lastCollapsable&quot;,
		lastExpandable: &quot;lastExpandable&quot;,
		last: &quot;last&quot;,
		hitarea: &quot;hitarea&quot;
	};
	
	// provide backwards compability
	$.fn.Treeview = $.fn.treeview;


	
})(jQuery);
&lt;/script&gt;



&lt;script&gt;
var sc_project=4838317; 
var sc_invisible=1; 
var sc_partition=56; 
var sc_click_stat=1; 
var sc_security=&quot;9ff8d9d0&quot;; 
&lt;/script&gt;</pre>
</div>
<div title="Mauve" modifier="shankar " created="200909210331" modified="200910080155" tags="palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>Background: #fff
Foreground: #000
PrimaryPale: #ddaa99
PrimaryLight: #552233
PrimaryMid: #552233
PrimaryDark: #014
SecondaryPale: #994444
SecondaryLight: #994444
SecondaryMid: #db4
SecondaryDark: #841
TertiaryPale: #ffeedd
TertiaryLight: #ccc
TertiaryMid: #999
TertiaryDark: #666
Error: #f88
[[ColorPaletteSNS]]</pre>
</div>
<div title="MultiTagEditorPlugin" modifier="Shankar Swamy" created="201112181846" modified="201112182001" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|MultiTagEditorPlugin|
|''Version:''|0.2.0 (Dec 29, 2006)|
|''Source:''|http://ido-xp.tiddlyspot.com/#MultiTagEditorPlugin|
|''Author:''|Ido Magal (idoXatXidomagalXdotXcom)|
|''Licence:''|[[BSD open source license]]|
|''CoreVersion:''|2.1.0|
|''Browser:''|??|

!Description
This plugin enables the addition and deletion of tags from sets of tiddlers.

!Installation instructions
*Create a new tiddler in your wiki and copy the contents of this tiddler into it.  Name it the same and tag it with &quot;systemConfig&quot;.
*Save and reload your wiki.
*Use it here [[MultiTagEditor]].

!Revision history
* v0.2.0 (Dec 29, 2006)
** Added Selection column that allows excluding tiddlers.
* v0.1.0 (Dec 27, 2006)
** First draft.

!To Do
* Clean up text strings.
* Figure out how to store selection so it isn't reset after every action.
* Prettify layout.

!Code
***/
//{{{

merge(config.shadowTiddlers,
{
	MultiTagEditor:[
	&quot;&lt;&lt;MTE&gt;&gt;&quot;,
	&quot;&quot;
	].join(&quot;\n&quot;)
});

config.macros.MTE =
{
	AddToListLabel : &quot;Add to List&quot;,
	AddToListPrompt : &quot;Add Tiddlers to the List&quot;,
	listViewTemplate :
	{
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Title', field: 'title', tiddlerLink: 'title', title: &quot;Title&quot;, type: 'TiddlerLink'},
			{name: 'Snippet', field: 'text', title: &quot;Snippet&quot;, type: 'String'},
			{name: 'Tags', field: 'tags', title: &quot;Tags&quot;, type: 'Tags'}
			],
		rowClasses: [
			],
		actions: [
			//{caption: &quot;More actions...&quot;, name: ''},
			//{caption: &quot;Remove selected tiddlers from list&quot;, name: 'delete'}
			]
	},
	tiddlers : [],
	HomeSection : [],
	ListViewSection : [],
	AddToListSection : [],
	
	handler : function( place, macroName, params, wikifier, paramString, tiddler )
	{
		this.HomeSection = place;
		var newsection = createTiddlyElement( null, &quot;div&quot;, null, &quot;MTE_AddTag&quot; );
		createTiddlyText(newsection, &quot;Tiddler Tags to edit: &quot;);
		var input = createTiddlyElement( null, &quot;input&quot;, null, &quot;txtOptionInput&quot; );
		input.type = &quot;text&quot;;
		input.size = 50;
		newsection.appendChild( input );
		newsection.inputBox = input;
		createTiddlyButton( newsection, this.AddToListLabel, this.AddToListPrompt, this.onAddToList, null, null, null );
		createTiddlyButton( newsection, &quot;Clear List&quot;, this.addtoListPrompt, this.onClear, null, null, null );
		createTiddlyElement( newsection, &quot;br&quot; );
		createTiddlyElement( newsection, &quot;br&quot; );
		this.AddToListSection = newsection;
	        this.HomeSection.appendChild( newsection );

		newsection = createTiddlyElement( null, &quot;div&quot;, null, &quot;MTE_addtag&quot; );
		createTiddlyButton( newsection, &quot;Add Tag&quot;, &quot;Add tag to all listed tiddlers&quot;, this.onAddTag, null, null, null );
		var input = createTiddlyElement( null, &quot;input&quot;, null, &quot;txtOptionInput&quot; );
		input.type = &quot;text&quot;;
		input.size = 50;
		newsection.appendChild( input );
		newsection.inputBox = input;
		createTiddlyElement( newsection, &quot;br&quot; );
		this.AddTagSection = newsection;
	        this.HomeSection.appendChild( newsection );

		newsection = createTiddlyElement( null, &quot;div&quot;, null, &quot;MTE_removetag&quot; );
		createTiddlyButton( newsection, &quot;Remove Tag&quot;, &quot;Remove tag from all listed tiddlers&quot;, this.onRemoveTag, null, null, null );
		var input = createTiddlyElement( null, &quot;input&quot;, null, &quot;txtOptionInput&quot; );
		input.type = &quot;text&quot;;
		input.size = 50;
		newsection.appendChild( input );
		newsection.inputBox = input;
		createTiddlyElement( newsection, &quot;br&quot; );
		this.RemoveTagSection = newsection;
	        this.HomeSection.appendChild( newsection );

		this.ListViewSection = createTiddlyElement( null, &quot;div&quot;, null, &quot;MTE_listview&quot; );
		this.HomeSection.appendChild( this.ListViewSection );
		ListView.create( this.ListViewSection, this.tiddlers, this.listViewTemplate, null );

	},


	ResetListView : function()
	{
		ListView.forEachSelector( config.macros.MTE.ListViewSection, function( e, rowName )
		{
			if( e.checked )
			{
				var title = e.getAttribute( &quot;rowName&quot; );
				var tiddler = config.macros.MTE.tiddlers.findByField( &quot;title&quot;, title );
				tiddler.Selected = 1;
			}
		});
		config.macros.MTE.HomeSection.removeChild( config.macros.MTE.ListViewSection );
		config.macros.MTE.ListViewSection = createTiddlyElement( null, &quot;div&quot;, null, &quot;MTE_listview&quot; );
		config.macros.MTE.HomeSection.appendChild( config.macros.MTE.ListViewSection );
		ListView.create( config.macros.MTE.ListViewSection, config.macros.MTE.tiddlers, config.macros.MTE.listViewTemplate, config.macros.MTE.onSelectCommand);
	},

	onAddToList : function()
	{
		store.forEachTiddler( function ( title, tiddler )
		{
			var tags = config.macros.MTE.AddToListSection.inputBox.value.readBracketedList();
			if (( tiddler.tags.containsAll( tags ))  &amp;&amp; ( config.macros.MTE.tiddlers.findByField( &quot;title&quot;, title ) == null ))
			{
				var t = store.getTiddlerSlices( title, [&quot;Name&quot;, &quot;Description&quot;, &quot;Version&quot;, &quot;CoreVersion&quot;, &quot;Date&quot;, &quot;Source&quot;, &quot;Author&quot;, &quot;License&quot;, &quot;Browsers&quot;] );
				t.title = title;
				t.tiddler = tiddler;
				t.text = tiddler.text.substr(0,50);
				t.tags = tiddler.tags;
				config.macros.MTE.tiddlers.push(t);
			}
		});
		config.macros.MTE.ResetListView();
	},

	onClear : function()
	{
		config.macros.MTE.tiddlers = [];
		config.macros.MTE.ResetListView();
	},

	onAddTag : function( e )
	{
		var selectedRows = [];
		ListView.forEachSelector(config.macros.MTE.ListViewSection, function( e, rowName )
		{
			if( e.checked )
				selectedRows.push( e.getAttribute( &quot;rowName&quot; ));
		});
		var tag = config.macros.MTE.AddTagSection.inputBox.value;
		for(t=0; t &lt; config.macros.MTE.tiddlers.length; t++)
		{
			if ( selectedRows.indexOf( config.macros.MTE.tiddlers[t].title ) != -1 ){
                         	//alert(&quot;Adding following tags: &quot; + tag);      
				store.setTiddlerTag( config.macros.MTE.tiddlers[t].title, true, tag);
			}
		}
		config.macros.MTE.ResetListView();
	},

	onRemoveTag : function( e )
	{
		var selectedRows = [];
		ListView.forEachSelector(config.macros.MTE.ListViewSection, function( e, rowName )
		{
			if( e.checked )
				selectedRows.push( e.getAttribute( &quot;rowName&quot; ));
		});
		var tag = config.macros.MTE.RemoveTagSection.inputBox.value;
		for(t=0; t &lt; config.macros.MTE.tiddlers.length; t++)
		{
			if ( selectedRows.indexOf( config.macros.MTE.tiddlers[t].title ) != -1 )
				store.setTiddlerTag( config.macros.MTE.tiddlers[t].title, false, tag);
		}
		config.macros.MTE.ResetListView();
	}

};
//}}}</pre>
</div>
<div title="NSN" modifier="Shankar" created="201009130012" modified="201009140513" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;clickify newTiddler title:{{prompt('enter a title','Anonymous Notes')}} tag: 'aaTag' label: &quot;NSN&quot; focus: &quot;tags&quot; text:{{store.getTiddlerText(&quot;NSNTemplate&quot;)}}&gt;&gt;</pre>
</div>
<div title="NSNTemplate" modifier="Shankar" created="201009131330" modified="201009140513" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{c1{Title:

}}}
{{c2{Main Idea:

}}}
{{c3{Summary:

}}}
{{c4{Why this is important to us:

}}}
{{c5{What is missing:

}}}
{{c6{Sources/Links:

}}}</pre>
</div>
<div title="Navigating in NS" modifier="YourName" created="200909161422" modified="200909161522" tags="[[How to use]] Note mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>There are four ways to navigate through ~NoteStorm:
#Search for a note using the search window
#Browse your notes using the topic index to the left
#Browse the tabs of all your open tiddlers
#Open the sidebar to access lists of notes by title, by date modified and by tags</pre>
</div>
<div title="NestedSlidersPlugin" modifier="Shankar" created="200603092327" modified="200905310339" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|NestedSlidersPlugin|
|Source|http://www.TiddlyTools.com/#NestedSlidersPlugin|
|Documentation|http://www.TiddlyTools.com/#NestedSlidersPluginInfo|
|Version|2.4.9|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Options|##Configuration|
|Description|show content in nest-able sliding/floating panels, without creating separate tiddlers for each panel's content|
!!!!!Documentation
&gt;see [[NestedSlidersPluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkFloatingSlidersAnimate&gt;&gt; allow floating sliders to animate when opening/closing
&gt;Note: This setting can cause 'clipping' problems in some versions of InternetExplorer.
&gt;In addition, for floating slider animation to occur you must also allow animation in general (see [[AdvancedOptions]]).
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2008.11.15 - 2.4.9 in adjustNestedSlider(), don't make adjustments if panel is marked as 'undocked' (CSS class).  In onClickNestedSlider(), SHIFT-CLICK docks panel (see [[MoveablePanelPlugin]])
|please see [[NestedSlidersPluginInfo]] for additional revision details|
2005.11.03 - 1.0.0 initial public release.  Thanks to RodneyGomes, GeoffSlocock, and PaulPetterson for suggestions and experiments.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.NestedSlidersPlugin= {major: 2, minor: 4, revision: 9, date: new Date(2008,11,15)};

// options for deferred rendering of sliders that are not initially displayed
if (config.options.chkFloatingSlidersAnimate===undefined)
	config.options.chkFloatingSlidersAnimate=false; // avoid clipping problems in IE

// default styles for 'floating' class
setStylesheet(&quot;.floatingPanel { position:absolute; z-index:10; padding:0.5em; margin:0em; \
	background-color:#eee; color:#000; border:1px solid #000; text-align:left; }&quot;,&quot;floatingPanelStylesheet&quot;);

// if removeCookie() function is not defined by TW core, define it here.
if (window.removeCookie===undefined) {
	window.removeCookie=function(name) {
		document.cookie = name+'=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;'; 
	}
}

config.formatters.push( {
	name: &quot;nestedSliders&quot;,
	match: &quot;\\n?\\+{3}&quot;,
	terminator: &quot;\\s*\\={3}\\n?&quot;,
	lookahead: &quot;\\n?\\+{3}(\\+)?(\\([^\\)]*\\))?(\\!*)?(\\^(?:[^\\^\\*\\@\\[\\&gt;]*\\^)?)?(\\*)?(\\@)?(?:\\{\\{([\\w]+[\\s\\w]*)\\{)?(\\[[^\\]]*\\])?(\\[[^\\]]*\\])?(?:\\}{3})?(\\#[^:]*\\:)?(\\&gt;)?(\\.\\.\\.)?\\s*&quot;,
	handler: function(w)
		{
			lookaheadRegExp = new RegExp(this.lookahead,&quot;mg&quot;);
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source)
			if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart)
			{
				var defopen=lookaheadMatch[1];
				var cookiename=lookaheadMatch[2];
				var header=lookaheadMatch[3];
				var panelwidth=lookaheadMatch[4];
				var transient=lookaheadMatch[5];
				var hover=lookaheadMatch[6];
				var buttonClass=lookaheadMatch[7];
				var label=lookaheadMatch[8];
				var openlabel=lookaheadMatch[9];
				var panelID=lookaheadMatch[10];
				var blockquote=lookaheadMatch[11];
				var deferred=lookaheadMatch[12];

				// location for rendering button and panel
				var place=w.output;

				// default to closed, no cookie, no accesskey, no alternate text/tip
				var show=&quot;none&quot;; var cookie=&quot;&quot;; var key=&quot;&quot;;
				var closedtext=&quot;&gt;&quot;; var closedtip=&quot;&quot;;
				var openedtext=&quot;&lt;&quot;; var openedtip=&quot;&quot;;

				// extra &quot;+&quot;, default to open
				if (defopen) show=&quot;block&quot;;

				// cookie, use saved open/closed state
				if (cookiename) {
					cookie=cookiename.trim().slice(1,-1);
					cookie=&quot;chkSlider&quot;+cookie;
					if (config.options[cookie]==undefined)
						{ config.options[cookie] = (show==&quot;block&quot;) }
					show=config.options[cookie]?&quot;block&quot;:&quot;none&quot;;
				}

				// parse label/tooltip/accesskey: [label=X|tooltip]
				if (label) {
					var parts=label.trim().slice(1,-1).split(&quot;|&quot;);
					closedtext=parts.shift();
					if (closedtext.substr(closedtext.length-2,1)==&quot;=&quot;)	
						{ key=closedtext.substr(closedtext.length-1,1); closedtext=closedtext.slice(0,-2); }
					openedtext=closedtext;
					if (parts.length) closedtip=openedtip=parts.join(&quot;|&quot;);
					else { closedtip=&quot;show &quot;+closedtext; openedtip=&quot;hide &quot;+closedtext; }
				}

				// parse alternate label/tooltip: [label|tooltip]
				if (openlabel) {
					var parts=openlabel.trim().slice(1,-1).split(&quot;|&quot;);
					openedtext=parts.shift();
					if (parts.length) openedtip=parts.join(&quot;|&quot;);
					else openedtip=&quot;hide &quot;+openedtext;
				}

				var title=show=='block'?openedtext:closedtext;
				var tooltip=show=='block'?openedtip:closedtip;

				// create the button
				if (header) { // use &quot;Hn&quot; header format instead of button/link
					var lvl=(header.length&gt;5)?5:header.length;
					var btn = createTiddlyElement(createTiddlyElement(place,&quot;h&quot;+lvl,null,null,null),&quot;a&quot;,null,buttonClass,title);
					btn.onclick=onClickNestedSlider;
					btn.setAttribute(&quot;href&quot;,&quot;javascript:;&quot;);
					btn.setAttribute(&quot;title&quot;,tooltip);
				}
				else
					var btn = createTiddlyButton(place,title,tooltip,onClickNestedSlider,buttonClass);
				btn.innerHTML=title; // enables use of HTML entities in label

				// set extra button attributes
				btn.setAttribute(&quot;closedtext&quot;,closedtext);
				btn.setAttribute(&quot;closedtip&quot;,closedtip);
				btn.setAttribute(&quot;openedtext&quot;,openedtext);
				btn.setAttribute(&quot;openedtip&quot;,openedtip);
				btn.sliderCookie = cookie; // save the cookiename (if any) in the button object
				btn.defOpen=defopen!=null; // save default open/closed state (boolean)
				btn.keyparam=key; // save the access key letter (&quot;&quot; if none)
				if (key.length) {
					btn.setAttribute(&quot;accessKey&quot;,key); // init access key
					btn.onfocus=function(){this.setAttribute(&quot;accessKey&quot;,this.keyparam);}; // **reclaim** access key on focus
				}
				btn.setAttribute(&quot;hover&quot;,hover?&quot;true&quot;:&quot;false&quot;);
				btn.onmouseover=function(ev) {
					// optional 'open on hover' handling
					if (this.getAttribute(&quot;hover&quot;)==&quot;true&quot; &amp;&amp; this.sliderPanel.style.display=='none') {
						document.onclick.call(document,ev); // close transients
						onClickNestedSlider(ev); // open this slider
					}
					// mouseover on button aligns floater position with button
					if (window.adjustSliderPos) window.adjustSliderPos(this.parentNode,this,this.sliderPanel);
				}

				// create slider panel
				var panelClass=panelwidth?&quot;floatingPanel&quot;:&quot;sliderPanel&quot;;
				if (panelID) panelID=panelID.slice(1,-1); // trim off delimiters
				var panel=createTiddlyElement(place,&quot;div&quot;,panelID,panelClass,null);
				panel.button = btn; // so the slider panel know which button it belongs to
				btn.sliderPanel=panel; // so the button knows which slider panel it belongs to
				panel.defaultPanelWidth=(panelwidth &amp;&amp; panelwidth.length&gt;2)?panelwidth.slice(1,-1):&quot;&quot;;
				panel.setAttribute(&quot;transient&quot;,transient==&quot;*&quot;?&quot;true&quot;:&quot;false&quot;);
				panel.style.display = show;
				panel.style.width=panel.defaultPanelWidth;
				panel.onmouseover=function(event) // mouseover on panel aligns floater position with button
					{ if (window.adjustSliderPos) window.adjustSliderPos(this.parentNode,this.button,this); }

				// render slider (or defer until shown) 
				w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
				if ((show==&quot;block&quot;)||!deferred) {
					// render now if panel is supposed to be shown or NOT deferred rendering
					w.subWikify(blockquote?createTiddlyElement(panel,&quot;blockquote&quot;):panel,this.terminator);
					// align floater position with button
					if (window.adjustSliderPos) window.adjustSliderPos(place,btn,panel);
				}
				else {
					var src = w.source.substr(w.nextMatch);
					var endpos=findMatchingDelimiter(src,&quot;+++&quot;,&quot;===&quot;);
					panel.setAttribute(&quot;raw&quot;,src.substr(0,endpos));
					panel.setAttribute(&quot;blockquote&quot;,blockquote?&quot;true&quot;:&quot;false&quot;);
					panel.setAttribute(&quot;rendered&quot;,&quot;false&quot;);
					w.nextMatch += endpos+3;
					if (w.source.substr(w.nextMatch,1)==&quot;\n&quot;) w.nextMatch++;
				}
			}
		}
	}
)

function findMatchingDelimiter(src,starttext,endtext) {
	var startpos = 0;
	var endpos = src.indexOf(endtext);
	// check for nested delimiters
	while (src.substring(startpos,endpos-1).indexOf(starttext)!=-1) {
		// count number of nested 'starts'
		var startcount=0;
		var temp = src.substring(startpos,endpos-1);
		var pos=temp.indexOf(starttext);
		while (pos!=-1)  { startcount++; pos=temp.indexOf(starttext,pos+starttext.length); }
		// set up to check for additional 'starts' after adjusting endpos
		startpos=endpos+endtext.length;
		// find endpos for corresponding number of matching 'ends'
		while (startcount &amp;&amp; endpos!=-1) {
			endpos = src.indexOf(endtext,endpos+endtext.length);
			startcount--;
		}
	}
	return (endpos==-1)?src.length:endpos;
}
//}}}
//{{{
window.onClickNestedSlider=function(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);
	while (theTarget &amp;&amp; theTarget.sliderPanel==undefined) theTarget=theTarget.parentNode;
	if (!theTarget) return false;
	var theSlider = theTarget.sliderPanel;
	var isOpen = theSlider.style.display!=&quot;none&quot;;

	// if SHIFT-CLICK, dock panel first (see [[MoveablePanelPlugin]])
	if (e.shiftKey &amp;&amp; config.macros.moveablePanel) config.macros.moveablePanel.dock(theSlider,e);

	// toggle label
	theTarget.innerHTML=isOpen?theTarget.getAttribute(&quot;closedText&quot;):theTarget.getAttribute(&quot;openedText&quot;);
	// toggle tooltip
	theTarget.setAttribute(&quot;title&quot;,isOpen?theTarget.getAttribute(&quot;closedTip&quot;):theTarget.getAttribute(&quot;openedTip&quot;));

	// deferred rendering (if needed)
	if (theSlider.getAttribute(&quot;rendered&quot;)==&quot;false&quot;) {
		var place=theSlider;
		if (theSlider.getAttribute(&quot;blockquote&quot;)==&quot;true&quot;)
			place=createTiddlyElement(place,&quot;blockquote&quot;);
		wikify(theSlider.getAttribute(&quot;raw&quot;),place);
		theSlider.setAttribute(&quot;rendered&quot;,&quot;true&quot;);
	}

	// show/hide the slider
	if(config.options.chkAnimate &amp;&amp; (!hasClass(theSlider,'floatingPanel') || config.options.chkFloatingSlidersAnimate))
		anim.startAnimating(new Slider(theSlider,!isOpen,e.shiftKey || e.altKey,&quot;none&quot;));
	else
		theSlider.style.display = isOpen ? &quot;none&quot; : &quot;block&quot;;

	// reset to default width (might have been changed via plugin code)
	theSlider.style.width=theSlider.defaultPanelWidth;

	// align floater panel position with target button
	if (!isOpen &amp;&amp; window.adjustSliderPos) window.adjustSliderPos(theSlider.parentNode,theTarget,theSlider);

	// if showing panel, set focus to first 'focus-able' element in panel
	if (theSlider.style.display!=&quot;none&quot;) {
		var ctrls=theSlider.getElementsByTagName(&quot;*&quot;);
		for (var c=0; c&lt;ctrls.length; c++) {
			var t=ctrls[c].tagName.toLowerCase();
			if ((t==&quot;input&quot; &amp;&amp; ctrls[c].type!=&quot;hidden&quot;) || t==&quot;textarea&quot; || t==&quot;select&quot;)
				{ try{ ctrls[c].focus(); } catch(err){;} break; }
		}
	}
	var cookie=theTarget.sliderCookie;
	if (cookie &amp;&amp; cookie.length) {
		config.options[cookie]=!isOpen;
		if (config.options[cookie]!=theTarget.defOpen) window.saveOptionCookie(cookie);
		else window.removeCookie(cookie); // remove cookie if slider is in default display state
	}

	// prevent SHIFT-CLICK from being processed by browser (opens blank window... yuck!)
	// prevent clicks *within* a slider button from being processed by browser
	// but allow plain click to bubble up to page background (to close transients, if any)
	if (e.shiftKey || theTarget!=resolveTarget(e))
		{ e.cancelBubble=true; if (e.stopPropagation) e.stopPropagation(); }
	Popup.remove(); // close open popup (if any)
	return false;
}
//}}}
//{{{
// click in document background closes transient panels 
document.nestedSliders_savedOnClick=document.onclick;
document.onclick=function(ev) { if (!ev) var ev=window.event; var target=resolveTarget(ev);

	if (document.nestedSliders_savedOnClick)
		var retval=document.nestedSliders_savedOnClick.apply(this,arguments);
	// if click was inside a popup... leave transient panels alone
	var p=target; while (p) if (hasClass(p,&quot;popup&quot;)) break; else p=p.parentNode;
	if (p) return retval;
	// if click was inside transient panel (or something contained by a transient panel), leave it alone
	var p=target; while (p) {
		if ((hasClass(p,&quot;floatingPanel&quot;)||hasClass(p,&quot;sliderPanel&quot;))&amp;&amp;p.getAttribute(&quot;transient&quot;)==&quot;true&quot;) break;
		p=p.parentNode;
	}
	if (p) return retval;
	// otherwise, find and close all transient panels...
	var all=document.all?document.all:document.getElementsByTagName(&quot;DIV&quot;);
	for (var i=0; i&lt;all.length; i++) {
		 // if it is not a transient panel, or the click was on the button that opened this panel, don't close it.
		if (all[i].getAttribute(&quot;transient&quot;)!=&quot;true&quot; || all[i].button==target) continue;
		// otherwise, if the panel is currently visible, close it by clicking it's button
		if (all[i].style.display!=&quot;none&quot;) window.onClickNestedSlider({target:all[i].button})
		if (!hasClass(all[i],&quot;floatingPanel&quot;)&amp;&amp;!hasClass(all[i],&quot;sliderPanel&quot;)) all[i].style.display=&quot;none&quot;;
	}
	return retval;
};
//}}}
//{{{
// adjust floating panel position based on button position
if (window.adjustSliderPos==undefined) window.adjustSliderPos=function(place,btn,panel) {
	if (hasClass(panel,&quot;floatingPanel&quot;) &amp;&amp; !hasClass(panel,&quot;undocked&quot;)) {
		// see [[MoveablePanelPlugin]] for use of 'undocked'
		var rightEdge=document.body.offsetWidth-1;
		var panelWidth=panel.offsetWidth;
		var left=0;
		var top=btn.offsetHeight; 
		if (place.style.position==&quot;relative&quot; &amp;&amp; findPosX(btn)+panelWidth&gt;rightEdge) {
			left-=findPosX(btn)+panelWidth-rightEdge; // shift panel relative to button
			if (findPosX(btn)+left&lt;0) left=-findPosX(btn); // stay within left edge
		}
		if (place.style.position!=&quot;relative&quot;) {
			var left=findPosX(btn);
			var top=findPosY(btn)+btn.offsetHeight;
			var p=place; while (p &amp;&amp; !hasClass(p,'floatingPanel')) p=p.parentNode;
			if (p) { left-=findPosX(p); top-=findPosY(p); }
			if (left+panelWidth&gt;rightEdge) left=rightEdge-panelWidth;
			if (left&lt;0) left=0;
		}
		panel.style.left=left+&quot;px&quot;; panel.style.top=top+&quot;px&quot;;
	}
}
//}}}
//{{{
// TW2.1 and earlier:
// hijack Slider stop handler so overflow is visible after animation has completed
Slider.prototype.coreStop = Slider.prototype.stop;
Slider.prototype.stop = function()
	{ this.coreStop.apply(this,arguments); this.element.style.overflow = &quot;visible&quot;; }

// TW2.2+
// hijack Morpher stop handler so sliderPanel/floatingPanel overflow is visible after animation has completed
if (version.major+.1*version.minor+.01*version.revision&gt;=2.2) {
	Morpher.prototype.coreStop = Morpher.prototype.stop;
	Morpher.prototype.stop = function() {
		this.coreStop.apply(this,arguments);
		var e=this.element;
		if (hasClass(e,&quot;sliderPanel&quot;)||hasClass(e,&quot;floatingPanel&quot;)) {
			// adjust panel overflow and position after animation
			e.style.overflow = &quot;visible&quot;;
			if (window.adjustSliderPos) window.adjustSliderPos(e.parentNode,e.button,e);
		}
	};
}
//}}}</pre>
</div>
<div title="NewHTMLFromTemplate" modifier="Shankar Swamy" created="200906021056" modified="200909150412" tags="makeTiddlers mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;newTiddler label:&quot;newHTML&quot; title:'New HTML' text:{{store.getTiddlerText('TiddlerMakeFile##html')}} tag:html&gt;&gt;</pre>
</div>
<div title="NewHerePlugin(Giffmex version)" modifier="Shankar Swamy" created="200909150251" modified="200909150251" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|NewHerePlugin|
|Description:|Creates the new here and new journal macros|
|Version:|3.0 ($Rev: 3861 $)|
|Date:|$Date: 2008-03-08 10:53:09 +1000 (Sat, 08 Mar 2008) $|
|Source:|http://mptw.tiddlyspot.com/#NewHerePlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;, modified by giffmex|
|License|http://mptw.tiddlyspot.com/#TheBSDLicense|
***/
//{{{
merge(config.macros, {
	newHere: {
		handler: function(place,macroName,params,wikifier,paramString,tiddler) {
			wikify(&quot;&lt;&lt;newTiddler &quot;+paramString+&quot; tag:[[&quot;+tiddler.title+&quot;]] tag:Note&gt;&gt;&quot;,place,null,tiddler);
		}
	},
	newJournalHere: {
		handler: function(place,macroName,params,wikifier,paramString,tiddler) {
			wikify(&quot;&lt;&lt;newJournal &quot;+paramString+&quot; tag:[[&quot;+tiddler.title+&quot;]]&gt;&gt;&quot;,place,null,tiddler);
		}
	}
});

//}}}</pre>
</div>
<div title="NoteNote" modifier="YourName" created="200809201248" modified="200809241322" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;!--{{{--&gt;
&lt;a style=&quot;color: #5566ff&quot;&gt;Looks like you are creating or editing a new note from the bottom up!&lt;br&gt;
Add the name for your note in the top window, and the text of your note text below. &lt;br&gt;
Add the topic that this note belongs to in the second window above. &lt;br&gt;
Use [[double brackets]] to enclose multiple-word topics. &lt;br&gt;
Use this drop-down menu:&lt;b&gt;&lt;span macro='tagChooser'&gt;&lt;/span&gt;&lt;/b&gt; to access your current topics and other tags&lt;/a&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="OpenHereMacro" modifier="Shankar" created="200612280437" modified="200908261750" tags="[[plugin macro]] systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|''OpenHereMacro'' |h
|Author |[[Robert Pollard]] |
|Version |1.0 |
|Date|2009.08.26 - Wednesday, 26 August 2009 |
|Description |Creates an internal link that opens the tiddler immediately below the link, building on Eric Shulman's NestedSlidersPlugin  |
|Source |http://www.climatechange3.net/#OpenHereMacro |
|Requires |[[NestedSlidersPlugin]] - http://www.TiddlyTools.com/#NestedSlidersPlugin |
***/
/***
!!!Example
{{{&lt;&lt;oh &quot;Climate Change 3.0&quot;&gt;&gt;}}}
&lt;&lt;oh &quot;Climate Change 3.0&quot;&gt;&gt;
!!!Installation
Import (or copy/paste) this tiddler into your document: and tag it with &quot;systemConfig&quot;
!!!Note
This macro generates the following syntax:
&lt;&lt;&lt;
{{{
+++[TiddlerName]
&lt;&lt;tiddler &quot;TiddlerName&quot;&gt;&gt;

===
}}}
&lt;&lt;&lt;
!!!Code
***/
//{{{
config.macros.oh = {};
config.macros.oh.handler= function(place,macroName,params) {
   var key=params[0];
   wikify('+++['+key+']\n\n&lt;'+'&lt;tiddler &quot;'+key+'&quot;&gt;'+'&gt;\n\n===\n',place)
}
//}}}
</pre>
</div>
<div title="PIN.Test Kanban Board!.JSON" modifier="YourName" created="201702190430" tags="aaTag savedPIN mySystem excludeLists excludeMissing excludeSearch" changecount="1">
<pre>[{&quot;ID&quot;:&quot;1487478533462&quot;,&quot;width&quot;:200,&quot;height&quot;:200,&quot;fontSize&quot;:&quot;18pt&quot;,&quot;originX&quot;:39,&quot;originY&quot;:143,&quot;zIndex&quot;:1,&quot;color&quot;:&quot;#E5E4E2&quot;,&quot;myDivID&quot;:&quot;DivID1487478533462&quot;,&quot;DIV&quot;:{&quot;jQuery18303231790110511913&quot;:99},&quot;myTextboxID&quot;:&quot;TB1487478533462&quot;,&quot;CPTA&quot;:{&quot;ID&quot;:&quot;1487478533462&quot;,&quot;jQuery18303231790110511913&quot;:85},&quot;bodyText&quot;:&quot;What can we do with this?\nNot a heck of a lot, but some very useful stuff he&quot;,&quot;background&quot;:&quot;#CCCCFF&quot;},{&quot;ID&quot;:&quot;1487478578249&quot;,&quot;width&quot;:200,&quot;height&quot;:200,&quot;fontSize&quot;:8,&quot;originX&quot;:244,&quot;originY&quot;:143,&quot;zIndex&quot;:2,&quot;color&quot;:&quot;#B4F9FF&quot;,&quot;myDivID&quot;:&quot;DivID1487478578249&quot;,&quot;DIV&quot;:{&quot;jQuery18303231790110511913&quot;:134},&quot;myTextboxID&quot;:&quot;TB1487478578249&quot;,&quot;CPTA&quot;:{&quot;ID&quot;:&quot;1487478578249&quot;,&quot;jQuery18303231790110511913&quot;:118}},{&quot;ID&quot;:&quot;1487478581069&quot;,&quot;width&quot;:200,&quot;height&quot;:200,&quot;fontSize&quot;:8,&quot;originX&quot;:449,&quot;originY&quot;:143,&quot;zIndex&quot;:3,&quot;color&quot;:&quot;#E82C0C&quot;,&quot;myDivID&quot;:&quot;DivID1487478581069&quot;,&quot;DIV&quot;:{&quot;jQuery18303231790110511913&quot;:160},&quot;myTextboxID&quot;:&quot;TB1487478581069&quot;,&quot;CPTA&quot;:{&quot;ID&quot;:&quot;1487478581069&quot;,&quot;jQuery18303231790110511913&quot;:146}},{&quot;ID&quot;:&quot;1487478582953&quot;,&quot;width&quot;:200,&quot;height&quot;:200,&quot;fontSize&quot;:8,&quot;originX&quot;:654,&quot;originY&quot;:143,&quot;zIndex&quot;:4,&quot;color&quot;:&quot;#F2CB00&quot;,&quot;myDivID&quot;:&quot;DivID1487478582953&quot;,&quot;DIV&quot;:{&quot;jQuery18303231790110511913&quot;:186},&quot;myTextboxID&quot;:&quot;TB1487478582953&quot;,&quot;CPTA&quot;:{&quot;ID&quot;:&quot;1487478582953&quot;,&quot;jQuery18303231790110511913&quot;:172}}]</pre>
</div>
<div title="PageTemplate" modifier="shankar " created="200909150213" modified="200910181430" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;!--{{{--&gt;
&lt;div class='header' color: [[ColorPalette::PrimaryLight]]&gt;
&lt;div class='headerShadow'&gt;
&lt;span class='siteTitle' refresh='content' tiddler='SiteTitle'&gt;&lt;/span&gt;&amp;nbsp;
&lt;span class='siteSubtitle' refresh='content' tiddler='SiteSubtitle'&gt;&lt;/span&gt;
&lt;/div&gt;
&lt;/div&gt;
&lt;div id='tiddlersBar' refresh='none' ondblclick='config.macros.tiddlersBar.onTiddlersBarAction(event)'&gt;&lt;/div&gt;
&lt;div id='mainMenu' refresh='content' force='true' tiddler='MainMenu'&gt;&lt;/div&gt;
&lt;div id='sidebar'&gt;
&lt;div id='sidebarOptions' refresh='content' force='true' tiddler='SideBarOptions'&gt;&lt;/div&gt;
&lt;div id='sidebarTabs' refresh='content' force='true' tiddler='SideBarTabs'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;div id='displayArea'&gt;
&lt;div id='messageArea'&gt;&lt;/div&gt;
&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;
&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="Palette-BrightGray" modifier="YourName" created="200911110040" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #FFFFFF 
PrimaryB:   #EFEFEF 
PrimaryC:   #DFDFDF 
PrimaryD:   #CFCFCF 
SecondaryA: #BFBFBF 
SecondaryB: #9F9F9F 
SecondaryC: #070707
SecondaryD: #171717
TertiaryA:  #272727
TertiaryB:  #2F2F2F
TertiaryC:  #373737
TertiaryD:  #3F3F3F

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-CppBook" modifier="shankar " created="200911081654" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #EFFFFF 
PrimaryB:   #FFFCEF 
PrimaryC:   #FFEFF8 
PrimaryD:   #D4F2F2 
SecondaryA: #FFFADF
SecondaryB: #F9DAEB
SecondaryC: #024D4D
SecondaryD: #524402
TertiaryA:  #50022E
TertiaryB:  #757C7C
TertiaryC:  #83827B
TertiaryD:  #80787C


TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-CppStyle" modifier="YourName" created="201702190557" modified="201702190601" tags="aaTag colorPalette palette excludeLists excludeSearch excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:     transparent
PrimaryB:     transparent
PrimaryC:     #DEDBCC
PrimaryD:     #DAD4C8
SecondaryA:   #3E3E3E
SecondaryB:   #390121
SecondaryC:   #442B02
SecondaryD:   #013801
TertiaryA:    #464020
TertiaryB:    #AAAA00
TertiaryC:    #01142D
TertiaryD:    #48404D

TidIDEDefaultColor: [[ColorPalette::SecondaryB]]
TidIDEDefaultBackground: [[ColorPalette::PrimaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

H1: 	#3C8484
H2: 	#0E89DC
H3: 	#010DE4
H4:	#44037E
H5:	#2C8804
H6: 	#88041C

Error: #f88

BGImage: url(../BGImages/C_C++-BG.jpg)
EditImage: url(../BGImages/C_C++-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DXType" modifier="shankar " created="200911081713" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #E8EEFF
PrimaryB:   #FFFFE5
PrimaryC:   #FFE6E5
PrimaryD:   #8C95AB
SecondaryA: #FDFECA
SecondaryB: #FFCCCB
SecondaryC: #011137
SecondaryD: #505102
TertiaryA:  #510402
TertiaryB:  #505258
TertiaryC:  #828375
TertiaryD:  #837675

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DarkBlueDarkTheme" modifier="shankar " created="200911081737" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #02001D
PrimaryB:   #202800
PrimaryC:   #290E00
PrimaryD:   #423128
SecondaryA: #3B4027
SecondaryB: #201F2E
SecondaryC: #EFEEFF
SecondaryD: #FBFFEC
TertiaryA:  #FFF2EC
TertiaryB:  #FFBD9E
TertiaryC:  #EBFF9E
TertiaryD:  #B0ABFF

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DarkBrown" modifier="shankar " created="200911090601" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #493840
PrimaryB:   #262123
PrimaryC:   #2A3436
PrimaryD:   #191B1C
SecondaryA: #575543
SecondaryB: #2D2C28
SecondaryC: #FFF9FC
SecondaryD: #F9FEFF
TertiaryA:  #FFFEF9
TertiaryB:  #FFFBE1
TertiaryC:  #E2FAFF
TertiaryD:  #FFE1EF

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DarkGray" modifier="YourName" created="200911110023" modified="200911110032" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #070707 
PrimaryB:   #171717 
PrimaryC:   #272727 
PrimaryD:   #2F2F2F 
SecondaryA: #373737 
SecondaryB: #3F3F3F 
SecondaryC: #FFFFFF 
SecondaryD: #EFEFEF 
TertiaryA:  #DFDFDF 
TertiaryB:  #CFCFCF 
TertiaryC:  #BFBFBF 
TertiaryD:  #9F9F9F 

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DarkKhahi" modifier="shankar " created="200911090615" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #211D01
PrimaryB:   #676346
PrimaryC:   #1C010C
PrimaryD:   #583C48
SecondaryA: #000F15
SecondaryB: #2D3B41
SecondaryC: #FFFEF7
SecondaryD: #FFF7FA
TertiaryA:  #F7FDFF
TertiaryB:  #D8F3FF
TertiaryC:  #FFD6E7
TertiaryD:  #FFFAD6

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-DusseraBlue" modifier="shankar " created="200911081936" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #D2ECFF
PrimaryB:   #FFF6CF
PrimaryC:   #FFD0CF
PrimaryD:   #FFA09E
SecondaryA: #FFED9E
SecondaryB: #A4D9FF
SecondaryC: #013052
SecondaryD: #524301
TertiaryA:  #520301
TertiaryB:  #836A69
TertiaryC:  #837E69
TertiaryD:  #6B7983

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-FinancialTimes" modifier="shankar " created="200911081628" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #FEF1E0 
PrimaryB:   #F7F1FF
PrimaryC:   #D5E3C8
PrimaryD:   #FFFEFC
SecondaryA: #EFE4B3
SecondaryB: #71756E
SecondaryC: #282828
SecondaryD: #6D3655	
TertiaryA:  #006
TertiaryB:  #C7A9BA
TertiaryC:  #E0CF7E
TertiaryD:  #031D1D

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-GaudyGreen" modifier="shankar " created="200911110301" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #084925
PrimaryB:   #06371D
PrimaryC:   #235539
PrimaryD:   #19713F
SecondaryA: #4DB87B
SecondaryB: #69B88B
SecondaryC: #CCF
SecondaryD: #3CF
TertiaryA:  #CF9756
TertiaryB:  #672B42
TertiaryC:  #C47091
TertiaryD:  #891E48

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-Green-0" modifier="shankar " created="200911030115" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{
PrimaryA: #ccdd88
PrimaryB: #113311
PrimaryC: #113311
PrimaryD: #111A11
SecondaryA: #667722
SecondaryB: #667722
SecondaryC: #db4
SecondaryD: #841
TertiaryA: #eeffaa
TertiaryB: #ccc
TertiaryC: #999
TertiaryD: #666

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-Hypertuned" modifier="shankar " created="200911030046" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{
Background: #1B1845
PrimaryMid: #C3C3C3
Error: #f88

GlobalAColor: #CF6
TiddlerBG: #201D54;
TiddlerTitleColor: #008000;
ViewerColor: #FFFFFF;
ViewerBG: #1B1845;

PreFrameColor: #1A163F;
PreColor: #FFFF00;
PreBG: #1A163F;
CodeColor: #FFAD95;
HeaderBG: #2B2671;
HeaderColor: #008000;
LinksColor: #E6E6E6;

H1Color: #FF870F; 
H2Color: #005900; 
H3Color: #702070;
H4Color: #B2B2B2;
H5Color: #707010;
H6Color: #630;

SidebarTabsColor: #FFFFFF;
SidebarTabsBG: #262367;
TabSelectedBG: #8888FF;
TabUnselectedBG: #006;
TabContentsBG: #1F1C51;
TabContentsColor: Pink;

TaggedBG: #312B7B;
TaggedColor: #A6A6A6;

TableBorderColor: #FF7400;
TableLinesColor: #D5FF80;
TableBackgroundColor: #181E00;
TableColor: #FBFFEC;

TidIDEDefaultColor: #FFFF00;
TidIDEDefaultBackground: #7F00FF;
TidIDETextareaColor: #FFFFFF;
TidIDETextareaBG: #52595F;
TidIDEButtonsColor:  #FFFFFF;
TidIDEButtonsBG: #8888FF;
TidIDETagsSelectColor: #FFFFFF;
TidIDETagsSelectBG: #8888ff;



}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-Hypertuned-0" modifier="shankar " created="200910260538" modified="200910260542" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{
Background: #221F5A
PrimaryMid: #C3C3C3
Error: #f88

TiddlerBG: #201D54;
TiddlerTitleColor: #008000;
ViewerColor: #FFFFFF;
ViewerBG: #1B1845;

PreFrameColor: #262367;
PreColor: #FFFF00;
PreBG: #1A163F;
CodeColor: #FFAD95;
HeaderBG: #2B2671;
HeaderColor: #008000;
LinksColor: #E6E6E6;

H1Color: #B2B2B2;
H2Color: #630;
H3Color: #FF870F;
H4Color: #005900;
H5Color: #707010;
H6Color: #702070;

SidebarTabsColor: #FFFFFF;
SidebarTabsBG: #262367;
TabSelectedBG: #8888FF;
TabUnselectedBG: #006;
TabContentsBG: #1F1C51;
TabContentsColor: Pink;

TaggedBG: #312B7B;
TaggedColor: #A6A6A6;

TidIDEDefaultColor: #FFFF00;
TidIDEDefaultBackground: #7F00FF;
TidIDETextareaColor: #FFFFFF;
TidIDETextareaBG: #52595F;
TidIDEButtonsColor:  #FFFFFF;
TidIDEButtonsBG: #8888FF;
TidIDETagsSelectColor: #FFFFFF;
TidIDETagsSelectBG: #8888ff;



}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-HypertunedReborn" modifier="YourName" created="200911132245" modified="200911132245" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{
PrimaryA:   #221F5A 
PrimaryB:   #2C2774 
PrimaryC:   #02001D
PrimaryD:   #B0ABFF
SecondaryA: #201F2E 
SecondaryB: #3B4027 
SecondaryC: #FBFFEC 
SecondaryD: #FFF2EC 
TertiaryA:  #813E1F
TertiaryB:  #697C1D 
TertiaryC:  #813E1F
TertiaryD:  #F69

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88


}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-LightReddishBrown" modifier="shankar " created="200911082154" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #FFF6F1
PrimaryB:   #F4F3FF
PrimaryC:   #FCFFF1
PrimaryD:   #EFFFB9
SecondaryA: #C9C2FF
SecondaryB: #FFD2B9
SecondaryC: #050128
SecondaryD: #2A3601
TertiaryA:  #51573F
TertiaryB:  #323040
TertiaryC:  #5C4B42
TertiaryD:  #47417C

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-LightSkyBlue" modifier="shankar " created="200911082135" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #CCE0FF
PrimaryB:   #FFFDC7
PrimaryC:   #FFF4F5
PrimaryD:   #F98B98
SecondaryA: #FFFB8E
SecondaryB: #7998CA
SecondaryC: #011A41
SecondaryD: #524F01
TertiaryA:  #50010A
TertiaryB:  #806366
TertiaryC:  #838265
TertiaryD:  #525B68

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-LivelyGreen" modifier="shankar " created="200911101504" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #3C4003
PrimaryB:   #383A14
PrimaryC:   #1D1F00
PrimaryD:   #00010E
SecondaryA: #0D0E17
SecondaryB: #00010E
SecondaryC: #FDFFE7
SecondaryD: #FFE7E8
TertiaryA:  #EAECFF
TertiaryB:  #F7FF85
TertiaryC:  #969EFF
TertiaryD:  #FF858C

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-ModernBlack" modifier="shankar " created="200911071350" modified="200911071703" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA: #262629
PrimaryB: #3B3736
PrimaryC: #44454F
PrimaryD: #393935
SecondaryA: #726460
SecondaryB: #010319
SecondaryC: #9CA5FF
SecondaryD: #A85B3C	
TertiaryA: #B8C36D
TertiaryB: #E1FB2E
TertiaryC: #DBDBDB
TertiaryD: #FFFDFD

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-ModernGray" modifier="shankar " created="200911081547" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #E0E6E6 
PrimaryB:   #D5DBDB
PrimaryC:   #BACACA
PrimaryD:   #98A6A6
SecondaryA: #EFE4B3
SecondaryB: #767375
SecondaryC: #282828
SecondaryD: #6D3655	
TertiaryA:  #006
TertiaryB:  #C7A9BA
TertiaryC:  #E0CF7E
TertiaryD:  #031D1D

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-ModernLightGreen" modifier="YourName" created="200911102353" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #DEDBBC
PrimaryB:   #DED9B0
PrimaryC:   #A9A9C1
PrimaryD:   #A0A0C1
SecondaryA: #656584
SecondaryB: #8C775C
SecondaryC: #7A592C
SecondaryD: #7A732C
TertiaryA:  #525263
TertiaryB:  #8D8170
TertiaryC:  #BCA689
TertiaryD:  #BCB889

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-ModernRose" modifier="shankar " created="200911100601" modified="200911101153" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #FFEFF7
PrimaryB:   #F3D4E3
PrimaryC:   #FFE6F2
PrimaryD:   #C8E0E4
SecondaryA: #FFFDEF
SecondaryB: #FFFADE
SecondaryC: #7D7579
SecondaryD: #6E7475
TertiaryA:  #83827B
TertiaryB:  #524602
TertiaryC:  #023E49
TertiaryD:  #4E0227

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-ModernSlate" modifier="shankar " created="200911080102" modified="200911080111" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #1A202E
PrimaryB:   #171B26
PrimaryC:   #132650
PrimaryD:   #444523
SecondaryA: #23231A
SecondaryB: #161600
SecondaryC: #804142
SecondaryD: #FFC1C3	
TertiaryA:  #0043DF
TertiaryB:  #FFFFF3
TertiaryC:  #FEFFC1
TertiaryD:  #F60

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-MonetBlue" modifier="YourName" created="200911101942" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #1D2096
PrimaryB:   #2326B6
PrimaryC:   #5D5FAD
PrimaryD:   #595DE7
SecondaryA: #8386F3
SecondaryB: #A1A3F3
SecondaryC: #FFFFFF
SecondaryD: #A69817
TertiaryA:  #A66817
TertiaryB:  #FFC375
TertiaryC:  #FFED47
TertiaryD:  #FFD39A

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-MostlyGray" modifier="shankar " created="200911091505" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #222222
PrimaryB:   #474747
PrimaryC:   #898989
PrimaryD:   #8B8B8B
SecondaryA: #8F8F8F
SecondaryB: #CDCDCD
SecondaryC: #87ABFF
SecondaryD: #FFFF09
TertiaryA:  #FF8080
TertiaryB:  #838340
TertiaryC:  #FFFFFF
TertiaryD:  #804040

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-NewReddishBrown" modifier="shankar " created="200911082144" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #391501
PrimaryB:   #050128
PrimaryC:   #2A3601
PrimaryD:   #51573F
SecondaryA: #323040
SecondaryB: #5C4B42
SecondaryC: #FFF6F1
SecondaryD: #F4F3FF
TertiaryA:  #FCFFF1
TertiaryB:  #EFFFB9
TertiaryC:  #C9C2FF
TertiaryD:  #FFD2B9

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-NoColors" modifier="shankar " created="200911030056" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryD: #FFFFFF;
Error: #f88

H1Color: #FF870F;  
H2Color: #005900; 
H3Color: #702070;
H4Color: #B2B2B2;
H5Color: #707010;
H6Color: #630;

TidIDEDefaultColor: #FFFF00;
TidIDEDefaultBackground: #7F00FF;
TidIDETextareaColor: #FFFFFF;
TidIDETextareaBG: #52595F;
TidIDEButtonsColor:  #FFFFFF;
TidIDEButtonsBG: #8888FF;
TidIDETagsSelectColor: #FFFFFF;
TidIDETagsSelectBG: #8888ff;



}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-PrincessFrog-1" modifier="shankar " created="200911112319" modified="200911130504" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #547D32
PrimaryB:   #85907B
PrimaryC:   #3F5E26
PrimaryD:   #A2918A
SecondaryA: #5B255B
SecondaryB: #695A69
SecondaryC: #D3E0C8
SecondaryD: #CEE0BF
TertiaryA:  #EBD9D2
TertiaryB:  #EBD3C9
TertiaryC:  #C6B1C6
TertiaryD:  #C6A9C6

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-Release" modifier="shankar " created="200911022117" modified="200911022117" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA: #304363;
PrimaryB: #903E46;
PrimaryC: #302F01
PrimaryD: #374E73;

SecondaryA: #FFFFFF;
SecondaryB: #BDD6FF;
SecondaryC: #FFFDB6;
SecondaryD: #B2B2B2;

TertiaryA: #707010;
TertiaryB: #FF870F;
TertiaryC: #FFB6BD;
TertiaryD: #FFFB46; 

Error: #f88

H4Color: [[ColorPalette::SecondaryC]]
H5Color: [[ColorPalette::SecondaryD]]
H6Color: [[ColorPalette::TertiaryA]]
H1Color: [[ColorPalette::TertiaryB]]
H2Color: [[ColorPalette::TertiaryC]]
H3Color: [[ColorPalette::TertiaryD]]

TableBackgroundColor: #000C20;


TidIDEDefaultColor: #FFFF00;
TidIDEDefaultBackground: #7F00FF;
TidIDETextareaColor: #FFFDB6;
TidIDETextareaBG: #425F8A;
TidIDEButtonsColor:  #959340;
TidIDEButtonsBG: #252A33;
TidIDETagsSelectColor: #292801;
TidIDETagsSelectBG: #BDD6FF;

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-RoyalBlue" modifier="shankar " created="200911082254" modified="200911082305" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #001F79
PrimaryB:   #334069
PrimaryC:   #001041
PrimaryD:   #80833F
SecondaryA: #4E5100
SecondaryB: #834540
SecondaryC: #FFE7E6
SecondaryD: #E6ECFF
TertiaryA:  #FF8980
TertiaryB:  #ABB200
TertiaryC:  #FAFF80
TertiaryD:  #809FFF

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-SlateColor" modifier="shankar " created="200911030054" modified="200911030054" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA: #304363;
PrimaryB: #903E46;
PrimaryC: #302F01
PrimaryD: #374E73;

SecondaryA: #FFFFFF;
SecondaryB: #BDD6FF;
SecondaryC: #FFFDB6;
SecondaryD: #B2B2B2;

TertiaryA: #707010;
TertiaryB: #FF870F;
TertiaryC: #FFB6BD;
TertiaryD: #FFFB46; 

Error: #f88

H4Color: [[ColorPalette::SecondaryC]]
H5Color: [[ColorPalette::SecondaryD]]
H6Color: [[ColorPalette::TertiaryA]]
H1Color: [[ColorPalette::TertiaryB]]
H2Color: [[ColorPalette::TertiaryC]]
H3Color: [[ColorPalette::TertiaryD]]

TidIDEDefaultColor: #FFFF00;
TidIDEDefaultBackground: #7F00FF;
TidIDETextareaColor: #FFFDB6;
TidIDETextareaBG: #425F8A;
TidIDEButtonsColor:  #959340;
TidIDEButtonsBG: #252A33;
TidIDETagsSelectColor: #292801;
TidIDETagsSelectBG: #BDD6FF;

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-StarterDefault" modifier="YourName" created="201702190558" modified="201702190600" tags="aaTag colorPalette palette excludeSearch excludeMissing System excludeLists" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:     transparent
PrimaryB:     transparent
PrimaryC:     #DEDBCC
PrimaryD:     #DAD4C8
SecondaryA:   #3E3E3E
SecondaryB:   #390121
SecondaryC:   #442B02
SecondaryD:   #013801
TertiaryA:    #464020
TertiaryB:    #AAAA00
TertiaryC:    #01142D
TertiaryD:    #48404D

TidIDEDefaultColor: [[ColorPalette::SecondaryB]]
TidIDEDefaultBackground: [[ColorPalette::PrimaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

H1: 	#3C8484
H2: 	#0E89DC
H3: 	#010DE4
H4:	#44037E
H5:	#2C8804
H6: 	#88041C

Error: #f88

BGImage: url(../BGImages/C_C++-BG.jpg)
EditImage: url(../BGImages/C_C++-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-VibrantModern" modifier="shankar " created="200911101518" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   #E6F9FF
PrimaryB:   #FFFAE6
PrimaryC:   #FFE6EE
PrimaryD:   #FF80AA
SecondaryA: #FFE880
SecondaryB: #81E3FF
SecondaryC: #473A00
SecondaryD: #014052
TertiaryA:  #1A3C45
TertiaryB:  #0C2D37
TertiaryC:  #25000D
TertiaryD:  #3C1D27

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88

}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-WorkLog" modifier="Shankar Swamy" created="200911081640" modified="201201071739" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{

PrimaryA:   transparent 
PrimaryB:   #3E3E3E
PrimaryC:   transparent
PrimaryD:   #1F1C21
SecondaryA: #838383
SecondaryB: #DBFFD7
SecondaryC: #FFFFFF
SecondaryD: #636363
TertiaryA:  #DBE7FF
TertiaryB:  #FFFFFF
TertiaryC:  #F0D9FF
TertiaryD:  #555

TidIDEDefaultColor: [[ColorPalette::TertiaryD]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::SecondaryB]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::SecondaryB]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::SecondaryB]]

H1: 	#BA7E2E
H2: 	#A4AB14
H3: 	#974B00
H4:	#CA9C00
H5:	#3E7164
H6: 	#3A6181

Error: #f88

BGImage: url(../BGImages/WorkBG.jpg)
EditImage: url(../BGImages/Work-EditBG.jpg)
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="Palette-YetAnotherBlack" modifier="Shankar" created="200911160647" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{floatleft small borderright{
PrimaryA:   #333439
PrimaryB:   #393A40
PrimaryC:   #3E3E39
PrimaryD:   #3E3C39
SecondaryA: #535249
SecondaryB: #534E49
SecondaryC: #FFFFFF
SecondaryD: #B9BCBE
TertiaryA:  #93949C
TertiaryB:  #A9A49E
TertiaryC:  #A9A89E
TertiaryD:  #A9A29A

TidIDEDefaultColor: [[ColorPalette::PrimaryB]]
TidIDEDefaultBackground: [[ColorPalette::TertiaryD]]
TidIDETextareaColor: [[ColorPalette::TertiaryA]]
TidIDETextareaBG: [[ColorPalette::PrimaryB]]
TidIDEButtonsColor: [[ColorPalette::TertiaryD]]
TidIDEButtonsBG: [[ColorPalette::PrimaryD]]
TidIDETagsSelectColor: [[ColorPalette::TertiaryD]]
TidIDETagsSelectBG: [[ColorPalette::PrimaryB]]
TidIDESelectedBG: [[ColorPalette::PrimaryC]]
TidIDESelectedColor: [[ColorPalette::TertiaryD]]

Error: #f88
}}}PaletteMaker:&lt;hr&gt;&lt;&lt;tiddler PaletteMaker&gt;&gt;{{clear block{}}}</pre>
</div>
<div title="PaletteMaker" modifier="shankar " created="200910050535" modified="200910301135" tags="aaTag palette excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|PaletteMaker|
|Source|http://www.TiddlyTools.com/#PaletteMaker|
|Version|1.2.2|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|Type|transclusion|
|Description|edit/create ColorPalette using interactive grid/list|
Usage
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler PaletteMaker with: PaletteName GridName noList noGrid allowOther&gt;&gt;
}}}
*''~PaletteName'' (default=ColorPalette)&lt;br&gt;specifies a tiddler containing {{{name:value}}} slices that assign names to color values
*''~GridName'' (default=[[216-color 'web safe' grid|http://en.wikipedia.org/wiki/Web_colors#Web-safe_colors]])&lt;br&gt;specifies a tiddler (or section) that defines a table, where each table cell contains one of:
**a 3-digit #RGB or 6-digit #RRGGBB color value
**an [[X11 Color Name|http://en.wikipedia.org/wiki/X11_color_names]]
**another valid CSS attribute value (see ''allowOther'', below)
*''noList'' //or// ''noGrid''&lt;br&gt;omits the palette listbox or color grid to provide a more compact layout
*''allowOther''&lt;br&gt;permit non-color CSS attribute values to be entered/selected, e.g., {{{url('images/somefile.jpg')}}}
&lt;&lt;&lt;
Notes:
&lt;&lt;&lt;
*{{block{
You can use &quot;-&quot; as placeholders for the default values of ''~PaletteName'' and/or ''~GridName'':
{{{
&lt;&lt;tiddler PaletteMaker with: - - nogrid&gt;&gt;
}}}
}}}
*{{block{
The grid/list are rendered with 'float:left' styles so content that follows will be rendered next to them.  To show your content below the grid/list display, embed an //empty// 'tagClear' CSS wrapper after the PaletteMaker:
{{{
&lt;&lt;tiddler PaletteMaker ...&gt;&gt;{{tagClear{
}}} 
}}}
You can also customize the default styles contained in [[PaletteMakerStyles]]:
&lt;&lt;tiddler PaletteMaker##showcode with: styles&gt;&gt;
}}}
*The default color grid definition is:&lt;br&gt;&lt;&lt;tiddler PaletteMaker##showcode with: colorgrid&gt;&gt;
&lt;&lt;&lt;
Examples
&lt;&lt;&lt;
Edit ColorPalette (allow non-color values to be entered):
{{{&lt;&lt;tiddler PaletteMaker with: - - allowOther&gt;&gt;}}}
&lt;&lt;tiddler PaletteMaker##show with: - - allowOther&gt;&gt;{{tagClear{
}}}
Create/edit NewPalette using a 16-color 'rainbow' and/or shades of gray (no list):
{{{&lt;&lt;tiddler PaletteMaker with: NewPalette PaletteMaker##grayscale noList&gt;&gt;}}}
&lt;&lt;tiddler PaletteMaker##show with: NewPalette PaletteMaker##grayscale noList&gt;&gt;
{{{&lt;&lt;tiddler PaletteMaker with: NewPalette PaletteMaker##rainbow noList&gt;&gt;}}}
&lt;&lt;tiddler PaletteMaker##show with: NewPalette PaletteMaker##rainbow noList&gt;&gt;
&lt;&lt;&lt;
!showcode
&lt;&lt;tiddler PaletteMaker##out with: {{store.getTiddlerText('PaletteMaker##$1')}}&gt;&gt;
!out
{{{
$1
}}}
!end

!colorgrid
|white		||   |   |   |   |   |   |FC0|F90|F60|F30|   |   |   |   |   |   ||FFF|
|black		||9C0|   |   |   |   |C90|FC3|FC6|F96|F63|C30|   |   |   |   |C03||EEE|
|red		||CF0|CF3|330|660|990|CC0|FF0|C93|C63|300|600|900|C00|F00|F36|F03||DDD|
|orange		||9F0|CF6|9C3|663|993|CC3|FF3|960|930|633|933|C33|F33|C36|F69|F06||CCC|
|yellow		||6F0|9F6|6C3|690|996|CC6|FF6|963|630|966|C66|F66|903|C39|F6C|F09||BBB|
|green		||3F0|6F3|390|6C0|9F3|CC9|FF9|C96|C60|C99|F99|F39|C06|906|F3C|F0C||AAA|
|blue		||0C0|3C0|360|693|9C6|CF9|FFC|FC9|F93|FCC|F9C|C69|936|603|C09|303||999|
|darkmagenta	||3C3|6C6|0F0|3F3|6F6|9F9|CFC|   |   |   |C9C|969|939|909|636|606||888|
|violet		||060|363|090|393|696|9C9|   |   |   |FCF|F9F|F6F|F3F|F0F|C6C|C3C||777|
|darkred	||030|0C3|063|396|6C9|9FC|CFF|39F|9CF|CCF|C9F|96C|639|306|90C|C0C||666|
|darkorange	||0F3|3F6|093|0C6|3F9|9FF|9CC|06C|69C|99F|99C|93F|60C|609|C3F|C0F||555|
|gold		||0F6|6F9|3C6|096|6FF|6CC|699|036|369|66F|66C|669|309|93C|C6F|90F||444|
|darkgreen	||0F9|6FC|3C9|3FF|3CC|399|366|069|039|33F|33C|339|336|63C|96F|60F||333|
|darkblue	||0FC|3FC|0FF|0CC|099|066|033|39C|36C|00F|00C|009|006|003|63F|30F||222|
|indigo		||0C9|   |   |   |   |09C|3CF|6CF|69F|36F|03C|   |   |   |   |30C||111|
|darkviolet	||   |   |   |   |   |   |0CF|09F|06F|03F|   |   |   |   |   |   ||000|
!grayscale
|FFF|EEE|DDD|CCC|BBB|AAA|999|888|777|666|555|444|333|222|111|000|
!rainbow
|black|white|red|orange|yellow|green|blue|darkmagenta|violet|darkred|darkorange|gold|darkgreen|darkblue|indigo|darkviolet|
!end

!styles
/*{{{*/
.colorgrid table
	{ float:left; margin:0 !important; border:0 !important; }
.colorgrid table, .colorgrid tr, .colorgrid th, .colorgrid tbody
	{ color:black; border:0 !important; }
.colorgrid td
	{ height:16px; width:16px; text-align:center; padding:0; line-height:100%; }
.colorgrid select
	{ float:left; margin-left:16px; font-size:80%; height:255px; }
/*}}}*/
!end

!code
&lt;&lt;tiddler {{
config.shadowTiddlers.PaletteMakerStyles=store.getTiddlerText('PaletteMaker##styles');
setStylesheet(store.getTiddlerText('PaletteMakerStyles'),'paletteMakerStyles');
window.paletteMaker = {
	getColor: function(t){ if (!t||!t.length) return null;
		var s=document.createElement('span').style;
		try { s.color='#'+t; if (s.color.length) return '#'+t; }
		catch(e) { try{ s.color=t; } catch(e){ return null; } return t; } // IE 
		s.color=t; return s.color.length?t:null; // FF
	},
	getTextColor: function(t){ 
		t=this.getColor(t);
		if (!t||!t.length||!t.startsWith('#')) return 'black'; // BAD COLOR or X11 COLOR NAME
		var rgb=t.substr(1).split(''); var long=t.length&gt;=6;
		function h2d(h){return '0123456789ABCDEF'.indexOf(h?h.toUpperCase():'');};
		var r=h2d(rgb[0]); var g=h2d(rgb[long?2:1]); var b=h2d(rgb[long?4:2]);
		if (r&lt;0||g&lt;0||b&lt;0||r+g+b&gt;=15) return 'black'; // BAD RGB or BRIGHT COLOR
		return 'white'; // DARK COLOR
	},
	getPalette: function(palette) {
		var pal={};
		var slices=store.calcAllSlices(palette);
		for (var s in slices) {
			var color=slices[s].toUpperCase().replace(/#/,'');
			if (!pal[color]) pal[color]=new Array();
			pal[color].push(s);
		}
		return pal;
	},
	drawGrid: function(place,grid,palette,opts) {
		var pm=window.paletteMaker; // abbrev
		removeChildren(place);
		if (!opts.contains('NOGRID')) wikify(store.getTiddlerText(grid,''),place);
		if (!opts.contains('NOLIST')) var s=pm.drawList(place,
			{ palette:palette,min:0,max:0,edit:true,callback:pm.callback,place:place,opts:opts });
		var pal=pm.getPalette(palette);
		var cells=place.getElementsByTagName('td');
		for (var i=0; i&lt;cells.length; i++) { var td=cells[i];
			td.style.border=0;
			var txt=getPlainText(td).trim(); if (!txt.length) continue;
			var c=pm.getColor(txt); if (!c &amp;&amp; !opts.contains('ALLOWOTHER')) continue;
			if (c) { td.style.backgroundColor=c; td.innerHTML=''; td.style.fontSize='70%'; }
			td.title=c||txt;
			td.style.cursor=c?'crosshair':'pointer';
			td.params={ palette:palette, min:0, max:15, edit:true, callback:pm.callback,
				place:place, grid:grid,	opts:opts, pick:c||txt };
			if (pal[txt.toUpperCase()]) {
				td.params.names=pal[txt.toUpperCase()];
				td.title+='='+td.params.names.join(', ');
				if (c) { td.style.color=pm.getTextColor(c); td.innerHTML='&amp;radic;'; }
			}
			td.onclick=function(ev) { ev=ev||window.event;
				var p=Popup.create(this); if(!p)return false;
				p.className+=' sticky smallform';
				var s=window.paletteMaker.drawList(p,this.params);
				s.style.fontSize='80%'; Popup.show(); s.focus();
				ev.cancelBubble=true; if(ev.stopPropagation)ev.stopPropagation();
				return false;
			};
		}
	},
	drawList: function(here,p) {
		var pm=window.paletteMaker; // abbrev
		var s=createTiddlyElement(here,'select');
		s.params=p;
		s.options[s.length]=new Option(p.palette+':','_view');
		s.options[s.length-1].title='open '+p.palette;
		if (p.edit &amp;&amp; p.pick!==undefined) {
			var c=pm.getColor(p.pick);
			s.options[s.length]=new Option('+Add this color...','_add');
			if (c) s.options[s.length-1].style.backgroundColor=c;
			if (c) s.options[s.length-1].style.color=pm.getTextColor(c);
			s.options[s.length-1].title=p.pick;
		}
		var colors=store.calcAllSlices(p.palette);
		for (var x in colors) {
			var c=pm.getColor(colors[x]);
			var prefix=p.names&amp;&amp;p.names.contains(x)?'=':'\xA0\xA0';
			s.options[s.length]=new Option(prefix+x,colors[x]);
			if (c) s.options[s.length-1].style.backgroundColor=c;
			if (c) s.options[s.length-1].style.color=pm.getTextColor(c)
			s.options[s.length-1].title=(!c?'other: &quot;':'')+colors[x]+(!c?'&quot;':'');
		}
		s.size=p.min&amp;&amp;s.length&lt;p.min?p.min:p.max&amp;&amp;s.length&gt;p.max?p.max:s.length;
		s.onclick=function(ev){ ev=ev||window.event;
			var name=this.options[this.selectedIndex].text.replace(/[\xA0=]+/,'').trim();
			if (this.params.callback) this.params.callback(this,name,this.value,this.params);
			return false;
		};
		s.onkeyup=function(ev){ ev=ev||window.event;
			if (ev.keyCode==13) { this.onclick(); Popup.remove(); }
			if (ev.keyCode==27) Popup.remove();
			return false;
		};
		return s;
	},
	callback: function(here,name,val,p){
		var pm=window.paletteMaker; // abbrev
		if (!val.length) return;
		var pick=p.pick!==undefined?p.pick:val;
		if (val=='_view') {
			story.displayTiddler(story.findContainingTiddler(this.place),p.palette);
			Popup.remove();
			return false;
		} else if (val=='_add') {
			var msg='Enter a new name for &quot;'+pick+'&quot;';
			name=prompt(msg,'');
			var slices=store.calcAllSlices(p.palette);
			while (name &amp;&amp; slices[name])
				name=prompt('&quot;'+name+'&quot; is already in use\n'+msg,name);
		} else if (p.edit) {
			var allow=p.opts.contains('ALLOWOTHER');
			var msg='Change &quot;'+name+'&quot; from &quot;'+val+'&quot; to:';
			pick=prompt(msg,pick);
			while (pick &amp;&amp; !pm.getColor(pick)) {
				var err='&quot;'+pick+'&quot; is not a recognized color\n\xa0';
				if (!allow) err+='Please try again\n\n';
				else err+='Press OK to use this value anyway\n\n';
				var pre=pick; pick=prompt(err+msg,pick);
				if (pre==pick &amp;&amp; allow) break;
			}
		} else {
			// TBD: callback without editing
			Popup.remove();	return false;
		}
		here.selectedIndex=0;
		if (!name||!pick) return false;
		pm.set(p.palette,name.replace(/ /g,''),pick);
		pm.drawGrid(p.place,p.grid,p.palette,p.opts);
		Popup.remove();
		return false;
	},
	set: function(palette,name,newval) {
		var tid=store.getTiddler(palette);
		if (!tid) { var tid=new Tiddler(); tid.text=store.getTiddlerText(palette,''); }
		var oldval=store.getTiddlerSlice(palette,name)||'';
		var pattern=&quot;((?:^|\\n)(?:[\\'\\/]{0,2})~?(?:&quot;
			+name.escapeRegExp()
			+&quot;)\\1\\:[\\t\\x20]*)(?:&quot;
			+oldval.escapeRegExp()
			+&quot;)([\\t\\x20]*(?:\\n|$))&quot;;
		var t=tid.text; var match=t.match(new RegExp(pattern));
		if (match) {
			var pos=t.indexOf(match[0]);
			var newText=t.substr(0,pos)+
				match[1]+newval+match[2]+
				t.substr(pos+match[0].length);
		} else { // place new slice at top of list or start of tiddler
			var match=t.match(store.slicesRE);
			var pos=t.indexOf(match?match[0]:'');
			var newText=t.substr(0,pos)
				+name+': '+newval+(t.length?'\n':'')
				+t.substr(pos);
		}
		var who=config.options.txtUserName; var when=new Date();
		if (config.options.chkForceMinorUpdate)
			{ var who=tid.modifier; var when=tid.modified; }
		displayMessage('setting &quot;'+palette+'::'+name+'&quot; to &quot;'+newval+'&quot;');
		store.saveTiddler(palette,palette,newText,who,when,tid.tags,tid.fields);
		story.refreshTiddler(palette,null,true);
	}
};
'';}}&gt;&gt;
!end

!show
&lt;&lt;tiddler {{
	var opts=[]
	var palette=('$1'!='$'+'1' &amp;&amp; '$1'!='-')?'$1':'ColorPalette';
	var grid   =('$2'!='$'+'2' &amp;&amp; '$2'!='-')?'$2':'PaletteMaker##colorgrid';
	opts.push('$3'.toUpperCase());
	opts.push('$4'.toUpperCase());
	opts.push('$5'.toUpperCase());
	if (!place.lastChild||!hasClass(place.lastChild,'colorgrid')) {
		var wrapper=createTiddlyElement(place,'span',null,'colorgrid');
		window.paletteMaker.drawGrid(wrapper,grid,palette,opts);
	}
'';}}&gt;&gt;
!end

%/&lt;&lt;tiddler PaletteMaker##code&gt;&gt;/%
%/&lt;&lt;tiddler {{var src='PaletteMaker'; src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');}}
	with: [[$1]] [[$2]] [[$3]] [[$4]] [[$5]]&gt;&gt;</pre>
</div>
<div title="QuickEditPlugin" modifier="Shankar" created="200810091518" modified="200909161553" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|QuickEditPlugin|
|Source|http://www.TiddlyTools.com/#QuickEditPlugin|
|Documentation|http://www.TiddlyTools.com/#QuickEditPlugin|
|Version|2.4.3|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 3.0 License|http://creativecommons.org/licenses/by-sa/3.0/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|Support functions for ~QuickEdit package: styles, utility functions, and 'toggleQuickEdit' command|
!!!!!Revisions
&lt;&lt;&lt;
2009.06.11 [2.4.3] added keyup() function to abbreviate listbox handling for CR and ESC
2009.05.07 [2.4.2] added processed() function to abbreviate event handler code
2008.09.07 [2.4.1] added removeCookie() function for compatibility with [[CookieManagerPlugin]]
2008.05.17 [2.4.0] copied code from StickyPopupPlugin to remove dependency
2008.05.12 [2.3.0] added &quot;toggleQuickEdit&quot; command handler (replaces inline script command)
2008.01.11 [2.2.0] converted from inline script
2007.03.29 [1.0.0] initial release (as inline script)
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.QuickEditPlugin= {major: 2, minor: 4, revision: 3, date: new Date(2009,6,11)};

// SET STYLESHEET
setStylesheet(&quot;\
.quickEdit a { border:2px outset ButtonFace; padding:0px 3px !important; \
	-moz-border-radius:.5em; -webkit-border-radius:.5em; \
	-moz-appearance:button !important; -webkit-appearance:push-button !important; \
	background-color:ButtonFace; color:ButtonText !important;  \
	line-height:200%; font-weight:normal; } \
.quickEdit a:hover { border: 2px inset ButtonFace; background-color:ButtonFace; }\
&quot;, &quot;quickEditStyles&quot;);

// REMOVE COOKIE
if (window.removeCookie===undefined) {
	window.removeCookie=function(name) {
		document.cookie = name+'=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;'; 
	}
}

// UTILITY FUNCTIONS
config.quickEdit = {
	processed: function(ev) { ev=ev||window.event;
		ev.cancelBubble=true;
		if(ev.stopPropagation) ev.stopPropagation();
		return false;
	},
	keyup: function(ev){ var k=(ev||window.event).keyCode;
		if (k==13) this.onclick();
		if (k==27) Popup.remove();
	},
	getField: function(where) {
		var here=story.findContainingTiddler(where); if (!here) return null;
		var e=story.getTiddlerField(here.getAttribute(&quot;tiddler&quot;),&quot;text&quot;);
		if (e&amp;&amp;e.getAttribute(&quot;edit&quot;)==&quot;text&quot;) return e;
		return null;
	},
	setSelection: function(where,newtext) {
		var e=this.getField(where); if (!e) return false;
		e.focus(); replaceSelection(e,newtext);
		return false;
	},
	wrapSelection: function(where,before,after) {
		var e=this.getField(where); if (!e) return false;
		e.focus(); replaceSelection(e,before+config.quickEdit.getSelection(e)+after);
		return false;
	},
	getSelection: function(e) {
		var seltext=&quot;&quot;;
		if (e&amp;&amp;e.setSelectionRange)
			seltext=e.value.substr(e.selectionStart,e.selectionEnd-e.selectionStart);
		else if (document.selection) {
			var range = document.selection.createRange();
			if (range.parentElement()==e) seltext=range.text
		}
		return seltext;
	},
	promptForFilename: function(msg,path,file) {
		if(window.Components) { // moz
			try {
				netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
				var nsIFilePicker = window.Components.interfaces.nsIFilePicker;
				var picker = Components.classes['@mozilla.org/filepicker;1'].createInstance(nsIFilePicker);
				picker.init(window, msg, nsIFilePicker.modeOpen);
				var thispath = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
				thispath.initWithPath(path);
				picker.displayDirectory=thispath;
				picker.defaultExtension='jpg';
				picker.defaultString=file;
				picker.appendFilters(nsIFilePicker.filterAll|nsIFilePicker.filterImages);
				if (picker.show()!=nsIFilePicker.returnCancel)
					var result=&quot;file:///&quot;+picker.file.persistentDescriptor.replace(/\\/g,'/');
			}
			catch(e) { alert('error during local file access: '+e.toString()) }
		}
		else { // IE
			try { // XP only
				var s = new ActiveXObject('UserAccounts.CommonDialog');
				s.Filter='All files|*.*|JPG files|*.jpg|GIF files|*.gif|PNG files|*.png|';
				s.FilterIndex=1; // default to JPG
				s.InitialDir=path;
				s.FileName=file;
				if (s.showOpen()) var result=s.FileName;
			}
			catch(e) { var result=prompt(msg,path+file); } // fallback for non-XP IE
		}
		return result;
	}
}
//}}}

//{{{
if (config.options.chkShowQuickEdit===undefined) config.options.chkShowQuickEdit=false;
config.commands.toggleQuickEdit = {
	hideReadOnly: true,
	getText: function() { return config.options.chkShowQuickEdit?'\u221Aquickedit':'quickedit'; },

	tooltip: 'show QuickEdit toolbar buttons',
	handler: function(event,src,title) {
		config.options.chkShowQuickEdit=!config.options.chkShowQuickEdit;
		config.macros.option.propagateOption(&quot;chkShowQuickEdit&quot;,&quot;checked&quot;, config.options.chkShowQuickEdit,&quot;input&quot;);
		if (config.options.chkShowQuickEdit) saveOptionCookie(&quot;chkShowQuickEdit&quot;);
		else removeCookie(&quot;chkShowQuickEdit&quot;);
		src.innerHTML=config.commands.toggleQuickEdit.getText();
		story.forEachTiddler(function(t,e){if (story.isDirty(t)) refreshElements(e);});
		return false;
	}
};
//}}}

// // COPIED FROM [[StickyPopupPlugin]] TO ELIMINATE PLUGIN DEPENDENCY
//{{{
if (config.options.chkStickyPopups==undefined) config.options.chkStickyPopups=false;
Popup.stickyPopup_onDocumentClick = function(ev)
{
	// if click is in a sticky popup, ignore it so popup will remain visible
	var e = ev ? ev : window.event; var target = resolveTarget(e);
	var p=target; while (p) {
		if (hasClass(p,&quot;popup&quot;) &amp;&amp; (hasClass(p,&quot;sticky&quot;)||config.options.chkStickyPopups)) break;
		else p=p.parentNode;
	}
	if (!p) // not in sticky popup (or sticky popups disabled)... use normal click handling
		Popup.onDocumentClick(ev);
	return true;
};
try{removeEvent(document,&quot;click&quot;,Popup.onDocumentClick);}catch(e){};
try{addEvent(document,&quot;click&quot;,Popup.stickyPopup_onDocumentClick);}catch(e){};
//}}}</pre>
</div>
<div title="QuickEditToolbar" modifier="Shankar" created="200810091547" modified="201109070345" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEditToolbar|
|Source|http://www.TiddlyTools.com/#QuickEditToolbar|
|Version|2.1.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin, InlineJavascriptPlugin|
|Optional|QuickEdit_replace, QuickEdit_split, QuickEdit_link, QuickEdit_macro, QuickEdit_image, QuickEdit_tiddler, QuickEdit_file, QuickEdit_format, QuickEdit_sort|
|Overrides||
|Description|quickly insert TiddlyWiki tiddler links or common formatting sequences directly into tiddler content|

Usage (in EditTemplate): &lt;div macro='tiddler QuickEditToolbar with: show'&gt;&lt;/div&gt;

where &quot;show&quot; is an OPTIONAL keyword to force the toolbar to be displayed regardless of the current 'toggle' state

%/&lt;&lt;tiddler HideTiddlerTags&gt;&gt;/%

TOOLBAR DEFINITIONS BEGIN HERE...
= = = = = = = = = = = = = = = = =
%/{{hidden quickEdit{
&lt;script&gt;
	// note: always show toolbar when directly viewing the tiddler containing the actual toolbar definition!
	var here=story.findContainingTiddler(place); if (here) var tid=here.getAttribute(&quot;tiddler&quot;);
	var show=&quot;$1&quot;!=&quot;$&quot;+&quot;1&quot;||config.options.chkShowQuickEdit||tid==&quot;QuickEditToolbar&quot; 
	place.style.display=show?&quot;block&quot;:&quot;none&quot;;
&lt;/script&gt;/%
%/&lt;&lt;tiddler QuickEdit_replace&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_split&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_sort&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_tiddler&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_file&gt;&gt;/%
%/ &amp;nbsp;/% (SPACER)
%/&lt;&lt;tiddler QuickEdit_format&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_align&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_color&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_font&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_css&gt;&gt;/%
%/ &amp;nbsp;/% (SPACER)
%/&lt;&lt;tiddler QuickEdit_link&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_macro&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_image&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_insert&gt;&gt;/%
%/ &amp;nbsp;/% (SPACER)
%/&lt;&lt;tiddler QuickEdit_indent&gt;&gt;/%
%/&lt;&lt;tiddler QuickEdit_heb/gk&gt;&gt;/%
%/}}}</pre>
</div>
<div title="QuickEdit_align" modifier="Shankar" created="200810091534" modified="201109070345" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_align|
|Source|http://www.TiddlyTools.com/#QuickEdit_align|
|Version|2.2.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition for toolbar button for text alignment|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_align&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_align'&gt;&lt;/span&gt;

**** ALIGNMENT ****
%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
title=&quot;align text&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select text alignment...','');
	s.onchange=function(){
		config.quickEdit.wrapSelection(this.button,'{{'+this.value+'{','}}}');
		Popup.remove(); return false;
	};
	s.options[s.length]=new Option('left','left');
	s.options[s.length-1].title='{{left{...}}}';
	s.options[s.length]=new Option('center','center');
	s.options[s.length-1].title='{{center{...}}}';
	s.options[s.length]=new Option('right','right');
	s.options[s.length-1].title='{{right{...}}}';
	s.options[s.length]=new Option('justify','justify');
	s.options[s.length-1].title='{{justify{...}}}';
	s.options[s.length]=new Option('float left','float left');
	s.options[s.length-1].title='{{floatleft{...}}}';
	s.options[s.length]=new Option('float right','float right');
	s.options[s.length-1].title='{{floatright{...}}}';
	Popup.show(p,false);
	event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();return false;&quot;
&gt;align&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_color" modifier="Shankar" created="200810091533" modified="201109070348" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_color|
|Source|http://www.TiddlyTools.com/#QuickEdit_color|
|Version|2.2.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition of toolbar button for &quot;color&quot; command|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_color&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_color'&gt;&lt;/span&gt;

**** COLOR ****
%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
title=&quot;text/background color - @@color:#RGB;background-color:#RGB;...@@&quot;
onclick=&quot;var p=Popup.create(this,null,'popup sticky smallform'); if (!p) return false;
 	p.style.padding='2px';
	function hex(d) { return '0123456789ABCDEF'.substr(d,1); }
	var fg=createTiddlyElement(p,'select'); fg.button=this;
	fg.style.width='12em';
	fg.options[0]=new Option('text color...','');
	fg.options[1]=new Option('\xa0 or enter a value','_ask');
	fg.options[2]=new Option('\xa0 or use default color','');
	for (var r=0;r&lt;16;r+=3) for (var g=0;g&lt;16;g+=3) for (var b=0;b&lt;16;b+=3) {
		var label=hex(r)+hex(g)+hex(b);
		fg.options[fg.length]=new Option(label,'#'+label);
		fg.options[fg.length-1].style.color='#'+label;
	}
	fg.onchange=function(){ var val=this.value;
		if (val=='_ask') { val=prompt('Enter a CSS color value');
		if (!val||!val.length) return false; }
		this.options[0].value=val; this.options[0].text=val.length?'text: '+val:'text color...';
		var bg=this.nextSibling;
		for (var i=3;i&lt;bg.options.length;i++) bg.options[i].style.color=val;
		var preview=this.nextSibling.nextSibling.nextSibling;
		var t=config.quickEdit.getSelection(config.quickEdit.getField(this.button));
		t=t.replace(/^@@(color\:.+;)?(background-color\:.+;)?/,'').replace(/@@$/,'');
		if (!t.length) t='~AaBbCcDdEeFfGgHhIiJj 1234567890';
		var fg=this.value; if (fg.length) fg='color:'+fg+';';
		var bg=this.nextSibling.value; if (bg.length) bg='background-color:'+bg+';';
		if (fg.length||bg.length) t='@@'+fg+bg+t+'@@';
		removeChildren(preview); wikify(t,preview);
		this.selectedIndex=0; return false;
	};
	var bg=createTiddlyElement(p,'select'); bg.button=this;
	bg.style.width='12em';
	bg.options[0]=new Option('background color...','');
	bg.options[1]=new Option('\xa0 or enter a value','_ask');
	bg.options[2]=new Option('\xa0 or use default color','');
	for (var r=0;r&lt;16;r+=3) for (var g=0;g&lt;16;g+=3) for (var b=0;b&lt;16;b+=3) {
		var label=hex(15-r)+hex(15-g)+hex(15-b);
		bg.options[bg.length]=new Option(label,'#'+label);
		bg.options[bg.length-1].style.backgroundColor='#'+label;
	}
	bg.onchange=function(){ var val=this.value;
		if (val=='_ask') { val=prompt('Enter a CSS color value');
		if (!val||!val.length) return false; }
		this.options[0].value=val;
		this.options[0].text=val.length?'background: '+val:'background color...';
		var fg=this.previousSibling;
		for (var i=3;i&lt;fg.options.length;i++) fg.options[i].style.backgroundColor=val;
		var preview=this.nextSibling.nextSibling;
		var t=config.quickEdit.getSelection(config.quickEdit.getField(this.button));
		t=t.replace(/^@@(color\:.+;)?(background-color\:.+;)?/,'').replace(/@@$/,'');
		if (!t.length) t='~AaBbCcDdEeFfGgHhIiJj 1234567890';
		var fg=this.previousSibling.value; if (fg.length) fg='color:'+fg+';';
		var bg=this.value; if (bg.length) bg='background-color:'+bg+';';
		if (fg.length||bg.length) t='@@'+fg+bg+t+'@@';
		removeChildren(preview); wikify(t,preview);
		this.selectedIndex=0; return false;
	};
	var b=createTiddlyElement(p,'input',null,null,null,{type:'button'}); b.button=this;
	b.value='ok'; b.style.width='4em';
	b.onclick=function() {
		var fg=this.previousSibling.previousSibling.value; if (fg.length) fg='color:'+fg+';';
		var bg=this.previousSibling.value; if (bg.length) bg='background-color:'+bg+';';
		var t=config.quickEdit.getSelection(config.quickEdit.getField(this.button));
		t=t.replace(/^@@(color\:.+;)?(background-color\:.+;)?/,'').replace(/@@$/,'');
		if (fg.length||bg.length) config.quickEdit.setSelection(this.button,'@@'+fg+bg+t+'@@');
		Popup.remove(); return false;
	};
	var preview=createTiddlyElement(p,'div',null,'viewer'); var s=preview.style;
	s.border='1px solid'; s.margin='2px'; s.width='24em'; s.padding='3px'; s.MozBorderRadius='3px';
	s.overflow='hidden'; s.textAlign='center'; s.whiteSpace='normal';
	var t=config.quickEdit.getSelection(config.quickEdit.getField(this));
	wikify(t.length?t:'~AaBbCcDdEeFfGgHhIiJj 1234567890',preview);
	Popup.show(p,false);
	event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();return false;&quot;
&gt;color&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_font" modifier="Shankar" created="200810091532" modified="201109070345" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_font|
|Source|http://www.TiddlyTools.com/#QuickEdit_font|
|Version|2.2.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition for toolbar button that set font-family CSS attribute|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_font&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_macro'&gt;&lt;/span&gt;

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
title=&quot;set font-family CSS attribute - @@font-family:facename;...@@&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select a font family...','');
	s.onchange=function(){
		if (this.value=='_edit')
			story.displayTiddler(story.findContainingTiddler(this.button),'QuickEdit_fontList',DEFAULT_EDIT_TEMPLATE);			
		else
			config.quickEdit.wrapSelection(this.button,'@@font-family:\x22'+this.value+'\x22;','@@');
		Popup.remove(); return false;
	};
	var fonts=store.getTiddlerText('QuickEdit_fontList','').split('\n');
	for (var i=0; i&lt;fonts.length; i++) {
		if (!fonts[i].length) continue;
		s.options[s.length]=new Option(fonts[i],fonts[i]);
		s.options[s.length-1].style.fontFamily=fonts[i];
	}
	s.options[s.length]=new Option('[Edit font list...]','_edit');
	s.options[s.length-1].title='enter fonts, one per line...';
	Popup.show(p,false);
	event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();return false;&quot;
&gt;font&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_fontList" modifier="YourName" created="200810091531" modified="200810091610" tags="settings excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>Arial,helvetica,sans-serif
Times New Roman,times,serif
Verdana,sans-serif
Courier,monospaced</pre>
</div>
<div title="QuickEdit_format" modifier="Shankar" created="200810091530" modified="201109070344" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_format|
|Source|http://www.TiddlyTools.com/#QuickEdit_format|
|Version|2.2.0|
|Author|Eric Shulman - ELS Design Studios (*This version has been slightly modified by Dave Gifford*)|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition for toolbar button for text formatting|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_format&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_format'&gt;&lt;/span&gt;

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; title=&quot;''bold''&quot; accesskey=&quot;B&quot; 
onclick=&quot;config.quickEdit.wrapSelection(this,'\x27\x27','\x27\x27'); return false;&quot;
&gt;&amp;nbsp;B&amp;nbsp;&lt;/a&gt;&lt;/html&gt;/%

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; title=&quot;//italics//&quot; accesskey=&quot;I&quot; 
onclick=&quot;config.quickEdit.wrapSelection(this,'//','//'); return false;&quot;
&gt;&amp;nbsp;I&amp;nbsp;&lt;/a&gt;&lt;/html&gt;/%

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; title=&quot;__underline__&quot; accesskey=&quot;U&quot; 
onclick=&quot;config.quickEdit.wrapSelection(this,'__','__'); return false;&quot;
&gt;&amp;nbsp;U&amp;nbsp;&lt;/a&gt;&lt;/html&gt;/%

%/ &amp;nbsp;/%  SPACER

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
title=&quot;format text&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select text format...','');
	s.onchange=function(){
		var parts=this.value.split(',');
		config.quickEdit.wrapSelection(this.button,parts[0],parts[1]);
		Popup.remove(); return false;
	};
	s.options[s.length]=new Option('superscript','^^,^^');
	s.options[s.length-1].title='^^superscript^^';
	s.options[s.length]=new Option('subscript','~~,~~');
	s.options[s.length-1].title='~~subcript~~';
	s.options[s.length]=new Option('blockquote','\n\&lt;\&lt;\&lt;\n,\n\&lt;\&lt;\&lt;\n');
	s.options[s.length-1].title='indented blockquote - \&lt;\&lt;\&lt;';
	s.options[s.length]=new Option('monospaced','{{{,}}}');
	s.options[s.length-1].title='inline monospaced text - {{{...}}}';
	s.options[s.length]=new Option('pre','\n{{{\n,\n}}}\n');
	s.options[s.length-1].title='multi-line monospaced text box - {{{...}}}';
	s.options[s.length]=new Option('heading 1','\n!,\n');
	s.options[s.length-1].title='H1 heading - !';
	s.options[s.length]=new Option('heading 2','\n!!,\n');
	s.options[s.length-1].title='H2 heading - !';
	s.options[s.length]=new Option('heading 3','\n!!!,\n');
	s.options[s.length-1].title='H3 heading - !';
	s.options[s.length]=new Option('heading 4','\n!!!!,\n');
	s.options[s.length-1].title='H4 heading - !';
	s.options[s.length]=new Option('heading 5','\n!!!!!,\n');
	s.options[s.length-1].title='H5 heading - !';
	s.options[s.length]=new Option('comment','/%,%/');
	s.options[s.length-1].title='comment (hidden content) - /%...%/';
	s.options[s.length]=new Option('HTML','&lt;html&gt;,&lt;\x2fhtml&gt;');
	s.options[s.length-1].title='HTML syntax - &lt;html&gt;...&lt;\x2fhtml&gt;';
	Popup.show(p,false);
	event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();return false;&quot;
&gt;format&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_heb/gk" modifier="Shankar" created="200902191602" modified="200909161551" tags="QuickEditPackage show mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_custom|
|Source|http://www.TiddlyTools.com/#QuickEdit_custom|
|Version|2.3.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|provides a droplist of custom-defined formats|

Usage:
in QuickEditToolbar: &lt;&lt;tiddler QuickEdit_custom&gt;&gt;
OR
in EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_custom'&gt;&lt;/span&gt;

!help
Reminders:

Custom format definitions are stored as an &quot;HR-separated list&quot; in a tiddler named [[QuickEdit_customList]].

The first line of each list item is the text 'label' to show in the droplist, followed by one or more lines of wiki content to be inserted into the tiddler source.

To embed the tiddler editor's current selected text within the formatted output, use &quot;$1&quot; (without quotes) to mark the position(s) where the selection should be inserted.
!end help

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; tabindex=&quot;-1&quot; 
title=&quot;custom defined formats&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select a custom format...','');
	var items=store.getTiddlerText('QuickEdit_heb/gkList','').split('\n----\n');
	for (var i=0; i&lt;items.length; i++) {
		if (!items[i].length) continue; var lines=items[i].split('\n');
		var label=lines.shift(); var val=lines.join('\n');
		s.options[s.length]=new Option(label,val); s.options[s.length-1].title=val;
	}
	s.options[s.length]=new Option('[Edit custom formats...]','_edit');
	s.options[s.length-1].title='add/change custom format definitions...';
	s.size=Math.min(s.length,15);
	s.onclick=function(){ if (!this.value.length) return;
		if (this.value=='_edit') {
			alert(store.getTiddlerText('QuickEdit_he/gk##help'));
			story.displayTiddler(story.findContainingTiddler(this.button),
				'QuickEdit_heb/gk',DEFAULT_EDIT_TEMPLATE);
		} else {
		        var e=config.quickEdit.getField(this.button); if (!e) return false;
			e.focus(); var txt=config.quickEdit.getSelection(e);
			replaceSelection(e,this.value.replace(/\$\x31/g,txt));
		}
		Popup.remove(); return false;
	};
	s.onkeyup=function(ev){
		var k=(ev||window.event).keyCode; if (k==13) this.onclick(); if (k==27) Popup.remove();
	};
	Popup.show(p,false);
	s.focus();
	return config.quickEdit.processed(event);&quot;
&gt;Heb/Gk&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_heb/gkList" modifier="YourName" created="200905171502" modified="200909161502" tags="settings QuickEditPackage excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>greek
@@font-family: Gentium;font-size: 16pt;$1@@
----
greek indent1
@@font-family: Gentium;font-size: 16pt;margin-left: 2em;display:block;$1@@
----
greek indent2
@@font-family: Gentium;font-size: 16pt;margin-left: 4em;display:block;$1@@
----
greek indent3
@@font-family: Gentium;font-size: 16pt;margin-left: 6em;display:block;$1@@
----
greek indent4
@@font-family: Gentium;font-size: 16pt;margin-left: 8em;display:block;$1@@
----
greek indent5
@@font-family: Gentium;font-size: 16pt;margin-left: 10em;display:block;$1@@
----
hebrew no align
@@font-family: Gentium;font-size: 20pt;$1@@
----
hebrew right align
@@font-family: Gentium;font-size: 20pt;text-align:right;$1@@
----
hebrew right indent1
@@font-family: Gentium;font-size: 20pt;text-align:right;margin-right: 2em;display:block;$1@@
----
hebrew right indent2
@@font-family: Gentium;font-size: 20pt;text-align:right;margin-right: 4em;display:block;$1@@
----
hebrew right indent3
@@font-family: Gentium;font-size: 20pt;text-align:right;margin-right: 6em;display:block;$1@@
----
hebrew right indent4
@@font-family: Gentium;font-size: 20pt;text-align:right;margin-right: 8em;display:block;$1@@
----
hebrew right indent5
@@font-family: Gentium;font-size: 20pt;text-align:right;margin-right: 10em;display:block;$1@@</pre>
</div>
<div title="QuickEdit_image" modifier="Shankar" created="200810091529" modified="201109070344" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_image|
|Source|http://www.TiddlyTools.com/#QuickEdit_image|
|Version|2.2.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition for toolbar buttons that insert embedded image references|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_image&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_image'&gt;&lt;/span&gt;

**** INSERT IMAGE ****
%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
	title=&quot;embed an image (jpg/gif/png) - [img[tooltip|URL]] or [img[tooltip|path/to/file.ext]]&quot;
	onclick=&quot;var fn=config.quickEdit.promptForFilename('Enter/select an image file',getLocalPath(document.location.href),'');
	if (!fn) return false;  /* cancelled by user */
	var tip=prompt('Enter a tooltip for this image',''); if (!tip) tip=''; else tip+='|';
	return config.quickEdit.setSelection(this,'[img['+tip+fn+']]');&quot;
&gt;image&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_indent" modifier="Shankar" created="200905171451" modified="200909161552" tags="QuickEditPackage show mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_custom|
|Source|http://www.TiddlyTools.com/#QuickEdit_custom|
|Version|2.3.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|provides a droplist of custom-defined formats|

Usage:
in QuickEditToolbar: &lt;&lt;tiddler QuickEdit_custom&gt;&gt;
OR
in EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_custom'&gt;&lt;/span&gt;

!help
Reminders:

Custom format definitions are stored as an &quot;HR-separated list&quot; in a tiddler named [[QuickEdit_customList]].

The first line of each list item is the text 'label' to show in the droplist, followed by one or more lines of wiki content to be inserted into the tiddler source.

To embed the tiddler editor's current selected text within the formatted output, use &quot;$1&quot; (without quotes) to mark the position(s) where the selection should be inserted.
!end help

%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; tabindex=&quot;-1&quot; 
title=&quot;custom defined formats&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select a custom format...','');
	var items=store.getTiddlerText('QuickEdit_indentList','').split('\n----\n');
	for (var i=0; i&lt;items.length; i++) {
		if (!items[i].length) continue; var lines=items[i].split('\n');
		var label=lines.shift(); var val=lines.join('\n');
		s.options[s.length]=new Option(label,val); s.options[s.length-1].title=val;
	}
	s.options[s.length]=new Option('[Edit custom formats...]','_edit');
	s.options[s.length-1].title='add/change custom format definitions...';
	s.size=Math.min(s.length,15);
	s.onclick=function(){ if (!this.value.length) return;
		if (this.value=='_edit') {
			alert(store.getTiddlerText('QuickEdit_indent##help'));
			story.displayTiddler(story.findContainingTiddler(this.button),
				'QuickEdit_indent',DEFAULT_EDIT_TEMPLATE);
		} else {
		        var e=config.quickEdit.getField(this.button); if (!e) return false;
			e.focus(); var txt=config.quickEdit.getSelection(e);
			replaceSelection(e,this.value.replace(/\$\x31/g,txt));
		}
		Popup.remove(); return false;
	};
	s.onkeyup=function(ev){
		var k=(ev||window.event).keyCode; if (k==13) this.onclick(); if (k==27) Popup.remove();
	};
	Popup.show(p,false);
	s.focus();
	return config.quickEdit.processed(event);&quot;
&gt;indent&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_indentList" modifier="YourName" created="200902191601" modified="200909161502" tags="settings QuickEditPackage excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>popup
($1((add note here)))
----
dark gray cell
bgcolor(#999999):
----
light gray cell
bgcolor(#dddddd):
----
tudu slider
{{tuduSlider{&lt;&lt;slider chkTIDDLER &quot;TIDDLER&quot; &quot;DISPLAYED TEXT  »&quot;&gt;&gt;}}}
----
syntax table header row
{{smalltexttable{
|!Versículos|!Traducción|!Función &lt;br&gt;sintáctica|
----
syntax table section header
|&gt;|&gt;|!5.12 - Afirmación|
----
syntax table row
|!5.14a^^1^^|translation|((Función »()))|
----
indent1
@@margin-left: 2em;display:block;$1@@
----
indent2
@@margin-left: 4em;display:block;$1@@
----
indent3
@@margin-left: 6em;display:block;$1@@
----
indent4
@@margin-left: 8em;display:block;$1@@
----
indent5
@@margin-left: 10em;display:block;$1@@
----</pre>
</div>
<div title="QuickEdit_insert" modifier="Shankar" created="200801120913" modified="201109070350" tags="QuickEditPackage mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_insert|
|Source|http://www.TiddlyTools.com/#QuickEdit_insert|
|Version|2.3.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|definition for toolbar button that inserts content from another tiddler or file|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_insert&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_insert'&gt;&lt;/span&gt;

**** INSERT TIDDLER ****
%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot; tabindex=&quot;-1&quot; 
title=&quot;insert content from another tiddler or external file&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';

	var s2=createTiddlyElement(p,'select'); s2.title='filter by tag';
	s2.options[0]=new Option('filter by tag...','');
	s2.options[s2.length]=new Option('[all tiddlers]','');
	var tags=store.getTags();
	for (var t=0; t&lt;tags.length; t++) s2.options[s2.length]=new Option(tags[t][0],tags[t][0]);
	s2.onchange=function(){
		var tag=this.value;
		var tids=tag.length?store.getTaggedTiddlers(tag,'title'):store.getTiddlers('title');
		var list=this.nextSibling.nextSibling;
		while (list.length) list.options[0]=null;
		var prompt='select a tiddler or file...';
		if (tag.length) prompt='select a tagged tiddler ['+tids.length+' matches]...';
		list.options[0]=new Option(prompt,'');
		if (!tag.length) list.options[list.length]=new Option('[browse for file...]','_file');
		for (var t=0; t&lt;tids.length; t++) {
			list.options[list.length]=new Option(tids[t].title,tids[t].title);
			list.options[list.length-1].title=tids[t].getSubtitle();
		}
		list.size=Math.min(list.length,10);
		list.selectedIndex=0; list.focus();
		this.style.width=list.offsetWidth+'px';
		if (!tag.length) this.selectedIndex=0;
	};
	createTiddlyElement(p,'br');

	var s=createTiddlyElement(p,'select'); s.button=this;
	s.title='select a tiddler or file';
	s.options[0]=new Option('select a tiddler or file...','');
	s.options[s.length]=new Option('[browse for file...]','_file');
	var tids=store.getTiddlers('title');
	for (var t=0; t&lt;tids.length; t++) {
		s.options[s.length]=new Option(tids[t].title,tids[t].title);
		s.options[s.length-1].title=tids[t].getSubtitle();
	}
	s.size=Math.min(s.length,10);
	s.onclick=function(){ if (!this.value.length) return false;
		if (this.value=='_file') {
			var fn=config.quickEdit.promptForFilename(
				'Enter/select a text file',getLocalPath(document.location.href),'');
			if (!fn) return false; /* cancelled by user */
			var txt=loadFile(getLocalPath(fn));
			if (!txt) { alert('Error: unable to read contents from \0027'+fn+'\0027'); return; }
		}
		else var txt=store.getTiddlerText(this.value);
		if (!txt) {
			displayMessage(this.value+' not found');
			this.selectedIndex=0; this.focus();
			return false;
		}
		config.quickEdit.setSelection(this.button,txt);
		Popup.remove(); return false;
	};
	s.onkeyup=function(ev){
		var k=(ev||window.event).keyCode; if (k==13) this.onclick(); if (k==27) Popup.remove();
	};
	Popup.show(p,false);
	s2.style.width=s.offsetWidth+'px';
	s.focus();
	return config.quickEdit.processed(event);&quot;
&gt;insert&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickEdit_link" modifier="Shankar" created="200810091526" modified="200810091557" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|QuickEdit_link|
|Source|http://www.TiddlyTools.com/#QuickEdit_link|
|Version|2.2.1|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.2|
|Type|script|
|Requires|QuickEditPlugin|
|Overrides||
|Description|toolbar button that inserts a ~PrettyTiddlyLink to a tiddler or external file|

Usage:
QuickEditToolbar: &lt;&lt;tiddler QuickEdit_link&gt;&gt;
OR
EditTemplate: &lt;span class='toolbar' macro='tiddler QuickEdit_link'&gt;&lt;/span&gt;

**** INSERT LINK ****
%/&lt;html&gt;&lt;hide linebreaks&gt;&lt;a href=&quot;javascript:;&quot; class=&quot;tiddlyLink&quot;
title=&quot;add a 'PrettyLink' to another tiddler - [[link text|TiddlerName]]&quot;
onclick=&quot;var p=Popup.create(this); if (!p) return false; p.className+=' sticky smallform';
	var s=createTiddlyElement(p,'select'); s.button=this;
	s.options[0]=new Option('select a tiddler or file...','');
	s.onchange=function(){
		var title=this.value; var txt=title;
		if (title=='_file') {
			title=config.quickEdit.promptForFilename('Select a file',
				getLocalPath(document.location.href),'');
			if (!title) { this.selectedIndex=0; this.focus(); return false; }
			var txt=title.substr(title.lastIndexOf('/')+1);
		}
		var txt=prompt('Enter the text to display for this link',txt);
		if (!txt) { this.selectedIndex=0; this.focus(); return false; }
		config.quickEdit.setSelection(this.button,'[['+txt+'|'+title+']]');
		Popup.remove(); return false;
	};
	s.options[s.length]=new Option('[browse for file...]','_file');
	var tids=store.getTiddlers('title');
	for (var t=0; t&lt;tids.length; t++) {
		s.options[s.length]=new Option(tids[t].title,tids[t].title);
		s.options[s.length-1].title=tids[t].getSubtitle();
	}
	var s=createTiddlyElement(p,'select');
	s.options[0]=new Option('match tag...','');
	s.onchange=function(){
		var tag=this.value;
		var tids=tag.length?store.getTaggedTiddlers(tag,'title'):store.getTiddlers('title');
		var list=this.previousSibling;
		while (list.length) list.options[0]=null;
		var prompt='select a tiddler or file...';
		if (tag.length) prompt='select a tagged tiddler ['+tids.length+' matches]...';
		list.options[0]=new Option(prompt,'');
		if (!tag.length) list.options[list.length]=new Option('[browse for file...]','_file');
		for (var t=0; t&lt;tids.length; t++) {
			list.options[list.length]=new Option(tids[t].title,tids[t].title);
			list.options[list.length-1].title=tids[t].getSubtitle();
		}
	};
	var tags=store.getTags();
	for (var t=0; t&lt;tags.length; t++) s.options[s.length]=new Option(tags[t][0],tags[t][0]);
	Popup.show(p,false);
	event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation();return false;&quot;
&gt;link&lt;/a&gt;&lt;/html&gt;</pre>
</div>
<div title="QuickOpenTagPlugin" modifier="Shankar Swamy" created="200803080053" modified="201201071652" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|QuickOpenTagPlugin|
|Description:|Changes tag links to make it easier to open tags as tiddlers|
|Version:|3.0.1 ($Rev: 3861 $)|
|Date:|$Date: 2008-03-08 10:53:09 +1000 (Sat, 08 Mar 2008) $|
|Source:|http://mptw.tiddlyspot.com/#QuickOpenTagPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License:|http://mptw.tiddlyspot.com/#TheBSDLicense|
***/
//{{{
config.quickOpenTag = {

	dropdownChar: (document.all ? &quot;\u25bc&quot; : &quot;\u25be&quot;), // the little one doesn't work in IE?

	createTagButton: function(place,tag,excludeTiddler) {
		// little hack so we can do this: &lt;&lt;tag PrettyTagName|RealTagName&gt;&gt;
		var splitTag = tag.split(&quot;|&quot;);
		var pretty = tag;
		if (splitTag.length == 2) {
			tag = splitTag[1];
			pretty = splitTag[0];
		}
		
		var sp = createTiddlyElement(place,&quot;span&quot;,null,&quot;quickopentag&quot;);
		createTiddlyText(createTiddlyLink(sp,tag,false),pretty);
		
		var theTag = createTiddlyButton(sp,config.quickOpenTag.dropdownChar,
                        config.views.wikified.tag.tooltip.format([tag]),onClickTag);
		theTag.setAttribute(&quot;tag&quot;,tag);
		if (excludeTiddler)
			theTag.setAttribute(&quot;tiddler&quot;,excludeTiddler);
    		return(theTag);
	},

	miniTagHandler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var tagged = store.getTaggedTiddlers(tiddler.title);
		if (tagged.length &gt; 0) {
			var theTag = createTiddlyButton(place,config.quickOpenTag.dropdownChar,
                        	config.views.wikified.tag.tooltip.format([tiddler.title]),onClickTag);
			theTag.setAttribute(&quot;tag&quot;,tiddler.title);
			theTag.className = &quot;miniTag&quot;;
		}
	},

	allTagsHandler: function(place,macroName,params) {
                var boolWorkLog = document.title.match(/^Work/);
		var tags = store.getTags(params[0]);
		var filter = params[1]; // new feature
		var ul = createTiddlyElement(place,&quot;ul&quot;);
		if(tags.length == 0)
			createTiddlyElement(ul,&quot;li&quot;,null,&quot;listTitle&quot;,this.noTags);
		for(var t=0; t&lt;tags.length; t++) {
			var title = tags[t][0];
                        // If document name begins with &quot;Work___&quot;, then don't show
                        // tags of the forms YYYY-MM-DD or YYY-MM
                        if( boolWorkLog &amp;&amp; (tags[t][0].match(/\d{4}-\d{2}/) || 
                                       tags[t][0].match(/\d{4}-\d{2}-\d{2}/)) )
                       {
                           //alert(&quot;Here I am: &quot; + tags[t][0]);
		           continue;
                       }

			if (!filter || (title.match(new RegExp('^'+filter)))) {
				var info = getTiddlyLinkInfo(title);
				var theListItem =createTiddlyElement(ul,&quot;li&quot;);
				var theLink = createTiddlyLink(theListItem,tags[t][0],true);
				var theCount = &quot; (&quot; + tags[t][1] + &quot;)&quot;;
				theLink.appendChild(document.createTextNode(theCount));
				var theDropDownBtn = createTiddlyButton(theListItem,&quot; &quot; +
                                config.quickOpenTag.dropdownChar,this.tooltip.format(
                                                                  [tags[t][0]]),onClickTag);
				theDropDownBtn.setAttribute(&quot;tag&quot;,tags[t][0]);
			}
		}
	},

	// todo fix these up a bit
	styles: [
&quot;/*{{{*/&quot;,
&quot;/* created by QuickOpenTagPlugin */&quot;,
&quot;.tagglyTagged .quickopentag, .tagged .quickopentag &quot;,
&quot;	{ margin-right:1.2em; border:1px solid #eee; padding:2px; padding-right:0px; padding-left:1px; }&quot;,
&quot;.quickopentag .tiddlyLink { padding:2px; padding-left:3px; }&quot;,
&quot;.quickopentag a.button { padding:1px; padding-left:2px; padding-right:2px;}&quot;,
&quot;/* extra specificity to make it work right */&quot;,
&quot;#displayArea .viewer .quickopentag a.button, &quot;,
&quot;#displayArea .viewer .quickopentag a.tiddyLink, &quot;,
&quot;#mainMenu .quickopentag a.tiddyLink, &quot;,
&quot;#mainMenu .quickopentag a.tiddyLink &quot;,
&quot;	{ border:0px solid black; }&quot;,
&quot;#displayArea .viewer .quickopentag a.button, &quot;,
&quot;#mainMenu .quickopentag a.button &quot;,
&quot;	{ margin-left:0px; padding-left:2px; }&quot;,
&quot;#displayArea .viewer .quickopentag a.tiddlyLink, &quot;,
&quot;#mainMenu .quickopentag a.tiddlyLink &quot;,
&quot;	{ margin-right:0px; padding-right:0px; padding-left:0px; margin-left:0px; }&quot;,
&quot;a.miniTag {font-size:150%;} &quot;,
&quot;#mainMenu .quickopentag a.button &quot;,
&quot;	/* looks better in right justified main menus */&quot;,
&quot;	{ margin-left:0px; padding-left:2px; margin-right:0px; padding-right:0px; }&quot;, 
&quot;#topMenu .quickopentag { padding:0px; margin:0px; border:0px; }&quot;,
&quot;#topMenu .quickopentag .tiddlyLink { padding-right:1px; margin-right:0px; }&quot;,
&quot;#topMenu .quickopentag .button { padding-left:1px; margin-left:0px; border:0px; }&quot;,
&quot;/*}}}*/&quot;,
		&quot;&quot;].join(&quot;\n&quot;),

	init: function() {
		// we fully replace these builtins. can't hijack them easily
		window.createTagButton = this.createTagButton;
		config.macros.allTags.handler = this.allTagsHandler;
		config.macros.miniTag = { handler: this.miniTagHandler };
		config.shadowTiddlers[&quot;QuickOpenTagStyles&quot;] = this.styles;
		store.addNotification(&quot;QuickOpenTagStyles&quot;,refreshStyles);
	}
}

config.quickOpenTag.init();

//}}}</pre>
</div>
<div title="RecentChangesPlugin" modifier="shankar " created="200707270332" modified="200910301132" tags="DiscoveryPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|RecentChangesPlugin|
|Source|http://www.TiddlyTools.com/#RecentChangesPlugin|
|Version|2.2.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|display droplist of recently changed tiddlers with goto, edit, and preview buttons|
!!!!!Usage
&lt;&lt;&lt;
The {{{&lt;&lt;recentChanges&gt;&gt;}}} macro displays a droplist of all tiddlers that have been changed within the last N days (default=10 days).  
{{{
&lt;&lt;recentChanges&gt;&gt;
&lt;&lt;recentChanges #ofdays summary noEdit previewheight previewclass&gt;&gt;
}}}
where:
* #ofdays specifies the time limit for listing changed tiddlers.  Use 0 (zero) to list all tiddlers in the document.
* ''summary'' is an optional keyword that outputs only the summary text (without the droplist or buttons)
* ''noEdit'' is an optional keyword that hides the 'edit' button
* previewheight is a CSS height measurement and sets the FIXED height of the tiddler preview area (default is 15em)
* previewclass is any CSS classname, and can be used to apply custom styles to the preview area (default is to use the standard 'viewer' class)
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
{{smallform{
{{{&lt;&lt;recentChanges&gt;&gt;}}}
&lt;&lt;recentChanges&gt;&gt;
{{{&lt;&lt;recentChanges 30 summary&gt;&gt;}}}
&lt;&lt;recentChanges 30 summary&gt;&gt;

{{{&lt;&lt;recentChanges 30 noedit 10em groupbox&gt;&gt;}}}
&lt;&lt;recentChanges 30 noedit 10em groupbox&gt;&gt;
}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.09.07 [2.2.1] fixed typo in shadow definition
2009.07.02 [2.2.0] added optional 'noedit' keyword to hide 'edit' button
2008.07.01 [2.1.0] added optional 'summary' keyword for simple text output
2008.05.01 [2.0.1] fixup for titles with double-quotes
2007.07.26 [2.0.0] re-written as plugin
2006.10.02 [1.0.0] initial release (as inline script ShowRecentChanges)
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.RecentChangesPlugin= {major: 2, minor: 2, revision: 1, date: new Date(2009,9,7)};

config.shadowTiddlers.RecentChanges='&lt;&lt;recentChanges&gt;&gt;';

config.macros.recentChanges = {
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var days=10; if (!isNaN(params[0])) days=parseInt(params[0]); // time limit in days (use 0 for all tiddlers)
		var summary=params[1]&amp;&amp;params[1].toLowerCase()=='summary'; if (summary) params.shift();
		var noedit=params[1]&amp;&amp;params[1].toLowerCase()=='noedit'; if (noedit) params.shift();
		var height='15em'; if (params[1]) height=params[1]; // preview area fixed height
		var previewclass='viewer'; if (params[2]) previewclass=params[2]; // preview area CSS class
		var tiddlers=store.getTiddlers('modified','excludeLists').reverse();
		var count=tiddlers.length;
		if (days) {
			var timelimit=(new Date()).getTime()-86400000*days;
			for (var count=0; count&lt;tiddlers.length &amp;&amp; tiddlers[count].modified&gt;timelimit; count++);
		}
		var s=count+' tiddlers have changed since ';
		s+=new Date(timelimit).formatString('DDD, MMM DDth YYYY 0hh:0mm');
		s+=' ('+days+' days ago)';
		if (summary)
			{ wikify(s,place); return; }
		var opts='&lt;option value=&quot;&quot;&gt;'+s+'&lt;/option&gt;';
		for (var i=0; i&lt;count; i++) { var t=tiddlers[i];
			opts+='&lt;option value=&quot;'+t.title.replace(/&quot;/g,&quot;&amp;#x22;&quot;)+'&quot;&gt;';
			opts+=t.modified.formatString('YYYY.0MM.0DD 0hh:0mm')+' - '+t.title;
			opts+='&lt;/option&gt;';
		}
		var h=store.getTiddlerText('RecentChangesPlugin##html')
		h=h.replace(/%options%/,opts);
		h=h.replace(/%listwidth%/,noedit?79.5:69.5);
		h=h.replace(/%noedit%/,noedit?'none':'inline');
		createTiddlyElement(place,'div').innerHTML=h;
		var preview=createTiddlyElement(place,'div',null,previewclass);
		preview.style.display='none';
		preview.style.whiteSpace='normal';
		preview.style.overflow='auto';
		preview.style.height=height;
	}
}
//}}}
/***
//{{{
!html
&lt;form&gt;&lt;select size=1 name=&quot;list&quot; style=&quot;width:%listwidth%%&quot;
	onchange=&quot;this.form.goto.disabled=this.form.edit.disabled=this.form.preview.disabled=!this.value.length;
		var target=this.parentNode.parentNode.nextSibling; removeChildren(target);
		if (!this.value.length)
			{ target.style.display='none'; this.form.preview.value='preview'; }
		else if (target.style.display=='block') {
			wikify('&lt;'+'&lt;tiddler [['+this.value+']]&gt;'+'&gt;',target);
			target.style.display='block';
			this.form.preview.value='done';
		}
&quot;&gt;%options%&lt;/select&gt;&lt;!--
--&gt;&lt;input type=&quot;button&quot; name=&quot;goto&quot; value=&quot;goto&quot; disabled title=&quot;view selected tiddler&quot; style=&quot;width:10%&quot;
	onclick=&quot;var target=this.parentNode.parentNode.nextSibling; removeChildren(target);
		target.style.display='none'; this.form.preview.value='preview';
		story.displayTiddler(story.findContainingTiddler(this),this.form.list.value);
&quot;&gt;&lt;input type=&quot;button&quot; name=&quot;edit&quot; value=&quot;edit&quot; disabled title=&quot;edit selected tiddler&quot; style=&quot;width:10%;display:%noedit%&quot;
	onclick=&quot;var target=this.parentNode.parentNode.nextSibling; removeChildren(target);
		target.style.display='none'; this.form.preview.value='preview';
		story.displayTiddler(story.findContainingTiddler(this),this.form.list.value,DEFAULT_EDIT_TEMPLATE);
&quot;&gt;&lt;input type=&quot;button&quot; name=&quot;preview&quot; value=&quot;preview&quot; disabled title=&quot;show/hide tiddler preview&quot; style=&quot;width:10%&quot;
	onclick=&quot;var target=this.parentNode.parentNode.nextSibling;
		if (this.value=='preview') {
			removeChildren(target);
			wikify('&lt;'+'&lt;tiddler [['+this.form.list.value+']]&gt;'+'&gt;',target);
			target.style.display=this.form.list.value.length?'block':'none'; this.value='done';
		} else {
			removeChildren(target);
			target.style.display='none'; this.value='preview';
		}
&quot;&gt;&lt;/form&gt;
!end
//}}}
***/
 </pre>
</div>
<div title="RefreshPageDisplay" modifier="Shankar" created="200906111642" modified="201109070347" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|RefreshPageDisplay|
|Source|http://www.TiddlyTools.com/#RefreshPageDisplay|
|Version|1.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires|InlineJavascriptPlugin|
|Overrides||
|Description|Refresh all tiddlers and page elements without restarting|
%/&lt;script label=&quot;$1&quot; title=&quot;Redisplay current page content WITHOUT RESTARTING!&quot;&gt;
	story.forEachTiddler(function(t,e){story.refreshTiddler(t,null,true)});
	refreshDisplay();
 	return false;
&lt;/script&gt;&lt;script&gt;
	if (&quot;$1&quot;==&quot;$&quot;+&quot;1&quot;) place.lastChild.innerHTML=&quot;refresh page display&quot;;
&lt;/script&gt;</pre>
</div>
<div title="RefreshTiddler" modifier="Shankar" created="200607290047" modified="201109070349" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|RefreshTiddler|
|Source|http://www.TiddlyTools.com/#RefreshTiddler|
|Version|0.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires|InlineJavascriptPlugin|
|Overrides||
|Description|link that forces a refresh of the current tiddler|

usage: &lt;&lt;tiddler RefreshTiddler with: &quot;label&quot; &quot;tooltip&quot;&gt;&gt;

where label and tooltip are optional and default to &quot;refresh&quot; and &quot;redisplay tiddler content&quot;, respectively.

%/&lt;script label=&quot;refresh&quot; title=&quot;redisplay tiddler content&quot;&gt;
	var here=story.findContainingTiddler(place); if (!here) return false;
	story.refreshTiddler(here.getAttribute(&quot;tiddler&quot;),null,true);
	return false;
&lt;/script&gt;&lt;script&gt;
	if (&quot;$1&quot;!=&quot;$&quot;+&quot;1&quot;) place.lastChild.innerHTML=&quot;$1&quot;;
	if (&quot;$2&quot;!=&quot;$&quot;+&quot;2&quot;) place.lastChild.title=&quot;$2&quot;;
&lt;/script&gt;</pre>
</div>
<div title="RelatedTiddlersPlugin" modifier="shankar " created="200706292320" modified="200910301131" tags="DiscoveryPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|RelatedTiddlersPlugin|
|Source|http://www.TiddlyTools.com/#RelatedTiddlersPlugin|
|Version|1.1.8|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Requires|InlineJavascriptPlugin, NestedSlidersPlugin, StyleSheetShortcuts|
|Description|starting from a selected tiddler, display a list and/or tree of linked or transcluded tiddlers|
!!!!!Usage
&lt;&lt;&lt;
Starting from a specified tiddler (default=current tiddler), {{{&lt;&lt;relatedTiddlers&gt;&gt;}}} recursively follows the internal links[] data to find all other tiddlers that are related to it by linking (e.g., {{{[[TiddlerName]]}}}) or used as macro parameter (e.g., {{{&lt;&lt;tiddler TiddlerName&gt;&gt;}}}).

The results can be displayed as a simple flat list of related tiddler titles, or as an indented tree diagram that shows the specific connections between the related tiddlers, and can be helpful for identifying clusters of interdependent tiddlers or simply generating an on-the-fly site map for quick discovery and navigation through complex or unfamiliar document content. 
//{{{
&lt;&lt;relatedTiddlers TiddlerName hideform &quot;exclude list&quot;&gt;&gt;
//}}}
*''TiddlerName'' (optional)&lt;br&gt;specifies the starting tiddler (and hides the 'select a tiddler' form controls).  Use keyword ''here'' to specify the current tiddler.
*''hideform'' (optional)&lt;br&gt;when present, suppress display of 'select tiddler' droplist and buttons.
*''&quot;exclude list&quot;'' (optional)&lt;br&gt;space-separated list of tiddlers whose links should not be followed.  Use quotes or double-square brackets to ensure list is processed as a single parameter.
The plugin also defines two functions that can be called externally (from other plugins or scripts) to generate and retrieve either a list of links or a formatted &quot;tree view&quot;:
&gt;{{{var list=config.macros.relatedTiddlers.getList(start,exclude,callback);}}}
&gt;{{{var tree=config.macros.relatedTiddlers.getTree(start,exclude,callback);}}}
where ''start'' and 'exclude'' are the same as the macro parameters described above, plus an optional reference to a callback function that allows you to generate an alternative list/tree, based on application-specific data (such tiddler references contained in tags or custom fields), rather than using the default &quot;links&quot; list, like this:
&gt;{{block{
{{{
window.myCallback=function(tiddler) {
	var list=[];
	// ... fill the list based on the specified tiddler ...
	return list;
}
}}}
}}}
The function takes a tiddler object as input, and returns a list of tiddler titles that are //directly// linked (or otherwise related) to that specific tiddler.  {{{getList()}}} and {{{getTree()}}} then use this information to find all the //indirect// connections between tiddlers to produce the list or tree output.
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkRelatedTiddlersShowList&gt;&gt; show list display
&lt;&lt;option chkRelatedTiddlersShowTree&gt;&gt; show tree display
&lt;&lt;option chkRelatedTiddlersZoom&gt;&gt; enable autosizing of tree display //(aka, &quot;zoom&quot; or &quot;shrink-and-grow&quot;)//
don't follow links contained in these tiddlers: &lt;&lt;option txtRelatedTiddlersExclude&gt;&gt;
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
{{smallform{&lt;&lt;relatedTiddlers&gt;&gt;}}}

Using getList()/getTree() public API from other scripts/plugins:
&gt;&lt;script show&gt;
	var start=&quot;About&quot;;
	var exclude=config.options.txtRelatedTiddlersExclude.readBracketedList();
	var callback=null;
	var list=config.macros.relatedTiddlers.getList(start,exclude,callback);
	var tree=config.macros.relatedTiddlers.getTree(start,exclude,callback);
	return &quot;There are &quot;+list.length+&quot; tiddlers related to [[&quot;+start+&quot;]]...\n&quot;+tree;
&lt;/script&gt;
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.09.29 [1.1.8] in findRelatedTiddlers(), fixed recursion when using non-null callback
2007.11.11 [1.1.7] in findRelatedTiddlers(), refactored into separate getlinks(),&lt;br&gt;and added param for optional callback function that can be used to return an alternative set of links.&lt;br&gt;Also added API functions, getTree() and getList() for use by other scripts
2007.07.13 [1.1.6] performance optimizations, more code cleanup
2007.07.10 [1.1.5] extensive code cleanup
2007.07.08 [1.1.0] converted from inline script
2007.06.29 [1.0.0] started (as inline script)
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.RelatedTiddlersPlugin={major: 1, minor: 1, revision: 8, date: new Date(2009,9,29)};

// initialize 'autozoom' and 'exclude' tree options (defaults are not to zoom, and to follow all links)
if (config.options.chkRelatedTiddlersZoom===undefined)
	config.options.chkRelatedTiddlersZoom=false;
if (config.options.txtRelatedTiddlersExclude===undefined)
	config.options.txtRelatedTiddlersExclude='GettingStarted DefaultTiddlers';
if (config.options.chkRelatedTiddlersShowList===undefined)
	config.options.chkRelatedTiddlersShowList=true;
if (config.options.chkRelatedTiddlersShowTree===undefined)
	config.options.chkRelatedTiddlersShowTree=false;

config.macros.relatedTiddlers={
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {

		// create form with unique DOM element ID (using current timestamp)... permits multiple form instances
		var now=new Date().getTime();
		var span=createTiddlyElement(place,&quot;span&quot;);
		span.innerHTML=this.form.format([&quot;relatedTiddlers_form&quot;+now]);
		var form=span.getElementsByTagName(&quot;form&quot;)[0]; // find form that we just created
		var target=createTiddlyElement(span,&quot;div&quot;); // create target block in which generated output will be placed

		// initialize droplist contents (all tiddlers except hidden ones)
		var tids=store.getTiddlers('title','excludeLists');
		for (i=0; i&lt;tids.length; i++) form.list.options[form.list.options.length]=new Option(tids[i].title,tids[i].title,false,false);

		// initialize exclude field (space-separated list)
		if (config.options.txtRelatedTiddlersExclude) form.exclude.value=config.options.txtRelatedTiddlersExclude;

		// set starting tiddler, form display, and/or exclude list from macro params (if present) and then show the results!
		var root=&quot;&quot;;
		var hide=false;
		var exclude=config.options.txtRelatedTiddlersExclude;
		if (params[0]) root=params[0]; // TiddlerName
		if (params[1]) hide=(params[1].toLowerCase()==&quot;hideform&quot;); // keyword: &quot;hideform&quot; or &quot;showform&quot; (default)
		if (params[2]) exclude=params[2]; // list of tiddlers whose links should not be followed
		if (root==&quot;here&quot;) { var tid=story.findContainingTiddler(place); if (tid) root=tid.getAttribute(&quot;tiddler&quot;); }
		if (store.tiddlerExists(root)) {
			// NOTE:  don't hide form when running IE, where putting initial focus on hidden form creates an error
			if (!config.browser.isIE) form.style.display=hide?&quot;none&quot;:&quot;block&quot;; // show/hide the controls
			form.list.value=root; // set the root
			form.exclude.value=exclude; // set 'exclude' field
			form.get.click(); // DISPLAY INITIAL RESULTS (if tiddler is selected)
		}
	},
	form:
		&quot;&lt;form id='%0' action='javascript:;' style='display:inline;margin:0;padding:0;' onsubmit='return false'&gt;&lt;!-- \
		--&gt;&lt;span class='fine' style='float:left;vertical-align:bottom;width:39.5%;'&gt;&lt;i&gt;find all tiddlers related to:&lt;/i&gt;&lt;/span&gt;&lt;!-- \
		--&gt;&lt;span class='fine' style='float:left;vertical-align:bottom;'&gt;&lt;i&gt;exclude links contained in:&lt;/i&gt;&lt;/span&gt;&lt;!-- \
		--&gt;&lt;div style='clear:both'&gt;&lt;!-- \
		--&gt;&lt;select name=list size=1 style='width:39.5%' onchange='this.form.get.click()'&gt;&lt;!-- \
		--&gt;&lt;option value=''&gt;select a tiddler...&lt;/option&gt;&lt;!-- \
		--&gt;&lt;/select&gt;&lt;!-- \
		--&gt;&lt;input type='text' option='txtRelatedTiddlersExclude' name='exclude' value='' style='width:40%' \
			title='enter the names of tiddlers whose links should NOT be followed' \
			onkeyup='if (event.keyCode==13) { this.blur(); this.form.get.click(); }'  \
			onchange='config.options[this.getAttribute(\&quot;option\&quot;)]=this.value;saveOptionCookie(this.getAttribute(\&quot;option\&quot;));'&gt;&lt;!-- \
		--&gt;&lt;input type=button name=get value='get related' style='width:10%'  \
			onclick='config.macros.relatedTiddlers.show(this.form,this.form.nextSibling);'&gt;&lt;!-- \
		--&gt;&lt;input type=button name=done value='done' disabled style='width:10%'  \
			onclick='this.form.list.selectedIndex=0; this.form.get.click();'&gt;&lt;!-- \
		--&gt;&lt;/div&gt;&lt;!-- \
		--&gt;&lt;/form&gt;&quot;,
	styles:
		&quot;.relatedTiddlers blockquote \
			{ border-left:1px dotted #999; margin:0 25px; padding-left:.5em; font-size:%0%; line-height:115%; } \
		.relatedTiddlers .borderleft \
			{ margin:0; padding:0; margin-left:1em; border-left:1px dotted #999; padding-left:.5em; } \
		.relatedTiddlers .fourcolumns \
			{ display:block; -moz-column-count:4; -moz-column-gap:1em; -moz-column-width:25%} \
		.relatedTiddlers a \
			{ font-weight:normal; } \
		.relatedTiddlers .bold, .relatedTiddlers .bold a \
			{ font-weight:bold; } \
		.relatedTiddlers .floatright \
			{ float:right; } \
		.relatedTiddlers .clear \
			{ clear:both; }	&quot;,
	toggleform:
		&quot;{{floatright{&lt;html&gt;&lt;a href='javascript:;' class='button' title='show/hide tiddler selection droplist and buttons' \
		onclick='var here=story.findContainingTiddler(this); var tid=here?here.getAttribute(\&quot;tiddler\&quot;):\&quot;\&quot;; \
			var f=document.getElementById(\&quot;%0\&quot;); var hide=(f.style.display!=\&quot;none\&quot;); \
			f.style.display=hide?\&quot;none\&quot;:\&quot;inline\&quot;; this.innerHTML=hide?\&quot;show form\&quot;:\&quot;hide form\&quot;; return false;'&gt;%1&lt;/a&gt;&lt;/html&gt;}}}&quot;,
	treecheck:
		&quot;{{floatright{@@display:none;&lt;&lt;option chkRelatedTiddlersShowTree&gt;&gt;@@&lt;html&gt;&lt;a href='javascript:;' class='button' onclick='this.parentNode.previousSibling.firstChild.click(); return false;'&gt;tree view&lt;/a&gt;&lt;/html&gt;}}}&quot;,
	tree:
		&quot;{{clear{\n----\n}}} \
		{{floatright small{&lt;&lt;option chkRelatedTiddlersZoom&gt;&gt;autosize tree display}}} \
		{{fine{\n''tiddlers linked from or included by'' [[%0]]\n}}}%1&quot;,
	listcheck:
		&quot;{{floatright{@@display:none;&lt;&lt;option chkRelatedTiddlersShowList&gt;&gt;@@&lt;html&gt;&lt;a href='javascript:;' class='button' onclick='this.parentNode.previousSibling.firstChild.click(); return false;'&gt;list view&lt;/a&gt;&lt;/html&gt;}}}&quot;,
	list:
		&quot;{{clear{\n----\n}}} \
		{{fine{\n''tiddlers containing links to'' [[%0]]\n}}} \
		{{small fourcolumns borderleft{\n%1}}} \
		{{fine{\n''tiddlers linked from or included by'' [[%0]]\n}}} \
		{{borderleft{\n \
			{{fine{\n''bold''=//direct links//, plain=//indirect links//, ''...''=//links not followed//}}} \
			{{small fourcolumns{\n%2}}} \
		}}}&quot;,
	skipped:
		&quot;&lt;html&gt;&lt;span title='links from %0 have NOT been followed'&gt;...&lt;/span&gt;&lt;/html&gt;&quot;,
	mouseover: function(ev) {
		this.saveSize=this.style.fontSize;
		this.style.fontSize='100%';
		this.style.borderLeftStyle='solid';
	},
	mouseout: function(ev) {
		this.style.fontSize=this.saveSize;
		this.style.borderLeftStyle='dotted';
	},
	findRelatedTiddlers: function(tid,tids,treeout,level,exclude,callback) { 
		// recursively build list of related tids (links and includes FROM the root tiddler) and generate treeview output
		var t=store.getTiddler(tid);
		if (!t || tids.contains(tid)) return tids; // tiddler already in results (or missing tiddler)... just return current results
		tids.push(t.title); // add tiddler to results
		var skip=exclude &amp;&amp; exclude.contains(tid);
		treeout.text+=level+&quot;[[&quot;+tid+&quot;]]&quot;+(skip?this.skipped.format([tid]):&quot;&quot;)+&quot;\n&quot;;
		if (skip) return tids; // branch is pruned... don't follow links
		var links=callback?callback(t):this.getLinks(t);
		for (var i=0; i&lt;links.length; i++) tids=this.findRelatedTiddlers(links[i],tids,treeout,level+&quot;&gt;&quot;,exclude,callback);
		return tids;
	},
	getLinks: function(tiddler) {
		if (!tiddler.linksUpdated) tiddler.changed();
		return tiddler.links;
	},
	getTree: function(start,exclude,callback) {
		// get related tiddlers and generate blockquote-indented tree output
		var list=[]; var tree={text:&quot;&quot;}; var level=&quot;&quot;;
		list=this.findRelatedTiddlers(start,list,tree,level,exclude,callback);
		return tree.text;
	},
	getList: function(start,exclude,callback) {
		// get related tiddlers and generate blockquote-indented tree output
		var list=[]; var tree={text:&quot;&quot;}; var level=&quot;&quot;;
		list=this.findRelatedTiddlers(start,list,tree,level,exclude,callback);
		return list;
	},
	show: function(form,target) {
		removeChildren(target); form.done.disabled=true; // clear any existing output and disable 'done' button
		var start=form.list.value; if (!start.length) return; // get selected starting tiddler.  If blank value (heading), do nothing

		// get related tiddlers and generate blockquote-indented tree output
		var rels=[]; var treeview={text:&quot;&quot;}; var level=&quot;&quot;;
		var exclude=config.options.txtRelatedTiddlersExclude.readBracketedList();
		var rels=this.findRelatedTiddlers(start,rels,treeview,level,exclude);
		rels.shift(); // remove self from list
		rels.sort(); // sort titles alphabetically

		// generate list output
		var tid=store.getTiddler(start);
		var relsview=&quot;&quot;; for (t=0; t&lt;rels.length; t++) {
			relsview+=tid.links.contains(rels[t])?(&quot;{{bold{[[&quot;+rels[t]+&quot;]]}}}&quot;):(&quot;[[&quot;+rels[t]+&quot;]]&quot;);
			if (exclude &amp;&amp; exclude.contains(rels[t])) relsview+=this.skipped.format([rels[t]]);
			relsview+=&quot;\n&quot;;
		}
	
		// get references TO the root tiddler, add to related tiddlers and generate refsview output
		var refs=[]; var referers=store.getReferringTiddlers(start);
		for(var r=0; r&lt;referers.length; r++)
			if(referers[r].title!=start &amp;&amp; !referers[r].tags.contains(&quot;excludeLists&quot;)) refs.push(referers[r].title);
		var refcount=refs.length; var relcount=rels.length; // remember individual counts
		for (var r=0; r&lt;refs.length; r++) rels.pushUnique(refs[r]); // combine lists without duplicates
		var total=rels.length; // get combined total
		var refsview=&quot;[[&quot;+refs.sort().join(&quot;]]\n[[&quot;)+&quot;]]\n&quot;;
	
		// set custom blockquote styles for treeview
		setStylesheet(this.styles.format([config.options.chkRelatedTiddlersZoom?80:100]),'relatedTiddlers_styles');

		// assemble and render output
		var summary=(total?(total+&quot; tiddler&quot;+(total==1?&quot; is&quot;:&quot;s are&quot;)):&quot;There are no tiddlers&quot;)+&quot; related to: [[&quot;+start+&quot;]]&quot;;
		var list=this.list.format([start,refsview.length?refsview:&quot;//none//&quot;,relsview.length?relsview:&quot;//none//&quot;]);
		var tree=this.tree.format([start,treeview.text]);
		var toggle=this.toggleform.format([form.id,(form.style.display=='none'?'show form':'hide form')]);
		var sep=&quot;{{floatright{ | }}}&quot;;
		var showList=total &amp;&amp; config.options.chkRelatedTiddlersShowList;
		var showTree=relcount &amp;&amp; config.options.chkRelatedTiddlersShowTree;
		var out=&quot;{{relatedTiddlers{&quot;+toggle+(relcount?sep+this.treecheck:&quot;&quot;)+(total?sep+this.listcheck:&quot;&quot;)+summary+(showList?list:&quot;&quot;)+(showTree?tree:&quot;&quot;)+&quot;}}}&quot;;
		wikify(out,target);
		form.done.disabled=false; // enable 'done' button

		// add mouseover/mouseout handling to blockquotes (for autosizing)
		var blocks=target.getElementsByTagName(&quot;blockquote&quot;);
		for (var b=0; b&lt;blocks.length; b++)
			{ blocks[b].onmouseover=this.mouseover; blocks[b].onmouseout=this.mouseout; }

		// add side-effect to checkboxes so that display is refreshed when a checkbox state is changed
		var checks=target.getElementsByTagName(&quot;input&quot;);
		for (var c=0; c&lt;checks.length; c++) {
			if (checks[c].type.toLowerCase()!=&quot;checkbox&quot;) continue;
			checks[c].coreClick=checks[c].onclick; // save standard click handler
			checks[c].formID=form.id; // link checkbox with correponding form
			checks[c].onclick=function() { this.coreClick.apply(this,arguments); document.getElementById(this.formID).get.click(); }
		}
	}
}
//}}}</pre>
</div>
<div title="SaveAsPlugin" modifier="Shankar" created="200602030909" modified="200909150412" tags="systemConfig ImportExportPackage basic mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SaveAsPlugin|
|Source|http://www.TiddlyTools.com/#SaveAsPlugin|
|Documentation|http://www.TiddlyTools.com/#SaveAsPluginInfo|
|Version|2.5.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Description|Save current document to a different path/filename|
Adds 'save as' command to 'backstage' menu and {{{&lt;&lt;saveAs&gt;&gt;}}} macro (to embed command link wherever you like).
&gt;//Note: This plugin replaces functionality previously provided by [[NewDocumentPlugin]], except for the HTML+CSS &quot;snapshot&quot; feature, which has been moved to a separate [[SnapshotPlugin]].//
!!!!!Documentation
&lt;&lt;&lt;
see [[SaveAsPluginInfo]]
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.04.30 [2.5.1] custom fields in CSV output
| Please see [[SaveAsPluginInfo]] for additional revision details |
2006.02.03 [1.0.0] Created.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.SaveAsPlugin= {major: 2, minor: 5, revision: 1, date: new Date(2009,4,30)};

config.macros.saveAs = {
	label: &quot;save as...&quot;,
	labelparam: &quot;label:&quot;,
	prompt: &quot;Save current document to a different path/file&quot;,
	promptparam: &quot;prompt:&quot;,
	filePrompt: &quot;Please select or enter a target path/filename&quot;,
	targetparam: &quot;target:&quot;,
	defaultFilename: &quot;new.html&quot;,
	filenameparam: &quot;filename:&quot;,
	currfilekeyword: &quot;here&quot;,
	typeparam: &quot;type:&quot;,
	type_TW: &quot;tw&quot;, type_PS: &quot;ps&quot;, type_TX: &quot;tx&quot;, type_CS: &quot;cs&quot;, type_NF: &quot;nf&quot;, // file type tokens
	type_map: { // map filetype param alternatives/abbreviations to token values
		tiddlywiki:&quot;tw&quot;, tw:&quot;tw&quot;, wiki: &quot;tw&quot;,
		purestore: &quot;ps&quot;, ps:&quot;ps&quot;, store:&quot;ps&quot;,
		plaintext: &quot;tx&quot;, tx:&quot;tx&quot;, text: &quot;tx&quot;,
		comma:     &quot;cs&quot;, cs:&quot;cs&quot;, csv:  &quot;cs&quot;,
		newsfeed:  &quot;nf&quot;, nf:&quot;nf&quot;, xml:  &quot;nf&quot;, rss:&quot;nf&quot;
	},
	replaceparam: &quot;replace&quot;,
	mergeparam: &quot;merge&quot;,
	quietparam: &quot;quiet&quot;,
	openparam: &quot;open&quot;,
	askParam: &quot;ask&quot;,
	askMsg: &quot;Enter a tag filter (use * for all tiddlers, 'none' for blank document)&quot;,
	emptyParam: &quot;none&quot;,
	confirmmsg: &quot;Found %0 tiddlers matching\n\n'%1'\n\nPress OK to proceed&quot;,
	mergeprompt: &quot;%0\nalready contains tiddler definitions.\n&quot;
		+&quot;\nPress OK to add new/revised tiddlers to current file contents.&quot;
		+&quot;\nPress Cancel to completely replace file contents&quot;,
	mergestatus: &quot;Merged %0 new/revised tiddlers and %1 existing tiddlers&quot;,
	okmsg: &quot;%0 tiddlers written to %1&quot;,
	failmsg: &quot;An error occurred while creating %1&quot;,
	filter: &quot;&quot;,
	handler: function(place,macroName,params) {
		if (params[0] &amp;&amp; params[0].substr(0,this.labelparam.length)==this.labelparam)
			var label=params.shift().substr(this.labelparam.length);
		if (params[0] &amp;&amp; params[0].substr(0,this.promptparam.length)==this.promptparam)
			var prompt=params.shift().substr(this.promptparam.length);
		if (params[0] &amp;&amp; params[0].substr(0,this.targetparam.length)==this.targetparam)
			var target=params.shift().substr(this.targetparam.length);
		if (params[0] &amp;&amp; params[0].substr(0,this.filenameparam.length)==this.filenameparam)
			var filename=params.shift().substr(this.filenameparam.length);
		if (params[0] &amp;&amp; params[0].substr(0,this.typeparam.length)==this.typeparam)
			var filetype=this.type_map[params.shift().substr(this.typeparam.length).toLowerCase()];
		var q=(params[0] &amp;&amp; params[0]==this.quietparam);   if (q) params.shift();
		var o=(params[0] &amp;&amp; params[0]==this.replaceparam); if (o) params.shift();
		var m=(params[0] &amp;&amp; params[0]==this.mergeparam);   if (m) params.shift();
		var a=(params[0] &amp;&amp; params[0]==this.openparam);    if (a) params.shift();
		var btn=createTiddlyButton(place,label||this.label,prompt||this.prompt,
			function(){config.macros.saveAs.go(
				this.getAttribute('target'),
				this.getAttribute('filename'),
				this.getAttribute('filetype'),
				this.getAttribute('filter'),
				this.getAttribute('quiet')==&quot;true&quot;,
				this.getAttribute('overwrite')==&quot;true&quot;,
				this.getAttribute('merge')==&quot;true&quot;,
				this.getAttribute('autoopen')==&quot;true&quot;);  return false;}
		);
		if (target) btn.setAttribute(&quot;target&quot;,target);
		if (filename) btn.setAttribute(&quot;filename&quot;,filename);
		btn.setAttribute(&quot;filetype&quot;,filetype||this.type_TW);
		btn.setAttribute(&quot;filter&quot;,params.join(&quot; &quot;));
		btn.setAttribute(&quot;quiet&quot;,q?&quot;true&quot;:&quot;false&quot;);
		btn.setAttribute(&quot;overwrite&quot;,o?&quot;true&quot;:&quot;false&quot;);
		btn.setAttribute(&quot;merge&quot;,m?&quot;true&quot;:&quot;false&quot;);
		btn.setAttribute(&quot;autoopen&quot;,a?&quot;true&quot;:&quot;false&quot;);
	},
	go: function(target,filename,filetype,filter,quiet,overwrite,merge,autoopen) {
		var cm=config.messages; // abbreviation
		var cms=config.macros.saveAs; // abbreviation
		if (window.location.protocol!=&quot;file:&quot;) // make sure we are local
			{ displayMessage(cm.notFileUrlError); return; }

		// get tidders, confirm filtered results
		var tids=cms.selectTiddlers(filter);
		if (tids===false) return; // cancelled by user
		if (cms.filter!=cms.emptyParam &amp;&amp; cms.filter.length &amp;&amp; !quiet)
			if (!confirm(cms.confirmmsg.format([tids.length,cms.filter]))) return;

		// get target path/filename
		if (!filetype) filetype=this.type_TW;
		target=target||cms.getTarget(filename,filetype==this.type_TX?'txt':filetype==this.type_CS?'csv':'html');
		if (!target) return; // cancelled by user

		var link=&quot;file:///&quot;+target.replace(/\\/g,'/');
		var samefile=link==decodeURIComponent(window.location.href);
		var p=getLocalPath(document.location.href);
		if (samefile) {
			if (config.options.chkSaveBackups) { var t=loadOriginal(p);if(t)saveBackup(p,t); }
			if (config.options.chkGenerateAnRssFeed &amp;&amp; saveRss instanceof Function) saveRss(p);
		}
		var notes=&quot;&quot;;
		var total={val:0};
		var out=this.assembleFile(target,filetype,tids,notes,quiet,overwrite,merge,total);
		var ok=saveFile(target,out);
		if (ok &amp;&amp; autoopen) {
			if (!samefile) window.open(link).focus();
			else { store.setDirty(false); window.location.reload(); }
		}
		if (!quiet || !(ok &amp;&amp; autoopen))
			displayMessage((ok?this.okmsg:this.failmsg).format([total.val,target]),link);
	},
	selectTiddlers: function(filter) {
		var cms=config.macros.saveAs; // abbreviation
		cms.filter=filter||&quot;&quot;;
		if (filter==cms.emptyParam) return [];
		if (!filter||!filter.length) return store.getTiddlers(&quot;title&quot;);
		// get filtered tiddlers
		if (filter==config.macros.saveAs.askParam) {
			filter=prompt(config.macros.saveAs.askMsg,&quot;&quot;);
			if (!filter) return false;  // cancelled by user
			cms.filter=filter==&quot;*&quot;?&quot;&quot;:filter;
			if (filter==&quot;*&quot;) return store.getTiddlers(&quot;title&quot;);
		}
		return store.filterTiddlers(&quot;[tag[&quot;+filter+&quot;]]&quot;);
	},
	getTarget: function(defName,defExt) {
		var cms=config.macros.saveAs; // abbreviation
		// get new target path/filename
		var newPath=getLocalPath(window.location.href);
		var slashpos=newPath.lastIndexOf(&quot;/&quot;); if (slashpos==-1) slashpos=newPath.lastIndexOf(&quot;\\&quot;); 
		if (slashpos!=-1) newPath=newPath.substr(0,slashpos+1); // trim filename
		if (!defName||!defName.length) { // use current filename as default
			var p=getLocalPath(window.location.href);
			var s=p.lastIndexOf(&quot;/&quot;); if (s==-1) s=p.lastIndexOf(&quot;\\&quot;); 
			if (s!=-1) defName=p.substr(s+1);
		}
		var defFilename=(defName||cms.defaultFilename).replace(/.html$/,'.'+defExt);
		var target=cms.askForFilename(cms.filePrompt,newPath,defFilename,defExt);
		if (!target) return; // cancelled by user
		// if specified file does not include a path, assemble fully qualified path and filename
		var slashpos=target.lastIndexOf(&quot;/&quot;); if (slashpos==-1) slashpos=target.lastIndexOf(&quot;\\&quot;);
		if (slashpos==-1) target=target+(defName||cms.defaultFilename).replace(/.html$/,'.'+defExt);
		return target;
	},
	askForFilename: function(msg,path,file,defExt) {
		if(window.Components) { // moz
			try {
				netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
				var nsIFilePicker = window.Components.interfaces.nsIFilePicker;
				var picker = Components.classes['@mozilla.org/filepicker;1'].createInstance(nsIFilePicker);
				picker.init(window, msg, nsIFilePicker.modeSave);
				var thispath = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
				thispath.initWithPath(path);
				picker.displayDirectory=thispath;
				picker.defaultExtension=defExt||'html';
				picker.defaultString=file;
				picker.appendFilters(nsIFilePicker.filterAll|nsIFilePicker.filterText|nsIFilePicker.filterHTML);
				if (picker.show()!=nsIFilePicker.returnCancel) var result=picker.file.persistentDescriptor;
			}
			catch(e) { alert('error during local file access: '+e.toString()) }
		}
		else { // IE
			try { // XP/Vista only
				var s = new ActiveXObject('UserAccounts.CommonDialog');
				s.Filter='All files|*.*|Text files|*.txt|HTML files|*.htm;*.html|';
				s.FilterIndex=(defExt=='txt')?2:3; // default to HTML files;
				s.InitialDir=path;
				s.FileName=file;
				if (s.showOpen()) var result=s.FileName;
			}
			catch(e) { var result=prompt(msg,path+file); } // fallback for non-XP IE
		}
		return result;
	},
	plainTextHeader:
		 'Source:\n\t%0\n'
		+'Title:\n\t%1\n'
		+'Subtitle:\n\t%2\n'
		+'Created:\n\t%3 by %4\n'
		+'Application:\n\tTiddlyWiki %5 / %6 %7\n\n',
	plainTextTiddler:
		'- - - - - - - - - - - - - - -\n'
		+'|     title: %0\n'
		+'|   created: %1\n'
		+'|  modified: %2\n'
		+'| edited by: %3\n'
		+'|      tags: %4\n'
		+'- - - - - - - - - - - - - - -\n'
		+'%5\n',
	plainTextFooter:
		'',
	newsFeedHeader:
		 '&lt;'+'?xml version=&quot;1.0&quot;?'+'&gt;\n'
		+'&lt;rss version=&quot;2.0&quot;&gt;\n'
		+'&lt;channel&gt;\n'
		+'&lt;title&gt;%1&lt;/title&gt;\n'
		+'&lt;link&gt;%0&lt;/link&gt;\n'
		+'&lt;description&gt;%2&lt;/description&gt;\n'
		+'&lt;language&gt;en-us&lt;/language&gt;\n'
		+'&lt;copyright&gt;Copyright '+(new Date().getFullYear())+' %4&lt;/copyright&gt;\n'
		+'&lt;pubDate&gt;%3&lt;/pubDate&gt;\n'
		+'&lt;lastBuildDate&gt;%3&lt;/lastBuildDate&gt;\n'
		+'&lt;docs&gt;http://blogs.law.harvard.edu/tech/rss&lt;/docs&gt;\n'
		+'&lt;generator&gt;TiddlyWiki %5 / %6 %7&lt;/generator&gt;\n',
	newsFeedTiddler:
		'\n%0\n',
	newsFeedFooter:
		'&lt;/channel&gt;&lt;/rss&gt;',
	pureStoreHeader:
		 '&lt;html&gt;&lt;body&gt;'
		+'&lt;style type=&quot;text/css&quot;&gt;'
		+'	#storeArea {display:block;margin:1em;}'
		+'	#storeArea div {padding:0.5em;margin:1em;border:2px solid black;height:10em;overflow:auto;}'
		+'	#pureStoreHeading {width:100%;text-align:left;background-color:#eeeeee;padding:1em;}'
		+'&lt;/style&gt;'
		+'&lt;div id=&quot;pureStoreHeading&quot;&gt;'
		+'	TiddlyWiki &quot;PureStore&quot; export file&lt;br&gt;'
		+'	Source'+': &lt;b&gt;%0&lt;/b&gt;&lt;br&gt;'
		+'	Title: &lt;b&gt;%1&lt;/b&gt;&lt;br&gt;'
		+'	Subtitle: &lt;b&gt;%2&lt;/b&gt;&lt;br&gt;'
		+'	Created: &lt;b&gt;%3&lt;/b&gt; by &lt;b&gt;%4&lt;/b&gt;&lt;br&gt;'
		+'	TiddlyWiki %5 / %6 %7&lt;br&gt;'
		+'	Notes:&lt;hr&gt;&lt;pre&gt;%8&lt;/pre&gt;'
		+'&lt;/div&gt;'
		+'&lt;div id=&quot;storeArea&quot;&gt;',
	pureStoreTiddler:
		'%0\n%1',
	pureStoreFooter:
		'&lt;/div&gt;&lt;!--POST-BODY-START--&gt;\n&lt;!--POST-BODY-END--&gt;&lt;/body&gt;&lt;/html&gt;',
	assembleFile: function(target,filetype,tids,notes,quiet,overwrite,merge,total) {
		var revised=&quot;&quot;;
		var now = new Date().toLocaleString();
		var src=convertUnicodeToUTF8(document.location.href);
		var title = convertUnicodeToUTF8(wikifyPlain(&quot;SiteTitle&quot;).htmlEncode());
		var subtitle = convertUnicodeToUTF8(wikifyPlain(&quot;SiteSubtitle&quot;).htmlEncode());
		var user = convertUnicodeToUTF8(config.options.txtUserName.htmlEncode());
		var twver = version.major+&quot;.&quot;+version.minor+&quot;.&quot;+version.revision;
		var v=version.extensions.SaveAsPlugin; var pver = v.major+&quot;.&quot;+v.minor+&quot;.&quot;+v.revision;
		var headerargs=[src,title,subtitle,now,user,twver,&quot;SaveAsPlugin&quot;,pver,notes];
		switch (filetype) {
			case this.type_TX: // plain text
				var header=this.plainTextHeader.format(headerargs);
				var footer=this.plainTextFooter;
				break;
			case this.type_CS: // comma-separated
				var fields={};
				for (var i=0; i&lt;tids.length; i++) for (var f in tids[i].fields) fields[f]=f;
				var names=['title','created','modified','modifier','tags','text'];
				for (var f in fields) names.push(f);
				var header=names.join(',')+'\n';
				var footer='';
				break;
			case this.type_NF: // news feed (XML)
				headerargs[0]=store.getTiddlerText(&quot;SiteUrl&quot;,&quot;&quot;);
				var header=this.newsFeedHeader.format(headerargs);
				var footer=this.newsFeedFooter;
				break;
			case this.type_PS: // PureStore (no code)
				var header=this.pureStoreHeader.format(headerargs);
				var footer=this.pureStoreFooter;
				break;
			case this.type_TW: // full TiddlyWiki
			default:
				var currPath=getLocalPath(window.location.href);
				var original=loadFile(currPath);
				if (!original) { alert(config.messages.cantSaveError); return; }
				var posDiv = locateStoreArea(original);
				if (!posDiv) { alert(config.messages.invalidFileError.format([currPath])); return; }
				var header = original.substr(0,posDiv[0]+startSaveArea.length)+&quot;\n&quot;;
				var footer = &quot;\n&quot;+original.substr(posDiv[1]);
				break;
		}
		var out=this.getData(target,filetype,tids,quiet,overwrite,merge,fields);
		var revised = header+convertUnicodeToUTF8(out.join(&quot;\n&quot;))+footer;
		// if full TW, insert page title and language attr, and reset MARKUP blocks as needed...
		if (filetype==this.type_TW) {
			var newSiteTitle=convertUnicodeToUTF8(getPageTitle()).htmlEncode();
			revised=revised.replaceChunk(&quot;&lt;title&quot;+&quot;&gt;&quot;,&quot;&lt;/title&quot;+&quot;&gt;&quot;,&quot; &quot; + newSiteTitle + &quot; &quot;);
			revised=updateLanguageAttribute(revised);
			var titles=[]; for (var i=0; i&lt;tids.length; i++) titles.push(tids[i].title);
			revised=updateMarkupBlock(revised,&quot;PRE-HEAD&quot;,
				titles.contains(&quot;MarkupPreHead&quot;)? &quot;MarkupPreHead&quot; :null);
			revised=updateMarkupBlock(revised,&quot;POST-HEAD&quot;,
				titles.contains(&quot;MarkupPostHead&quot;)?&quot;MarkupPostHead&quot;:null);
			revised=updateMarkupBlock(revised,&quot;PRE-BODY&quot;,
				titles.contains(&quot;MarkupPreBody&quot;)? &quot;MarkupPreBody&quot; :null);
			revised=updateMarkupBlock(revised,&quot;POST-SCRIPT&quot;,
				titles.contains(&quot;MarkupPostBody&quot;)?&quot;MarkupPostBody&quot;:null);
		}
		total.val=out.length;
		return revised;
	},
	getData: function(target,filetype,tids,quiet,overwrite,merge,fields) {
		// output selected tiddlers and gather list of titles (for use with merge)
		var out=[]; var titles=[];
		var url=store.getTiddlerText(&quot;SiteUrl&quot;,&quot;&quot;);
		for (var i=0; i&lt;tids.length; i++) {
			out.push(this.formatItem(store,filetype,tids[i],url,fields));
			titles.push(tids[i].title);
		}
		// if TW or PureStore format, ask to merge with existing tiddlers (if any)
		if (filetype==this.type_TW || filetype==this.type_PS) {
			if (overwrite) return out; // skip merge... forced overwrite
			var text=loadFile(target);
			if (text &amp;&amp; text.length) {
				var remoteStore=new TiddlyWiki();
				if (remoteStore.importTiddlyWiki(convertUTF8ToUnicode(text))
					&amp;&amp; (merge||confirm(this.mergeprompt.format([target])))) {
					var existing=remoteStore.getTiddlers(&quot;title&quot;);
					for (var i=0; i&lt;existing.length; i++)
						if (!titles.contains(existing[i].title))
							out.push(this.formatItem(remoteStore,filetype,existing[i],url));
					if (!quiet) displayMessage(this.mergestatus.format([tids.length,out.length-tids.length]));
				}
			}
		}
		return out;
	},
	formatItem: function(s,f,t,u,fields) {
		if (f==this.type_TW)
			var r=s.getSaver().externalizeTiddler(s,t);
		if (f==this.type_PS)
			var r=this.pureStoreTiddler.format([t.title,s.getSaver().externalizeTiddler(s,t)]);
		if (f==this.type_NF)
			var r=this.newsFeedTiddler.format([t.saveToRss(u)]);
		if (f==this.type_TX)
			var r=this.plainTextTiddler.format([t.title, t.created.toLocaleString(), t.modified.toLocaleString(),
				t.modifier, String.encodeTiddlyLinkList(t.tags), t.text]);
		if (f==this.type_CS) {
			function toCSV(t) { return '&quot;'+t.replace(/&quot;/g,'&quot;&quot;')+'&quot;'; } // always encode CSV
			var out=[ toCSV(t.title), toCSV(t.created.toLocaleString()), toCSV(t.modified.toLocaleString()),
				toCSV(t.modifier), toCSV(String.encodeTiddlyLinkList(t.tags)), toCSV(t.text) ];
			for (var f in fields) out.push(toCSV(t.fields[f]||''));
			var r=out.join(',');
		}
		return r||&quot;&quot;;
	}
};
//}}}
//{{{
// automatically add saveAs to backstage
config.tasks.saveAs = {
	text: &quot;saveAs&quot;,
	tooltip: config.macros.saveAs.prompt,
	action: function(){ clearMessage(); config.macros.saveAs.go(); }
}
config.backstageTasks.splice(config.backstageTasks.indexOf(&quot;save&quot;)+1,0,&quot;saveAs&quot;);
//}}}</pre>
</div>
<div title="SaveCloseTiddlerPlugin" modifier="Shankar Swamy" created="200806101331" modified="201207152020" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|SaveCloseTiddlerPlugin|
|Description:|Provides two extra toolbar commands, saveCloseTiddler and cancelCloseTiddler|
|Version:|3.0 ($Rev: 5502 $)|
|Date:|$Date: 2008-06-10 23:31:39 +1000 (Tue, 10 Jun 2008) $|
|Source:|http://mptw.tiddlyspot.com/#SaveCloseTiddlerPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License:|http://mptw.tiddlyspot.com/#TheBSDLicense|
To use these you must add them to the tool bar in your EditTemplate
***/
//{{{
merge(config.commands,{

	saveCloseTiddler: {
		text: 'Save &amp; Close',
		tooltip: 'Save changes to this tiddler and close it',
		handler: function(ev,src,title) {
			var closeTitle = title;
			var newTitle = story.saveTiddler(title,ev.shiftKey);
			if (newTitle)
				closeTitle = newTitle;
			return config.commands.closeTiddler.handler(ev,src,closeTitle);
		}
	},

	cancelCloseTiddler: {
		text: 'Revert &amp; Close',
		tooltip: 'Undo changes to this tiddler and close it',
		handler: function(ev,src,title) {
			// the same as closeTiddler now actually
			return config.commands.closeTiddler.handler(ev,src,title);
		}
	}

});

//}}}</pre>
</div>
<div title="SearchOptions plugin tweaks" modifier="Shankar Swamy" created="200809060149" modified="201211100154" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>//{{{
window.reportSearchResults=function(text,matches)
{
	var title=config.macros.search.reportTitle
	var q = config.options.chkRegExpSearch ? &quot;/&quot; : &quot;'&quot;;
	var body=&quot;\n&quot;;

	// numbered list of links to matching tiddlers
	body+=&quot;\n&lt;&lt;&lt;&quot;;
	for(var t=0;t&lt;matches.length;t++) {
		var date=config.options.chkSearchByDate?(matches[t].modified.formatString('YYYY.0MM.0DD 0hh:0mm')+&quot; &quot;):&quot;&quot;;
		body+=&quot;\n# &quot;+date+&quot;[[&quot;+matches[t].title+&quot;]]&quot;;
	}
	body+=&quot;\n&lt;&lt;&lt;\n&quot;;

	// create/update the tiddler
	var tiddler=store.getTiddler(title); if (!tiddler) tiddler=new Tiddler();
	tiddler.set(title,body,config.options.txtUserName,(new Date()),&quot;excludeLists excludeSearch&quot;);
	store.addTiddler(tiddler); story.closeTiddler(title);

	// use alternate &quot;search again&quot; label in &lt;&lt;search&gt;&gt; macro
	var oldprompt=config.macros.search.label;
	config.macros.search.label=&quot;search again&quot;;

	// render/refresh tiddler
	story.displayTiddler(null,title,1);
	store.notify(title,true);

	// restore standard search label
	config.macros.search.label=oldprompt;

}

//}}}</pre>
</div>
<div title="SearchOptionsPlugin" modifier="Shankar" created="200510181742" modified="201106110056" tags="DiscoveryPackage NavigationPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SearchOptionsPlugin|
|Source|http://www.TiddlyTools.com/#SearchOptionsPlugin|
|Documentation|http://www.TiddlyTools.com/#SearchOptionsPluginInfo|
|Version|3.0.6|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|extend core search function with additional user-configurable options|
Adds extra options to core search function including selecting which data items to search, enabling/disabling incremental key-by-key searches, and generating a ''list of matching tiddlers'' instead of immediately displaying all matches.  This plugin also adds syntax for rendering 'search links' within tiddler content to embed one-click searches using pre-defined 'hard-coded' search terms.
!!!!!Documentation
&gt;see [[SearchOptionsPluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
Search in:
&lt;&lt;option chkSearchTitles&gt;&gt; titles &lt;&lt;option chkSearchText&gt;&gt; text &lt;&lt;option chkSearchTags&gt;&gt; tags &lt;&lt;option chkSearchFields&gt;&gt; fields &lt;&lt;option chkSearchShadows&gt;&gt; shadows
&lt;&lt;option chkSearchHighlight&gt;&gt; Highlight matching text in displayed tiddlers
&lt;&lt;option chkSearchList&gt;&gt; Show list of matches
&lt;&lt;option chkSearchListTiddler&gt;&gt; Write list to [[SearchResults]] tiddler
&lt;&lt;option chkSearchTitlesFirst&gt;&gt; Show title matches first
&lt;&lt;option chkSearchByDate&gt;&gt; Sort matching tiddlers by modification date (most recent first)
&lt;&lt;option chkIncrementalSearch&gt;&gt; Incremental key-by-key search: {{twochar{&lt;&lt;option txtIncrementalSearchMin&gt;&gt;}}} or more characters,  {{threechar{&lt;&lt;option txtIncrementalSearchDelay&gt;&gt;}}} msec delay
&lt;&lt;option chkSearchOpenTiddlers&gt;&gt; Search only in tiddlers that are currently displayed
&lt;&lt;option chkSearchExcludeTags&gt;&gt; Exclude tiddlers tagged with: &lt;&lt;option txtSearchExcludeTags&gt;&gt;
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.09.22 [3.0.6] in TiddlyWiki.prototype.search, added 'match' param for core compatibility
2009.01.16 [3.0.5] added chkSearchOpenTiddlers option to limit searches to displayed tiddlers only
|please see [[SearchOptionsPluginInfo]] for additional revision details|
2005.10.18 [1.0.0] Initial Release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.SearchOptionsPlugin= {major: 3, minor: 0, revision: 6, date: new Date(2009,9,22)};

var defaults={
	chkSearchTitles:	true,
	chkSearchText:		true,
	chkSearchTags:		true,
	chkSearchFields:	true,
	chkSearchTitlesFirst:	true,
	chkSearchList:		true,
	chkSearchHighlight:	true,
	chkSearchListTiddler:	false,
	chkSearchByDate:	false,
	chkIncrementalSearch:	true,
	chkSearchShadows:	true,
	chkSearchOpenTiddlers:	false,
	chkSearchExcludeTags:	true,
	txtSearchExcludeTags:	'excludeSearch',
	txtIncrementalSearchDelay:	500,
	txtIncrementalSearchMin:	3
}; for (var id in defaults) if (config.options[id]===undefined)
	config.options[id]=defaults[id];

if (config.macros.search.reportTitle==undefined)
	config.macros.search.reportTitle=&quot;SearchResults&quot;; // note: not a cookie!
config.macros.search.label+=&quot;\xa0&quot;; // a little bit of space just because it looks better
//}}}
// // searchLink: {{{[search[text to find]] OR [search[text to display|text to find]]}}}
//{{{
config.formatters.push( {
	name: &quot;searchLink&quot;,
	match: &quot;\\[search\\[&quot;,
	lookaheadRegExp: /\[search\[(.*?)(?:\|(.*?))?\]\]/mg,
	prompt: &quot;search for: '%0'&quot;,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch &amp;&amp; lookaheadMatch.index == w.matchStart) {
			var label=lookaheadMatch[1];
			var text=lookaheadMatch[2]||label;
			var prompt=this.prompt.format([text]);
			var btn=createTiddlyButton(w.output,label,prompt,
				function(){story.search(this.getAttribute(&quot;searchText&quot;))},&quot;searchLink&quot;);
			btn.setAttribute(&quot;searchText&quot;,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
});
//}}}
// // incremental search uses option settings instead of hard-coded delay and minimum input values
//{{{
var fn=config.macros.search.onKeyPress;
fn=fn.toString().replace(/500/g, &quot;config.options.txtIncrementalSearchDelay||500&quot;);
fn=fn.toString().replace(/&gt; 2/g, &quot;&gt;=(config.options.txtIncrementalSearchMin||3)&quot;);
eval(&quot;config.macros.search.onKeyPress=&quot;+fn);
//}}}
// // REPLACE story.search() for option to &quot;show search results in a list&quot;
//{{{
Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	var co=config.options; // abbrev
	var re=new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? &quot;mg&quot; : &quot;img&quot;);
	if (config.options.chkSearchHighlight) highlightHack=re;
	var matches = store.search(re,co.chkSearchByDate?&quot;modified&quot;:&quot;title&quot;,&quot;&quot;);
	if (co.chkSearchByDate) matches=matches.reverse(); // most recent first
	var q = useRegExp ? &quot;/&quot; : &quot;'&quot;;
	clearMessage();
	if (!matches.length) {
		if (co.chkSearchListTiddler) discardSearchResults();
		displayMessage(config.macros.search.failureMsg.format([q+text+q]));
	} else {
		if (co.chkSearchList||co.chkSearchListTiddler) 
			reportSearchResults(text,matches);
		else {
			var titles = []; for(var t=0; t&lt;matches.length; t++) titles.push(matches[t].title);
			this.closeAllTiddlers(); story.displayTiddlers(null,titles);
			displayMessage(config.macros.search.successMsg.format([matches.length, q+text+q]));
		}
	}
	highlightHack = null;
}
//}}}
// // REPLACE store.search() for enhanced searching/sorting options
//{{{
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var co=config.options; // abbrev
	var tids = this.reverseLookup(&quot;tags&quot;,excludeTag,!!match,sortField);
	var opened=[]; story.forEachTiddler(function(tid,elem){opened.push(tid);});

	// eliminate tiddlers tagged with excluded tags
	if (co.chkSearchExcludeTags&amp;&amp;co.txtSearchExcludeTags.length) {
		var ex=co.txtSearchExcludeTags.readBracketedList();
		var temp=[]; for(var t=tids.length-1; t&gt;=0; t--)
			if (!tids[t].tags.containsAny(ex)) temp.push(tids[t]);
		tids=temp;
	}

	// scan for matching titles first...
	var results = [];
	if (co.chkSearchTitles) {
		for(var t=0; t&lt;tids.length; t++) {
			if (co.chkSearchOpenTiddlers &amp;&amp; !opened.contains(tids[t].title)) continue; 
			if(tids[t].title.search(searchRegExp)!=-1) results.push(tids[t]);
		}
		if (co.chkSearchShadows)
			for (var t in config.shadowTiddlers) {
				if (co.chkSearchOpenTiddlers &amp;&amp; !opened.contains(t)) continue; 
				if ((t.search(searchRegExp)!=-1) &amp;&amp; !store.tiddlerExists(t))
					results.push((new Tiddler()).assign(t,config.shadowTiddlers[t]));
			}
	}
	// then scan for matching text, tags, or field data
	for(var t=0; t&lt;tids.length; t++) {
		if (co.chkSearchOpenTiddlers &amp;&amp; !opened.contains(tids[t].title)) continue; 
		if (co.chkSearchText &amp;&amp; tids[t].text.search(searchRegExp)!=-1)
			results.pushUnique(tids[t]);
		if (co.chkSearchTags &amp;&amp; tids[t].tags.join(&quot; &quot;).search(searchRegExp)!=-1)
			results.pushUnique(tids[t]);
		if (co.chkSearchFields &amp;&amp; store.forEachField!=undefined)
			store.forEachField(tids[t],
				function(tid,field,val) {
					if (val.search(searchRegExp)!=-1) results.pushUnique(tids[t]);
				},
				true); // extended fields only
	}
	// then check for matching text in shadows
	if (co.chkSearchShadows)
		for (var t in config.shadowTiddlers) {
			if (co.chkSearchOpenTiddlers &amp;&amp; !opened.contains(t)) continue; 
			if ((config.shadowTiddlers[t].search(searchRegExp)!=-1) &amp;&amp; !store.tiddlerExists(t))
				results.pushUnique((new Tiddler()).assign(t,config.shadowTiddlers[t]));
		}

	// if not 'titles first', or sorting by modification date,
	// re-sort results to so titles, text, tag and field matches are mixed together
	if(!sortField) sortField = &quot;title&quot;;
	var bySortField=function(a,b){
		if(a[sortField]==b[sortField])return(0);else return(a[sortField]&lt;b[sortField])?-1:+1;
	}
	if (!co.chkSearchTitlesFirst || co.chkSearchByDate) results.sort(bySortField);

	return results;
}
//}}}
// // HIJACK core {{{&lt;&lt;search&gt;&gt;}}} macro to add &quot;report&quot; and &quot;simple inline&quot; output
//{{{
config.macros.search.SOP_handler=config.macros.search.handler;
config.macros.search.handler = function(place,macroName,params)
{
	// if &quot;report&quot;, use SearchOptionsPlugin report generator for inline output
	if (params[1]&amp;&amp;params[1].substr(0,6)==&quot;report&quot;) {
		var keyword=params[0];
		var options=params[1].split(&quot;=&quot;)[1]; // split &quot;report=option+option+...&quot;
		var heading=params[2]?params[2].unescapeLineBreaks():&quot;&quot;;
		var matches=store.search(new RegExp(keyword.escapeRegExp(),&quot;img&quot;),&quot;title&quot;,&quot;excludeSearch&quot;);
		if (matches.length) wikify(heading+window.formatSearchResults(keyword,matches,options),place);
	} else if (params[1]) {
		var keyword=params[0];
		var heading=params[1]?params[1].unescapeLineBreaks():&quot;&quot;;
		var seperator=params[2]?params[2].unescapeLineBreaks():&quot;, &quot;;
		var matches=store.search(new RegExp(keyword.escapeRegExp(),&quot;img&quot;),&quot;title&quot;,&quot;excludeSearch&quot;);
		if (matches.length) {
			var out=[];
			for (var m=0; m&lt;matches.length; m++) out.push(&quot;[[&quot;+matches[m].title+&quot;]]&quot;);
			wikify(heading+out.join(seperator),place);
		}
	} else
		config.macros.search.SOP_handler.apply(this,arguments);
};
//}}}
// // SearchResults panel handling
//{{{
setStylesheet(&quot;.searchResults { padding:1em 1em 0 1em; }&quot;,&quot;searchResults&quot;); // matches std tiddler padding

config.macros.search.createPanel=function(text,matches,body) {

	function getByClass(e,c) { var d=e.getElementsByTagName(&quot;div&quot;);
		for (var i=0;i&lt;d.length;i++) if (hasClass(d[i],c)) return d[i]; }
	var panel=createTiddlyElement(null,&quot;div&quot;,&quot;searchPanel&quot;,&quot;searchPanel&quot;);
	this.renderPanel(panel,text,matches,body);
	var oldpanel=document.getElementById(&quot;searchPanel&quot;);
	if (!oldpanel) { // insert new panel just above tiddlers
		var da=document.getElementById(&quot;displayArea&quot;);
		da.insertBefore(panel,da.firstChild);
	} else { // if panel exists
		var oldwrap=getByClass(oldpanel,&quot;searchResults&quot;);
		var newwrap=getByClass(panel,&quot;searchResults&quot;);
		// if no prior content, just insert new content
		if (!oldwrap) oldpanel.insertBefore(newwrap,null);
		else {	// swap search results content but leave containing panel intact
			oldwrap.style.display='block'; // unfold wrapper if needed
			var i=oldwrap.getElementsByTagName(&quot;input&quot;)[0]; // get input field
			if (i) { var pos=this.getCursorPos(i); i.onblur=null; } // get cursor pos, ignore blur
			oldpanel.replaceChild(newwrap,oldwrap);
			panel=oldpanel; // use existing panel
		} 
	}
	this.showPanel(true,pos);
	return panel;
}

config.macros.search.renderPanel=function(panel,text,matches,body) {

	var wrap=createTiddlyElement(panel,&quot;div&quot;,null,&quot;searchResults&quot;);
	wrap.onmouseover = function(e){ addClass(this,&quot;selected&quot;); }
	wrap.onmouseout = function(e){ removeClass(this,&quot;selected&quot;); }
	// create toolbar: &quot;open all&quot;, &quot;fold/unfold&quot;, &quot;close&quot;
	var tb=createTiddlyElement(wrap,&quot;div&quot;,null,&quot;toolbar&quot;);
	var b=createTiddlyButton(tb, &quot;open all&quot;, &quot;open all matching tiddlers&quot;, function() {
		story.displayTiddlers(null,this.getAttribute(&quot;list&quot;).readBracketedList()); return false; },&quot;button&quot;);
	var list=&quot;&quot;; for(var t=0;t&lt;matches.length;t++) list+='[['+matches[t].title+']] ';
	b.setAttribute(&quot;list&quot;,list);
	var b=createTiddlyButton(tb, &quot;fold&quot;, &quot;toggle display of search results&quot;, function() {
		config.macros.search.foldPanel(this); return false; },&quot;button&quot;);
	var b=createTiddlyButton(tb, &quot;close&quot;, &quot;dismiss search results&quot;,	function() {
		config.macros.search.showPanel(false); return false; },&quot;button&quot;);
	createTiddlyText(createTiddlyElement(wrap,&quot;div&quot;,null,&quot;title&quot;),&quot;Search for: &quot;+text); // title
	wikify(body,createTiddlyElement(wrap,&quot;div&quot;,null,&quot;viewer&quot;)); // report
	return panel;
}

config.macros.search.showPanel=function(show,pos) {
	var panel=document.getElementById(&quot;searchPanel&quot;);
	var i=panel.getElementsByTagName(&quot;input&quot;)[0];
	i.onfocus=show?function(){config.macros.search.stayFocused(true);}:null;
	i.onblur=show?function(){config.macros.search.stayFocused(false);}:null;
	if (show &amp;&amp; panel.style.display==&quot;block&quot;) { // if shown, grab focus, restore cursor
		if (i&amp;&amp;this.stayFocused()) { i.focus(); this.setCursorPos(i,pos); }
		return;
	}
	if(!config.options.chkAnimate) {
		panel.style.display=show?&quot;block&quot;:&quot;none&quot;;
		if (!show) { removeChildren(panel); config.macros.search.stayFocused(false); }
	} else {
		var s=new Slider(panel,show,false,show?&quot;none&quot;:&quot;children&quot;);
		s.callback=function(e,p){e.style.overflow=&quot;visible&quot;;}
		anim.startAnimating(s);
	}
	return panel;
}

config.macros.search.foldPanel=function(button) {
	var d=document.getElementById(&quot;searchPanel&quot;).getElementsByTagName(&quot;div&quot;);
	for (var i=0;i&lt;d.length;i++) if (hasClass(d[i],&quot;viewer&quot;)) var v=d[i]; if (!v) return;
	var show=v.style.display==&quot;none&quot;;
	if(!config.options.chkAnimate)
		v.style.display=show?&quot;block&quot;:&quot;none&quot;;
	else {
		var s=new Slider(v,show,false,&quot;none&quot;);
		s.callback=function(e,p){e.style.overflow=&quot;visible&quot;;}
		anim.startAnimating(s);
	}
	button.innerHTML=show?&quot;fold&quot;:&quot;unfold&quot;;
	return false;
}

config.macros.search.stayFocused=function(keep) { // TRUE/FALSE=set value, no args=get value
	if (keep===undefined) return this.keepReportInFocus;
	this.keepReportInFocus=keep;
	return keep
}	

config.macros.search.getCursorPos=function(i) {
	var s=0; var e=0; if (!i) return { start:s, end:e };
	try {
		if (i.setSelectionRange) // FF
			{ s=i.selectionStart; e=i.selectionEnd; }
		if (document.selection &amp;&amp; document.selection.createRange) { // IE
			var r=document.selection.createRange().duplicate();
			var len=r.text.length; s=0-r.moveStart('character',-100000); e=s+len;
		}
	}catch(e){};
	return { start:s, end:e };
}
config.macros.search.setCursorPos=function(i,pos) {
	if (!i||!pos) return; var s=pos.start; var e=pos.end;
	if (i.setSelectionRange) //FF
		i.setSelectionRange(s,e);
	if (i.createTextRange) // IE
		{ var r=i.createTextRange(); r.collapse(true); r.moveStart(&quot;character&quot;,s); r.select(); }
}
//}}}
// // SearchResults report generation
// note: these functions are defined globally, so they can be more easily redefined to customize report formats//
//{{{
if (!window.reportSearchResults) window.reportSearchResults=function(text,matches)
{
	var cms=config.macros.search; // abbrev
	var body=window.formatSearchResults(text,matches);
	if (!config.options.chkSearchListTiddler) // show #searchResults panel
		window.scrollTo(0,ensureVisible(cms.createPanel(text,matches,body)));
	else { // write [[SearchResults]] tiddler
		var title=cms.reportTitle;
		var who=config.options.txtUserName;
		var when=new Date();
		var tags=&quot;excludeLists excludeSearch temporary&quot;;
		var tid=store.getTiddler(title); if (!tid) tid=new Tiddler();
		tid.set(title,body,who,when,tags);
		store.addTiddler(tid);
		story.closeTiddler(title);
		story.displayTiddler(null,title);
	}
}

if (!window.formatSearchResults) window.formatSearchResults=function(text,matches,opt)
{
	var body='';
	var title=config.macros.search.reportTitle
	var q = config.options.chkRegExpSearch ? &quot;/&quot; : &quot;'&quot;;
	if (!opt) var opt=&quot;all&quot;;
	var parts=opt.split(&quot;+&quot;);
	for (var i=0; i&lt;parts.length; i++) { var p=parts[i].toLowerCase();
		if (p==&quot;again&quot;||p==&quot;all&quot;)   body+=window.formatSearchResults_again(text,matches);
		if (p==&quot;summary&quot;||p==&quot;all&quot;) body+=window.formatSearchResults_summary(text,matches);
		if (p==&quot;list&quot;||p==&quot;all&quot;)    body+=window.formatSearchResults_list(text,matches);
		if (p==&quot;buttons&quot;||p==&quot;all&quot;) body+=window.formatSearchResults_buttons(text,matches);
	}
	return body;
}

if (!window.formatSearchResults_again) window.formatSearchResults_again=function(text,matches)
{
	var title=config.macros.search.reportTitle
	var body='';
	// search again
	body+='{{span{&lt;&lt;search &quot;'+text.replace(/&quot;/g,'&amp;#x22;')+'&quot;&gt;&gt; /%\n';
	body+='%/&lt;html&gt;&lt;input type=&quot;button&quot; value=&quot;search again&quot;';
	body+=' onclick=&quot;var t=this.parentNode.parentNode.getElementsByTagName(\'input\')[0];';
	body+=' config.macros.search.doSearch(t); return false;&quot;&gt;';
	body+=' &lt;a href=&quot;javascript:;&quot; onclick=&quot;';
	body+=' var e=this.parentNode.nextSibling;';
	body+=' var show=e.style.display!=\'block\';';
	body+=' if(!config.options.chkAnimate) e.style.display=show?\'block\':\'none\';';
	body+=' else anim.startAnimating(new Slider(e,show,false,\'none\'));';
	body+=' return false;&quot;&gt;options...&lt;/a&gt;';
	body+='&lt;/html&gt;@@display:none;border-left:1px dotted;margin-left:1em;padding:0;padding-left:.5em;font-size:90%;/%\n';
	body+='	%/&lt;&lt;option chkSearchTitles&gt;&gt;titles /%\n';
	body+='	%/&lt;&lt;option chkSearchText&gt;&gt;text /%\n';
	body+='	%/&lt;&lt;option chkSearchTags&gt;&gt;tags /%\n';
	body+='	%/&lt;&lt;option chkSearchFields&gt;&gt;fields /%\n';
	body+='	%/&lt;&lt;option chkSearchShadows&gt;&gt;shadows\n';
	body+='	&lt;&lt;option chkCaseSensitiveSearch&gt;&gt;case-sensitive /%\n';
	body+='	%/&lt;&lt;option chkRegExpSearch&gt;&gt;text patterns /%\n';
	body+='	%/&lt;&lt;option chkSearchByDate&gt;&gt;sorted by date\n';
	body+='	&lt;&lt;option chkSearchHighlight&gt;&gt; highlight matching text in displayed tiddlers\n';
	body+='	&lt;&lt;option chkIncrementalSearch&gt;&gt;incremental key-by-key search: /%\n';
	body+='	%/{{twochar{&lt;&lt;option txtIncrementalSearchMin&gt;&gt;}}} or more characters, /%\n';
	body+='	%/{{threechar{&lt;&lt;option txtIncrementalSearchDelay&gt;&gt;}}} msec delay\n';
	body+='	&lt;&lt;option chkSearchOpenTiddlers&gt;&gt; search only in tiddlers that are currently displayed\n';
	body+='	&lt;&lt;option chkSearchExcludeTags&gt;&gt;exclude tiddlers tagged with:\n';
	body+='	{{editor{&lt;&lt;option txtSearchExcludeTags&gt;&gt;}}}/%\n';
	body+='%/@@}}}\n\n';
	return body;
}

if (!window.formatSearchResults_summary) window.formatSearchResults_summary=function(text,matches)
{
	// summary: nn tiddlers found matching '...', options used
	var body='';
	var co=config.options; // abbrev
	var title=config.macros.search.reportTitle
	var q = co.chkRegExpSearch ? &quot;/&quot; : &quot;'&quot;;
	body+=&quot;''&quot;+config.macros.search.successMsg.format([matches.length,q+&quot;{{{&quot;+text+&quot;}}}&quot;+q])+&quot;''\n&quot;;
	var opts=[];
	if (co.chkSearchTitles) opts.push(&quot;titles&quot;);
	if (co.chkSearchText) opts.push(&quot;text&quot;);
	if (co.chkSearchTags) opts.push(&quot;tags&quot;);
	if (co.chkSearchFields) opts.push(&quot;fields&quot;);
	if (co.chkSearchShadows) opts.push(&quot;shadows&quot;);
	if (co.chkSearchOpenTiddlers) body+=&quot;^^//search limited to displayed tiddlers only//^^\n&quot;;
	body+=&quot;~~&amp;nbsp; searched in &quot;+opts.join(&quot; + &quot;)+&quot;~~\n&quot;;
	body+=(co.chkCaseSensitiveSearch||co.chkRegExpSearch?&quot;^^&amp;nbsp; using &quot;:&quot;&quot;)
		+(co.chkCaseSensitiveSearch?&quot;case-sensitive &quot;:&quot;&quot;)
		+(co.chkRegExpSearch?&quot;pattern &quot;:&quot;&quot;)
		+(co.chkCaseSensitiveSearch||co.chkRegExpSearch?&quot;matching^^\n&quot;:&quot;&quot;);
	return body;
}

if (!window.formatSearchResults_list) window.formatSearchResults_list=function(text,matches)
{
	// bullet list of links to matching tiddlers
	var body='';
	var pattern=co.chkRegExpSearch?text:text.escapeRegExp();
	var sensitive=co.chkCaseSensitiveSearch?&quot;mg&quot;:&quot;img&quot;;
	var link='{{tiddlyLinkExisting{&lt;html&gt;&lt;nowiki&gt;&lt;a href=&quot;javascript:;&quot; onclick=&quot;'
		+'if(config.options.chkSearchHighlight)'
		+'	highlightHack=new RegExp(\x27'+pattern+'\x27.escapeRegExp(),\x27'+sensitive+'\x27);'
		+'story.displayTiddler(null,\x27%0\x27);'
		+'highlightHack = null; return false;'
		+'&quot; title=&quot;%2&quot;&gt;%1&lt;/a&gt;&lt;/html&gt;}}}';
	for(var t=0;t&lt;matches.length;t++) {
		body+=&quot;* &quot;;
		if (config.options.chkSearchByDate)
			body+=matches[t].modified.formatString('YYYY.0MM.0DD 0hh:0mm')+&quot; &quot;;
		var title=matches[t].title;
		var fixup=title.replace(/'/g,&quot;\\x27&quot;).replace(/&quot;/g,&quot;\\x22&quot;);
		var tid=store.getTiddler(title);
		var tip=tid?tid.getSubtitle():''; tip=tip.replace(/&quot;/g,&quot;&amp;quot;&quot;);
		body+=link.format([fixup,title,tip])+'\n';
	}
	return body;
}

if (!window.formatSearchResults_buttons) window.formatSearchResults_buttons=function(text,matches)
{
	// embed buttons only if writing SearchResults to tiddler
	if (!config.options.chkSearchListTiddler) return &quot;&quot;;
	// &quot;open all&quot; button
	var title=config.macros.search.reportTitle;
	var body=&quot;&quot;;
	body+=&quot;@@diplay:block;&lt;html&gt;&lt;input type=\&quot;button\&quot; href=\&quot;javascript:;\&quot; &quot;
		+&quot;onclick=\&quot;story.displayTiddlers(null,[&quot;;
	for(var t=0;t&lt;matches.length;t++)
		body+=&quot;'&quot;+matches[t].title.replace(/\'/mg,&quot;\\'&quot;)+&quot;'&quot;+((t&lt;matches.length-1)?&quot;, &quot;:&quot;&quot;);
	body+=&quot;],1);\&quot; accesskey=\&quot;O\&quot; value=\&quot;open all matching tiddlers\&quot;&gt;&lt;/html&gt; &quot;;
	// &quot;discard SearchResults&quot; button
	body+=&quot;&lt;html&gt;&lt;input type=\&quot;button\&quot; href=\&quot;javascript:;\&quot; &quot;
		+&quot;onclick=\&quot;discardSearchResults()\&quot; value=\&quot;discard &quot;+title+&quot;\&quot;&gt;&lt;/html&gt;&quot;;
	body+=&quot;@@\n&quot;;
	return body;
}

if (!window.discardSearchResults) window.discardSearchResults=function()
{
	// remove the tiddler
	story.closeTiddler(config.macros.search.reportTitle);
	store.deleteTiddler(config.macros.search.reportTitle);
	store.notify(config.macros.search.reportTitle,true);
}
//}}}</pre>
</div>
<div title="SearchOptionsPlugin tweaks" modifier="Shankar Swamy" created="200809200020" modified="201211100154" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>//{{{
window.reportSearchResults=function(text,matches)
{
	var title=config.macros.search.reportTitle
	var q = config.options.chkRegExpSearch ? &quot;/&quot; : &quot;'&quot;;
	var body=&quot;\n&quot;;

	// numbered list of links to matching tiddlers
	body+=&quot;\n&lt;&lt;&lt;&quot;;
	for(var t=0;t&lt;matches.length;t++) {
		var date=config.options.chkSearchByDate?(matches[t].modified.formatString('YYYY.0MM.0DD 0hh:0mm')+&quot; &quot;):&quot;&quot;;
		body+=&quot;\n# &quot;+date+&quot;[[&quot;+matches[t].title+&quot;]]&quot;;
	}
	body+=&quot;\n&lt;&lt;&lt;\n&quot;;

	// create/update the tiddler
	var tiddler=store.getTiddler(title); if (!tiddler) tiddler=new Tiddler();
	tiddler.set(title,body,config.options.txtUserName,(new Date()),&quot;excludeLists excludeSearch&quot;);
	store.addTiddler(tiddler); story.closeTiddler(title);

	// use alternate &quot;search again&quot; label in &lt;&lt;search&gt;&gt; macro
	var oldprompt=config.macros.search.label;
	config.macros.search.label=&quot;search again&quot;;

	// render/refresh tiddler
	story.displayTiddler(null,title,1);
	store.notify(title,true);

	// restore standard search label
	config.macros.search.label=oldprompt;

}

//}}}</pre>
</div>
<div title="SearchOptionsPlugin tweaks(without search again)" modifier="YourName" created="200809200020" modified="200909151532" tags="systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>//{{{
window.reportSearchResults=function(text,matches)
{
	var title=config.macros.search.reportTitle
	var q = config.options.chkRegExpSearch ? &quot;/&quot; : &quot;'&quot;;
	var body=&quot;\n&quot;;

	// numbered list of links to matching tiddlers
	body+=&quot;\n&lt;&lt;&lt;&quot;;
	for(var t=0;t&lt;matches.length;t++) {
		var date=config.options.chkSearchByDate?(matches[t].modified.formatString('YYYY.0MM.0DD 0hh:0mm')+&quot; &quot;):&quot;&quot;;
		body+=&quot;\n# &quot;+date+&quot;[[&quot;+matches[t].title+&quot;]]&quot;;
	}
	body+=&quot;\n&lt;&lt;&lt;\n&quot;;

	// create/update the tiddler
	var tiddler=store.getTiddler(title); if (!tiddler) tiddler=new Tiddler();
	tiddler.set(title,body,config.options.txtUserName,(new Date()),&quot;excludeLists excludeSearch&quot;);
	store.addTiddler(tiddler); story.closeTiddler(title);

	// render/refresh tiddler
	story.displayTiddler(null,title,1);
	store.notify(title,true);

	// restore standard search label
	config.macros.search.label=oldprompt;

}

//}}}</pre>
</div>
<div title="SearchOptionsPluginInfo" modifier="Shankar" created="200801090140" modified="200912301630" tags="pluginInfo excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SearchOptionsPluginInfo|
|Source|http://www.TiddlyTools.com/#SearchOptionsPlugin|
|Documentation|http://www.TiddlyTools.com/#SearchOptionsPluginInfo|
|Version|3.0.5|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|documentation|
|Description|Documentation for SearchOptionsPlugin|
Extend core search function with additional user-configurable options including selecting which data items to search, enabling/disabling incremental key-by-key searches, and generating a ''list of matching tiddler'' instead of immediately displaying all matches.  This plugin also adds syntax for rendering 'search links' within tiddler content to embed one-click searches using pre-defined 'hard-coded' search terms.
!!!!!Search link Syntax
&lt;&lt;&lt;
To insert a 'search link' into tiddler content, you can write:
{{{
[search[text to find]]
}}}
or
{{{
[search[text to display|text to find]]
}}}
Clicking on the resulting search link will trigger the search functionality, just as if the specified 'text to find' had been entered into the standard search input field usually displayed in the document sidebar.
&lt;&lt;&lt;
!!!!!Inline output: search macro syntax
&lt;&lt;&lt;
Alternatively, to embed search results lists directly into your tiddler content, you can use:
{{{
&lt;&lt;search &quot;text&quot; report&gt;&gt; (report is a literal keyword)
&lt;&lt;search &quot;text&quot; &quot;heading&quot; &quot;separator&quot;&gt;&gt; (simple inline generator)
}}}
&lt;&lt;&lt;
!!!!!Inline output examples:
&lt;&lt;&lt;
*+++*[&amp;lt;&amp;lt;search &quot;wood&quot;&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot;&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; &quot;/%%/&quot;&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; &quot;/%%/&quot;&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; &quot;See also: &quot;&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; &quot;See also: &quot;&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; &quot;See also:\n*&quot; &quot;\n*&quot;&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; &quot;See also:\n*&quot; &quot;\n*&quot;&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=list &quot;See also:&quot;&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=list &quot;See Also:&quot; &gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=all&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=all&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=summary+buttons+again+list&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=summary+buttons+again+list&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=summary+again&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=summary+again&gt;&gt;
===

*+++*[&amp;lt;&amp;lt;search &quot;wood&quot; report=summary&amp;gt;&amp;gt;]&gt;...
&lt;&lt;search &quot;wood&quot; report=summary&gt;&gt;
===

&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
Search in:
&lt;&lt;option chkSearchTitles&gt;&gt; titles &lt;&lt;option chkSearchText&gt;&gt; text &lt;&lt;option chkSearchTags&gt;&gt; tags &lt;&lt;option chkSearchFields&gt;&gt; fields &lt;&lt;option chkSearchShadows&gt;&gt; shadows
{{{&lt;&lt;option chkSearchTitles&gt;&gt; &lt;&lt;option chkSearchText&gt;&gt; &lt;&lt;option chkSearchTags&gt;&gt;}}}
{{{&lt;&lt;option chkSearchFields&gt;&gt; &lt;&lt;option chkSearchShadows&gt;&gt;}}}
&lt;&lt;option chkSearchHighlight&gt;&gt; Highlight matching text in displayed tiddlers {{{&lt;&lt;option chkSearchHighlight&gt;&gt;}}}
&lt;&lt;option chkSearchList&gt;&gt; Show list of matches {{{&lt;&lt;option chkSearchList&gt;&gt;}}}
&lt;&lt;option chkSearchListTiddler&gt;&gt; Write list to [[SearchResults]] tiddler {{{&lt;&lt;option chkSearchListTiddler&gt;&gt;}}}
&lt;&lt;option chkSearchTitlesFirst&gt;&gt; Show title matches first {{{&lt;&lt;option chkSearchTitlesFirst&gt;&gt;}}}
&lt;&lt;option chkSearchByDate&gt;&gt; Sort matching tiddlers by date {{{&lt;&lt;option chkSearchByDate&gt;&gt;}}}
&lt;&lt;option chkIncrementalSearch&gt;&gt; Incremental key-by-key search: {{twochar{&lt;&lt;option txtIncrementalSearchMin&gt;&gt;}}} or more characters,  {{threechar{&lt;&lt;option txtIncrementalSearchDelay&gt;&gt;}}} msec delay
{{{&lt;&lt;option chkSearchIncremental&gt;&gt; &lt;&lt;option txtSearchIncrementalMin&gt;&gt; &lt;&lt;option txtSearchIncrementalDelay&gt;&gt;}}}
&lt;&lt;option chkSearchOpenTiddlers&gt;&gt; Search only in tiddlers that are currently displayed {{{&lt;&lt;option chkSearchOpenTiddlers&gt;&gt;}}}
&lt;&lt;option chkSearchExcludeTags&gt;&gt; Exclude tiddlers tagged with: &lt;&lt;option txtSearchExcludeTags&gt;&gt;
{{{&lt;&lt;option chkSearchExcludeTags&gt;&gt;}}} {{{&lt;&lt;option txtSearchExcludeTags&gt;&gt;}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.01.16 3.0.5 added chkSearchOpenTiddlers option to limit searches to displayed tiddlers only
2009.01.15 3.0.4 in formatSearchResults_list(), corrected link generation to properly handle single-quotes and double-quotes in tiddler titles
2009.01.09 3.0.3 added chkSearchHighlight to optionally disable highlighting of matched text
2009.01.05 3.0.2 in formatSearchResults_list(), set/clear 'highlightHack' via HTML links so that search term will be highlighted when displaying tiddlers.
2008.10.14 3.0.1 changed panel class from &quot;tiddler&quot; to &quot;searchPanel&quot; and added style definition for &quot;searchPanel&quot;.  Fixes ticket #771 (in IE, links from search results were reporting errors due to &quot;fake&quot; tiddler class wrapper)
2008.10.02 3.0.0 added optional list of tags to use for excluding tiddler from searches (default=&quot;excludeLists&quot;).
2008.09.24 2.9.9 performance improvment to reportSearchResults(): when rendering a real SearchResults tiddler, store.notify() isn't needed since the results tiddler is always explicitly closed and redrawn each time.
2008.09.20 2.9.8 corrected createPanel() and renderPanel() so toolbar will be correctly shown/hidden on mouseover/mouseout.
2008.09.19 2.9.7 fixes to panel handling for IE, Safari, and others.  Changed panel id to #searchPanel and added .searchResults CSS class wrapper around panel content.  Fixed fold/unfold handling.
2008.09.18 2.9.6 refactored panel handling code, added 'fold/unfold' panel toolbar command, added dynamic 'title' (shows search term), added txtIncrementalSearchMin option
2008.09.17 2.9.5 added focus and cursor handling for 'search again' field in #searchResults DIV report so that an incremental key-by-key search doesn't interfere with continuous typing into the field.
2008.09.17 2.9.4 fix 'flicker' when updating #searchResults DIV by wikify()ing to an 'offscreen' DIV and then using replaceChild() instead of using removeChildren() followed by wikify()
2008.09.16 2.9.3 changed report layout, added &quot;search again&quot; and collapsible 'options' section with incremental search checkbox and &quot;txtIncrementalSearchDelay&quot; timer tweak to onKeyPress()
2008.08.25 2.9.2 added animation to search results DIV.  Also, the #searchResults DOM element is only auto-created if it does not exist ... and when closed, the DIV is simply hidden rather than removed.  This allows custom placement of search results report in the PageTemplate definition.
2008.08.23 2.9.1 story column search results uses {{{&lt;&lt;moveablePanel&gt;&gt;}}}
2008.08.22 2.9.0 default is now to show search results at top of story column, similar to FND's SimpleSearchPlugin display, with an option to generate SearchResults tiddler as before.  Also changed 'chkSearchIncremental' to 'chkIncrementalSearch' to match core option variable
2008.08.12 2.8.2 change default for chkSearchByDate back to FALSE, and adjusted &quot;list&quot; and &quot;again&quot; output formats (minor tweaks requested by PhilWhitehouse for use on TiddlyWiki.com)
2008.08.11 2.8.1 changed defaults for chkSearchTitlesFirst, chkSearchList and chkSearchShadows to TRUE to enable enhanced search results output as soon as plugin is installed.
2008.06.21 2.8.0 added extended syntax for {{{&lt;&lt;search &quot;text&quot; report heading&gt;&gt; and &lt;&lt;search &quot;text&quot; &quot;heading&quot; &quot;seperator&quot;&gt;&gt;}}}
2008.05.03 2.7.1 in searchLink formatter handler(), use separate setAttribute() call instead of passing attribs to createTiddlyButton().  Avoids conflict with errant code in TiddlerNotesPlugin (v2.1 26/10/07)
2008.04.29 2.7.0 added searchLink formatter (syntax: {{{[search[text]]}}} or {{{[search[display|text]]}}})
2008.04.08 2.6.2 don't automatically add options to AdvancedOptions shadow tiddler
2007.02.17 2.6.1 added redefinition of config.macros.search.onKeyPress() to restore check to bypass key-by-key searching (i.e., when chkSearchIncremental==false), which had been unintentionally removed with v2.6.0
2007.02.13 2.6.0 remove redefinition of config.macros.search.handler since core now includes handling for ENTER key.
2007.02.08 2.5.1 include 'temporary' tag when creating SearchResults (for use with TemporaryTiddlersPlugin)
2007.01.29 2.5.0 added support for &quot;sort results by date&quot;.  Default is to sort alphabetically (standard).  When sorted by dates, most recent changes are shown first
2006.10.10 2.4.0 added support for &quot;search in tiddler data&quot; (tiddler.fields)  Default is to search extended data.
2006.04.06 2.3.0 added support for &quot;search in shadow tiddlers&quot;.  Default is *not* to search in the shadows (i.e. standard TW behavior).  Note: if a shadow tiddler has a 'real' counterpart, only the real tiddler is searched, since the shadow is inaccessible for viewing/editing.
2006.02.03 2.2.1 rewrite timeout clearing code and blank search text handling to match 2.0.4 core release changes.  note that core no longer permits &quot;blank=all&quot; searches, so neither does this plugin.  To search for all, use &quot;.&quot; with text patterns enabled.
2006.02.02 2.2.0 in search.handler(), KeyHandler() function clears 'left over' timeout when search input is &lt; 3 chars.  Prevents searching on shorter text when shortened by rapid backspaces (&lt;500msec)
2006.02.01 2.1.9 in Story.prototype.search(), correct inverted logic for using/not using regular expressions when searching
also, blank search text now presents &quot;No search text.  Continue anyway?&quot; confirm() message box, so search on blank can still be processed if desired by user.
2006.02.01 2.1.8 in doSearch(), added alert/return if search text is blank
2006.01.20 2.1.7 fixed setting of config.macros.search.reportTitle so that Tweaks can override it.
2006.01.19 2.1.6 improved SearchResults formatting, added a &quot;search again&quot; form to the report (based on a suggestion from MorrisGray)
define results report title using config.macros.search.reportTitle instead of hard-coding the tiddler title
2006.01.18 2.1.5 Created separate functions for reportSearchResults(text,matches) and discardSearchResults(), so that other developers can create alternative report generators.
2006.01.17 2.1.4 Use regExp.search() instead of regExp.test() to scan for matches.  Correctd the problem where only half the matching tiddlers (the odd-numbered ones) were being reported.
2006.01.15 2.1.3 Added information (date/time, username, search options used) to SearchResults output
2006.01.10 2.1.2 use displayTiddlers() to render matched tiddlers.  This lets you display multiple matching tiddlers, even if SinglePageModePlugin is enabled.
2006.01.08 2.1.1 corrected invalid variable reference, &quot;txt.value&quot; to &quot;text&quot; in story.search()
2006.01.08 2.1.0 re-write to match new store.search(), store.search.handler() and story.search() functions.
2005.12.30 2.0.0 Upgraded to TW2.0.  When rendering SearchResults tiddler, closeTiddler() first to ensure display is refreshed.
2005.12.26 1.4.0 added option to search for matching text in tiddler tags
2005.12.21 1.3.7 use \\ to 'escape' single quotes in tiddler titles when generating &quot;Open all matching tiddlers&quot; link.  Also, added access key: &quot;O&quot;, to trigger &quot;open all&quot; link.  Based on a suggestion by UdoBorkowski.
2005.12.18 1.3.6 call displayMessage() AFTER showing matching tiddlers so message is not cleared too soon
2005.12.17 1.3.5 if no matches found, just display message and delete any existing SearchResults tiddler.
2005.12.17 1.3.4 use {/%%/{/%%/{  and }/%%/}/%%/} to 'escape' display text in SearchResults tiddler to ensure that formatting contained in search string is not rendered.  Based on a suggestion by UdoBorkowski.
2005.12.14 1.3.3 tag SearchResults tiddler with 'excludeSearch' so it won't list itself in subsequent searches. Based on a suggestion by UdoBorkowski.
2005.12.14 1.3.2 added &quot;open all matching tiddlers...&quot; link to search results output. Based on a suggestion by UdoBorkowski.
2005.12.10 1.3.1 added &quot;discard search results&quot; link to end of search list tiddler output for quick self-removal of 'SearchResults' tiddler.
2005.12.01 1.3.0 added chkSearchIncremental to enable/disable 'incremental' searching (i.e., search after each keystroke) (default is ENABLED).
added handling for Enter key so it can be used to start a search. Based on a suggestion by LyallPearce
2005.11.25 1.2.1 renamed from SearchTitleOrTextPlugin to SearchOptionsPlugin
2005.11.25 1.2.0 added chkSearchList option.  Based on a suggestion by RodneyGomes
2005.10.19 1.1.0 added chkSearchTitlesFirst option.  Based on a suggestion by ChristianHauck
2005.10.18 1.0.0 Initial Release.  Based on a suggestion by LyallPearce.
&lt;&lt;&lt;</pre>
</div>
<div title="SearchResults" modifier="YourName" created="200911140048" modified="201504142236" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;&lt;
# [[Clarity]]
&lt;&lt;&lt;
</pre>
</div>
<div title="SectionLinksPlugin" modifier="shankar " created="200901061840" modified="200911140256" tags="systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SectionLinksPlugin|
|Source|http://www.TiddlyTools.com/#SectionLinksPlugin|
|Documentation|http://www.TiddlyTools.com/#SectionLinksPlugin|
|Version|1.3.4|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|allow tiddler sections in TiddlyLinks to be used as anchor points|
This plugin enhances the processing of section references so they can be used in links to auto-scroll to the indicated heading within a tiddler (i.e., similar to the 'anchor' behavior provided in HTML by {{{&lt;a name=&quot;foo&quot;&gt;}}} and {{{&lt;a href=&quot;#foo&quot;&gt;...&lt;/a&gt;}}})
!!!Usage
&lt;&lt;&lt;
!!!!!{{{&lt;&lt;tiddler&gt;&gt;}}} macro 
&gt;The {{{&lt;&lt;tiddler SomeTiddler##SomeSection&gt;&gt;}}} syntax has been extended so that when the tiddler title is omitted or the 'here' keyword is used (e.g., {{{&lt;&lt;tiddler ##SomeSection&gt;&gt;}}} or {{{&lt;&lt;tiddler here##SomeSection&gt;&gt;}}}), then the current containing tiddler is implied by default.
!!!!!~TiddlyLink syntax
&gt;the standard link syntax has been extended so that a section name can included in a tiddler link (e.g., {{{[[SomeTiddler##SomeSection]]}}}).  When clicked, the tiddler is displayed and the specified section heading will be automatically scrolled into view. If the tiddler title is omitted or the 'here' keyword is used (e.g., {{{[[##SomeSection]]}}} or {{{[[here##SomeSection]]&gt;&gt;}}}), then the current containing tiddler is implied by default.
!!!!!&quot;&quot;&quot;&lt;&lt;sectionTOC&gt;&gt;&quot;&quot;&quot; macro
&gt;This macro generates a 'Table of Contents'-style numbered-bullet list with links to all sections within the current tiddler.  Simply place the following macro at the //end of the tiddler content// (i.e., following all section headings):
{{{
&lt;&lt;sectionTOC&gt;&gt; or &lt;&lt;sectionTOC className&gt;&gt;
}}}
&gt;Note: The macro must occur at the end of the tiddler in order to locate the rendered section headings that precede it. In addition, to position the macro's //output// within the tiddler, you must create a special 'target element' that uses a specified classname (default='sectionTOC'), like this:
{{{
{{sectionTOC{}}}
}}}
&gt;When the {{{&lt;&lt;sectionTOC&gt;&gt;}}} macro is rendered, it will find the matching 'sectionTOC'-classed element and writes it's output there.  You can also add the macro and/or target elements directly to the [[ViewTemplate]] definition, so that every tiddler can automatically display the table of contents:
{{{
&lt;span class='sectionTOC'&gt;&lt;/span&gt; &lt;!-- target element --&gt;
...
&lt;span macro='sectionTOC'&gt;&lt;/span&gt; &lt;!-- must be at end of tiddler --&gt;
}}}
&lt;&lt;&lt;
!!!Revisions
&lt;&lt;&lt;
2009.08.21 [1.3.4] added handling to ignore leading/trailing whitespace in section references
2009.08.21 [1.3.3] in createTiddlyLink(), add tiddlyLinkNonExistingSection class if matching section is not found
2009.08.14 [1.3.2] in createTiddlyLink(), don't override core value for ~TiddlyLink attribute
2009.08.02 [1.3.1] in sectionTOC.handler(), trim leading/trailing whitespace from generated section links
2009.08.01 [1.3.0] in scrollToSection(), apply 3-tier section matching (exact, startsWith, contains)
2009.07.06 [1.2.2] fixed displayTiddler() hijack
2009.07.03 [1.2.1] in {{{&lt;&lt;sectionTOC&gt;&gt;}}}, suppress output if target is not found
2009.06.02 [1.2.0] added support for 'here' keyword in {{{[[here##section]]}}} links and {{{&lt;&lt;tiddler here##section&gt;&gt;}}} macro
2009.04.09 [1.1.1] in sectionTOC macro, make target visible when TOC is rendered.
2009.01.18 [1.1.0] added {{{&lt;&lt;sectionTOC&gt;&gt;}}} macro to generate numbered-bullet links to sections of current tiddler
2009.01.06 [1.0.0] converted to stand-alone plugin
2008.10.14 [0.0.0] initial release (as [[CoreTweaks]] #784 - http://trac.tiddlywiki.org/ticket/784)
&lt;&lt;&lt;
!!!Code
***/
//{{{
version.extensions.SectionLinksPlugin= {major: 1, minor: 3, revision: 4, date: new Date(2009,8,21)};

Story.prototype.scrollToSection = function(title,section) {
	if (!title||!section) return; var t=this.getTiddler(title); if (!t) return null;
	var elems=t.getElementsByTagName('*'); var heads=[];
	for (var i=0; i&lt;elems.length; i++)
		if (['H1','H2','H3','H4','H5'].contains(elems[i].nodeName)) heads.push(elems[i]);
	for (var i=0; i&lt;heads.length; i++)
		if (getPlainText(heads[i]).trim()==section) break;
	if (i==heads.length) for (var i=0; i&lt;heads.length; i++)
		if (getPlainText(heads[i]).trim().startsWith(section)) break;
	if (i==heads.length) for (var i=0; i&lt;heads.length; i++)
		if (getPlainText(heads[i]).trim().indexOf(section)!=-1) break;
	if (i&lt;heads.length) { var h=heads[i];
		// if section heading is collapsed, click to expand it - see [[FoldHeadingsPlugin]]
		if (hasClass(h,'foldable') &amp;&amp; h.nextSibling.style.display=='none') h.onclick();
		// scroll *after* tiddler animation
		var delay=config.options.chkAnimate?config.animDuration+100:0;
		setTimeout('window.scrollTo('+findPosX(h)+','+findPosY(h)+')',delay);
		return h;
	}
}
//}}}
/***
!!!!core hijacks
***/
/***
!!!!!createTiddlyLink
***/
//{{{
// [[tiddlername##section]] and [[##section]]
if (!window.createTiddlyLink_section)
	window.createTiddlyLink_section=window.createTiddlyLink;
window.createTiddlyLink=function(place,title) {
	var t=story.findContainingTiddler(place); var tid=t?t.getAttribute('tiddler'):'';
	var parts=title.split(config.textPrimitives.sectionSeparator);
	var title=parts[0]; var section=parts[1]; if (section) section=section.trim();
	if (!title.length || title.toLowerCase()=='here') title=tid;  // default=current tiddler
	arguments[1]=title;
	var btn=createTiddlyLink_section.apply(this,arguments);
	if (section) {
		btn.setAttribute('section',section);
		if (store.getTiddlerText(title+config.textPrimitives.sectionSeparator+section)===null)
			addClass(btn,'tiddlyLinkNonExistingSection');
	}
	return btn;
}
//}}}
/***
!!!!!onClickTiddlerLink
***/
//{{{
if (!window.onClickTiddlerLink_section)
	window.onClickTiddlerLink_section=window.onClickTiddlerLink;
window.onClickTiddlerLink=function(ev) {
	var e=ev||window.event;	var target=resolveTarget(e); var title=null;
	while (target!=null &amp;&amp; title==null) {
		title=target.getAttribute('tiddlyLink');
		section=target.getAttribute('section');
		target=target.parentNode;
	} 
	var t=story.findContainingTiddler(target); var tid=t?t.getAttribute('tiddler'):'';
	if (title!=tid||!section) // avoid excess scrolling for intra-tiddler links
		onClickTiddlerLink_section.apply(this,arguments);
	story.scrollToSection(title,section);
	return false;
}
//}}}
/***
!!!!! displayTiddler
***/
//{{{
if (!Story.prototype.displayTiddler_section)
	Story.prototype.displayTiddler_section=Story.prototype.displayTiddler;
Story.prototype.displayTiddler = function(srcElement,tiddler)
{
	var title=(tiddler instanceof Tiddler)?tiddler.title:tiddler;
	var parts=title.split(config.textPrimitives.sectionSeparator);
	var title=parts[0]; var section=parts[1]; if (section) section=section.trim();
	if (!title.length || title.toLowerCase()=='here') {
		var t=story.findContainingTiddler(place);
		title=t?t.getAttribute('tiddler'):'';
	}
	arguments[1]=title;  // default=current tiddler
	this.displayTiddler_section.apply(this,arguments);
	story.scrollToSection(title,section);
}
//}}}
/***
!!!!!isExternalLink
***/
//{{{
if (!config.formatterHelpers.isExternalLink_section)
	config.formatterHelpers.isExternalLink_section=config.formatterHelpers.isExternalLink;
config.formatterHelpers.isExternalLink=function(link) {
	if (link.indexOf(config.textPrimitives.sectionSeparator)!=-1) return false;
	return config.formatterHelpers.isExternalLink_section.apply(this,arguments);
}
//}}}
/***
!!!!!tiddler.handler
***/
//{{{
if (!config.macros.tiddler.handler_section)
	config.macros.tiddler.handler_section=config.macros.tiddler.handler;
config.macros.tiddler.handler=function(place,macroName,params,wikifier,paramString,tiddler)
{
	if (!params[0]) return;
	var sep=config.textPrimitives.sectionSeparator;
	var parts=params[0].split(sep); var tid=parts[0]; var sec=parts[1]; if (sec) sec=sec.trim();
	if ((tid.toLowerCase()=='here'||!tid.length) &amp;&amp; sec) { // fixup for 'here##section' and '##section'
		var here=story.findContainingTiddler(place)
		var tid=here?here.getAttribute('tiddler'):tiddler?tiddler.title:'';
		arguments[2][0]=tid+sep+sec;
		arguments[4]=paramString.replace(new RegExp('(here)?'+sep+sec),tid+sep+sec);
	}
	config.macros.tiddler.handler_section.apply(this,arguments);
}
//}}}
/***
!!!!sectionTOC macro
***/
//{{{
config.macros.sectionTOC = {
	targetClass: 'sectionTOC',
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var out=[];
		var targetClass=params[0]||this.targetClass;
		var t=story.findContainingTiddler(place); if (!t) return;
		var elems=t.getElementsByTagName('*');
		var level=5; // topmost heading level
		for (var i=0; i&lt;elems.length; i++) {
			var txt=getPlainText(elems[i]).trim();
			var link='[['+txt+'|##'+txt+']]';
			switch(elems[i].nodeName) {
				case 'H1': out.push('#'+link);		level=1; break;
				case 'H2': out.push('##'+link);		level=level&lt;2?level:2; break;
				case 'H3': out.push('###'+link);	level=level&lt;3?level:3; break;
				case 'H4': out.push('####'+link);	level=level&lt;4?level:4; break;
				case 'H5': out.push('#####'+link);	level=level&lt;5?level:5; break;
				default: if (hasClass(elems[i],targetClass)) var target=elems[i];
			}
		}
		// trim excess bullet levels
		if (level&gt;1) for (var i=0; i&lt;out.length; i++) out[i]=out[i].substr(level-1);
		// show numbered list
		if (out.length &amp;&amp; target) {
			if (target.style.display=='none') target.style.display='block';
			wikify(out.join('\n'),target);
		}
	}
}
//}}}
/***
!!!Invoke macro
{{{
&lt;&lt;sectionTOC&gt;&gt;
}}}
***/
// //&lt;&lt;sectionTOC&gt;&gt;</pre>
</div>
<div title="SelectPaletteMacro" modifier="YourName" created="200909210327" modified="200909210331" tags="systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
Quick and dirtly palette switcher for 2.1.x
&lt;&lt;selectPalette&gt;&gt;
WARNING this will overwrite your ColorPalette tiddler.
***/

//{{{

merge(config.macros,{

	setPalette: {

		handler: function(place,macroName,params,wikifier,paramString,tiddler) {
			var paletteName = params[0] ? params[0] : tiddler.title;
			createTiddlyButton(place,&quot;apply&quot;,&quot;Apply this palette&quot;,function(e) {
				config.macros.selectPalette.updatePalette(tiddler.title);
				return false;
			});
		}
	},

	selectPalette: {

		handler: function(place,macroName,params,wikifier,paramString,tiddler) {
			createTiddlyDropDown(place,this.onPaletteChange,this.getPalettes());
		},

		getPalettes: function() {
			var result = [
				{caption:&quot;-select palette-&quot;, name:&quot;&quot;},
				{caption:&quot;(Default)&quot;, name:&quot;(default)&quot;}
			];
			var tagged = store.getTaggedTiddlers(&quot;palette&quot;,&quot;title&quot;);
			for(var t=0; t&lt;tagged.length; t++)
				result.push({caption:tagged[t].title, name:tagged[t].title});
			return result;
		},

		onPaletteChange: function(e) {
			config.macros.selectPalette.updatePalette(this.value);
			return true;
		},

		updatePalette: function(title) {
			if (title != &quot;&quot;) {
				store.deleteTiddler(&quot;ColorPalette&quot;);
				if (title != &quot;(default)&quot;)
					store.saveTiddler(&quot;ColorPalette&quot;,&quot;ColorPalette&quot;,store.getTiddlerText(title),
								config.options.txtUserName,undefined,&quot;palette excludeSearch excludeLists excludeMissing System&quot;);
				this.refreshPalette();
				if(config.options.chkAutoSave)
					saveChanges(true);
			}
		},

		refreshPalette: function() {
			config.macros.refreshDisplay.onClick();
		}
	}
});

//}}}</pre>
</div>
<div title="SelectStylesheetPlugin" modifier="YourName" created="200511060404" modified="200709282316" tags="mySystem systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|SelectStylesheetPlugin|
|''Source:''|http://www.TiddlyTools.com/#SelectStylesheetPlugin|
|''Author:''|Eric Shulman - ELS Design Studios|
|''License:''|[[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|''~CoreVersion:''|2.0.10|

Select alternative TiddlyWiki CSS stylesheet 'themes' from a list of tiddlers tagged with &quot;stylesheets&quot;.

!!!!!Usage
&lt;&lt;&lt;
This plugin defines a macro that creates a stylesheet link or selection listbox/droplist that can be added to the content of any tiddler (such as the OptionsPanel or MainMenu tiddlers).

First, create (or import) a custom style sheet tiddler (i.e, a tiddler containing CSS definitions) and tag it with &lt;&lt;tag stylesheets&gt;&gt; so it can be included in the selection list.  Then, add the {{{&lt;&lt;selectStylesheet&gt;&gt;}}} macro to the desired tiddler to display the stylesheet list.  (note: to create a link to apply a specific stylesheet, include the stylesheet tiddlername as a parameter.  See below for more details).

Select your desired stylesheet from the droplist:
** ''[system]'' uses the built-in CSS definitions
** ''[default]'' uses &quot;StyleSheet&quot; tiddler (if present)
** //tiddlername// uses any named stylesheet
The currently selected stylesheet is indicated by a '&gt;' symbol.

//Note: If a selected stylesheet tiddler no longer exists (i.e, the tiddler was deleted or renamed after it had been selected for use), the [default] CSS tiddler (&quot;StyleSheet&quot;) will be used as a fallback.  If this tiddler does not exist either, then the built-in CSS definitions are used.//
&lt;&lt;&lt;
!!!!!Parameters
&lt;&lt;&lt;
The selectStylesheet macro accepts parameters to control various features and functions. //Note: while each parameter is optional and may be omitted from the macro, the parameters (when present) must appear in the order shown below.//
* ''size:nnn''
Determines the number of lines to display in the stylesheet list.  If this parameter is omitted or &quot;size:1&quot; is specified, a single-line droplist is created.  When a size &gt; 1 is provided, a standard, fixed-size scrollable listbox is created.  You can use &quot;size:0&quot; or &quot;size:auto&quot; to display a varible-height listbox that automatically adjusts to fit the current list contents without scrolling.
* ''width:nnn[cm|px|em|%]''
Controls the width of the stylesheet list.  Overrides the built-in CSS width declaration (=100%).  Use standard CSS width units (cm=centimeters, px=pixels, em=M-space, %=proportional to containing area).  You can also use a &quot;.selectStylesheet&quot; custom CSS class definition to override the built-in CSS declarations for the stylesheet list.
* ''label:text'' and ''prompt:text''
when used in conjunction with a specific named stylesheet to create a stylesheet link (see //tiddlername// param, below), these two parameters define the link text the 'tooltip' text that appears near the mouse pointer when placed over the link, respectively.
* ''//tiddlername//''
If you include a stylesheet //tiddlername// parameter in the macro (e.g., {{{&lt;&lt;selectStylesheet [[Woodshop]]&gt;&gt;}}} then a link will be created instead of a listbox/droplist.  Selecting this link applies the specified stylesheet.  You may use the special keywords ''[system]'' to use the built-in CSS definitions, or ''[none]'' to bypass all stylesheet tiddlers (sometimes useful during CSS debugging).

&lt;&lt;&lt;
!!!!!Nested Stylesheets
&lt;&lt;&lt;
The CSS definitions for TiddlyWiki are fairly substantial, and stylesheet tiddlers can include hundreds of lines of CSS statements.  Often, these stylesheets will use the exact same CSS for the bulk of their definitions plus several changes or additions to create a difference in appearance.  This results in lots of duplicated CSS definitions that can become difficult to keep 'in sync' with each other.

To make this problem much easier to manage, you can move the common CSS definitions into separate stylesheet tiddlers.  Then, embed {{{[[tiddlertitle]]}}} references in the original stylesheet tiddlers to re-combine the CSS definitions into a single stylesheet 'theme' to be applied.

With some clever division of CSS into separate tiddlers, you can quite easily construct dozens of stylesheet combinations.  You can also mark the common CSS tiddlers with tags and use them as overlay stylesheets so you can mix-and-match their styles to create even more 'on-the-fly' stylesheet combinations.

Note: Normally, when rendering tiddler content for display, the {{{[[tiddlertitle]]}}} syntax means &quot;insert a link to this tiddler&quot;.  However, when applying stylesheets, this syntax means &quot;insert the content of this tiddler&quot;
&lt;&lt;&lt;
!!!!!Bypassing default shadow styles (for 'CSS gurus')
&lt;&lt;&lt;
Normally, TiddlyWiki documents automatically use CSS definitions contained in ''shadow tiddlers:'' StyleSheetLayout, StyleSheetColors, and StyleSheetPrint.  Custom stylesheet definitions are then ''overlayed'' on top of these default styles, allowing you to modify and extend the CSS definitions to suit your desired look-and-feel, by just adding a few lines of CSS, instead of directly modifying the shadow tiddlers (which, while it is allowed, is not recommended).

Prior to version 4.3.0 (2006 August 27), the plugin behavior always bypassed the shadow stylesheets when applying a selected custom stylesheet.  As a result, the custom stylesheet definitions had to contain this syntax: {{{[[StyleSheetLayout]] [[StyleSheetColors]] [[StyleSheetPrint]]}}} to make use of the default CSS definitions.  Unfortunately, this made it awkward to import and use 'standard' StyleSheet tiddlers defined for use without the SelectStylesheetPlugin, as they didn't necessarily contain the needed references to the shadow defaults.

''As of version 4.3.0, SelectStylesheetPlugin no longer bypasses the default shadow stylesheets, so that the {{{[[...]]}}} references to the shadows are not required to include the default styles.''

However, if overriding a CSS definition in a custom StyleSheet is simply not sufficient for your needs, you can still ''completely bypass the built-in shadow styles'' by entering
{{{
config.options.chkBypassShadowStyles=true
}}}
into a tiddler tagged with&lt;&lt;tag systemConfig&gt;&gt; (e.g., &quot;ConfigTweaks&quot;).  This ''internal system value'' causes the plugin to revert to the pre-4.3.0 behavior so that it skips the shadow styles when applying a selected stylesheet.  Note that this setting is not a user-level preference, so it is not presented as a checkbox option nor stored in a cookie, as it is intended to only be set by the //author// of the document.
&lt;&lt;&lt;
!!!!!Changing templates or invoking custom javascript from a stylesheet
&lt;&lt;&lt;
In addition to CSS definitions, some TiddlyWiki look-and-feel designs also make adjustments to the TiddlyWiki document structure so that certain document features can be moved, hidden, or otherwise redefined.  The default set of templates that control the document structure are called PageTemplate, ViewTemplate, and EditTemplate.  To select an alternative set of templates, you can include the special psuedo-macro ''{{{&lt;&lt;template prefix&gt;&gt;}}}'' in your stylesheet.  This adds the indicated prefix to the standard template names, and automatically switches to using those templates whenever the stylesheet is selected and applied.

Whenever a document is being viewed in read-only mode (i.e., via http: protocol), an implied template prefix of &quot;Web&quot; is also used, and is inserted between any custom template prefix and the standard template name.  For example, ''{{{&lt;&lt;template Custom&gt;&gt;}}}'' will use {{{CustomWebViewTemplate}}} when the document is in read-only mode.  You can specify an alternative for this implied prefix by including a second prefix parameter in the pseudo-macro.  For example, ''{{{&lt;&lt;template Custom ReadOnly&gt;&gt;}}}'' will use {{{CustomReadOnlyViewTemplate}}}.  Note: if a template tiddler with the indicated combination of custom and read-only prefixes is not available, a suitable fallback template is chosen, first by omitting the custom prefix, then by omitting the read-only prefix, and finally by omitting both, and reverting to the appropriate default template.

In addition to selecting alternative templates, a stylesheet can also include the psuedo-macro ''{{{&lt;&lt;init tiddlertitle&gt;&gt;}}}'' to execute custom javascript that can access TiddlyWiki internal data and 'core' functions or perform direct manipulation of the currently-rendered DOM elements of the document.  First, place the desired javascript code into one or more tiddlers (note: //although these tiddlers will contain javascript, ''do NOT tag them as 'systemConfig', since this will cause the javascript to be executed every time TW starts'', rather than only when a specific stylesheet has been selected//).  Then, add the ''{{{&lt;&lt;init tiddlertitle&gt;&gt;}}}'' pseudo-macro to your stylesheet so the javascript will be executed when that specific stylesheet is selected and applied.

Of course, when another stylesheet is subsequently selected, other custom javascript functions may be needed to reset whatever TW internal data changes or DOM manipulations were performed by any {{{&lt;&lt;init&gt;&gt;}}} scripts.  You can define tiddlers containing these ''reset'' scripts by embedding ''{{{&lt;&lt;reset tiddlertitle&gt;&gt;}}}'' in your stylesheet definition.  Unlike {{{&lt;&lt;init&gt;&gt;}}} scripts, any tiddlers declared in this way will NOT be executed when the stylesheet is applied, but will be remembered and automatically executed before applying another stylesheet.

Note: These special-purpose psuedo-macros are only executed when the stylesheet containing them is actually in use.  When these macros are rendered as part of the tiddler content (such as when //viewing// a stylesheet definition), the macros simply report their values without performing any actions.
&lt;&lt;&lt;
!!!!!Examples
&lt;&lt;&lt;
single auto-sized listbox
{{{&lt;&lt;selectStylesheet size:auto width:60%&gt;&gt;}}}
&lt;&lt;selectStylesheet size:auto width:60%&gt;&gt;

droplist for stylesheets
{{{&lt;&lt;selectStylesheet size:1 width:30%&gt;&gt;}}}
&lt;&lt;selectStylesheet size:1 width:30%&gt;&gt;

inline links to set specific stylesheets
{{{&lt;&lt;selectStylesheet Woodshop&gt;&gt; or &lt;&lt;selectStylesheet [[Edge of Night]]&gt;&gt; or &lt;&lt;selectStylesheet [default]&gt;&gt;  or &lt;&lt;selectStylesheet [none]&gt;&gt; or &lt;&lt;selectStylesheet label:TiddlyWiki &quot;prompt:The standard TW stylesheet&quot; [system]&gt;&gt;
}}}
&lt;&lt;selectStylesheet Woodshop&gt;&gt; or &lt;&lt;selectStylesheet [[Edge of Night]]&gt;&gt; or &lt;&lt;selectStylesheet [default]&gt;&gt;  or &lt;&lt;selectStylesheet [none]&gt;&gt; or &lt;&lt;selectStylesheet label:TiddlyWiki &quot;prompt:The standard TW stylesheet&quot; [system]&gt;&gt;

stylesheet definitions (tagged with &quot;stylesheets&quot;):
&lt;&lt;tag stylesheets&gt;&gt;
&lt;&lt;&lt;
!!!!!Installation
&lt;&lt;&lt;
import (or copy/paste) the following tiddlers into your document:
''SelectStylesheetPlugin'' (tagged with &lt;&lt;tag systemConfig&gt;&gt;)
^^documentation and javascript for SelectStylesheethandling^^

create/edit ''OptionsPanel'':
Add &quot;{{{&lt;&lt;selectStylesheet [size:nnn|auto] [width:nnn[cm|px|em|%]&gt;&gt;}}}&quot; macro.
&lt;&lt;&lt;
!!!!!Revision History
&lt;&lt;&lt;
''2006.11.14'' [4.3.5] in applyPageTemplate(), only force use of selectStylesheet alternative page template if explicit template parameter is NOT provided (i.e., allow other plugin code to pass a value for the template).  Based on a request by Paulo Soares.
''2006.11.12'' [4.3.4] in applyStylesheets(), moved invocation of 'reset' handlers so they occur BEFORE switching to another template. (thanks to UdoBorkowski for the bug report)
''2006.11.11'' [4.3.3] in initSelectStylesheetNotification(), hijack previously registered notifications for refreshPageTemplate() in addition to refreshStyles().  This ensures that non-default PageTemplate is displayed when document is first loaded (thanks to AndresLister for bug report).
''2006.11.11'' [4.3.2] in applyStylesheets(), use getRecursiveTiddlerText() instead of getTiddlerText() to retrieve system-default shadow stylesheet. (thanks to UdoBorkowski for the bug report)
''2006.09.26'' [4.3.1] in applyStylesheets(), corrected setting of StyleSheetPrint.  Restored &quot;[none]&quot; choice in listbox.
''2006.08.27'' [4.3.0] in applyStylesheets(), changed default so that shadow stylesheets are automatically applied ALONG WITH the selected custom stylesheet. Use config.options.chkBypassShadowStyles=true to revert to the prior handling (i.e., skip the shadow stylesheets)
''2006.08.26'' [4.2.7] in applyStylesheets(), added depth-limiting param to getRecursiveTiddlerText() to avoid inifinite recursion.  Note: limits nesting of stylesheets to 10 levels (same as core).
''2006.06.28 [4.2.6]'' added 'nocookie' param to set(), so &quot;style:xyz&quot; param can **temporarily** override stylesheet (by NOT overwriting the cookie value)
''2006.05.18 [4.2.5]'' revert to 'onchange' handling, BUT... don't *reload* the list contents each time selection changes (just move the &quot;&gt;&quot; indicator to the current item instead), AND... track onkeydown/up to avoid FF crash due to excess calls to set() when scrolling a listbox by holding down arrow keys.
''2006.05.15 [4.2.4]'' switch from 'onchange' listbox handling to 'onclick' and 'onkeyup'.  Avoids FF **CRASH** due to stylesheets being excessively refreshed *during* onchange due to keyboard event handling.
''2006.04.21 [4.2.3]'' recognize &quot;stylesheet&quot; tag when building list of available stylesheets (in addition to plural, &quot;stylesheets&quot;)
''2006.04.05 [4.2.2]'' in applyStylesheet(), reverted change from 4.2.0: *don't* apply &quot;StyleSheetColors&quot; and &quot;StyleSheetLayout&quot; along with selected stylesheet, so custom stylesheet can completely bypass the default formatting.  To include default formatting in a stylesheet, embed &quot;[[StyleSheetColors]] [[StyleSheetLayout]]&quot; 
''2006.03.30 [4.2.1]'' in applyStylesheet(), change calls from &quot;window.eval()&quot; to just &quot;eval()&quot; to avoid FF1501 'global variable crash' problem 
''2006.03.30 [4.2.0]'' remove [none] choice from listbox.  Added handling for &lt;&lt;selectStylesheet sheetname&gt;&gt; to create a link that applies the specified sheet instead of presenting a listbox of available sheets.  added &quot;style:&quot; paramifier.  Apply &quot;StyleSheetColors&quot; and &quot;StyleSheetLayout&quot; along with selected stylesheet (i.e., overlay selected sheet on top of shadow styles instead of replacing default shadow styles).  Based on suggestions from Clint Checketts.
''2006.03.09 [4.1.4]'' in refreshSelectStylesheet(), make sure that tiddler named in stylesheet cookie value still exists before attempting to select it in the listbox.
''2006.02.25 [4.1.3]'' Problem: the &quot;&gt;&quot; indicator was not always being refreshed, due to event &quot;timing&quot; issues.  refreshSelectStylesheet() deferred for 10msec so it will execute *after* onChangeSelectStylesheet event processing has completed.
''2006.02.24 [4.1.2]'' Problem: {{{&lt;&lt;template&gt;&gt;}}} macro was not being processed in IE.
Cause: regexp processing creates browser-internal &quot;private globals&quot; used to keep track of the regexp parser's state, including the current 'scan' position within the source string.  This lets you use search() and exec() inside loops to scan for successive pattern matches.  In applyStyleSheet(), &quot;theCSS.search(templateRegExp)&quot; was called before &quot;theCSS.exec(templateRegExp)&quot;.  As a result, the regexp parser had already matched the {{{&lt;&lt;template&gt;&gt;}}} macro embedded in the CSS and thus did not actually process the macro and switch the templates.
Fix: use {{{indexOf(&quot;&lt;&lt;template&quot;)}}} instead of search(templateRegExp) to check for presence of template switching macro in CSS.
''2006.02.23 [4.1.1]'' performance fixes: in switchTemplates(), added default init of 'altTemplate' value to prevent unneeded triggering of refreshPageTemplate() during TW load-time when using standard templates.  Saves LOTS of startup time and avoids the dreaded &quot;script is running slowly&quot; FireFox warnings.
Also, the forEachTiddler() call to force a &quot;refresh all tiddlers&quot; (needed when view/edit templates are changed) was moved from applyPageTemplate() and is now called directly from switchTemplates().  This eliminates redundant re-rendering of tiddlers while the page template is being refreshed.
''2006.02.21 [4.1.0]'' added {{{&lt;&lt;template&gt;&gt;}}} pseudo-macro with new switchTemplate() function.  Allows stylsheets to switch page/view/edit templates by adding a prefix to standard template names.  Detects readOnly mode and automatically adds &quot;Web&quot; to template name (e.g. &quot;MyWebViewTemplate&quot;).  Defines &quot;Web&quot; shadow templates and &quot;viewSource&quot; toolbar command.
''2006.02.21 [4.0.3]'' added real macro handlers for psuedo-macros &quot;init&quot;, &quot;reset&quot; so they will display in the stylesheet tiddler without appearing as an error.
''2006.01.20 [4.0.2]'' add 'var' to unintended global variable declarations and wrapped notification hijack in init function to eliminate globals and avoid FireFox 1.5.0.1 crash bug when referencing globals
''2006.01.20 [4.0.1]'' Added optional &quot;init&quot; keyword for {{{&lt;&lt;init tiddlertitle&gt;&gt;}}} psuedo-macro syntax (note: previous {{{&lt;&lt;tiddlertitle&gt;&gt;}}} syntax still permitted)
Revised documentation to better describe use of init/reset for custom code invokation.
''2005.11.05 [4.0.0]'' Entire plugin simplified in response to new &quot;shadow stylesheet&quot; architecture introduced in TW1.2.37.  Concept of separate overlays has been removed.  Stylesheet themes are assembled using [[tiddler]] 'nesting' syntax, and tagged as 'stylesheet'.  A single listbox/droplist is provided to select themes.
''2005.10.25 [3.1.0]'' added support for embedding {{{&lt;&lt;reset tiddlertitle&gt;&gt;}}} companion code (to declare 'DOM cleanup' routines invoked when a stylesheet is UNloaded)
//Based on a request from ClintChecketts//
''2005.10.09 [3.0.1]'' combined documentation and code in a single tiddler
''2005.08.15 [3.0.0]'' Another major re-write.  Replaced separate &quot;selectOverlays&quot; macro definition with 'overlays' parameter on 'selectStylesheet' macro.  Added support for embedding {{{&lt;&lt;tiddlertitle&gt;&gt;}}} companion code.  applyStylesheets() completely re-designed to address quirks with loading and combining multiple stylesheets using browser-specific native handling, as well as add support for executing companion code.  Stylesheets+overlays+code are now handled in a platform-neutral manner that avoids differences between browser implementations and uses much less overhead in the DOM.
''2005.08.07 [2.0.0]'' Major re-write to not use static ID values for listbox controls, so that multiple macro instances can exist without corrupting each other or the DOM.  Moved HTML and CSS definitions into plugin code instead of using separate tiddlers.  Added new features: support for multiple groups of overlay stylesheets with collapsible tree display. Added size and width params for listbox display.
''2005.07.27 [1.0.3]'' core update 1.2.29: custom overlayStyleSheet() replaced with new core setStylesheet()
''2005.07.25 [1.0.2]'' correct 'fallback' handling in selectStyleSheet()
''2005.07.23 [1.0.1]'' added parameter checks and corrected addNotification() usage
''2005.07.20 [1.0.0]'' Initial Release
&lt;&lt;&lt;
!!!!!Credits
&lt;&lt;&lt;
This feature was developed by EricShulman from [[ELS Design Studios|http:/www.elsdesign.com]].  Thanks to David Jaquith for testing and bug reports and SteveRumsby for feature suggestions.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.selectStylesheet = {major: 4, minor: 3, revision: 5, date: new Date(2006,11,14)};

// IE needs explicit global scoping for functions/vars called from browser events
window.refreshSelectStylesheet=refreshSelectStylesheet;
window.applyStylesheets=applyStylesheets;

if (!config.options.txtStyleSheet) config.options.txtStyleSheet=&quot;StyleSheet&quot;;
//}}}

//{{{
// define macro rendering handler
config.macros.selectStylesheet = { };
config.macros.selectStylesheet.reset = [];
config.macros.selectStylesheet.handler = function(place,macroName,params) {
	setStylesheet(&quot;.selectStylesheet {width:100%;font-size:8pt;margin:0em}&quot;,&quot;selectStylesheetPlugin&quot;);
	var autosize=1;
	if (params[0] &amp;&amp; (params[0]==&quot;size:auto&quot;))
		{ autosize=0; params.shift(); }
	if (params[0] &amp;&amp; (params[0].substr(0,5)==&quot;size:&quot;))
		autosize=(params.shift()).substr(5);
	if (params[0] &amp;&amp; (params[0].substr(0,6)==&quot;width:&quot;))
		var width=(params.shift()).substr(6);
	if (params[0] &amp;&amp; (params[0].substr(0,6)==&quot;label:&quot;))
		var label=(params.shift()).substr(6);
	if (params[0] &amp;&amp; (params[0].substr(0,7)==&quot;prompt:&quot;))
		var prompt=(params.shift()).substr(7);
	if (params[0] &amp;&amp; params[0].trim().length) // create a link that sets a specific stylesheet
		createTiddlyButton(place,label?label:params[0],prompt?prompt:params[0], function(){config.macros.selectStylesheet.set(params[0]); return false;});
	else { // create a select list of available stylesheets
		var theList=createTiddlyElement(place,&quot;select&quot;,null,&quot;selectStylesheet&quot;,null);
		theList.onkeydown=function() // track keystrokes for listbox only
			{ if (this.size&gt;1 &amp;&amp; !this.keydown) { this.keydown=true; this.previousIndex=this.selectedIndex; } return true; };
		theList.onkeyup=function()
			{ if (this.keydown) { this.keydown=false; if (this.selectedIndex!=this.previousIndex) config.macros.selectStylesheet.set(this.value); } return true; };
		theList.onchange=function()
			{ if (!this.keydown) config.macros.selectStylesheet.set(this.value); return true; };
		theList.size=1;
		theList.autosize=autosize;
		if (width) theList.style.width=width;
		store.addNotification(null,refreshSelectStylesheet);
		refreshSelectStylesheet();
	}
}
config.macros.selectStylesheet.set = function(theSheet,nocookie) {
	if (!theSheet || !theSheet.trim().length) return;
	var allStyleLists=getElementsByClass(&quot;selectStylesheet&quot;);
	for (var k=0; k&lt;allStyleLists.length; k++) {
		var theList=allStyleLists[k];
		for (var t=0; t&lt;theList.options.length; t++)	 {
			if (theList.options[t].text.substr(0,1)==&quot;&gt;&quot;)
				theList.options[t].text=String.fromCharCode(160)+String.fromCharCode(160)+theList.options[t].text.substr(1);
			if ((theList.options[t].value==theSheet) || (theSheet==&quot;[default]&quot; &amp;&amp; theList.options[t].value==&quot;StyleSheet&quot;))
				{ theList.options[t].text=&quot;&gt;&quot;+theList.options[t].text.substr(2); theList.selectedIndex=t; }
		}
	}
	config.options.txtStyleSheet=theSheet;
	if (!nocookie) saveOptionCookie(&quot;txtStyleSheet&quot;);
	applyStylesheets();
	return;
}
if (config.paramifiers) config.paramifiers.style = { onstart: function(theSheet) { config.macros.selectStylesheet.set(theSheet,true); } };

// set to TRUE to enable debugging status messages when stylesheets are applied
config.macros.selectStylesheet.verbose = false;

// hijack existing notifications for refreshStyles() and refreshPageTemplate() handlers
initSelectStylesheetNotification();
function initSelectStylesheetNotification() {
	for (var i=0; i&lt;store.namedNotifications.length; i++) {
		if (store.namedNotifications[i].notify==window.refreshStyles)
			store.namedNotifications[i].notify=applyStylesheets;
		if (store.namedNotifications[i].notify==window.refreshPageTemplate)
			store.namedNotifications[i].notify=applyPageTemplate;
	}
}

// hijack refreshStyles() handler
config.macros.selectStylesheet.coreRefreshStyles = window.refreshStyles;
window.refreshStyles=applyStylesheets;

// hijack refreshPageTemplate() handler
config.macros.selectStylesheet.coreRefreshPageTemplate = window.refreshPageTemplate;
window.refreshPageTemplate=applyPageTemplate;

function getElementsByClass(classname)
{
	var arr=new Array();
	var count=0;
	var all=document.all? document.all : document.getElementsByTagName(&quot;*&quot;);
	for (var i=0; i&lt;all.length; i++)
		if (all[i].className==classname)
			arr[count++]=all[i];
	return arr;
}

function refreshSelectStylesheet()
{
	var indent = String.fromCharCode(160)+String.fromCharCode(160)+String.fromCharCode(160);
	// for all instances of the selectStylesheet control
	var allStyleLists=getElementsByClass(&quot;selectStylesheet&quot;);
	for (var k=0; k&lt;allStyleLists.length; k++) {
		var theList=allStyleLists[k];
		// clear current list contents
		while (theList.length &gt; 0) { theList.options[0] = null; }
		theList.selectedIndex=-1;
		// fill the stylesheet list
		var count=0;
		// prompt text
		theList.options[count++] = new Option(&quot;select a stylesheet:&quot;,&quot;&quot;,false,false);
		// option: none (built-in hard-coded CSS only)
		theList.options[count++] = new Option(indent+&quot;[none]&quot;,&quot;[none]&quot;,false,false);
		// option: default (built-in plus shadow stylesheets)
		theList.options[count++] = new Option(indent+&quot;[system]&quot;,&quot;[system]&quot;,false,false);
		// option: StyleSheet tiddler, if present
		if (store.getTiddler(&quot;StyleSheet&quot;)!=undefined)
			theList.options[count++] = new Option(indent+&quot;[default]&quot;,&quot;StyleSheet&quot;,false,false);
		// options: CSS tiddlers tagged with &quot;stylesheets&quot; or &quot;stylesheet&quot;
		var theSheets=store.getTaggedTiddlers(&quot;stylesheets&quot;).concat(store.getTaggedTiddlers(&quot;stylesheet&quot;));
		for (var i=0; i&lt;theSheets.length; i++) {
			var theTitle=theSheets[i].title;
			if (theTitle==&quot;StyleSheet&quot;) continue;
			theList.options[count++] = new Option(indent+theTitle,theTitle,false,false);
		}
		// make sure the requested stylesheet exists, fallback if not...
		var theSheet=config.options.txtStyleSheet;
		if (theSheet!=&quot;[none]&quot; &amp;&amp; theSheet!=&quot;[system]&quot; &amp;&amp; !store.getTiddler(theSheet)) theSheet=&quot;StyleSheet&quot;;
		if (!store.getTiddler(theSheet)) theSheet=&quot;[system]&quot;;
		// set the listbox selection to current stylesheet
		theList.selectedIndex=0;	// default to first item
		for (var t=0; t&lt;theList.options.length; t++)	
			if (theList.options[t].value==theSheet)
				{ theList.selectedIndex=t; break; }
		theList.options[t].text=&quot;&gt;&quot;+theList.options[t].text.substr(2);
		// autosize as appropriate
		theList.size=(theList.autosize&lt;1)?theList.options.length:theList.autosize;
	} // end of &quot;for all instances&quot;
}
//}}}

//{{{
config.macros.selectStylesheet.templates = { };
function switchTemplates(which,readOnlyPrefix)
{
	// remember original templates (init only)
	if (!config.macros.selectStylesheet.templates.originalpage)
		config.macros.selectStylesheet.templates.originalpage = &quot;PageTemplate&quot;;
	if (!config.macros.selectStylesheet.templates.originalview)
		config.macros.selectStylesheet.templates.originalview = config.tiddlerTemplates[1];
	if (!config.macros.selectStylesheet.templates.originaledit)
		config.macros.selectStylesheet.templates.originaledit = config.tiddlerTemplates[2];
	if (!config.macros.selectStylesheet.altTemplate)
		config.macros.selectStylesheet.altTemplate=&quot;&quot;;

	// define shorthand variables just for code readability 
	var page=config.macros.selectStylesheet.templates.originalpage;
	var view=config.macros.selectStylesheet.templates.originalview;
	var edit=config.macros.selectStylesheet.templates.originaledit;

	// get 'readOnly' mode... set by TW core, but not until after the plugin is loaded, so we need to do this here as well...
	var loc = document.location.href;
	if (readOnly==undefined)
		var readOnly = (loc.substr(0,4) == &quot;http&quot; || loc.substr(0,3) == &quot;ftp&quot;) ? config.options.chkHttpReadOnly : false;

	// get prefix defaults
	if (!which) var which=&quot;&quot;;
	if (!readOnlyPrefix) var readOnlyPrefix = &quot;Web&quot;;
	if (!readOnly) readOnlyPrefix=&quot;&quot;;
	var alt = which+readOnlyPrefix;

	var msg=&quot;current template prefix: '%0', requested template prefix '%1'&quot;;
	if (config.macros.selectStylesheet.verbose) alert(msg.format([config.macros.selectStylesheet.altTemplate,alt]));

	// only switch if really changing templates
	if (alt == config.macros.selectStylesheet.altTemplate) return;

	// remember which templates are being used
	config.macros.selectStylesheet.altTemplate = alt;

	// set page template, with fallbacks for missing combinations
	var pageTemplate=alt+page;
	if (!store.getTiddlerText(pageTemplate)) pageTemplate=which+page;
	if (!store.getTiddlerText(pageTemplate)) pageTemplate=readOnlyPrefix+page;
	if (!store.getTiddlerText(pageTemplate)) pageTemplate=page;
	config.macros.selectStylesheet.templates.currentpage = pageTemplate;

	// set view template, with fallbacks for missing combinations
	var viewTemplate=alt+view;
	if (!store.getTiddlerText(viewTemplate)) viewTemplate=which+view;
	if (!store.getTiddlerText(viewTemplate)) viewTemplate=readOnlyPrefix+view;
	if (!store.getTiddlerText(viewTemplate)) viewTemplate=view;
	config.tiddlerTemplates[1] = config.macros.selectStylesheet.templates.currentview = viewTemplate;

	// set edit template, with fallbacks for missing combinations
	var editTemplate=alt+edit;
	if (!store.getTiddlerText(editTemplate)) editTemplate=which+edit;
	if (!store.getTiddlerText(editTemplate)) editTemplate=readOnlyPrefix+edit;
	if (!store.getTiddlerText(editTemplate)) editTemplate=edit;
	config.tiddlerTemplates[2] = config.macros.selectStylesheet.templates.currentedit = editTemplate;

	var msg=&quot;switching to templates: %0, %1, %2&quot;;
	if (config.macros.selectStylesheet.verbose) alert(msg.format([pageTemplate,viewTemplate,editTemplate]));

	// apply page template
	window.applyPageTemplate();
	// apply view/edit templates
	story.forEachTiddler(function(title,element) { this.refreshTiddler(title,null,true);});

}
// Hijack refreshPageTemplate to force alternative template to be used (if any)
function applyPageTemplate(template)
{
	var cw=document.getElementById(&quot;contentWrapper&quot;);
	cw.style.display=&quot;none&quot;;
	if (!template) var template=config.macros.selectStylesheet.templates.currentpage;
	if (config.macros.selectStylesheet.verbose) alert(&quot;Apply PageTemplate: %0&quot;.format([template]));
	config.macros.selectStylesheet.coreRefreshPageTemplate(template);
	cw.style.display=&quot;block&quot;;
}
//}}}

//{{{
function applyStylesheets()
{
	// define pattern to match executable &lt;&lt;tiddlername&gt;&gt; references embedded in CSS text
	var setTiddlerRegExp = new RegExp(&quot;(?:&lt;&lt;(?:init )([^&gt;]+)&gt;&gt;)&quot;,&quot;mg&quot;);
	var resetTiddlerRegExp = new RegExp(&quot;(?:&lt;&lt;reset ([^&gt;]+)&gt;&gt;)&quot;,&quot;mg&quot;);
	var templateRegExp = new RegExp(&quot;(?:&lt;&lt;template ([^\s&gt;]+)( [^&gt;]+)?&gt;&gt;)&quot;,&quot;mg&quot;);

	// make sure the requested stylesheet exists, fallback if not...
	var theSheet=config.options.txtStyleSheet;
	switch (theSheet) {
		case &quot;[none]&quot;:
		case &quot;[system]&quot;:
			break;
		default:
			if (!store.getTiddler(theSheet)) theSheet=&quot;StyleSheet&quot;;
			if (!store.getTiddler(theSheet)) theSheet=&quot;[system]&quot;;
			break;
	}

	// When store.NotifyAll() is invoked, it can trigger multiple calls to applyStylesheets(),
	// even though only one is needed to set the styles and render things properly.  The extra calls
	// add unnecessary processing overhead by performing multiple re-rendering of entire TW display,
	// often resulting in &quot;slow script&quot; warnings.  To avoid this, we can track the last stylesheet that
	// was applied and only apply the current requested sheet if it is really a different sheet, OR
	// if the TW contents have actually changed (which might include changes to the current stylesheet)
	if (theSheet==config.macros.selectStylesheet.current &amp;&amp; !store.dirty) return;
	config.macros.selectStylesheet.current=theSheet;

	// get the primary stylesheet CSS
	var msg=&quot;stylesheet: '%0'&quot;;
	if (config.macros.selectStylesheet.verbose) alert(msg.format([theSheet]));
	var theCSS = (theSheet.substr(0,1)=='[')?&quot;&quot;:store.getRecursiveTiddlerText(theSheet,&quot;&quot;,10);
	if (theSheet.substr(0,1)!='[') store.addNotification(theSheet,refreshStyles);

	// execute any saved stylesheet 'reset' code tiddlers
	while (config.macros.selectStylesheet.reset.length) {
		var tiddler=config.macros.selectStylesheet.reset.shift();
		var msg=&quot;stylesheet reset macro: '%0'&quot;;
		if (config.macros.selectStylesheet.verbose) alert(msg.format([tiddler]));
		var msg=&quot;error in '%0': %1&quot;;
		try { eval(store.getTiddlerText(tiddler)); }
		catch(e) { displayMessage(msg.format([tiddler,e.toString()])); }
	}

	// if &lt;&lt;template&gt;&gt; reference is not specified, reset to standard template
	if (theCSS.indexOf(&quot;&lt;&lt;template&quot;)==-1) switchTemplates();

	// execute any embedded &lt;&lt;template&gt;&gt; references
	do {
		var match = templateRegExp.exec(theCSS);
		if(match &amp;&amp; match[1]) switchTemplates(match[1],match[2]);
	} while(match);
	// filter out embedded &lt;&lt;template&gt;&gt; references
	theCSS = theCSS.replace(templateRegExp,&quot;&quot;);

	// save embedded &lt;&lt;reset tiddlername&gt;&gt; references
	do {
		var match = resetTiddlerRegExp.exec(theCSS);
		if(match &amp;&amp; match[1])
			config.macros.selectStylesheet.reset.push(match[1]);
	} while(match);
	// filter out embedded &lt;&lt;reset tiddlername&gt;&gt; references
	theCSS = theCSS.replace(resetTiddlerRegExp,&quot;&quot;);

	// execute any embedded &lt;&lt;init tiddlername&gt;&gt; references
	do {
		var match = setTiddlerRegExp.exec(theCSS);
		if(match &amp;&amp; match[1]) {
			var msg=&quot;stylesheet macro: '%0'&quot;;
			if (config.macros.selectStylesheet.verbose) alert(msg.format([match[1]]));
			var msg=&quot;error in '%0': %1&quot;;
			try { eval(store.getTiddlerText(match[1])); }
			catch(e) { displayMessage(msg.format([match[1],e.toString()])); }
		}
	} while(match);
	// filter out embedded &lt;&lt;set tiddlername&gt;&gt; references
	theCSS = theCSS.replace(setTiddlerRegExp,&quot;&quot;);

	// finally, apply the styles
	switch (theSheet) {
		case &quot;[none]&quot;: // no styles
			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetColors&quot;);
			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetLayout&quot;);
			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheetPrint&quot;);
			setStylesheet(&quot;/*bypass*/&quot;,&quot;StyleSheet&quot;);
			break;
		case &quot;[system]&quot;: // default styles only
theSheet,&quot;&quot;,10
			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetLayout&quot;,&quot;&quot;,10),&quot;StyleSheetLayout&quot;);
			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetColors&quot;,&quot;&quot;,10),&quot;StyleSheetColors&quot;);
			setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetPrint&quot;,&quot;&quot;,10),&quot;StyleSheetPrint&quot;);
			setStylesheet(&quot;&quot;,&quot;StyleSheet&quot;);
			break;
		default: // alternative stylesheet *replaces* default styles
			if (config.options.chkBypassShadowStyles) { // NOTE: hard-coded value, not saved as cookie, adjust in &quot;ConfigTweaks&quot;
				// stylesheet *replaces* default styles
				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetLayout&quot;);
				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetColors&quot;);
				setStylesheet(&quot;/* overridden by [[&quot;+theSheet+&quot;]] */&quot;,&quot;StyleSheetPrint&quot;);
			}
			else {
				// stylesheet *overlays* default styles
				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetLayout&quot;,&quot;&quot;,10),&quot;StyleSheetLayout&quot;);
				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetColors&quot;,&quot;&quot;,10),&quot;StyleSheetColors&quot;);
				setStylesheet(store.getRecursiveTiddlerText(&quot;StyleSheetPrint&quot;,&quot;&quot;,10),&quot;StyleSheetPrint&quot;);
			}
			setStylesheet(theCSS,&quot;StyleSheet&quot;);
			break;
	}
}

config.macros.init = { };
config.macros.init.handler = function(place,macroName,params)
	{ var out=&quot;init: [[%0]]&quot;; wikify(out.format(params),place); }
config.macros.reset = { };
config.macros.reset.handler = function(place,macroName,params)
	{ var out=&quot;reset: [[%0]]&quot;; wikify(out.format(params),place); }
config.macros.template = { };
config.macros.template.handler = function(place,macroName,params)
	{ var out=&quot;use template prefix: ''%0 %1''&quot;; wikify(out.format(params),place); }

//}}}</pre>
</div>
<div title="ShowLocalDirectory" modifier="shankar " created="200711192137" modified="200910301132" tags="transclusion mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ShowLocalDirectory|
|Source|http://www.TiddlyTools.com/#ShowLocalDirectory|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|display local filesystem directory listings|
Usage
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ShowLocalDirectory&gt;&gt;
&lt;&lt;tiddler ShowLocalDirectory with: localpath format&gt;&gt;
}}}
*''localpath'' uses system-specific file naming conventions (or keyword &quot;here&quot; for the current document directory).  Note: for Windows filesystem, use doubled backslashes and enclose the entire path in square brackets (e.g., {{{[[C:\\temp\\foo]]}}})
*''format'' determines the type of output produced:
**''plain''&lt;br&gt;show fully-qualified path/filenames ~AS-IS, without any additional formatting.
**''list''&lt;br&gt;show fully-qualified path/filenames, so that the local system-specific filename can be *displayed* while linking to a valid system-independent &quot;file:&quot; URL for browser navigation.
**''directory'' (default)&lt;br&gt;show header followed by a formatted table, containing links for filenames, filesizes (in bytes), and modification dates, plus a summary footer reporting the total file and byte counts.
&lt;&lt;&lt;
Example
&lt;&lt;&lt;
{{{&lt;&lt;tiddler ShowLocalDirectory&gt;&gt;}}}
&lt;&lt;tiddler ShowLocalDirectory##show&gt;&gt;
&lt;&lt;&lt;
!end

!init
&lt;&lt;tiddler {{
	window.getCurrentFolder=function() {
		var h=document.location.href;
		return getLocalPath(decodeURIComponent(h.substr(0,h.lastIndexOf(&quot;/&quot;)+1)));
	}
	window.getParentFolder=function(cwd) {
		var lastchar=cwd.substr(cwd.length-1,1);
		if (lastchar==&quot;/&quot; || lastchar==&quot;\\&quot;) cwd=cwd.substr(0,cwd.length-1);
		var pos=cwd.lastIndexOf(&quot;/&quot;); if (pos==-1) pos=cwd.lastIndexOf(&quot;\\&quot;);
		return pos!=-1?cwd.substr(0,pos+1):null;
	}
	window.askForFolder=function(cwd) {
		if (config.browser.isIE) {
			try { // XPSP2 IE only
				var s = new ActiveXObject('UserAccounts.CommonDialog');
				s.InitialDir=cwd.replace(/\//g,&quot;\\&quot;);
				s.FileName=''; s.Filter='All files|*.*|'; s.FilterIndex=1;
				var path=s.showOpen()?s.FileName.substr(0,s.FileName.lastIndexOf(&quot;\\&quot;)+1):null;
			}
			catch(e) { var path=prompt(&quot;Enter a directory path:&quot;,cwd.replace(/\//g,&quot;\\&quot;));	}
		} else { // FireFox
			if(!window.Components) return;
			try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
			catch(e) { alert(e.description?e.description:e.toString()); return; }
			var nsIFilePicker = window.Components.interfaces.nsIFilePicker;
			var picker = Components.classes['@mozilla.org/filepicker;1'].createInstance(nsIFilePicker);
			picker.init(window, &quot;Select a folder&quot;, nsIFilePicker.modeGetFolder);
			var thispath = Components.classes['@mozilla.org/file/local;1'].createInstance(Components.interfaces.nsILocalFile);
			try { thispath.initWithPath(cwd.replace(/\\/g,&quot;/&quot;)); }
			catch(e) { thispath.initWithPath(getLocalPath(decodeURIComponent(document.location.href.substr(0,document.location.href.lastIndexOf(&quot;/&quot;)+1)))); }
			picker.displayDirectory=thispath;
			picker.appendFilters(nsIFilePicker.filterAll); picker.defaultString=''; picker.defaultExtension=''; 
			var path=picker.show()!=nsIFilePicker.returnCancel?picker.file.persistentDescriptor:null;
		}
		return path;
	}
	window.getFileList=function(cwd) { // returns array of file info (path,name,size,isFolder,url,modified)
		var files=[];
		if (config.browser.isIE) {
			cwd=cwd.replace(/\//g,&quot;\\&quot;);
			var fso = new ActiveXObject(&quot;Scripting.FileSystemObject&quot;);
			if(!fso.FolderExists(cwd)) return [];
			var dir=fso.GetFolder(cwd);
			for(var f=new Enumerator(dir.SubFolders); !f.atEnd(); f.moveNext())
				files.push({ path:f.item().path, name:f.item().name, size:f.item().size,
					url:&quot;file:///&quot;+f.item().path.replace(/\\/g,&quot;/&quot;), isFolder:fso.FolderExists(f.item().path),
					modified:new Date(f.item().DateLastModified).formatString(&quot;YYYY.0MM.0DD 0hh:0mm:0ss&quot;)});
			for(var f=new Enumerator(dir.Files); !f.atEnd(); f.moveNext())
				files.push({ path:f.item().path, name:f.item().name, size:f.item().size,
					url:&quot;file:///&quot;+f.item().path.replace(/\\/g,&quot;/&quot;), isFolder:fso.FolderExists(f.item().path),
					modified:new Date(f.item().DateLastModified).formatString(&quot;YYYY.0MM.0DD 0hh:0mm:0ss&quot;)});
		} else { // FF
			if(!window.Components) return;
			try { netscape.security.PrivilegeManager.enablePrivilege(&quot;UniversalXPConnect&quot;); }
			catch(e) { alert(e.description?e.description:e.toString()); return null; }
			var file=Components.classes[&quot;@mozilla.org/file/local;1&quot;].createInstance(Components.interfaces.nsILocalFile);
			try { file.initWithPath(cwd); } catch(e) { return []; }
			if (!file.exists() || !file.isDirectory()) { return []; }
			var folder=file.directoryEntries;
			while (folder.hasMoreElements()) {
				var f=folder.getNext().QueryInterface(Components.interfaces.nsILocalFile);
				if (f instanceof Components.interfaces.nsILocalFile)
					files.push({path:f.path, name:f.leafName, size:f.fileSize,
						isFolder:f.isDirectory(), url:&quot;file:///&quot;+f.path.replace(/\\/g,&quot;/&quot;),
						modified:new Date(f.lastModifiedTime).formatString(&quot;YYYY.0MM.0DD 0hh:0mm:0ss&quot;)});
			}
		}
		return files;
	}

	window.renderDirectoryList=function(target,cwd,fmt) {
		var files=getFileList(cwd);
		if (!files||!files.length) { // maybe relative directory... fixup and try again...
			var fixup=getCurrentFolder()+cwd;
			var files=getFileList(fixup);
			if (!files||!files.length) {
				var out=&quot;{{errorButton{error reading &quot;+cwd+&quot;}\}\}&quot;;
				removeChildren(target); wikify(out,target);
				target.style.display=&quot;block&quot;;
				return false;
			} else cwd=fixup;
		}
		if (!cwd||!cwd.length) cwd=config.options.txtLocalDirectory;
		if (!cwd||!cwd.length) cwd=getCurrentFolder();
		config.options.txtLocalDirectory=cwd;
		var header=&quot;&quot;; var item=&quot;&quot;; var folderitem=&quot;&quot;; var folderlink=&quot;&quot;; var footer=&quot;&quot;;
		switch (fmt) {
			case &quot;plain&quot;: item=folderitem=&quot;&lt;nowiki&gt;%0&lt;/nowiki&gt;\n&quot;; break;
			case &quot;list&quot;: item=folderitem=&quot;[[%1|file:///%0]]\n&quot;; break;
			default:
				var header=&quot;Index of {{{%0}\}\}\n^^(as of %1)^^\n|filename&amp;nbsp;&amp;nbsp;| size&amp;nbsp;&amp;nbsp;|modified|h\n&quot;;
				var item=&quot;|[[%1|%2]]&amp;nbsp;&amp;nbsp;| %3&amp;nbsp;&amp;nbsp;|%4|\n&quot;;
				var folderlink='&lt;html&gt;&lt;a href=&quot;javascript:;&quot; title=&quot;open %1...&quot; onclick=&quot;';
				folderlink+='	var t=this.parentNode.parentNode.parentNode.parentNode.parentNode.parentNode;';
				folderlink+=&quot;	window.renderDirectoryList(t,'%0','');&quot;;
				folderlink+='	return false;';
				folderlink+='&quot;&gt;%1&lt;/a&gt;&lt;/html&gt;';
				var folderitem='|'+folderlink+'&amp;nbsp;&amp;nbsp;| |%4|\n';
				var footer=&quot;|&gt;|&gt;|&gt;| !Total of %0 bytes in %1 files |f\n|borderless sortable|k\n&quot;;
				var showDirectory=true;
				break;
		}
		var out=header.format([cwd,new Date().toLocaleString()]);
		if (showDirectory) {
			var p=getParentFolder(cwd);
			if (p) files.unshift({path:p, name:&quot;(parent folder)&quot;, size:0, isFolder:true, url:&quot;file:///&quot;+p.replace(/\\/g,&quot;/&quot;),
				modified:new Date().formatString(&quot;YYYY.0MM.0DD 0hh:0mm:0ss&quot;)});
		}
		var total=0;
		for (var i=0; i&lt;files.length; i++) {
			var line=(files[i].isFolder?folderitem:item).format([files[i].path,files[i].name,files[i].url,files[i].size,files[i].modified]);
			if (showDirectory) line=line.replace(/\\/g,&quot;\\\\&quot;); // fixup for PC-style file paths embedded in 'folderlink'
			if (!files[i].isFolder) total+=files[i].size;
			out+=line;
		}
		out+=footer.format([total,files.length]);
		removeChildren(target); wikify(out,target); target.style.display=&quot;block&quot;;

		// make table sortable (code adapted from [[TableSortingPlugin]]
		var c = config.tableSorting; if (!c) return; // no sortable tables
		var table = target.getElementsByTagName(&quot;table&quot;)[0];
		if (table) {
			var x=null, rev,
				thead=table.getElementsByTagName('thead')[0],
				headers=thead.rows[thead.rows.length-1].cells;
			for (var j=0; j&lt;headers.length; j++){
				var h = headers[j];
				if (hasClass(h,&quot;nosort&quot;)) continue;
				h.setAttribute(&quot;index&quot;,j);
				h.onclick = function(){c.sortTable(this); return false;};
				h.ondblclick = stopEvent;
				if(h.getElementsByTagName(&quot;span&quot;).length == 0)
					createTiddlyElement(h,&quot;span&quot;,null,&quot;hidden&quot;,c.uarrow); 
				if(!x &amp;&amp; hasClass(h,&quot;autosort&quot;))
					{ x = j; rev = hasClass(h,&quot;reverse&quot;); }
			}
			if(x) c.sortTable(headers[x],rev);
		}
	}
'';}}&gt;&gt;
!end

!selectFolder
&lt;html&gt;&lt;a href='javascript:;' onclick='
	var path=askForFolder(getCurrentFolder());
	var target=this.parentNode.parentNode.parentNode.nextSibling;
	if (path) window.renderDirectoryList(target,path,&quot;&quot;);
	return false;
'&gt;select a folder&lt;/a&gt;
| &lt;a href='javascript:;' onclick='
	var target=this.parentNode.parentNode.parentNode.nextSibling;
	window.renderDirectoryList(target,getCurrentFolder(),&quot;&quot;);
	return false;
'&gt;use document location...&lt;/a&gt;
| &lt;a href='javascript:;' onclick='
	var target=this.parentNode.parentNode.parentNode.nextSibling;
	window.renderDirectoryList(target,config.options.txtLocalDirectory,&quot;&quot;);
	return false;
'&gt;refresh list...&lt;/a&gt;
&lt;nowiki&gt;&lt;/html&gt;
!end

!show
&lt;&lt;tiddler ShowLocalDirectory##init&gt;&gt;{{hidden small{
&lt;&lt;tiddler ShowLocalDirectory##selectFolder&gt;&gt;
----
}}}@@display:none;content automatically replaced@@&lt;&lt;tiddler {{
	var cwd=getCurrentFolder(); // default to current folder
	if (&quot;$1&quot;==&quot;$&quot;+&quot;1&quot;) // show 'select a folder' command
		place.lastChild.previousSibling.style.display=&quot;block&quot;;
	else if (&quot;$1&quot;.toLowerCase()==&quot;here&quot;) // use document directory
		cwd=getCurrentFolder();
	else // use path param as specified
		cwd=&quot;$1&quot;;
	window.renderDirectoryList(place.lastChild,cwd,&quot;$2&quot;);
'';}}&gt;&gt;
!end

%/&lt;&lt;tiddler {{ var src='ShowLocalDirectory'; src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show')}}
	with: [[$1]] [[$2]]&gt;&gt;</pre>
</div>
<div title="ShowSimilarTagsToThis" modifier="YourName" created="200909150319" tags="accordian attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tiddler ShowSimilarTagsToThis with: &quot;CSS&quot; limit&gt;&gt;
----
&lt;script&gt;
	var out=[]; var similar={}; var rank=[];
	var here=story.findContainingTiddler(place);
	var title='$1'!='$'+'1'?'$1':here?here.getAttribute('tiddler'):'';
	var limit='$2'!='$'+'2'?'$2':1;
	var tid=store.getTiddler(title); if (!tid) return;
	var tids=store.reverseLookup('tags','excludeLists'); // get all tiddlers (including from IncludePlugin)
	for (var i=0; i&lt;tids.length; i++) { var t=tids[i];
		if (t.title==tid.title) continue;
		var tags=[]; for (var j=0; j&lt;t.tags.length; j++)
			if (tid.tags.contains(t.tags[j])) tags.push(t.tags[j]);
		if (tags.length &gt;= limit) {
			similar[tids[i].title]=tags;
			if (!rank[tags.length]) rank[tags.length]=new Array();
			rank[tags.length].push(tids[i].title);
		}
	}
	for (var r=rank.length-1; r&gt;=0; r--) { if (!rank[r]) continue;
		out.push('*%0 shared tags:'.format([r,rank[r].length]));
		for (var t=0; t&lt;rank[r].length; t++)
			out.push('##[[%0]] ~~(&quot;&quot;&quot;%1&quot;&quot;&quot;)~~'.format([rank[r][t],similar[rank[r][t]].join(', ')]));
	}
	return out.join('\n');
&lt;/script&gt;</pre>
</div>
<div title="SideBarOptions" modifier="shankar " created="200909210450" modified="200910301138" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre></pre>
</div>
<div title="SideBarTabs" modifier="YourName" created="200909150532" modified="200911122237" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>@@font-size: 1.5em; [[Global Options]]@@
[[Calendar]]
Quick Find in User Notes:
&lt;&lt;gotoTiddler filter:&quot;aaTag&quot;&gt;&gt;
&lt;&lt;slider chkSliderSidebarTabs SliderSidebarTabs&gt;&gt;</pre>
</div>
<div title="SinglePageModePlugin" modifier="shankar " created="200508151715" modified="200910301112" tags="NavigationPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SinglePageModePlugin|
|Source|http://www.TiddlyTools.com/#SinglePageModePlugin|
|Documentation|http://www.TiddlyTools.com/#SinglePageModePluginInfo|
|Version|2.9.6|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|Show tiddlers one at a time with automatic permalink, or always open tiddlers at top/bottom of page.|
This plugin allows you to configure TiddlyWiki to navigate more like a traditional multipage web site with only one tiddler displayed at a time.
!!!!!Documentation
&gt;see [[SinglePageModePluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time
&gt;&lt;&lt;option chkSinglePagePermalink&gt;&gt; Automatically permalink current tiddler
&gt;&lt;&lt;option chkSinglePageKeepFoldedTiddlers&gt;&gt; Don't close tiddlers that are folded
&gt;&lt;&lt;option chkSinglePageKeepEditedTiddlers&gt;&gt; Don't close tiddlers that are being edited
&lt;&lt;option chkTopOfPageMode&gt;&gt; Open tiddlers at the top of the page
&lt;&lt;option chkBottomOfPageMode&gt;&gt; Open tiddlers at the bottom of the page
&lt;&lt;option chkSinglePageAutoScroll&gt;&gt; Automatically scroll tiddler into view (if needed)

Notes:
* The &quot;display one tiddler at a time&quot; option can also be //temporarily// set/reset by including a 'paramifier' in the document URL: {{{#SPM:true}}} or {{{#SPM:false}}}.
* If more than one display mode is selected, 'one at a time' display takes precedence over both 'top' and 'bottom' settings, and if 'one at a time' setting is not used, 'top of page' takes precedence over 'bottom of page'.
* When using Apple's Safari browser, automatically setting the permalink causes an error and is disabled.
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2008.10.17 [2.9.6] changed chkSinglePageAutoScroll default to false
| Please see [[SinglePageModePluginInfo]] for previous revision details |
2005.08.15 [1.0.0] Initial Release.  Support for BACK/FORWARD buttons adapted from code developed by Clint Checketts.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.SinglePageModePlugin= {major: 2, minor: 9, revision: 6, date: new Date(2008,10,17)};
//}}}
//{{{
config.paramifiers.SPM = { onstart: function(v) {
	config.options.chkSinglePageMode=eval(v);
	if (config.options.chkSinglePageMode &amp;&amp; config.options.chkSinglePagePermalink &amp;&amp; !config.browser.isSafari) {
		config.lastURL = window.location.hash;
		if (!config.SPMTimer) config.SPMTimer=window.setInterval(function() {checkLastURL();},1000);
	}
} };
//}}}
//{{{
if (config.options.chkSinglePageMode==undefined)
	config.options.chkSinglePageMode=false;
if (config.options.chkSinglePagePermalink==undefined)
	config.options.chkSinglePagePermalink=true;
if (config.options.chkSinglePageKeepFoldedTiddlers==undefined)
	config.options.chkSinglePageKeepFoldedTiddlers=false;
if (config.options.chkSinglePageKeepEditedTiddlers==undefined)
	config.options.chkSinglePageKeepEditedTiddlers=false;
if (config.options.chkTopOfPageMode==undefined)
	config.options.chkTopOfPageMode=false;
if (config.options.chkBottomOfPageMode==undefined)
	config.options.chkBottomOfPageMode=false;
if (config.options.chkSinglePageAutoScroll==undefined)
	config.options.chkSinglePageAutoScroll=false;
//}}}
//{{{
config.SPMTimer = 0;
config.lastURL = window.location.hash;
function checkLastURL()
{
	if (!config.options.chkSinglePageMode)
		{ window.clearInterval(config.SPMTimer); config.SPMTimer=0; return; }
	if (config.lastURL == window.location.hash) return; // no change in hash
	var tids=decodeURIComponent(window.location.hash.substr(1)).readBracketedList();
	if (tids.length==1) // permalink (single tiddler in URL)
		story.displayTiddler(null,tids[0]);
	else { // restore permaview or default view
		config.lastURL = window.location.hash;
		if (!tids.length) tids=store.getTiddlerText(&quot;DefaultTiddlers&quot;).readBracketedList();
		story.closeAllTiddlers();
		story.displayTiddlers(null,tids);
	}
}


if (Story.prototype.SPM_coreDisplayTiddler==undefined)
	Story.prototype.SPM_coreDisplayTiddler=Story.prototype.displayTiddler;
Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,slowly)
{
	var title=(tiddler instanceof Tiddler)?tiddler.title:tiddler;
	var tiddlerElem=document.getElementById(story.idPrefix+title); // ==null unless tiddler is already displayed
	var opt=config.options;
	var single=opt.chkSinglePageMode &amp;&amp; !startingUp;
	var top=opt.chkTopOfPageMode &amp;&amp; !startingUp;
	var bottom=opt.chkBottomOfPageMode &amp;&amp; !startingUp;
	if (single) {
		story.forEachTiddler(function(tid,elem) {
			// skip current tiddler and, optionally, tiddlers that are folded.
			if (	tid==title
				|| (opt.chkSinglePageKeepFoldedTiddlers &amp;&amp; elem.getAttribute(&quot;folded&quot;)==&quot;true&quot;))
				return;
			// if a tiddler is being edited, ask before closing
			if (elem.getAttribute(&quot;dirty&quot;)==&quot;true&quot;) {
				if (opt.chkSinglePageKeepEditedTiddlers) return;
				// if tiddler to be displayed is already shown, then leave active tiddler editor as is
				// (occurs when switching between view and edit modes)
				if (tiddlerElem) return;
				// otherwise, ask for permission
				var msg=&quot;'&quot;+tid+&quot;' is currently being edited.\n\n&quot;;
				msg+=&quot;Press OK to save and close this tiddler\nor press Cancel to leave it opened&quot;;
				if (!confirm(msg)) return; else story.saveTiddler(tid);
			}
			story.closeTiddler(tid);
		});
	}
	else if (top)
		arguments[0]=null;
	else if (bottom)
		arguments[0]=&quot;bottom&quot;;
	if (single &amp;&amp; opt.chkSinglePagePermalink &amp;&amp; !config.browser.isSafari) {
		window.location.hash = encodeURIComponent(String.encodeTiddlyLink(title));
		config.lastURL = window.location.hash;
		document.title = wikifyPlain(&quot;SiteTitle&quot;) + &quot; - &quot; + title;
		if (!config.SPMTimer) config.SPMTimer=window.setInterval(function() {checkLastURL();},1000);
	}
	if (tiddlerElem &amp;&amp; tiddlerElem.getAttribute(&quot;dirty&quot;)==&quot;true&quot;) { // editing... move tiddler without re-rendering
		var isTopTiddler=(tiddlerElem.previousSibling==null);
		if (!isTopTiddler &amp;&amp; (single || top))
			tiddlerElem.parentNode.insertBefore(tiddlerElem,tiddlerElem.parentNode.firstChild);
		else if (bottom)
			tiddlerElem.parentNode.insertBefore(tiddlerElem,null);
		else this.SPM_coreDisplayTiddler.apply(this,arguments); // let CORE render tiddler
	} else
		this.SPM_coreDisplayTiddler.apply(this,arguments); // let CORE render tiddler
	var tiddlerElem=document.getElementById(story.idPrefix+title);
	if (tiddlerElem&amp;&amp;opt.chkSinglePageAutoScroll) {
		// scroll to top of page or top of tiddler
		var isTopTiddler=(tiddlerElem.previousSibling==null);
		var yPos=isTopTiddler?0:ensureVisible(tiddlerElem);
		// if animating, defer scroll until after animation completes
		var delay=opt.chkAnimate?config.animDuration+10:0;
		setTimeout(&quot;window.scrollTo(0,&quot;+yPos+&quot;)&quot;,delay); 
	}
}

if (Story.prototype.SPM_coreDisplayTiddlers==undefined)
	Story.prototype.SPM_coreDisplayTiddlers=Story.prototype.displayTiddlers;
Story.prototype.displayTiddlers = function() {
	// suspend single/top/bottom modes when showing multiple tiddlers
	var opt=config.options;
	var saveSPM=opt.chkSinglePageMode; opt.chkSinglePageMode=false;
	var saveTPM=opt.chkTopOfPageMode; opt.chkTopOfPageMode=false;
	var saveBPM=opt.chkBottomOfPageMode; opt.chkBottomOfPageMode=false;
	this.SPM_coreDisplayTiddlers.apply(this,arguments);
	opt.chkBottomOfPageMode=saveBPM;
	opt.chkTopOfPageMode=saveTPM;
	opt.chkSinglePageMode=saveSPM;
}
//}}}</pre>
</div>
<div title="SinglePageModePluginInfo" modifier="shankar " created="200508151715" modified="200910301111" tags="pluginInfo mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|SinglePageModePluginInfo|
|Source|http://www.TiddlyTools.com/#SinglePageModePlugin|
|Documentation|http://www.TiddlyTools.com/#SinglePageModePluginInfo|
|Version|2.9.6|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|documentation|
|Description|Documentation for SinglePageModePlugin|
Normally, as you click on the links in TiddlyWiki, more and more tiddlers are displayed on the page. The order of this tiddler display depends upon when and where you have clicked. Some people like this non-linear method of reading the document, while others have reported that when many tiddlers have been opened, it can get somewhat confusing.  SinglePageModePlugin allows you to configure TiddlyWiki to navigate more like a traditional multipage web site with only one item displayed at a time.
!!!!!Usage
&lt;&lt;&lt;
When the plugin is enabled, only one tiddler will be displayed at a time and the browser window's titlebar is updated to include the current tiddler title.  The browser's location URL is also updated with a 'permalink' for the current tiddler so that it is easier to create a browser 'bookmark' for the current tiddler.  Alternatively, even when displaying multiple tiddlers //is// permitted, you can still reduce the potential for confusion by forcing  tiddlers to always open at the top (or bottom) of the page instead of being displayed following the tiddler containing the link that was clicked.
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkSinglePageMode&gt;&gt; Display one tiddler at a time
&gt;&lt;&lt;option chkSinglePagePermalink&gt;&gt; Automatically permalink current tiddler
&gt;&lt;&lt;option chkSinglePageKeepFoldedTiddlers&gt;&gt; Don't close tiddlers that are folded
&gt;&lt;&lt;option chkSinglePageKeepEditedTiddlers&gt;&gt; Don't close tiddlers that are being edited
&lt;&lt;option chkTopOfPageMode&gt;&gt; Open tiddlers at the top of the page
&lt;&lt;option chkBottomOfPageMode&gt;&gt; Open tiddlers at the bottom of the page
&lt;&lt;option chkSinglePageAutoScroll&gt;&gt; Automatically scroll tiddler into view (if needed)

Notes:
* {{block{
The &quot;display one tiddler at a time&quot; option can also be //temporarily// set/reset by including a 'paramifier' in the document URL: {{{#SPM:true}}} or {{{#SPM:false}}}. You can also use {{{SPM:expression}}}, where 'expression' is any javascript statement that evaluates to true or false.  This allows you to create hard-coded links in other documents that can selectively enable/disable the use of this option based on various programmatic conditions, such as the current username. For example, using
&amp;nbsp;&amp;nbsp;&amp;nbsp;{{{#SPM:config.options.txtUserName!=&quot;SomeName&quot;}}}
enables 'one tiddler at a time' display for all users //other than// &quot;~SomeName&quot;)}}}
* If more than one display mode is selected, 'one at a time' display takes precedence over both 'top' and 'bottom' settings, and if 'one at a time' setting is not used, 'top of page' takes precedence over 'bottom of page'.
* When using Apple's Safari browser, automatically setting the permalink causes an error and is disabled.
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2008.10.17 2.9.6 changed chkSinglePageAutoScroll default to false
2008.06.12 2.9.5 corrected 'scroll to top of page' logic in auto-scroll handling
2008.06.11 2.9.4 added chkSinglePageKeepEditedTiddlers option
2008.06.05 2.9.3 in displayTiddler(), bypass single/top/bottom mode handling if startingUp.  Allows multiple tiddlers to be displayed during startup processing (e.g., #story:DefaultTiddlers), even if single/top/bottom mode is enabled.
2008.04.18 2.9.2 in displayTiddler() and checkLastURL(), handling for Unicode in tiddler titles (remove explicit conversion between Unicode and UTF, as this is apparently done automatically by encode/decodeURIComponent, resulting in double-encoding!
2008.04.08 2.9.1 don't automatically add options to AdvancedOptions shadow tiddler
2008.04.02 2.9.0 in displayTiddler(), when single-page mode is in use and a tiddler is being edited, ask for permission to save-and-close that tiddler, instead of just leaving it open.
2008.03.29 2.8.3 in displayTiddler(), get title from tiddler object (if needed).  Fixes errors caused when calling function passes a tiddler *object* instead of a tiddler *title*
2008.03.14 2.8.2 in displayTiddler(), if editing specified tiddler, just move it to top/bottom of story *without* re-rendering (prevents discard of partial edits).
2008.03.06 2.8.1 in paramifier handler, start 'checkURL' timer if chkSinglePageMode is enabled
2008.03.06 2.8.0 added option, {{{config.options.chkSinglePageKeepFoldedTiddlers}}}, so folded tiddlers won't be closed when using single-page mode.  Also, in checkURL(), if hash is a ''permaview'' (e.g., &quot;#foo bar baz&quot;), then display multiple tiddlers rather than attempting to display &quot;foo bar baz&quot; as a single tiddler
2008.03.05 2.7.0 added support for &quot;SPM:&quot; URL paramifier
2008.03.01 2.6.0 in hijack of displayTiddler(), added 'title' argument to closeAllTiddlers() so that target tiddler isn't closed-and-reopened if it was already displayed.  Also, added config.options.chkSinglePageAutoScrolloption to bypass automatic 'scroll into view' logic (note: core still does it's own ensureVisible() handling)
2007.12.22 2.5.3 in checkLastURL(), use decodeURIComponent() instead of decodeURI so that tiddler titles with commas (and/or other punctuation) are correctly handled.
2007.10.26 2.5.2 documentation cleanup
2007.10.08 2.5.1 in displayTiddler(), when using single-page or top-of-page mode, scrollTo(0,0) to ensure that page header is in view.
2007.09.13 2.5.0 for TPM/BPM modes, don't force tiddler to redisplay if already shown.  Allows transition between view/edit or collapsed/view templates, without repositioning displayed tiddler.
2007.09.12 2.4.0 added option to disable automatic permalink feature.  Also, Safari is now excluded from permalinking action to avoid bug where tiddlers don't display after hash is updated.
2007.03.03 2.3.1 fix typo when adding BPM option to AdvancedOptions (prevented checkbox from appearing)
2007.03.03 2.3.0 added support for BottomOfPageMode (BPM) based on request from DaveGarbutt
2007.02.06 2.2.3 in Story.prototype.displayTiddler(), use convertUnicodeToUTF8() for correct I18N string handling when creating URL hash string from tiddler title (based on bug report from BidiX)
2007.01.08 2.2.2 use apply() to invoke hijacked core functions
2006.07.04 2.2.1 in hijack for displayTiddlers(), suspend TPM as well as SPM so that DefaultTiddlers displays in the correct order.
2006.06.01 2.2.0 added chkTopOfPageMode (TPM) handling
2006.02.04 2.1.1 moved global variable declarations to config.* to avoid FireFox 1.5.0.1 crash bug when assigning to globals
2005.12.27 2.1.0 hijack displayTiddlers() so that SPM can be suspended during startup while displaying the DefaultTiddlers (or #hash list).  Also, corrected initialization for undefined SPM flag to &quot;false&quot;, so default behavior is to display multiple tiddlers
2005.12.27 2.0.0 Update for TW2.0
2005.11.24 1.1.2 When the back and forward buttons are used, the page now changes to match the URL.  Based on code added by Clint Checketts
2005.10.14 1.1.1 permalink creation now calls encodeTiddlyLink() to handle tiddler titles with spaces in them
2005.10.14 1.1.0 added automatic setting of window title and location bar ('auto-permalink').  feature suggestion by David Dickens.
2005.10.09 1.0.1 combined documentation and code in a single tiddler
2005.08.15 1.0.0 Initial Release
&lt;&lt;&lt;</pre>
</div>
<div title="SiteSubtitle" modifier="YourName" created="200611232248" modified="201702182302" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&amp;#124;&lt;&lt;tiddler ToggleLeftSidebar with: &amp;larr;&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;newTiddler title: 'Create a new section' tag: 'Topics' label: 'Section' text:&quot;&quot;&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;clickify newTiddler title:{{prompt('enter a title','Anonymous Notes')}} tag: 'aaTag' text:{{new Date()}}&gt;&gt;&amp;nbsp;&amp;#124;[[KB|KB]]&amp;nbsp;&amp;#124;&lt;&lt;tiddler DailyHeader&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;tiddler DailyNotes&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;closeAll&gt;&gt;&amp;nbsp;|&lt;&lt;saveChanges&gt;&gt;&amp;nbsp;&amp;#124;[[search]]&amp;nbsp;&amp;#124;Edit: &lt;&lt;option chkDoubleClickToEdit&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;tiddler ToggleTiddlersBar with: &amp;#926; [[Tiddler Tabs Toggle]]&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;tiddler ToggleFullScreen with: &amp;loz; &amp;oplus;&gt;&gt;&amp;nbsp;&amp;#124;&lt;&lt;tiddler ToggleTiddlerTags with: tags&gt;&gt;&amp;nbsp;&amp;#124;[[XCT|Transform Office Communicator Text]]&amp;nbsp;&amp;#124;&lt;&lt;tiddler ToggleRightSidebar with: &amp;rarr;&gt;&gt;&amp;#124;</pre>
</div>
<div title="SiteTitle" modifier="YourName" created="200909150515" modified="201702182320" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>Starter&amp;nbsp;&amp;nbsp;@@font-size:60%;font-weight:normal;color: #FFFFFF;&lt;&lt;today DD-MMM &gt;&gt;@@</pre>
</div>
<div title="SiteUrl" modifier="YourName" created="200911111411" modified="200911112013" tags="aaTag excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>http:///thisIs.NOT.A.Site</pre>
</div>
<div title="SliderSidebarTabs" modifier="shankar " created="200812221548" modified="200911121657" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tabs txtMainTab &quot;Timeline&quot; &quot;Timeline&quot; TabTimeline &quot;All&quot; &quot;All tiddlers&quot; TabAll &quot;Tags&quot; &quot;All tags&quot; TabTags &quot;System --&gt;&quot; &quot;More lists&quot; TabMore&gt;&gt;</pre>
</div>
<div title="StyleSheet" modifier="Shankar" created="200909150212" modified="201109070529" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>[[JqueryTreeviewCSS-T]]
/*{{{*/

/*TiddlyWiki stuff that remains the same regardless of ColorPalette used*/
.button:hover {background:#fe8;}
#messageArea {background:#fe8;}
.popup li a:hover {background:#fe8;}
.annotation {background:#fe8;}
.highlight, .marked {background:#fe8;}
#backstageArea a:hover {background:#fe8;}
.viewer pre {border:1px solid #fe8; background:#ffc;}
.warning {background:#ffc;}
.popup li a:active {background:#ffc;}
#messageArea .button {background:#ffc;}
.wizard .button {color:[[ColorPalette::Foreground]]; background:#fe8; border: 1px solid;
	border-color:#ffc [[ColorPalette::SecondaryDark]] [[ColorPalette::SecondaryDark]] #ffc;}

/*FONT STUFF*/
body {font-family: Calibri, Arial, sans-serif; font-size: 12pt;}
h1,h2,h3,h4,h5 { color:[[ColorPalette::SecondaryPale]]; background: white; font-family: Verdana; border-bottom: none;}
.editor a {color:#dddddd;}
#editor a {color:#dddddd;}
.nowrap { white-space:nowrap;} 
.bluey {font-weight: bold; color:[[ColorPalette::SecondaryPale]] font-size: 1.3em;}
.popup li .tagger a{display:inline} 
.fontResizer {color:[[ColorPalette::SecondaryPale]]}

.toolbar a {color:[[ColorPalette::SecondaryLight]];}
.selected .toolbar a {color:[[ColorPalette::SecondaryLight]];}
.selected .toolbar a:hover {color:[[ColorPalette::SecondaryLight]];}

/* SHORTENS THE HEIGHT OF THE HEADER */
.headerShadow {padding: 1em 0em .4em 1em;}
.headerForeground {padding: 1em 0em .4em 1em;}
.siteTitle {font-size:1.5em;}
.siteSubtitle {font-size:1em;}

/*MAINMENU*/
#mainMenu {width: 10.0em; text-align: left; font-size: .85em; overflow: hidden;}
/* #displayArea {margin: 0em 15em 0em 16.5em;}  - shankar */
#displayArea {margin: 0.5em 15em 0em 10.0em;}  /* top, right, bottom, left */

/*TABLE HEADER*/
.viewer th {color: #000; background-color: #eeeeee;} 

/*TIDDLER TOPMARGIN AND BUTTON BORDER*/
a.button{border: 0;}  
.viewer { margin-top: .1em; } 
.viewer {line-height: 1.7em;}

/* TAGS DISPLAY - shankar swamy */
.tagged li { display:inline; }
.tagged { display:block; clear:both; width:98%; }

/*TIDDLER TITLE COLOR MATCH BOTTOM OF HEADER*/
.title {color:[[ColorPalette::PrimaryMid]];}
/*UNORDERED and ORDERED LISTS TWEAK*/
.viewer li {padding-top: 0.5em; padding-bottom: 0.5em;} 
/*LINELESS BLOCKQUOTES*/
.viewer blockquote {border-left: 0px; margin-top:0em; margin-bottom:0em; }

/*INVISIBLE TABLE*/
.viewer .invisiblecomm table {border-color: white;}
.viewer .invisiblecomm table td { font-size: 1em; font-family: Verdana; border-color: white; padding: 10px 20px 10px 0px; text-align: left; vertical-align: top; padding: 20px;} 
.viewer .invisiblecomm table th { color:[[ColorPalette::SecondaryLight]]; background-color: white; border-color: white; font-family: Verdana; font-size: 1.2em; font-weight: bold; padding: 10px 20px 10px 0px; text-align: left; vertical-align: top;} 
.viewer .invisiblecomm table tr.leftColumn { background-color: #bbbbbb; }

/*TOPMENU*/
#topMenu {padding-left: 1em; background-color: [[ColorPalette::PrimaryPale]]; color: #110077; font-family: Trebuchet MS, Verdana; font-size: 13pt; line-height: 1em;}
#topMenu table td {margin: 10px;}
#topMenu .purple a {color:[[ColorPalette::SecondaryPale]]}

/*TABS - see also stylesheettiddlersbar*/
.tabSelected{color:[[ColorPalette::PrimaryDark]];
	background:[[ColorPalette::TertiaryPale]];
	border-left:1px solid [[ColorPalette::TertiaryLight]];
	border-top:1px solid [[ColorPalette::TertiaryLight]];
	border-right:1px solid [[ColorPalette::TertiaryLight]];
}
.tabUnselected {color:[[ColorPalette::Background]]; background:[[ColorPalette::TertiaryMid]];}
.tabContents {background:white; border:1px solid [[ColorPalette::TertiaryLight]];}
.tabContents .button {border:0;}

/*ROUNDED CORNERS AND BORDERS*/
.tiddler {
  border-top:    1px solid #ccc; 
  border-left:   1px solid #ccc; 
  border-bottom: 3px solid #ccc; 
  border-right:  3px solid #ccc; 
  margin: 0.5em; 
  background:#fff; 
  padding: 0.5em; 
  -moz-border-radius: 1em; }
#messageArea { 
  background-color: #eee; 
  border-color: #8ab; 
  border-width: 4px; 
  border-style: dotted; 
  font-size: 90%; 
  padding: 0.5em; 
  -moz-border-radius: 1em; }

/* TAB COLOR FIX */
.tabUnselected {color:#777777;}

/* GIFFMEX TWEAKS TO STYLESHEETPRINT (so that nothing but tiddler title and text are printed) */
@media print {#mainMenu {display: none ! important;}}
@media print {#topMenu {display: none ! important;}}
@media print {#sidebar {display: none ! important;}}
@media print {#messageArea {display: none ! important;}} 
@media print {#toolbar {display: none ! important;}}
@media print {.header {display: none ! important;}}
@media print {.tiddler .subtitle {display: none ! important;}}
@media print {.tiddler .toolbar {display; none ! important; }}
@media print {.tiddler .tagging {display; none ! important; }}
@media print {.tiddler .tagged {display; none ! important; }}
@media print {#displayArea {margin: 1em 1em 0em 1em;}}
@media print {.pageBreak {page-break-before: always;}}
/*}}}*/
[[StyleSheetSNS]]</pre>
</div>
<div title="StyleSheetSNS" modifier="YourName" created="200910080125" modified="201404242306" tags="mySystem aaTag excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/*{{{*/
a {color: [[ColorPalette::SecondaryD]];} 
a:hover, .header a:hover, .tiddlersBar a:hover {background-color: [[ColorPalette::PrimaryC]]; color: [[ColorPalette::TertiaryA]];}
.treeview a:hover, .treeview ul a:hover {color: [[ColorPalette::TertiaryA]];}

body {background: [[ColorPalette::PrimaryA]]; color: [[ColorPalette::SecondaryA]]; background-image: [[ColorPalette::BGImage]]; }
#backstageButton{ display: inline !Important; }
/* Shadow header is the header that is really visible! */
.headerShadow{ padding: 0 0 0 0; line-height: 1.6em; 
[[ColorPalette::SecondaryC]]; /* background-color: [[ColorPalette::TertiaryA]]; */ }

/* This determines the color of the tiddler links in the SiteSubtitle */
.header { background-color: [[ColorPalette::PrimaryA]];}
.header a { color: [[ColorPalette::SecondaryD]]; }
.siteTitle {font-size: 24pt; padding: 0 0 0 30px; }
/* following: 'create ... (...) date'
.siteSubtitle {font-size:1.0em; font-weight: normal; padding: 0 0 0 0.2em;
               color: [[ColorPalette::SecondaryD]]; }

#displayArea{ margin: 0 15em 0 10em; }

/* remove bold face fonts for links to existing tiddlers */
.tiddlyLinkExisting{ font-weight: normal !Important; color: [[ColorPalette::TertiaryB]]; }
.tiddlyLinkNonExisting { color: [[ColorPalette::TertiaryD]]; }

/*ROUNDED CORNERS AND BORDERS*/
.tiddler {
  border: 0; margin: 0; padding: 0; -moz-border-radius: 0em;
  border-color: [[ColorPalette::PrimaryA]]; 
  background-color: [[ColorPalette::PrimaryA]];
  border-width: 0 0 0 0 ; 
  }
.tiddler .button{ color: [[ColorPalette::SecondaryD]]; } 
.tiddler .button:hover{background-color: [[ColorPalette::PrimaryC]];}
.title {color: [[ColorPalette::TertiaryC]]; } 
/* 'created date': */
.subtitle{ color: [[ColorPalette::SecondaryD]]; }

#messageArea { 
  border-width: 0px; border-style: dotted; font-size: 90%; 
  padding: 0.5em; -moz-border-radius: 0em; }

.title{ font-size: 1.6em; font-weight: normal; }
/*  Tiddler Display Tabs  */

#tiddlersBar {
    line-height: 1.4em; background-color: [[ColorPalette::PrimaryD]];
    .tabUnselected .tabButton {
        font-size:0.75em;
        padding : 0px 2px 0px 2px; margin: 0 0 0 1px;}
    .tabSelected .tabButton {
        font-size:0.75em;color:#000;font-weight:bold;
        padding : 0px 2px 0px 2px; margin: 0 0 0 1px;}
    .tabSelected .tabButton:hover {font-weight:bold; }
    .tabUnselected .tabButton:hover {background-color: [[ColorPalette::TertiaryA]];}
    .tabContents {border-top:0px; margin-left:0.5em; margin-right:0.5em;} 
 }
.button:hover {background: [[ColorPalette::PrimaryC]]; }  /* tiddlers bar tabs color */
 
.viewer  { line-height: 1.2em;  font-weight: normal; 
           display: block !important; text-align: justify !important; 
           max-width: 800px !important; }   
.viewer ol li {padding-top: 0em; padding-bottom: 0em; line-height: 1.0em;} 
.viewer ul li { padding-top: 0em; padding-bottom: 0em; line-height: 1.2em; }

.viewer pre {border:0; 
             background-color: [[ColorPalette::PrimaryB]];
	     color: [[ColorPalette::TertiaryA]];
             line-height: 1.2em;
             font-size: 1.0em;
             text-align: justify !Important;
             white-space: pre; 
             margin-left: 0;
             padding: 0 0 0 0; }
.viewer code { font-size: 1.0em; line-height: 1.2em; color: [[ColorPalette::SecondaryA]]; }


/* Calendar colors are customized via CoreConfigsOverrides tiddler */
.calendar, .calendar table, .calendar th, .calendar tr, .calendar td {
font-size:1.6em; line-height:1em; text-align:center; }

/* Treeview (left sidebar) */
#mainMenu{ background-color: [[ColorPalette::PrimaryC]]; }

h1, h2, h3, h4, h5, h6, h7 { 
    font-family: Verdana; 
    background: transparent;
    font-weight: normal;
    font-size: 1.0em; 
    line-height: 140%;
    margin-top: 0px;
    margin-bottom: 0px;
    padding: 0px;
}
h1 { color: [[ColorPalette::H1]]; }
h2 { color: [[ColorPalette::H2]]; }
h3 { color: [[ColorPalette::H3]]; }
h4 { color: [[ColorPalette::H4]]; }
h5 { color: [[ColorPalette::H5]]; }
h6 { color: [[ColorPalette::H6]]; }

.tagged li { display:inline; }
.tagged, .selected .tagged{ 
              display: none; width: 100%; 
              border: 0 none; font-size: 0.9em; 
              padding: 0;  margin: 0;}
.tagged ul a{ background-color: [[ColorPalette::PrimaryA]]; color: [[ColorPalette::SecondaryC]]; }
.tagged ul a:hover{ color: [[ColorPalette::SecondaryD]]; }

#sidebar{ background-color: [[ColorPalette::PrimaryC]]; color: [[ColorPalette::SecondaryA]];}
#sidebarTabs{ background-color: inherit; }
.tabSelected{ background-color: [[ColorPalette::PrimaryD]]; color: [[ColorPalette::SecondaryA]];}
.tabUnselected{ background-color: [[ColorPalette::PrimaryC]]; color: [[ColorPalette::SecondaryA]]; }
.tabSelected, .tabUnselected { -moz-border-radius-topleft: 0.4em; -moz-border-radius-topright: 0.4em; }
.tabUnselected:hover{ background-color: [[ColorPalette::PrimaryC]]; } 
.tabSelected:hover { background-color: [[ColorPalette::SecondaryC]]; }
.tabContents{ background-color: inherit;  }

.viewer table {border:2px solid [[ColorPalette::TertiaryA]]; background-color: [[ColorPalette::TableBackgroundColor]];}
.viewer th, .viewer table td, .table th, .twtable thead td {background-color:#00C20; border:1px solid ; color::[[ColorPalette::SecondaryC]];}
.viewer td, .viewer tr {border:1px solid SecondaryD;} 

.SlTidIDEStyles{ background-image: [[ColorPalette::EditImage]]; }
/* mainly colors the labels of the bottom most elments of the TidIDE editor */
.SlTidIDEStyles {  color: [[ColorPalette::TidIDEDefaultColor]]; 
                   background-color: [[ColorPalette::TidIDEDefaultBackground]];}
/* text-area of the TidIDE Editor */
.SlTidIDEStyles textarea { color: [[ColorPalette::TidIDETextareaColor]]; 
                           background-color: [[ColorPalette::TidIDETextareaBG]]; font-size: 1.2em; background-image: [[ColorPalette::EditImage]];}

.tidIDEPanel input[type='button'] { color: [[ColorPalette::TidIDEButtonsColor]]; background-image: [[ColorPalette::EditImage]];  background-color: [[ColorPalette::TidIDEButtonsBG]];  } 
/* TidIDE tags display */
.tidIDEPanel select { color: [[ColorPalette::TidIDETagsSelectColor]]; 
                     background-color: [[ColorPalette::TidIDETagsSelectBG]]; }
.tidIDEPanel input {color: [[ColorPalette::TidIDESelectedColor]]; background-color: [[ColorPalette::TidIDESelectedBG]]; } 
/* the editor is reduced to a single line - we need it for the treeview to work properly */
.editor, .editor input, .editor textarea{ display: none; }

.c0 {color: [[ColorPalette::SecondaryA]];}
.c1 {color: [[ColorPalette::H1]];}
.c2 {color: [[ColorPalette::H2]];}
.c3 {color: [[ColorPalette::H3]];}
.c4 {color: [[ColorPalette::H4]];}
.c5 {color: [[ColorPalette::H5]];}
.c6 {color: [[ColorPalette::H6]];}

.quote {display: inline-block;  background: [[ColorPalette::PrimaryB]];
}
.quote:before, .quote:after {
  background: [[ColorPalette::PrimaryB]];
  color: [[ColorPalette::SecondaryD]];
  font-weight: bold;
  content: &quot;\&quot;&quot;
}
/*}}}*/</pre>
</div>
<div title="StyleSheetSNS-Work" modifier="Shankar Swamy" created="201112281857" modified="201201120603" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/*{{{*/
.tabContents li.listLink { 
	margin-left: 1.0em; color: red; }
.tabContents h1.listTitle .tiddlyLinkExisting {
	font-weight: bold; color: #009932; }
.tabContents h1.listTitle .tiddlyLinkNonExisting {
	font-weight: normal; font-style: oblique; color: #7F723F; }

.bigFont {
	color: [[ColorPalette::H2]];
	font-size:2.0em;
	text-decoration: underline;
}
/*}}}*/</pre>
</div>
<div title="StyleSheetShortcuts" modifier="shankar " created="200611070646" modified="200910301131" tags="Note aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|StyleSheetShortcuts|
|Source|http://www.TiddlyTools.com/#StyleSheetShortcuts|
|Version||
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|CSS|
|Description|'convenience' classes for common formatting, alignment, boxes, tables, etc.|

These 'style tweaks' can be easily included in other stylesheet tiddler so they can share a baseline look-and-feel that can then be customized to create a wide variety of 'flavors'.
***/
/*{{{*/

/* text alignments */
.left
	{ display:block;text-align:left; }
.center
	{ display:block;text-align:center; }
.center table
	{ margin:auto !important; }
.right	
	{ display:block;text-align:right; }
.justify
	{ display:block;text-align:justify; }
.indent
	{ display:block;margin:0;padding:0;border:0;margin-left:2em; }
.floatleft
	{ float:left; }
.floatright
	{ float:right; }
.valignTop, .valignTop table, .valignTop tbody, .valignTop th, .valignTop tr, .valignTop td
	{ vertical-align:top; }
.valignBottom, .valignBottom table, .valignBottom tbody, .valignBottom th, .valignBottom tr, .valignBottom td
	{ vertical-align:bottom; }
.clear
	{ clear:both; }
.wrap
	{ white-space:normal; }
.nowrap
	{ white-space:nowrap; }
.hidden
	{ display:none; }
.show
	{ display:inline !important; }
.span
	{ display:span; }
.block
	{ display:block; }
.relative
	{ position:relative; }
.absolute
	{ position:absolute; }

/* font sizes */
.big
	{ font-size:14pt;line-height:120% }
.medium
	{ font-size:12pt;line-height:120% }
.normal
	{ font-size:9pt;line-height:120% }
.small
	{ font-size:8pt;line-height:120% }
.fine
	{ font-size:7pt;line-height:120% }
.tiny
	{ font-size:6pt;line-height:120% }
.larger
	{ font-size:120%; }
.smaller
	{ font-size:80%; }

/* font styles */
.bold
	{ font-weight:bold; }
.italic
	{ font-style:italic; }
.underline
	{ text-decoration:underline; }

/* plain list items (no bullets or indent) */
.nobullets li { list-style-type: none; margin-left:-2em; }

/* vertical tabsets - courtesy of Tobias Beer */
.vTabs .tabset {float:left;display:block;padding:0px;margin-top:.5em;min-width:20%;}
.vTabs .tabset .tab {display:block;text-align:right;padding:2px 3px 2px 7px; margin:0 1px 1px 0;}
.vTabs .tabContents {margin-left:20%;max-width:80%;padding:5px;}
.vTabs .tabContents .tabContents {border:none; background:transparent;}

/* multi-column tiddler content (not supported in Internet Explorer) */
.twocolumns { display:block;
	-moz-column-count:2; -moz-column-gap:1em; -moz-column-width:50%; /* FireFox */
	-webkit-column-count:2; -webkit-column-gap:1em; -webkit-column-width:50%; /* Safari */
	column-count:2; column-gap:1em; column-width:50%; /* Opera */
}
.threecolumns { display:block;
	-moz-column-count:3; -moz-column-gap:1em; -moz-column-width:33%; /* FireFox */
	-webkit-column-count:3; -webkit-column-gap:1em; -webkit-column-width:33%; /* Safari */
	column-count:3; column-gap:1em; column-width:33%; /* Opera */
}
.fourcolumns { display:block;
	-moz-column-count:4; -moz-column-gap:1em; -moz-column-width:25%; /* FireFox */
	-webkit-column-count:4; -webkit-column-gap:1em; -webkit-column-width:25%; /* Safari */
	column-count:4; column-gap:1em; column-width:25%; /* Opera */
}

/* page breaks */
.breakbefore { page-break-before:always; }
.breakafter { page-break-before:always; } 

/* show/hide browser-specific content for InternetExplorer vs. non-IE (&quot;moz&quot;) browsers */
*[class=&quot;ieOnly&quot;]
	{ display:none; } /* hide in moz (uses CSS selector) */
* html .mozOnly, *:first-child+html .mozOnly
	{ display: none; } /* hide in IE (uses IE6/IE7 CSS hacks) */

/* borderless tables */
.borderless, .borderless table, .borderless td, .borderless tr, .borderless th, .borderless tbody
	{ border:0 !important; margin:0 !important; padding:0 !important; }
.widetable, .widetable table
	{ width:100%; }

/* thumbnail images (fixed-sized scaled images) */
.thumbnail img { height:5em !important; }

/* stretchable images (auto-size to fit tiddler) */
.stretch img { width:95%; }

/* grouped content */
.outline
	{ display:block; padding:1em; -moz-border-radius:1em;-webkit-border-radius:1em; border:1px solid; }
.menubox
	{ display:block; padding:1em; -moz-border-radius:1em;-webkit-border-radius:1em; border:1px solid; background:#fff; color:#000; }
.menubox .button, .menubox .tiddlyLinkExisting, .menubox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.groupbox
	{ display:block; padding:1em; -moz-border-radius:1em;-webkit-border-radius:1em; border:1px solid; background:#ffe; color:#000; }
.groupbox a, .groupbox .button, .groupbox .tiddlyLinkExisting, .groupbox .tiddlyLinkNonExisting
	{ color:#009 !important; }
.groupbox code
	{ color:#333 !important; }
.borderleft
	{ margin:0;padding:0;border:0;margin-left:1em; border-left:1px dotted; padding-left:.5em; }
.borderright
	{ margin:0;padding:0;border:0;margin-right:1em; border-right:1px dotted; padding-right:.5em; }
.borderbottom
	{ margin:0;padding:1px 0;border:0;border-bottom:1px dotted; margin-bottom:1px; padding-bottom:1px; }
.bordertop
	{ margin:0;padding:0;border:0;border-top:1px dotted; margin-top:1px; padding-top:1px; }

/* scrolled content */
.scrollbars { overflow:auto; }
.height10em { height:10em; }
.height15em { height:15em; }
.height20em { height:20em; }
.height25em { height:25em; }
.height30em { height:30em; }
.height35em { height:35em; }
.height40em { height:40em; }

/* compact form */
.smallform
	{ white-space:nowrap; }
.smallform input, .smallform textarea, .smallform button, .smallform checkbox, .smallform radio, .smallform select
	{ font-size:8pt; }

/* stretchable edit fields and textareas (auto-size to fit tiddler) */
.stretch input { width:99%; }
.stretch textarea { width:99%; }

/* compact input fields (limited to a few characters for entering percentages and other small values) */
.onechar input   { width:1em; }
.twochar input   { width:2em; }
.threechar input { width:3em; }
.fourchar input  { width:4em; }
.fivechar input  { width:5em; }

/* text colors */
.white { color:#fff !important }
.gray  { color:#999 !important }
.black { color:#000 !important }
.red   { color:#f66 !important }
.green { color:#0c0 !important }
.blue  { color:#99f !important }

/* rollover highlighting */
.mouseover 
	{color:[[ColorPalette::TertiaryLight]] !important;}
.mouseover a
	{color:[[ColorPalette::TertiaryLight]] !important;}
.selected .mouseover
	{color:[[ColorPalette::Foreground]] !important;}
.selected .mouseover .button, .selected .mouseover a
	{color:[[ColorPalette::PrimaryDark]] !important;}

/* rollover zoom text */
.zoomover
	{ font-size:80% !important; }
.selected .zoomover
	{ font-size:100% !important; }

/* [[ColorPalette]] text colors */
.Background	{ color:[[ColorPalette::Background]];	 }
.Foreground	{ color:[[ColorPalette::Foreground]];	 }
.PrimaryPale	{ color:[[ColorPalette::PrimaryPale]];	 }
.PrimaryLight	{ color:[[ColorPalette::PrimaryLight]];	 }
.PrimaryMid	{ color:[[ColorPalette::PrimaryMid]];	 }
.PrimaryDark	{ color:[[ColorPalette::PrimaryDark]];	 }
.SecondaryPale	{ color:[[ColorPalette::SecondaryPale]]; }
.SecondaryLight	{ color:[[ColorPalette::SecondaryLight]];}
.SecondaryMid	{ color:[[ColorPalette::SecondaryMid]];	 }
.SecondaryDark	{ color:[[ColorPalette::SecondaryDark]]; }
.TertiaryPale	{ color:[[ColorPalette::TertiaryPale]];	 }
.TertiaryLight	{ color:[[ColorPalette::TertiaryLight]]; }
.TertiaryMid	{ color:[[ColorPalette::TertiaryMid]];	 }
.TertiaryDark	{ color:[[ColorPalette::TertiaryDark]];	 }
.Error		{ color:[[ColorPalette::Error]];	 }

/* [[ColorPalette]] background colors */
.BGBackground	  { background-color:[[ColorPalette::Background]];	}
.BGForeground	  { background-color:[[ColorPalette::Foreground]];	}
.BGPrimaryPale	  { background-color:[[ColorPalette::PrimaryPale]];	}
.BGPrimaryLight	  { background-color:[[ColorPalette::PrimaryLight]];	}
.BGPrimaryMid	  { background-color:[[ColorPalette::PrimaryMid]];	}
.BGPrimaryDark	  { background-color:[[ColorPalette::PrimaryDark]];	}
.BGSecondaryPale  { background-color:[[ColorPalette::SecondaryPale]]; 	}
.BGSecondaryLight { background-color:[[ColorPalette::SecondaryLight]];	}
.BGSecondaryMid	  { background-color:[[ColorPalette::SecondaryMid]];	}
.BGSecondaryDark  { background-color:[[ColorPalette::SecondaryDark]]; 	}
.BGTertiaryPale	  { background-color:[[ColorPalette::TertiaryPale]];	}
.BGTertiaryLight  { background-color:[[ColorPalette::TertiaryLight]]; 	}
.BGTertiaryMid	  { background-color:[[ColorPalette::TertiaryMid]];	}
.BGTertiaryDark	  { background-color:[[ColorPalette::TertiaryDark]];	}
.BGError	  { background-color:[[ColorPalette::Error]];	 	}
/*}}}*/</pre>
</div>
<div title="StyleSheetTiddlersBar" modifier="shankar " created="200909210403" modified="200910301138" tags="Note aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>!!!StyleSheetTiddlersBar
/*{{{*/
.button {border:1px; color:#777777;}
.tab {white-space:nowrap;}
 {padding : 0.45em 0.5em 0.0em 1.0em;margin-left:0em;margin-right:0em}
 {margin-bottom:0px;}

 .tabSelected .button:hover {font-size:0.95em; color:[[ColorPalette::SecondaryPale]]; background: #fff;padding : 0px 0px 0px 2px;}
 .tabUnselected .button:hover {font-size:0.95em;color:[[ColorPalette::SecondaryPale]]; background: #fff; padding : 0px 0px 0px 2px;}

 .tabUnselected .button {font-size:0.95em; color:[[ColorPalette::SecondaryPale]]; padding : 0px 0px 0px 2px;}
 .tabSelected .button {font-size:0.95em; font-weight:bold; color:[[ColorPalette::SecondaryPale]];padding : 0px 0px 0px 2px;}

 .tabSelected {background-color:white;font-weight:bold;color:[[ColorPalette::PrimaryMid]];border: 0px #c06 solid;border-bottom:0px; font-size:0.95em;}

 .tabUnselected {
background-color:[[ColorPalette::TertiaryPale]];
border:0px #eee solid; border-bottom:0px;font-size:0.95em; }

.tabUnselected .tabButton {font-size:0.75em;color:#333;background:transparent; padding : 0px 2px 0px 2px; margin: 0 0 0 1px;}
.tabSelected .tabButton {font-size:0.75em;color:#000;font-weight:bold;background:transparent;padding : 0px 2px 0px 2px; margin: 0 0 0 1px;}

.tabSelected .tabButton:hover {font-weight:bold; color: #f00;background: #fff;}
.tabUnselected .tabButton:hover {color: #f00;background: #fff;}

.tiddler, .tabContents {border-top:0px #fa0 solid;margin-left:0.5em;margin-right:0.5em;}
#tiddlersBar  {background:#abf;line-height: 1em;}
#tiddlersBar  {background:[[ColorPalette::PrimaryPale]];}
/*}}}*/</pre>
</div>
<div title="Syntax Help" modifier="Shankar" created="200708241853" modified="201106162013" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>!Reference to ~TiddlyWiki Markups:
!!Related: [[Internal Macros]] (particuarly for the {{{&lt;&lt;br&gt;&gt;}}} macro that inserts a new line),  [[TiddlerListMacro]] &amp; [[TiddlerListMacroExtendedInfo]].
!Basic Formatting
|!Format|!Markup|!Example|
|Bold|{{{''Bold''}}} (2 single quotes)|''Bold''|
|Highlight|{{{@@Highlight@@}}}|@@Highlight@@|
|CSS Extended Highlights|{{{@@some css;Highlight@@}}}&lt;&lt;br&gt;&gt;For backwards compatibility, the following highlight syntax is also accepted:{{{@@bgcolor(#ff0000):color(#ffffff):red coloured@@}}}|@@background-color:#ff0000;color:#ffffff;red coloured@@&lt;&lt;br&gt;&gt;&lt;&lt;slider AtEg ./atEg 'Extended example ...'&gt;&gt;|
|Custom CSS Class|&lt;html&gt;&lt;code&gt;{{wrappingClass{Text that is now accentuated}}}&lt;/code&gt;&lt;/html&gt;&lt;&lt;br&gt;&gt;By default, the text is placed in a &lt;span&gt;. To use a &lt;div&gt; instead, insert a line break before the text (after the single {)&lt;&lt;br&gt;&gt;In the CSS: {{{.wrappingClass {color: red;} }}}|Add .wrappingClass to StyleSheet|
|Italic|{{{//Italic//}}}|//Italic//|
|Monospaced text|&lt;html&gt;&lt;code&gt;{{{ ... }}}&lt;/code&gt;&lt;/html&gt;|{{{Monospaced text}}}|
|Monospaced block multiline|Put &lt;html&gt;&lt;code&gt;{{{&lt;/code&gt;&lt;/html&gt; and &lt;html&gt;&lt;code&gt;}}}&lt;/code&gt;&lt;/html&gt; on their own lines|&lt;html&gt;&lt;pre&gt;{{{&lt;br/&gt;Monospaced&lt;br/&gt;Multi-line&lt;br/&gt;Block&lt;br/&gt;}}}&lt;/pre&gt;&lt;/html&gt;|
|Strikethough|{{{--Strikethrough--}}}|--Strikethrough--|
|Subscript|{{{~~Subscript~~}}}|Text~~Subscript~~|
|Superscript|{{{^^Superscript^^}}}|Text^^Superscript^^|
|Underlined|{{{__Underline__}}}(2 underscores)|__Underscored__|
|Any HTML|{{{&lt;html&gt;&lt;span&gt;any&lt;/span&gt;&lt;br /&gt;&lt;b&gt;valid&lt;/b&gt; &lt;em&gt;xhtml&lt;/em&gt;&lt;/html&gt;}}}|&lt;html&gt;&lt;span&gt;any&lt;/span&gt;&lt;br /&gt;&lt;b&gt;valid&lt;/b&gt; &lt;em&gt;xhtml&lt;/em&gt;&lt;/html&gt;|
!&quot;Document&quot; Structure
|!Format|!Markup|!Example|
|Headings|{{{!Heading 1}}}&lt;&lt;br&gt;&gt;{{{!!Heading 2}}}&lt;&lt;br&gt;&gt;{{{!!Heading 3}}}&lt;&lt;br&gt;&gt;{{{!!Heading 4}}}&lt;&lt;br&gt;&gt;{{{!!Heading 5}}}|&lt;html&gt;&lt;h1&gt;Heading 1&lt;/h1&gt;&lt;h2&gt;Heading 2&lt;/h2&gt;&lt;h3&gt;Heading 3&lt;/h3&gt;&lt;h4&gt;Heading 4&lt;/h4&gt;&lt;h5&gt;Heading 5&lt;/h5&gt;&lt;/html&gt;|
|Any HTML|{{{&lt;html&gt;&lt;p&gt;any valid xhtml&lt;/p&gt;&lt;/html&gt;}}}|&lt;html&gt;&lt;p&gt;any valid xhtml&lt;/p&gt;&lt;/html&gt;|
|Block quotes|{{{&gt;Blockquote}}}&lt;&lt;br&gt;&gt;Can be nested using multiple &gt;|&lt;html&gt;&lt;blockquote&gt;Blockquote&lt;blockquote&gt;Nested Blockquote&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/html&gt;|
|Blockquotes - Multiline|&lt;html&gt;&lt;tt&gt;&lt;&lt;&lt;&lt;/tt&gt;&lt;br/&gt;multi-line&lt;br/&gt;blockquote&lt;br/&gt;&lt;tt&gt;&lt;&lt;&lt;&lt;/tt&gt;&lt;/html&gt; |&lt;html&gt;&lt;blockquote&gt;multi-line&lt;br/&gt;blockquote&lt;/blockquote&gt;&lt;/html&gt;|
|Horizontal Rule|{{{----}}} (4 dashes on a line of their own)|&lt;html&gt;&lt;hr&gt;&lt;/html&gt;|
|Images|{{{[img[favicon.ico]]}}}&lt;&lt;br&gt;&gt;Note that image files are always external to the TW file|[img[http://www.tiddlywiki.com/favicon.ico]]|
|Inline Comments|{{{/% .... %/}}}&lt;&lt;br&gt;&gt;Text between the markers will not be shown in view mode|Not shown: /% Not Shown %/|
|Links|Any WikiWord (creates a link to a tiddler whether it exists or not).&lt;&lt;br&gt;&gt;Note that a WikiWord has to start with a capital letter and have a further mix of upper and lower case.|PageTemplate|
|~|{{{[[Manual Link]]}}} (Especially for tiddlers with spaces in their titles)|[[Table of Contents]]|
|~|{{{[[Pretty Link|Some Crafty Link]]}}}&lt;&lt;br&gt;&gt;Note: Makes an external link if the target does not yet exist (e.g. {{{[[Not Yet A Tiddler|NotYetATiddler]]}}})|[[Pretty Link|MainMenu]]&lt;&lt;br&gt;&gt;[[Not Yet A Tiddler|NotYetATiddler]]|
|~|Automatic external link {{{http://www.knightnet.org.uk}}}|http://www.knightnet.org.uk|
|~|Pretty external link&lt;&lt;br&gt;&gt;{{{[[My Home Page|http://www.knightnet.org.uk]]}}}|[[My Home Page|http://www.knightnet.org.uk]]|
|~|OS Folder link&lt;&lt;br&gt;&gt;Windows Share: {{{file://///server/share}}}&lt;&lt;br&gt;&gt;Windows Local: {{{file:///c:/folder/file}}}&lt;&lt;br&gt;&gt;Un*x Local File: {{{file://folder/file}}}&lt;&lt;br&gt;&gt;Relative File: {{{folder/file}}}||
|List - Bulleted|{{{* List entry}}}|&lt;html&gt;&lt;ul&gt;&lt;li&gt;Bullet List&lt;/li&gt;&lt;/ul&gt;&lt;/html&gt;|
|List - Numbered|{{{# List entry}}}|&lt;html&gt;&lt;ol&gt;&lt;li&gt;Numbered List&lt;/li&gt;&lt;/ol&gt;&lt;/html&gt;|
|List - Nested|Both list types can be nested by using multiple * or #&lt;&lt;br&gt;&gt;Note that * and # must be the first character of the line as with all block format markup.&lt;&lt;br&gt;&gt;{{{* 1st level}}}&lt;&lt;br&gt;&gt;{{{** 2nd level}}}|&lt;&lt;tiddler ./nestedListEg&gt;&gt;|
|Tables| {{{|}}} |Column Seperator |
|~| {{{!}}} |Header (Row or Column) |
|~| {{{&gt;}}} |Column Span |
|~| {{{~}}} |Row Span |
|~| {{{|Left |}}} |Left Align |
|~| {{{| Right|}}} |Right Align|
|~| {{{| Center |}}} |Center Align |
|~| {{{|Caption|c}}} |Table Caption (Can be at top or bottom)|
|~| {{{|Header|h}}} |Marks the row as being a header row (will be wrapped with a {{{&lt;thead&gt;}}} and so all entries are automatically formatted as per {{{|!}}} cells)|
|~| {{{|Footer|f}}} |Marks the row as being a footer row (will be wrapped with a {{{&lt;tfoot&gt;}}}, no special formatting is pre-defined for this but can be added to your own CSS)|
|~| {{{|CSSclass|k}}} |Applies a CSS class to the table to allow additional formatting (NB: only works if no whitespace after the k)|
|~|&gt;|Note that the additional CSS classes evenRow and oddRow are automatically applied to all rows of the table. But evenRow is applied to the &quot;first&quot; row as per JavaScript convention (it is the zero'th row which is strangely considered even!).|
|~|&gt;|To have a table with no borders at all. Use {{{|noBorder|k}}} with the CSS (in your StyleSheet tiddler):&lt;&lt;br&gt;&gt;{{{ .noBorder,.noBorder td,.noBorder th,.noBorder tr{border:0 !important} }}}|
|Table Sample|&lt;&lt;tiddler ./tblMarkup&gt;&gt;|&lt;&lt;tiddler ./tblShow&gt;&gt;|
!Notes
You can use the custom CSS formatter in combination with headers and lists to allow new lines within the entry. e.g.:
{{{
#{{block{
Bullet 1
Some text in the same bullet
(Note that &quot;block&quot; can be anything, it is the formatters CSS class name)
 }}}
# Bullet 2 
}}}
#{{block{
Bullet 1
Some text in the same bullet
}}}
# Bullet 2 

(Julian Knight, 2006-05-11)
&lt;part atEg hidden&gt;
{{{
This is before the indented text
@@display:block;margin-left:2em;This text will be indented...
...and can even span across several lines...

...or even include blank lines.
@@This is after the indented text 
}}}
This is before the indented text
@@display:block;margin-left:2em;This text will be indented...
...and can even span across several lines...

...or even include blank lines.
@@This is after the indented text 
&lt;/part&gt;
&lt;part tblMarkup hidden&gt;
{{{
|table caption at top|c
|header|header|h
|text, more text, more text|text, more text, more text|
|!heading|!heading|
|&gt;|colspan=2|
|rowspan|left align |
|~| center |
|bgcolor(green):green| right|
|footer|footer|f
|table caption at bottom|c
}}}
&lt;/part&gt;
&lt;part tblShow hidden&gt;
|table caption at top|c
|header|header|h
|text, more text, more text|text, more text, more text|
|!heading|!heading|
|&gt;|colspan=2|
|rowspan|left align |
|~| center |
|bgcolor(green):green| right|
|footer|footer|f
|table caption at bottom|c
&lt;/part&gt;
&lt;part nestedListEg hidden&gt;
* 1st Level
** 2nd Level
&lt;/part&gt;</pre>
</div>
<div title="SystemList" modifier="shankar " created="200911140343" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;forEachTiddler where tiddler.tags.contains('mySystem') sortBy
'(tiddler.title)' write '&quot;[[&quot;+tiddler.title+&quot;]]\n&quot;'&gt;&gt; </pre>
</div>
<div title="TabMore" modifier="shankar " created="200911121432" modified="200911140346" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tabs txtMoreTab &quot;System&quot; &quot;System Components&quot; SystemList &quot;Shadowed&quot; &quot;Shadowed tiddlers&quot; TabMoreShadowed &quot;Missing&quot; &quot;Missing tiddlers&quot; TabMoreMissing &quot;Unlisted&quot; tiddler ListUnlisted&gt;&gt;</pre>
</div>
<div title="TaggedTemplateTweak" modifier="Shankar" created="200909092000" modified="200909092000" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TaggedTemplateTweak|
|Source|http://www.TiddlyTools.com/#TaggedTemplateTweak|
|Documentation|http://www.TiddlyTools.com/#TaggedTemplateTweakInfo|
|Version|1.1.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides|Story.prototype.chooseTemplateForTiddler()|
|Description|use alternative ViewTemplate/EditTemplate for tiddler's tagged with specific tag values|
This tweak extends story.chooseTemplateForTiddler() so that ''whenever a tiddler is marked with a specific tag value, it can be viewed and/or edited using alternatives to the standard tiddler templates.'' 
!!!!!Documentation
&gt;see [[TaggedTemplateTweakInfo]]
!!!!!Revisions
&lt;&lt;&lt;
2008.01.22 [*.*.*] plugin size reduction - documentation moved to [[TaggedTemplateTweakInfo]]
2007.06.23 [1.1.0] re-written to use automatic 'tag prefix' search instead of hard coded check for each tag.  Allows new custom tags to be used without requiring code changes to this plugin.
| please see [[TaggedTemplateTweakInfo]] for previous revision details |
2007.06.11 [1.0.0] initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.taggedTemplate= {major: 1, minor: 1, revision: 0, date: new Date(2007,6,23)};
Story.prototype.taggedTemplate_chooseTemplateForTiddler = Story.prototype.chooseTemplateForTiddler
Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	// get default template from core
	var template=this.taggedTemplate_chooseTemplateForTiddler.apply(this,arguments);

	// if the tiddler to be rendered doesn't exist yet, just return core result
	var tiddler=store.getTiddler(title); if (!tiddler) return template;

	// look for template whose prefix matches a tag on this tiddler
	for (t=0; t&lt;tiddler.tags.length; t++) {
		var tag=tiddler.tags[t];
		if (store.tiddlerExists(tag+template)) { template=tag+template; break; }
		// try capitalized tag (to match WikiWord template titles)
		var cap=tag.substr(0,1).toUpperCase()+tag.substr(1);
		if (store.tiddlerExists(cap+template)) { template=cap+template; break; }
	}

	return template;
}
//}}}</pre>
</div>
<div title="TaggerPlugin" modifier="Shankar" created="200909150315" modified="200909262048" tags="mySystem systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|~TaggerPlugin|
|''Version:''|1.0.1 (2006-06-01)|
|''Source:''|http://tw.lewcid.org//#TaggerPlugin|
|''Author:''|SaqImtiaz|
|''Description:''|Provides a drop down listing current tiddler tags, and allowing toggling of tags.|
|''Documentation:''|[[TaggerPluginDocumentation]]|
|''Source Code:''|[[TaggerPluginSource]]|
|''~TiddlyWiki:''|Version 2.0.8 or better|
|''Requires''|[[DeprecatedFunctionsPlugin]]|
|''Stylesheet Changes''|ViewTemplate|
|See Above|&lt;div class='toolbar'&gt;&lt;span style=&quot;padding-right:2.45em;&quot; macro='tagger source:TagDB exclude:excludeLists'&gt;&lt;/span&gt;&lt;/div&gt;|


***/
//{{{

config.tagger={
       defaults:{
              label: '= parent topics ',
              tooltip: 'Manage tiddler tags',
              taglist: 'true',
              excludeTags: 'excludeLists',
              notags: 'tiddler has no tags',
              aretags: 'current tiddler tags:',
              toggletext: 'add tags:'
       }
};

config.macros.tagger={};
config.macros.tagger.arrow = (document.all?&quot;▼&quot;:&quot;▾&quot;); // the fat one is the only one that works in IE
config.macros.tagger.handler =  function(place,macroName,params,wikifier,paramString,tiddler) {
       var defaults = config.tagger.defaults;
       var nAV = paramString.parseParams('tagman', null, true);
       var label = ((nAV[0].label)&amp;&amp;(nAV[0].label[0])!='.')?nAV[0].label[0]+this.arrow: defaults.label+this.arrow;
       var tooltip = ((nAV[0].tooltip)&amp;&amp;(nAV[0].tooltip[0])!='.')?nAV[0].tooltip[0]: defaults.tooltip;
       var taglist = ((nAV[0].taglist)&amp;&amp;(nAV[0].taglist[0])!='.')?nAV[0].taglist[0]: defaults.taglist;
       var exclude = ((nAV[0].exclude)&amp;&amp;(nAV[0].exclude[0])!='.')?(nAV[0].exclude[0]).readBracketedList(): defaults.excludeTags.readBracketedList();
       if ((nAV[0].source)&amp;&amp;(nAV[0].source[0])!='.')var source = nAV[0].source[0];
       if (source&amp;&amp;!store.getTiddler(source)) return false;

       var onclick = function(e) {
                   if (!e) var e = window.event;
                   var popup = Popup.create(this);
                   var tagsarray = store.getTags();
                   var tags=new Array();

                   for (var i=0; i&lt;tagsarray.length; i++){
                       tags.push(tagsarray[i][0]);}

                   if (source)
                      {var sourcetiddler=store.getTiddler(source);
                       tags=sourcetiddler.tags.sort();}

                   var currentTags = tiddler.tags.sort();

                   var createButtons=function(text,theTag,tooltipPrefix){
                       var sp = createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;span&quot;,null,&quot;tagger&quot;);
                       var theToggle = createTiddlyButton(sp,text,tooltipPrefix+&quot; '&quot;+theTag+&quot;'&quot;,taggerOnToggle,&quot;button&quot;,&quot;toggleButton&quot;);
                       theToggle.setAttribute(&quot;tiddler&quot;,tiddler.title);
                       theToggle.setAttribute(&quot;tag&quot;,theTag);
                       insertSpacer(sp);
                       if (window.createTagButton_orig_mptw)
                           createTagButton_orig_mptw(sp,theTag);
                       else
                           createTagButton(sp,theTag);
                       }

                   createTiddlyElement(popup,&quot;li&quot;,null,&quot;listTitle&quot;,(tiddler.tags.length == 0 ? defaults.notags : defaults.aretags));

                   for (var t=0; t&lt;currentTags.length; t++){
                      createButtons(&quot;[x]&quot;,currentTags[t],&quot;remove tag &quot;);
                       }

                   createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;hr&quot;);

                   if (taglist!='false')
                      { createTiddlyElement(popup,&quot;li&quot;,null,&quot;listTitle&quot;,defaults.toggletext);
                        for (var i=0; i&lt;tags.length; i++){
                          if (!tiddler.tags.contains(tags[i])&amp;&amp;!exclude.contains(tags[i]))
                                  {createButtons(&quot;[ ]&quot;,tags[i],&quot;add tag &quot;);
                                  }
                          }
                          createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;hr&quot;);
                      }

                   var newTagButton = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),(&quot;Create new tag&quot;),null,taggerOnToggle);
                   newTagButton.setAttribute(&quot;tiddler&quot;,tiddler.title);
                   if (source) newTagButton.setAttribute(&quot;source&quot;,source);

                   Popup.show(popup,false);
                   e.cancelBubble = true;
                   if (e.stopPropagation) e.stopPropagation();
                   return(false);
                   };

       createTiddlyButton(place,label,tooltip,onclick,&quot;button&quot;,&quot;taggerDrpBtn&quot;);
};

window.taggerOnToggle = function(e) {
              var tag = this.getAttribute(&quot;tag&quot;);
              var title = this.getAttribute(&quot;tiddler&quot;);
              var tiddler = store.getTiddler(title);
              if (!tag)
                 {
                 var newtag=prompt(&quot;Enter new tag:&quot;,&quot;&quot;);
                 if (newtag!=''&amp;&amp;newtag!=null)
                    {
                    var tag=newtag;
                    if (this.getAttribute(&quot;source&quot;))
                    {var sourcetiddler =  store.getTiddler(this.getAttribute(&quot;source&quot;));
                    sourcetiddler.tags.pushUnique(newtag);}
                    }
                 else
                     {return false;};
                 }
              if (!tiddler || !tiddler.tags)
                 {store.saveTiddler(title,title,'',config.options.txtUserName,new Date(),tag);}
              else
                  {if (tiddler.tags.find(tag)==null)
                     {tiddler.tags.push(tag)}
                  else if(!newtag)
                      {tiddler.tags.splice(tiddler.tags.find(tag),1)};
                  store.saveTiddler(tiddler.title,tiddler.title,tiddler.text,tiddler.modifier,tiddler.modified,tiddler.tags);};
              story.refreshTiddler(title,null,true);
              if(config.options.chkAutoSave)
                  saveChanges();
              return false;
};

setStylesheet(
 &quot;.tagger a.button {font-weight: bold;display:inline; padding:0px;}\n&quot;+
 &quot;.tagger #toggleButton {padding-left:2px; padding-right:2px; margin-right:1px; font-size:110%;}\n&quot;+
 &quot;#nestedtagger {background:#2E5ADF; border: 1px solid #0331BF;}\n&quot;+
 &quot;.popup .listTitle {color:#000;}\n&quot;+
 &quot;&quot;,
&quot;TaggerStyles&quot;);

window.lewcidTiddlerSwapTag =  function (tiddler, oldTag, newTag){
                    for (var i = 0; i &lt; tiddler.tags.length; i++)
			  if (tiddler.tags[i] == oldTag) {
				  tiddler.tags[i] = newTag;
				  return true;}
                         return false;
}

window.lewcidRenameTag = function(e) {
                    var tag=this.getAttribute(&quot;tag&quot;);
                    var newtag=prompt(&quot;Rename tag '&quot;+tag+&quot;' to:&quot;,tag);

                    if ((newtag==tag)||(newtag==null)) {return false;}

                    if(store.tiddlerExists(newtag))
                               {if(confirm(config.messages.overwriteWarning.format([newtag.toString()])))
                                             story.closeTiddler(newtag,false,false);
                               else
                                             return null;}

                    tagged=store.getTaggedTiddlers(tag);
                    if (tagged.length!=0){
                          for (var j = 0; j &lt; tagged.length; j++)
                              lewcidTiddlerSwapTag(tagged[j],tag,newtag);}

                    if (store.tiddlerExists(tag))
                       {store.saveTiddler(tag,newtag);}
                    if (document.getElementById(&quot;tiddler&quot;+tag))
                       {var oldTagTiddler =  document.getElementById(story.idPrefix + tag);
                       var before= story.positionTiddler(oldTagTiddler);
                       var place = document.getElementById(story.container);
                       story.closeTiddler(tag,false,false);
                       story.createTiddler(place,before,newtag,null);
                       story.saveTiddler(newtag);}
                    if(config.options.chkAutoSave)
                        saveChanges();
                    return false;
}


window.onClickTag=function(e)
{
	if (!e) var e = window.event;
	var theTarget = resolveTarget(e);

        var nested = (!isNested(theTarget));
        if ((Popup.stack.length &gt; 1)&amp;&amp;(nested==true)) {Popup.removeFrom(1);}
        else if(Popup.stack.length &gt; 0 &amp;&amp; nested==false) {Popup.removeFrom(0);};

        var theId = (nested==false)? &quot;popup&quot; : &quot;nestedtagger&quot;;
        var popup = createTiddlyElement(document.body,&quot;ol&quot;,theId,&quot;popup&quot;,null);
        Popup.stack.push({root: this, popup: popup});

	var tag = this.getAttribute(&quot;tag&quot;);
	var title = this.getAttribute(&quot;tiddler&quot;);
	if(popup &amp;&amp; tag)
		{
		var tagged = store.getTaggedTiddlers(tag); 
		var titles = [];
		var li,r;
		for(r=0;r&lt;tagged.length;r++)
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		var lingo = config.views.wikified.tag;
		if(titles.length &gt; 0)
			{
			var openAll = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute(&quot;tag&quot;,tag);
			createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;hr&quot;);
			for(r=0; r&lt;titles.length; r++)
				{
				createTiddlyLink(createTiddlyElement(popup,&quot;li&quot;),titles[r],true);
				}
			}
		else
			createTiddlyText(createTiddlyElement(popup,&quot;li&quot;,null,&quot;disabled&quot;),lingo.popupNone.format([tag]));
		createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;hr&quot;);
		var h = createTiddlyLink(createTiddlyElement(popup,&quot;li&quot;),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));

		createTiddlyElement(createTiddlyElement(popup,&quot;li&quot;),&quot;hr&quot;);

		var renameTagButton = createTiddlyButton(createTiddlyElement(popup,&quot;li&quot;),(&quot;Rename tag '&quot;+tag+&quot;'&quot;),null,lewcidRenameTag);
		renameTagButton.setAttribute(&quot;tag&quot;,tag)
		}
	Popup.show(popup,false);
	e.cancelBubble = true;
	if (e.stopPropagation) e.stopPropagation();
	return(false);
}

if (!window.isNested)
   window.isNested = function(e) {
        while (e != null) {
                var contentWrapper = document.getElementById(&quot;contentWrapper&quot;);
                if (contentWrapper == e) return true;
                e = e.parentNode;
                }
        return false;
   };

config.shadowTiddlers.TaggerPluginDocumentation=&quot;The documentation is available [[here.|http://tw.lewcid.org/#TaggerPluginDocumentation]]&quot;;

config.shadowTiddlers.TaggerPluginSource=&quot;The uncompressed source code is available [[here.|http://tw.lewcid.org/#TaggerPluginSource]]&quot;;
//}}}</pre>
</div>
<div title="TextAreaPlugin" modifier="Shankar" created="200512242341" modified="200911151458" tags="systemConfig TidIDEPackage excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TextAreaPlugin|
|Source|http://www.TiddlyTools.com/#TextAreaPlugin|
|Documentation|http://www.TiddlyTools.com/#TextAreaPluginInfo|
|Version|2.2.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|Adds Find/Again keyboard search, autosize, and 'stretch bar' resize for textarea controls|
!!!!!Documentation
&gt;see [[TextAreaPluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkTextAreaExtensions&gt;&gt; use control-f (find), control-g (find again) inside text area
&lt;&lt;option chkDisableAutoSelect&gt;&gt; place cursor at start of textarea instead of pre-selecting content
&lt;&lt;option chkResizeEditor&gt;&gt; modify shadow EditTemplate to add resizeable text area (and autosize command)
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.04.08 [2.2.1] added autosizeEditor macro to enable automatic autosizing without using toolbar command
2009.04.06 [2.2.0] added resizeListbox macro definition and adjusted dragbar width calculation.
|please see [[TextAreaPluginInfo]] for additional revision details|
2006.01.22 [1.0.0] Moved from temporary &quot;System Tweaks&quot; tiddler into 'real' TextAreaPlugin tiddler.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.TextAreaPlugin= {major: 2, minor: 2, revision: 1, date: new Date(2009,4,8)};

if (config.options.chkTextAreaExtensions===undefined) config.options.chkTextAreaExtensions=true;
if (config.options.chkDisableAutoSelect===undefined) config.options.chkDisableAutoSelect=true;
if (config.options.chkResizeEditor===undefined) config.options.chkResizeEditor=true;

// automatically tweak shadow EditTemplate to add &quot;autosizeEditor&quot; toolbar command
if (config.options.chkResizeEditor)
	config.shadowTiddlers.EditTemplate=config.shadowTiddlers.EditTemplate.replace(/deleteTiddler/,&quot;deleteTiddler autosizeEditor&quot;);
// automatically tweak shadow EditTemplate to add &quot;resizeEditor&quot; macro
if (config.options.chkResizeEditor)
	config.shadowTiddlers.EditTemplate+=&quot;&lt;span macro='resizeEditor'&gt;&lt;/span&gt;&quot;;

// Put focus in a specified tiddler field
Story.prototype.TextAreaExtensions_focusTiddler=Story.prototype.focusTiddler;
Story.prototype.focusTiddler = function(title,field)
{
	this.TextAreaExtensions_focusTiddler.apply(this,arguments); // first call core
	var e = this.getTiddlerField(title,field);
	if (e &amp;&amp; config.options.chkDisableAutoSelect) {
		if (e.setSelectionRange) // FF
			e.setSelectionRange(0,0);
		else if (e.createTextRange) // IE
			{ var r=e.createTextRange(); r.collapse(true); r.select(); }
	}
	if (e &amp;&amp; config.options.chkTextAreaExtensions) addKeyDownHandlers(e);
}
//}}}

//{{{
function addKeyDownHandlers(e)
{
	// exit if not textarea or element doesn't allow selections
	if (e.tagName.toLowerCase()!=&quot;textarea&quot;||!e.setSelectionRange||e.initialized) return;

	// utility function: exits keydown handler and prevents browser from processing the keystroke
	var processed=function(ev) {
		ev.cancelBubble=true; // IE4+
		try{event.keyCode=0;}catch(e){}; // IE5
		if (window.event) ev.returnValue=false; // IE6
		if (ev.preventDefault) ev.preventDefault(); // moz/opera/konqueror
		if (ev.stopPropagation) ev.stopPropagation(); // all
		return false;
	}
	// capture keydown in edit field
	e.saved_onkeydown=e.onkeydown; // save current keydown handler (if any)
	e.onkeydown=function(ev) { if (!ev) var ev=window.event;
		var key=ev.keyCode;
		if (!key) {
			var char=event.which?event.which:event.charCode;
			if (char==102) key=70;
			if (char==103) key=71;
		}
		// process CTRL-F (find matching text) or CTRL-G (find next match)
		if (ev.ctrlKey &amp;&amp; (key==70||key==71)) {

			// prompt for text to find
			var defFind=e.findText?e.findText:e.value.substring(e.selectionStart,e.selectionEnd);
			if (key==70||!e.findText||!e.findText.length) // ctrl-f or no saved search text
				{ var f=prompt(&quot;find:&quot;, defFind); e.focus(); if (f) e.findText=f; }
			if (!e.findText||!e.findText.length) return processed(ev); //  if no search text, exit

			// do case-insensitive match with 'wraparound'...  if not found, alert and exit 
			var newstart=e.value.toLowerCase().indexOf(e.findText.toLowerCase(),e.selectionStart+1);
			if (newstart==-1) newstart=e.value.toLowerCase().indexOf(e.findText.toLowerCase());
			if (newstart==-1) { alert(&quot;'&quot;+e.findText+&quot;' not found&quot;); e.focus(); return processed(ev); }

			// set new selection, scroll it into view, and report line position in status bar
			e.setSelectionRange(newstart,newstart+e.findText.length);
			var linecount=e.value.split('\n').length;
			var thisline=e.value.substr(0,e.selectionStart).split('\n').length;
			e.scrollTop=Math.floor((thisline-1-e.rows/2)*e.scrollHeight/linecount);
			window.status=&quot;line: &quot;+thisline+&quot;/&quot;+linecount;
			return processed(ev);
		}
		if (e.saved_onkeydown) // call previous keydown handler (if any)
			e.saved_onkeydown(ev);
	}
	e.initialized=true;
}
//}}}

// // 'autosize' toolbar command
//{{{
config.commands.autosizeEditor = {
	text: 'autosize',
	tooltip: 'automatically adjust the editor height to fit the contents',
	text_alt: '\u221Aautosize',
	hideReadOnly: false,
	handler: function(event,src,title) {
		var here=story.findContainingTiddler(src); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		for (i=0;i&lt;ta.length;i++) {
			// only autosize textareas actually used to edit tiddler fields
			if (ta[i].getAttribute(&quot;edit&quot;)==undefined) continue;
			ta[i].button=src;
			if (!ta[i].maxed)
				config.commands.autosizeEditor.on(ta[i]);
			else
				config.commands.autosizeEditor.off(ta[i],true);
		}
		return false;
	},
	on: function(e) {
		if (e.maxed) return; // already autosizing!
		if (e.savedheight==undefined)
			e.savedheight=e.style.height;
		if (e.savedkeyup==undefined) {
			e.savedkeyup=e.onkeyup;
			e.onkeyup=function(ev) {
				if (!ev) var ev=window.event; var e=resolveTarget(ev);
				e.style.height=e.scrollHeight+'px';
				if (e.savedkeyup) e.savedkeyup();
			}
		}
		// IE reports error: &quot;not implemented&quot; for onkeypress
		if (!config.browser.isIE &amp;&amp; e.savedkeypress==undefined) {
			e.savedkeypress=e.onkeypress;
			e.onkeypress=function(ev) {
				if (!ev) var ev=window.event; var e=resolveTarget(ev);
				if (ev.keyCode==33) { // PGUP
					if (window.scrollByPages) window.scrollByPages(-1);
					return false;
				}
				if (ev.keyCode==34) { // PGDN
					if (window.scrollByPages) window.scrollByPages(1);
					return false;
				}
				if (e.savedkeypress) e.savedkeypress();
			}
		}
		e.style.height=e.scrollHeight+'px';
		if (e.button) e.button.innerHTML=config.commands.autosizeEditor.text_alt;
		e.maxed=true;
	},
	off: function(e,resetHeight) {
		if (resetHeight) e.style.height=e.savedheight;
		e.onkeyup=e.savedkeyup;
		// IE reports error: &quot;not implemented&quot; for onkeypress
		if (!config.browser.isIE) e.onkeypress=e.savedkeypress;
		if (e.button) e.button.innerHTML=config.commands.autosizeEditor.text;
		e.maxed=false;
	}
};

config.macros.autosizeEditor={
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var here=story.findContainingTiddler(place); if (!here) return;
		var ta=here.getElementsByTagName('textarea'); if (!ta) return;
		for (i=0;i&lt;ta.length;i++) {
			// only autosize textareas actually used to edit tiddler fields
			if (ta[i].getAttribute(&quot;edit&quot;)==undefined) continue;
			config.commands.autosizeEditor.on(ta[i]);
		}
		return false;
	}
}
//}}}

// // grab-and-stretch handle
//{{{
config.macros.resizeEditor = { // add stretch bar to editor textarea
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var here=story.findContainingTiddler(place); if (!here) return;
		var ta=here.getElementsByTagName('textarea');
		if (ta) for (i=0;i&lt;ta.length;i++) {
			// only resize tiddler editor textareas
			if (ta[i].getAttribute(&quot;edit&quot;)==undefined) continue;
			new window.TextAreaResizer(ta[i]);
		}
	}
}

config.macros.resizeTiddler = { // add stretch bar to tiddler viewer element
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var here=story.findContainingTiddler(place); if (!here) return;
		var elems=here.getElementsByTagName('div');
		if (elems) for (i=0;i&lt;elems.length;i++) if (hasClass(elems[i],'viewer')) break;
		if (i&lt;elems.length) new window.TextAreaResizer(elems[i]);
	}
}

config.macros.resizeFrame = { // add stretch bar to iframes
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var here=story.findContainingTiddler(place); if (!here) return;
		var fr=here.getElementsByTagName('iframe');
		if (fr) for (i=0;i&lt;fr.length;i++) new window.TextAreaResizer(fr[i]);
	}
}

config.macros.resizeListbox = { // add stretch bar to listbox controls
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var here=story.findContainingTiddler(place); if (!here) here=place;
		var fr=here.getElementsByTagName('select');
		if (fr) for (i=0;i&lt;fr.length;i++) new window.TextAreaResizer(fr[i]);
	}
}

// TextAreaResizer script by Jason Johnston (jj@lojjic.net)
// Created August 2003.  Use freely, but give me credit.
// adds a handle below textareas that the user can drag with the mouse to resize the textarea.
// MODIFIED by ELS for use with TW

window.TextAreaResizer = function(elt) {
	this.element = elt;
	this.create();
}
window.TextAreaResizer.prototype = {
	create : function() {
		var elt = this.element;
		var thisRef = this;
		var h = this.handle = document.createElement(&quot;div&quot;);
		h.style.height = &quot;3px&quot;; // was 4px... looked too fat!
		h.style.overflow = &quot;hidden&quot;; // ELS: force IE to trim height to &lt; 1em
		var adjust=elt.nodeName=='textarea'?4:0;  // 4 pixels for textarea border edge
//		h.style.width=(elt.offsetWidth-adjust)+&quot;px&quot;;
		h.style.width=&quot;auto&quot;;
		h.style.backgroundColor = &quot;#999&quot;; // ELS: standard mid-tone (dark) gray
		h.style.cursor = &quot;s-resize&quot;;
		h.title = &quot;Drag to resize text box&quot;;
		h.onmousedown=function(evt){thisRef.dragStart(evt)};
		elt.parentNode.insertBefore(h, elt.nextSibling);
	},
	dragStart : function(evt) {
		if (!evt) var evt=window.event;
		this.dragStop(evt); // ELS: stop any current drag processing first
		var thisRef = this;
		this.dragStartY = evt.clientY;
		this.dragStartH = this.element.offsetHeight;
		document.savedmousemove=document.onmousemove;
		document.onmousemove=this.dragMoveHdlr=function(evt){thisRef.dragMove(evt)};
		document.savedmouseup=document.onmouseup;
		document.onmouseup=this.dragStopHdlr=function(evt){thisRef.dragStop(evt)};
	},
	dragMove : function(evt) {
		if (!evt) var evt=window.event;
		// ELS: make sure height is at least 10px
		var h=this.dragStartH+evt.clientY-this.dragStartY;
		if (h&lt;10) h=10; this.element.style.height=h+&quot;px&quot;;
		// ELS: match handle to textarea width (which may have changed due to document scrollbars)
//		var adjust=this.element.nodeName.toLowerCase()=='textarea'?4:0; // 4 pixels for textarea
//		this.handle.style.width=(this.element.offsetWidth-adjust)+&quot;px&quot;;
		// ELS: when manually resizing, disable autoresizing (without restoring saved height)
		if (this.element.maxed!=undefined &amp;&amp; this.element.maxed)
			config.commands.autosizeEditor.off(this.element,false);
	},
	dragStop : function(evt) {
		if (!evt) var evt=window.event;
		document.onmousemove=(document.savedmousemove!=undefined)?document.savedmousemove:null;
		document.onmousemove=(document.savedmouseup!=undefined)?document.savedmouseup:null;
	},
	destroy : function() {
		var elt = this.element;
		elt.parentNode.removeChild(this.handle);
		elt.style.height = &quot;&quot;;
	}
};
//}}}</pre>
</div>
<div title="TextAreaPluginInfo" modifier="Shankar" created="200801082003" modified="200911151457" tags="pluginInfo excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TextAreaPluginInfo|
|Source|http://www.TiddlyTools.com/#TextAreaPlugin|
|Documentation|http://www.TiddlyTools.com/#TextAreaPluginInfo|
|Version|2.2.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|documentation|
|Description|Documentation for TextAreaPlugin|
Adds Find/Again keyboard search, autosize, and 'stretch bar' resize for textarea controls
!!!!!Usage
&lt;&lt;&lt;
When in tiddler editor, use ''Control-F'' and ''control-G'' to ''&quot;Find text&quot;'' and ''&quot;find text aGain&quot;'', respectively, allowing you to copy, find, paste, findagain, paste, etc to perform &quot;search-and-replace&quot; actions.  ''autosize'' toolbar command toggles the tiddler editor textarea height between fixed-height and &quot;automatically fit the contents&quot;.  Stretch (change height) of editor (or other element types) using 'grab handle' that is displayed below the editor textarea field.
&lt;&lt;&lt;
!!!!!Configuration
&lt;&lt;&lt;
&lt;&lt;option chkTextAreaExtensions&gt;&gt; use control-f (find), control-g (find again) inside text area
&lt;&lt;option chkDisableAutoSelect&gt;&gt; place cursor at start of textarea instead of pre-selecting content
&lt;&lt;option chkResizeEditor&gt;&gt; modify shadow EditTemplate to add resizeable text area (and autosize command)
* ''Add 'autosizeEditor' command to toolbar:''
{{{
// add command keyword to end of {{{EditToolbar}}} slice definition in [[ToolbarCommands]]:
|EditToolbar| ... autosizeEditor|
}}}
* Alternatively, ''enable autosize by default:''
{{{
// add to the end of the EditTemplate:
&lt;span macro='autosizeEditor'&gt;&lt;/span&gt;
}}}
* ''Add stretch bar to editor:''
{{{
// add ''resize...'' macro to EditTemplate 
&lt;span macro='resizeEditor'&gt;&lt;/span&gt; or
&lt;span macro='resizeTiddler'&gt;&lt;/span&gt; or
&lt;span macro='resizeFrame'&gt;&lt;/span&gt; or
&lt;span macro='resizeListbox'&gt;&lt;/span&gt;
}}}
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.04.06 2.2.0 added resizeListbox macro definition and adjusted dragbar width calculation.
2008.01.08 2.1.9 fixed default setting of uninitialized option values so that &quot;false&quot; is not treated as &quot;undefined&quot;
2008.01.07 2.1.8 added 'initialized' flag so keyDownHandlers() will only be added once to each control (prevents recursion errors)
2007.12.21 2.1.7 in dragMove(), subtract 4-pixel 'fudge factor' when adjusting drag bar width to match textarea width.  Apparently textarea 'offsetWidth' includes the 2-pixel surrounding edge, but CSS 100% calculation does NOT, resulting is an increase in the textarea width when displayed in a variable-width moveable panel.
2007.11.19 2.1.6 fix fatal IE errors by NOT setting 'onkeypress' handler (which IE reports as &quot;not implemented&quot;).  Also, only add autosize grab bar to textareas that are actually used to edit tiddler fields (i.e., they have an &quot;edit=fieldname&quot; attribute).  This prevents undesirable autosizing of textareas used for HTML/DOM display by [[PreviewPlugin]].
2007.11.18 2.1.5 in config.commands.autosizeEditor, changed alt command text to use character-based &quot;psuedo-checkbox&quot; instead of embedded html fragment
2007.09.04 2.1.4 in window.TextAreaResizer.prototype.create(), set initial grab handle width to auto instead of matching textarea.offsetWidth (which can be initially==0)
2007.04.29 2.1.3 in addKeyDownHandlers(), used 'findText' instead of 'find', hopefully to avoid strict ECMAScript1.5 error on certain browsers.
2007.03.01 2.1.2 use apply() to invoke hijacked core function
2006.11.16 2.1.0 restored chkDisableAutoSelect (place cursor at start of textarea instead of pre-selecting content)
2006.11.16 2.0.0 removed chkDisableEscapeKey (obsolete... use custom EditTemplate to change toolbar definition).  Rewrote focusTiddler as a HIJACK instead of just overwriting core function (permits other plugins to also hijack function).  Removed TAB character processing (now built-in as of TW2.1).  Merged code from ResizeEditorPlugin:
&gt; 2006.11.16 [1.3.x] merged with TextAreaPlugin
&gt; 2006.11.02 1.3.1 in DragMove() and DragStop(), check for undefined properties so IE doesn't report &quot;Not Implemented&quot; error when property is referenced without having been previously initialized.
&gt; 2006.11.01 1.3.0 added 'resizeEditor' MACRO for 'grab handle' stretch resizing (based on code from Jon Scully and Jason Johnston (jj@lojjic.net).  
&gt; 2006.11.01 1.2.6 removed increaseEditor, decreaseEditor, and resizeEditor toolbar COMMAND definitions (resize by setting 'rows' property of textarea field conflicts with resize via style.height CSS attribute as set by autosize/drag).
&gt; 2006.11.01 1.2.5 fixed 'savedkeypress' handling (was writing to savedkeyup by mistake)
&gt; 2006.10.28 1.2.4 added '+' to 'saveTiddler' toolbar command (enables ctrl-enter keyhandling)
&gt; 2006.10.18 1.2.3 added decreaseEditor and increaseEditor commands
&gt; 2006.10.18 1.2.2 onkeypress handling to redirect PGUP/PGDN to window.scrollByPages() (works in FF, but not yet in IE)
&gt; 2006.10.18 1.2.1 fixed references to default string constants (oops!)
&gt; 2006.10.18 1.2.0 renamed 'resizeEditor' to 'autosizeEditor' and added new 'resizeEditor' toolbar command to prompt for # of rows to display
&gt; 2006.10.02 1.1.1 show checkbox in button label (when automatic resizing is enabled)
&gt; 2006.10.01 1.1.0 added 'onkeyup' automatic fit-to-contents handling
&gt; 2006.09.30 1.0.0 initial release
2006.08.01 1.1.2 improved processed() utility function to handle IE5 and IE6, as well as calling preventDefault() for moz browsers.  Thanks to Bradley Meck for research and code examples.
2006.07.09 1.1.1 removed chkDisableAutoSelect
2006.02.14 1.1.0 added option for chkDisableEscapeKey (default is standard action)
2006.01.22 1.0.1 only add extra key processing for TEXTAREA elements (not other edit fields).
added option to enable/disable textarea keydown extensions (default is &quot;standard keys&quot; only)
2006.01.22 1.0.0 Moved from temporary &quot;System Tweaks&quot; tiddler into 'real' TextAreaPlugin tiddler.
&lt;&lt;&lt;</pre>
</div>
<div title="ThumbThing" modifier="YourName" created="200905241650" modified="200911112015" tags="transclusion excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ThumbThing|
|Source|http://www.TiddlyTools.com/#ThumbThing|
|Version|1.2.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|display a scaled 'thumbnail' image with popup for full-sized image|

Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ThumbThing with: image thumbWidth thumbHeight fullWidth fullHeight&gt;&gt;
}}}
*{{{image}}} is one of:
**a local path/file
**a remote URL reference
**the title of a tiddler containing an attached image (see [[AttachFilePlugin]])
*{{{thumbWidth, thumbHeight, fullWidth, fullHeight}}} are CSS measurements.  Use 'auto' (or omit values) for default (full-sized) image height and/or width. For proportional scaling, specify a fixed-width OR fixed-height and use 'auto' for the other dimension.
&lt;&lt;&lt;
Example:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ThumbThing with: images/meow2.jpg 100px&gt;&gt;
}}}
&lt;&lt;tiddler ThumbThing with: images/meow2.jpg 100px&gt;&gt;
&lt;&lt;&lt;
See also:
&gt;[[AllThumbs]]
!end

!show
&lt;html&gt;&lt;hide linebreaks&gt;
&lt;img src=&quot;$1&quot; style=&quot;border=0;width:$2;height:$3;&quot; title=&quot;$1&quot; onclick=&quot;
	var p=Popup.create(this); if (!p) return; var s=p.style; s.border=s.padding='0'; s.background='none';
	p.innerHTML='&lt;img src=\x22$1\x22 style=\x22border:1px solid #999;background:#eee;width:$4;height:$5\x22&gt;';
	Popup.show(); event.cancelBubble=true; if(event.stopPropagation)event.stopPropagation(); return(false);
&quot;&gt;&lt;/html&gt;
!end
%/&lt;&lt;tiddler {{'ThumbThing##'+('$1'=='$'+'1'?'info':'show')}} with:
	{{var cma=config.macros.attach; (cma&amp;&amp;cma.isAttachment('$1'))?cma.getAttachment('$1'):'$1';}}
	[[$2]] [[$3]] [[$4]] [[$5]]&gt;&gt;</pre>
</div>
<div title="TidIDEEditTemplate" modifier="ShankarSwamy" created="200605040156" modified="200709222330" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;div class='toolbar' macro='toolbar -cancelTiddler'&gt;&lt;/div&gt;
&lt;div class='title' macro='view title'&gt;&lt;/div&gt;
&lt;div class='viewer' macro='tidIDE system +edit:here'&gt;&lt;/div&gt;</pre>
</div>
<div title="TidIDEPlugin" modifier="YourName" created="200604151607" modified="201510202139" tags="TidIDEPackage systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TidIDEPlugin|
|Source|http://www.TiddlyTools.com/#TidIDEPlugin|
|Documentation|http://www.TiddlyTools.com/#TidIDEPluginInfo|
|Version|1.8.5|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Requires||
|Overrides||
|Options|##Configuration|
|Description|TiddlyWiki Integrated Development Environment - tools for authors and plugin writers|
~TidIDE (//prounounced &quot;Tie Dyed&quot;//) - ''Tid''dlyWiki ''I''ntegrated ''D''evelopment ''E''nvironment - allows you to define a set of checkboxes to toggle a stack of 'tool panels' containing tools for TiddlyWiki authors to use when creating and debugging their TiddlyWiki documents.  Each tool is defined by a separate tiddler, allowing you to define any convenient set of tools simply by adding/removing tiddler references from the {{{&lt;&lt;tidIDE...&gt;&gt;}}} macro call.

In addition to presenting checkboxes/tool panels that are defined in separate tiddlers, the {{{&lt;&lt;tidIDE&gt;&gt;}}} macro can invoke an optional built-in &quot;editor panel&quot; that presents an alternative tiddler editor to create, modify, and manage the tiddlers in your document... and, if you have also installed [[PreviewPlugin]], the editor can automatically display a ''//formatted preview//'' of the current tiddler content that is updated ''live, key-by-key'' while you edit the tiddler source.
!!!!!Documentation
&gt;see [[TidIDEPluginInfo]]
!!!!!Configuration
&lt;&lt;&lt;
Number of rows to display in text input area &lt;&lt;option txtTidIDEMaxEditRows&gt;&gt; 
{{{usage: &lt;&lt;option txtTidIDEMaxEditRows&gt;&gt;}}}
^^//Note: if not specified here, default uses {{{&lt;&lt;option txtMaxEditRows&gt;&gt;}}} value (see [[AdvancedOptions]])//^^
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.09.22 [1.8.5] added edit='tags' to tags input so {{{&lt;&lt;newTiddler tags:...&gt;&gt;}}} can init field
2009.08.27 [1.8.4] added 'tidIDEPanel' classname to container element (for custom CSS)
|please see [[TidIDEPluginInfo]] for additional revision details|
2006.04.15 [0.5.0] Initial ALPHA release. Converted from inline script.
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.TidIDEPlugin= {major: 1, minor: 8, revision: 5, date: new Date(2009,9,22)};

//-------------------------------------------------------------------------
window.xmcmSaveToClipboard=function(textToCopy) {
	function copy(out) {
		if(window.Components) { // FIREFOX
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var id='@mozilla.org/widget/clipboardhelper;1';
			var clip=Components.classes[id].getService(Components.interfaces.nsIClipboardHelper);
			clip.copyString(out);
		} else if(window.clipboardData) { // IE
			window.clipboardData.setData('text',out);
		} else if(document.execCommand) { // CHROME, SAFARI, IE6
			var ta=document.createElement('textarea');
			ta.style.position='absolute';
			ta.style.left='-100%';
			document.body.appendChild(ta);
			ta.value=out; ta.select();
			document.execCommand('Copy',false,null);
			document.body.removeChild(ta);
		} else throw('cannot access clipboard');
	}
	
	try	 { copy(textToCopy); }
	catch(e) { // FALLBACK
		alert('Copy to clipboard() failed - you will have to copy the text manually.');
		}
}
//--------------------------------------------------------------------------

// settings
if (config.options.txtTidIDEMaxEditRows==undefined)
	config.options.txtTidIDEMaxEditRows=config.options.txtMaxEditRows

// shadow payload
config.shadowTiddlers['TidIDEPluginEditorPanel']=store.getTiddlerText('TidIDEPlugin##editorPanel');

config.macros.tidIDE = {
	versionMsg: &quot;TidIDE v%0.%1.%2: &quot;,
	datetimefmt: &quot;0MM/0DD/YYYY 0hh:0mm&quot;,
	titleMsg: &quot;Please enter a new tiddler title&quot;,
	isShadowMsg: &quot;'%0' is a shadow tiddler and cannot be removed.&quot;,
	evalMsg: &quot;Warning!! Processing '%0' as a systemConfig (plugin) tiddler may produce unexpected results! Are you sure you want to proceed?&quot;,
	evalCompletedMsg: &quot;Processing completed&quot;,
	toolsDef: &quot;&lt;html&gt;&lt;a href='javascript:config.macros.tidIDE.set(\&quot;%0\&quot;,\&quot;%1\&quot;);'&gt;edit %1...&lt;/a&gt;&lt;/html&gt;&quot;,
	editorLabel: &quot;TiddlerEditor&quot;
};

config.macros.tidIDE.handler= function(place,macroName,params) {
	var here=story.findContainingTiddler(place);
	var selectors=&quot;&quot;;
	var panels=&quot;&quot;;
	var showsys=false;
	var title=&quot;&quot;;
	var id=&quot;&quot;; if (here) id=here.getAttribute(&quot;tiddler&quot;).replace(/ /g,&quot;_&quot;);
	var p=params.shift();
	if (!p) p=&quot;edit:here&quot;; // default to editor if no params
	var openpanels=[];
	var panelcount=0;
	while (p) {
		var defOpen=(p.substr(0,1)==&quot;+&quot;); if (defOpen) p=p.substr(1);
		if (p.substr(0,3)==&quot;id:&quot;)
			{ id=p.substr(3); }
		else if (p.substr(0,4)==&quot;edit&quot;) {
			panelcount++;
			defOpen=defOpen || (!params[0] &amp;&amp; panelcount==1); // if only one panel to show, default to open
			var toolname=this.editorLabel;
			if (p.indexOf('|')!=-1) toolname=p.substr(0,p.indexOf('|'));
			selectors+=this.html.editorchk.replace(/%toolname%/mg,toolname);
			selectors=selectors.replace(/%showpanel%/mg,defOpen?&quot;CHECKED&quot;:&quot;&quot;);
			panels+=store.getTiddlerText('TidIDEPluginEditorPanel');
			// editor panel setup...
			panels=panels.replace(/%showpanel%/mg,defOpen?&quot;block&quot;:&quot;none&quot;);
			panels=panels.replace(/%maxrows%/mg,config.options.txtTidIDEMaxEditRows);
			panels=panels.replace(/%disabled%/mg,readOnly?&quot;DISABLED&quot;:&quot;&quot;);
			panels=panels.replace(/%readonlychk%/mg,readOnly?&quot;CHECKED&quot;:&quot;&quot;);
			panels=panels.replace(/%minoredits%/mg,config.options.chkForceMinorUpdate&amp;&amp;!readOnly?&quot;&quot;:&quot;DISABLED&quot;);
			panels=panels.replace(/%minorchk%/mg,config.options.chkForceMinorUpdate?&quot;CHECKED&quot;:&quot;&quot;);
			var tiddlers=store.getTiddlers(&quot;title&quot;); var tiddlerlist=&quot;&quot;; 
			for (var t=0; t&lt;tiddlers.length; t++)
				tiddlerlist+='&lt;option value=&quot;'+tiddlers[t].title+'&quot;&gt;'+tiddlers[t].title+'&lt;/option&gt;';
			for (var t in config.shadowTiddlers)
				if (!store.tiddlerExists(t)) tiddlerlist+=&quot;&lt;option value='&quot;+t+&quot;'&gt;&quot;+t+&quot; (shadow)&lt;/option&gt;&quot;;
			panels=panels.replace(/%tiddlerlist%/mg,tiddlerlist);
			var tags = store.getTags(); var taglist=&quot;&quot;;
			for (var t=0; t&lt;tags.length; t++)
                        {
                                // filter out the date tags - specific Work notes
                                if( document.title.match(/^Work/) ) 
                                {
                                    // filter out tags of the format '2011-08' and '2011-08-01'
			            if( tags[t][0].match(/\d{4}-\d{2}-\d{2}/) ||
                                        tags[t][0].match(/\d{4}-\d{2}/) )
                                    {   
                                        //alert(&quot;Found ONE: &quot; + tags[t][0]);
				        continue;
                                    }
                                }
				taglist+=&quot;&lt;option value='&quot;+tags[t][0]+&quot;'&gt;&quot;+tags[t][0]+&quot;&lt;/option&gt;&quot;;
                                
                        }
			panels=panels.replace(/%taglist%/mg,taglist);
			if (p.substr(0,5)==&quot;edit:&quot;) { 
				title=p.substr(5); 
				if (here &amp;&amp; title==&quot;here&quot;) title=here.id.substr(7);
			}
		}
		else {
			panelcount++;
			defOpen=defOpen || (!params[0] &amp;&amp; panelcount==1); // if only one panel to show, default to open
			var toolid=toolname=p;
			if (p.indexOf('|')!=-1)
				{ toolname=p.substr(0,p.indexOf('|')); toolid=p.substr(p.indexOf('|')+1); }
			selectors+=this.html.toolschk.replace(/%toolid%/mg,toolid).replace(/%toolname%/mg,toolname);
			selectors=selectors.replace(/%showpanel%/mg,defOpen?&quot;CHECKED&quot;:&quot;&quot;);
			panels+=this.html.toolspanel.replace(/%toolid%/mg,toolid);
			panels=panels.replace(/%showpanel%/mg,defOpen?&quot;block&quot;:&quot;none&quot;);
			if (defOpen) openpanels.push(toolid);
		}
		p=params.shift(); // next param
	}
	var html=this.html.framework;
	if (panelcount&lt;2)
		html=html.replace(/%version%/mg,'').replace(/%selector%/mg,''); // omit header/selectors if just one panel to display
	else {
		var v=version.extensions.TidIDEPlugin;
		html=html.replace(/%version%/mg, this.versionMsg.format([v.major,v.minor,v.revision]));
		html=html.replace(/%selector%/mg,selectors+&quot;&lt;hr style='margin:0;padding:0'&gt;&quot;);
	}
	html=html.replace(/%panels%/mg,panels);
	html=html.replace(/%id%/mg,id);
	var newIDE=createTiddlyElement(place,&quot;span&quot;,null,&quot;tidIDEPanel&quot;);
	newIDE.innerHTML=html;
	//  fix made necessary due to changes in TiddlyWiki 2.8.1
	// if (title.length) this.set(id,title); // pre-load tiddler editor values (if needed)
        if (title.length) this.set(id,here.getAttribute(&quot;tiddler&quot;)); // pre-load tiddler editor values (if needed)  
	if (openpanels.length) for (i=0;i&lt;openpanels.length;i++) { config.macros.tidIDE.loadPanel(id,openpanels[i]); }
	// see [[TextAreaPlugin]] for extended ctrl-F/G (search/search again)and TAB handler definitions
	if (window.addKeyDownHandlers!=undefined) {
		var elems=newIDE.getElementsByTagName(&quot;textarea&quot;);
		for (var i=0;i&lt;elems.length;i++) window.addKeyDownHandlers(elems[i]);
	}
	var prev=document.getElementById(id+'_previewpanel');
	if (config.macros.preview &amp;&amp; prev)  // add previewer to editor (if installed)
		config.macros.preview.handler(prev,&quot;preview&quot;,[&quot;text&quot;,&quot;15&quot;]);
}
//}}}

// // CUSTOM PANEL FUNCTIONS 
//{{{
config.macros.tidIDE.loadPanel=function(id,toolid) {
	var place=document.getElementById(id+&quot;_&quot;+toolid+&quot;_panel&quot;); if (!place) return;
	var t=store.getTiddlerText(toolid,&quot;&quot;);
	place.innerHTML=&quot;&quot;; 
	if (t) wikify(t,place); else place.innerHTML=this.toolsDef.format([id,toolid]);
}
//}}}

// // EDITOR PANEL FUNCTIONS
//{{{
config.macros.tidIDE.set=function(id,title) {
	var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
	var f=document.getElementById(id+&quot;_editorform&quot;);
	if (f.dirty &amp;&amp; !confirm(config.commands.cancelTiddler.warning.format([f.current]))) return;
	// reset to form defaults
	f.dirty=false;
	f.current=&quot;&quot;;
	f.created.value=f.created.defaultValue;
	f.modified.value=f.modified.defaultValue;
	//f.author.value=f.author.defaultValue;
	f.content.value=f.content.defaultValue;
	f.tags.value=f.tags.defaultValue;
	f.size.value=f.size.defaultValue;
	if (!title.length) return;
	f.current=title;
	// values for new/shadow tiddlers
	var cdate=new Date();
	var mdate=new Date();
	var modifier=config.options.txtUserName;
	var text=config.views.editor.defaultText.format([title]);
	var tags=&quot;&quot;;
	// adjust values for shadow tiddlers
	if (store.isShadowTiddler(title))
		{ modifier=config.views.wikified.shadowModifier; text=store.getTiddlerText(title) }
	// get values for specified tiddler (if it exists)
	var t=store.getTiddler(title);
	if (t)	{ var cdate=t.created; var mdate=t.modified; var modifier=t.modifier; var text=t.text; var tags=t.getTags(); }
	if (!t &amp;&amp; !store.isShadowTiddler(title)) f.tiddlers.options[f.tiddlers.options.length]=new Option(title,title,false,true); // add item to list
	f.tiddlers.value=title; // select current title (just in case it wasn't already selected)
	f.created.value=cdate.formatString(this.datetimefmt);
	f.modified.value=mdate.formatString(this.datetimefmt);
	//f.author.value=modifier;
	f.content.value=text;
	f.tags.value=tags;
	f.minoredits.checked=config.options.chkForceMinorUpdate&amp;&amp;!readOnly;
	f.size.value=f.content.value.length;
}

config.macros.tidIDE.add=function(id) {
	var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
	var f=document.getElementById(id+&quot;_editorform&quot;);
	if (f.dirty &amp;&amp; !confirm(config.commands.cancelTiddler.warning.format([f.current]))) return;
	var title=prompt(this.titleMsg,config.macros.newTiddler.title);
	while (title &amp;&amp; store.tiddlerExists(title) &amp;&amp; !confirm(config.messages.overwriteWarning.format([title])))
		title=prompt(this.titleMsg,config.macros.newTiddler.title);
	if (!title || !title.trim().length) return; // cancelled by user
	f.dirty=false; // suppress unneeded confirmation message
	this.set(id,title);
}

config.macros.tidIDE.remove=function(id) {
	var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
	var f=document.getElementById(id+&quot;_editorform&quot;);
	if (!f.current.length) return;
	if (!store.tiddlerExists(f.current) &amp;&amp; store.isShadowTiddler(f.current)) { alert(this.isShadowMsg.format([f.current])); return; }
	if (config.options.chkConfirmDelete &amp;&amp; !confirm(config.commands.deleteTiddler.warning.format([f.current]))) return;
	if (store.tiddlerExists(f.current)) {
		story.closeTiddler(f.current);
		store.removeTiddler(f.current);
		store.setDirty(true);
		if(config.options.chkAutoSave) saveChanges();
	}
	f.tiddlers.options[f.tiddlers.selectedIndex]=null; // remove item from list
	f.dirty=false; // suppress unneeded confirmation message
	this.set(id,&quot;&quot;); // clear form controls
}
//-------------------
config.macros.tidIDE.saveAndContinue=function(id,saveAs) {
	var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
	var f=document.getElementById(id+&quot;_editorform&quot;);
	var title=f.current;
	if (!title || !title.trim().length || saveAs) { // get a new title
                //alert(&quot;Inside!&quot;);
		title=prompt(this.titleMsg,config.macros.newTiddler.title);
		while (title &amp;&amp; store.tiddlerExists(title) &amp;&amp; !confirm(config.messages.overwriteWarning.format([title])))
			title=prompt(this.titleMsg,config.macros.newTiddler.title);
		if (!title || !title.trim().length) return; // cancelled by user
		f.tiddlers.options[f.tiddlers.options.length]=new Option(title,title,false,true); // add item to list
                f.current=title;
	}
	var author=config.options.txtUserName;
	var mdate=new Date();
	var content=f.content.value;
	var tags=f.tags.value;
	var tiddler=store.saveTiddler(title,title,content,author,mdate,tags);
	if (f.minoredits.checked) {
		var author=config.options.txtUserName;
		var mdate=new Date(f.modified.value);
		var cdate=new Date(f.created.value);
		tiddler.assign(null,null,author,mdate,null,cdate);
	}
	store.setDirty(true);
	if(config.options.chkAutoSave){
		saveChanges();
		// shankar - uncomment next line to see the proof that the &quot;***&quot; message is flashed on &quot;Save&quot;.
		//alert(&quot;Called save &amp; continue!&quot;);
	}
	//story.refreshTiddler(title,null,true);
	f.dirty=false;
        //story.closeTiddler(title);  // shankar
        //story.displayTiddler(null, title);
}

config.macros.tidIDE.appendTextToTiddler=function(id, newTextL, newTextR, cursorDelta)
{
    var domEl  = jQuery('textarea').get(0);
    var cStart = domEl.selectionStart;
    var cEnd   = domEl.selectionEnd;
    var Text_Left = domEl.value.substring(0, cStart);
    var Text_Selected = domEl.value.substring(cStart, cEnd);
    var Text_Right = domEl.value.substring(cEnd);
    
    // handling '#' or '*' are special cases - no newTextR here!
    if( (newTextL == newTextR) &amp;&amp;  ((newTextL == '#') || (newTextL == '*'))  )
    {
        newTextR = &quot;&quot;;
        //alert('Before: ' + Text_Selected);
        var InsertText = newTextL + &quot; &quot;;
        if( Text_Selected == &quot;&quot;) 
        {
	    Text_Selected = InsertText;
        }
        else {  // some times, this will add a redundant InsertText at the end.
                // to make that go away will make the code so messy, so we live with this!
        	Text_Selected = InsertText + 
                                  Text_Selected.replace(/\n/g, &quot;\n&quot;+InsertText); 
        	//alert('After: ' + Text_Selected);
    	}  //  if( Text_Selected == &quot;&quot;) 
        domEl.value = Text_Left + Text_Selected + Text_Right; 
        return;
    }
    else {
        // if it is a &quot;img&quot; or &quot;file&quot; markup, we need the file name &amp; need to 
        // modify the newTextL:
        if( !newTextL.indexOf(&quot;[img&quot;) || !newTextL.indexOf(&quot;file:&quot;))
        {
            if( !newTextL.indexOf(&quot;file:&quot;) )
                newTextR = &quot;&quot;;
                ;
            // Guess the Folder name anyway:
             var GuessFolder = location.pathname.substring(    
                                    location.pathname.lastIndexOf('/')+1);           
             GuessFolder = &quot;../LinkedFiles/&quot; + 
                            GuessFolder.substring( 0, GuessFolder.lastIndexOf('.') )
                            + &quot;/&quot;;
            // Guess the file name as the prefix of the tiddler or the full title
            // itself if the title has no spaces:
            var f=document.getElementById(id+&quot;_editorform&quot;);
	    var titlePrompt = (f.current.split(&quot; &quot;)[0]).trim();
            //alert(&quot;Current tiddler name is: &quot; + titlePrompt);
            if ( !newTextL.indexOf(&quot;[img&quot;) )
            {
                titlePrompt += &quot;.JPG&quot;;
            } else
            {
                titlePrompt += &quot;.pdf&quot;;
            }
            xmcmSaveToClipboard( titlePrompt );
            GuessFolder += titlePrompt;

	    // this is the img or file markup - prompt for the file name:
            var myFileName = prompt(&quot;File name: &quot;, GuessFolder);
            if( myFileName == &quot;&quot; )
		return
                ;

            // Prompt for a label for the file display - if it is a file:
            if( !newTextL.indexOf(&quot;file:&quot;) )
            {
                var myFileLabel = prompt(&quot;Label for the file:&quot;, &quot;&quot;);
                myFileLabel     = myFileLabel.trim();
                if (myFileLabel.length &gt; 0)
                {
                    newTextL = &quot;[[&quot; + myFileLabel + &quot;|&quot; + newTextL + myFileName + &quot;]]&quot;;
                } else
                {
                    newTextL += myFileName;
                }
            }  
            else {
                    newTextL += myFileName;
            }    //    if( newTextL.indexOf(&quot;file:&quot;) )

            cEnd = cEnd + newTextL.length + newTextR.length;
            cursorDelta = 0;   
            //alert(&quot;Left Text: &quot; + newTextL); 
            //alert(&quot;newTextR: &quot; + newTextR);        
	}	//if( !newTextL.indexOf(&amp;quot;[img&amp;quot;) || ... )
    	domEl.value = Text_Left + newTextL + 
                      Text_Selected + newTextR + Text_Right;
    }  // else ... if( (newTextL == newTextR) &amp;&amp; (newTextL == &quot;#&quot;)  )  

    // reset the cursor position to the next logical place for
    // inserting text &amp;amp; return the focus to the text box:
    domEl.setSelectionRange(cEnd+cursorDelta, cEnd+cursorDelta);
    domEl.focus().select();
} 

config.macros.tidIDE.save=function(id,saveAs) {
	var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
	var f=document.getElementById(id+&quot;_editorform&quot;);
        var oldTitle = &quot;&quot; ;
	var title=f.current;
	if (!title || !title.trim().length || saveAs) { // get a new title
		title=prompt(this.titleMsg,config.macros.newTiddler.title);
		while (title &amp;&amp; store.tiddlerExists(title) &amp;&amp; !confirm(config.messages.overwriteWarning.format([title])))
			title=prompt(this.titleMsg,config.macros.newTiddler.title);
		if (!title || !title.trim().length) return; // cancelled by user
		f.tiddlers.options[f.tiddlers.options.length]=new Option(title,title,false,true); // add item to list
                if(saveAs) oldTitle = f.current;
		f.current=title;
                //alert(&quot;Changed title: &quot; + f.current);
                // save the new title in the clipboard - in case we need it
                xmcmSaveToClipboard( title ); 
	}
	var author=config.options.txtUserName;
	var mdate=new Date();
	var content=f.content.value;
	var tags=f.tags.value;
	var tiddler=store.saveTiddler(title,title,content,author,mdate,tags);
	if (f.minoredits.checked) {
		var author=config.options.txtUserName;
		var mdate=new Date(f.modified.value);
		var cdate=new Date(f.created.value);
		tiddler.assign(null,null,author,mdate,null,cdate);
	}
	store.setDirty(true);
	if(config.options.chkAutoSave){
		saveChanges();
		// shankar - uncomment next line to see the proof that 
                // the &quot;***&quot; message is flashed on &quot;Save&quot;.
		// alert(&quot;Saved!&quot;);
	}
	story.refreshTiddler(title,null,true);
	f.dirty=false;
        story.closeTiddler(title);  // shankar
        story.displayTiddler(null, title);
         
        // for saveAs option, refresh the old tiddler:
        if( saveAs )
	{
        	config.macros.tidIDE.set( id, oldTitle );
	}
}

config.macros.tidIDE.pushTagsCB = function(id)
{
    var savedTagsTiddler = &quot;DefaultTags&quot;;
    var savedTags;
    var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
    var f=document.getElementById(id+&quot;_editorform&quot;);
    
    // determine the size of the saved tags array:
    if (store.tiddlerExists(savedTagsTiddler)) {
        savedTags = JSON.parse(store.getTiddlerText(savedTagsTiddler));
    }  else {
        savedTags = [&quot;aaTag&quot;, 
                     &quot;excludeLists excludeSearch excludeMissing mySystem&quot;,
                     &quot;excludeLists excludeSearch excludeMissing&quot;,
                     &quot;mySystem&quot;, &quot;systemConfig&quot;];
    }    //  if (!store.tiddlerExists(savedTagsTiddler)) 

    savedTags.unshift(f.tags.value);

    store.saveTiddler( savedTagsTiddler, savedTagsTiddler, 
                       JSON.stringify(savedTags), config.options.txtUserName, 
                       new Date(), &quot;aaTag excludeLists excludeMissing excludeSearch mySystem&quot; );
    autoSaveChanges(null,[savedTagsTiddler]); 
    //alert(&quot;PUSH TAGS: &quot; + f.tags.value);
}    //  config.macros.tidIDE.pushTagsCB = function(id)

config.macros.tidIDE.popTagsCB = function(id)
{
    var savedTagsTiddler = &quot;DefaultTags&quot;;
    var savedTags;

    var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
    var f=document.getElementById(id+&quot;_editorform&quot;);

    if (store.tiddlerExists(savedTagsTiddler)) 
    {
        savedTags = JSON.parse(store.getTiddlerText(savedTagsTiddler));
    }  

    if (savedTags == undefined)
    {
        savedTags = [&quot;aaTag&quot;, 
                     &quot;excludeLists excludeSearch excludeMissing mySystem&quot;,
                     &quot;excludeLists excludeSearch excludeMissing&quot;,
                     &quot;mySystem&quot;, &quot;systemConfig&quot;];
    }    //  if (!store.tiddlerExists(savedTagsTiddler)) 

    f.tags.value = savedTags.shift();

    store.saveTiddler( savedTagsTiddler, savedTagsTiddler, 
                       JSON.stringify(savedTags), config.options.txtUserName, 
                       new Date(), &quot;aaTag excludeLists excludeMissing excludeSearch mySystem&quot; );
    autoSaveChanges(null,[&quot;DefaultTags&quot;]);  

    //alert(&quot;pop tags: &quot; + config.options.tagsDefault[0]);
}    //  config.macros.tidIDE.popTagsCB = function(id)

config.macros.tidIDE.rotateTagsCB = function(id)
{
    var place=document.getElementById(id+&quot;_editorpanel&quot;); if (!place) return;
    var f=document.getElementById(id+&quot;_editorform&quot;);

    var savedTagsTiddler = &quot;DefaultTags&quot;;
    var savedTags;
    
    if (store.tiddlerExists(savedTagsTiddler)) {
        savedTags = JSON.parse(store.getTiddlerText(savedTagsTiddler));
    }

    if (savedTags == undefined)
    {
        savedTags = [&quot;aaTag&quot;, 
                     &quot;excludeLists excludeSearch excludeMissing mySystem&quot;,
                     &quot;excludeLists excludeSearch excludeMissing&quot;,
                     &quot;mySystem&quot;, &quot;systemConfig&quot;];
    }    //  if (!store.tiddlerExists(savedTagsTiddler)) 

    var tmpTag = savedTags.shift();
    savedTags.push(tmpTag);

    store.saveTiddler( savedTagsTiddler, savedTagsTiddler, 
                       JSON.stringify(savedTags), config.options.txtUserName, 
                       new Date(), &quot;aaTag excludeLists excludeMissing excludeSearch mySystem&quot; );
    autoSaveChanges(null,[savedTagsTiddler]); 

    f.tags.value = savedTags[0];

}    //  config.macros.tidIDE.rotateTagsCB = function(id)

//}}}

// // HTML DEFINITIONS
//{{{
config.macros.tidIDE.html = { };
config.macros.tidIDE.html.framework = &quot; \
	&lt;html&gt; %version% &lt;form style='display:inline;margin:0;padding:0;'&gt;%selector%&lt;/form&gt; %panels% &lt;/html&gt; \
&quot;;
//}}}
//{{{
config.macros.tidIDE.html.editorchk = &quot; \
	&lt;input type=checkbox name=editor \
		style='display:inline;width:auto;margin:1px;' \
		title='add/delete/modify tiddlers' %showpanel% \
		onclick='document.getElementById(\&quot;%id%_editorpanel\&quot;).style.display=this.checked?\&quot;block\&quot;:\&quot;none\&quot;;'&gt;%toolname% \
&quot;;
config.macros.tidIDE.html.toolschk = &quot; \
	&lt;input type=checkbox name=tools \
		style='display:inline;width:auto;margin:1px;' \
		title='' %showpanel% \
		onclick='document.getElementById(\&quot;%id%_%toolid%_panel\&quot;).style.display=this.checked?\&quot;block\&quot;:\&quot;none\&quot;; \
			if (this.checked) config.macros.tidIDE.loadPanel(\&quot;%id%\&quot;,\&quot;%toolid%\&quot;);'&gt;%toolname% \
&quot;;
//}}}
//{{{
config.macros.tidIDE.html.toolspanel = &quot; \
	&lt;div id='%id%_%toolid%_panel' style='display:%showpanel%;margin:0;margin-top:0.5em'&gt; \
	&lt;/div&gt; \
&quot;;
//}}}
/***
//{{{
!editorPanel
&lt;div id='%id%_editorpanel' style='display:%showpanel%;margin:0;margin-top:0.5em'&gt;
&lt;form id='%id%_editorform' style='display:inline;margin:0;padding:0;'&gt;

&lt;!-- tiddler editor list and buttons --&gt;
&lt;select size=1 name=tiddlers style='display:inline;width:20%;'
	onchange='config.macros.tidIDE.set(&quot;%id%&quot;,this.value); this.value=this.form.current;'&gt;
&lt;option value=''&gt;select a tiddler...&lt;/option&gt;
%tiddlerlist%
&lt;/select&gt;&lt;!--


--&gt;&lt;input name=saveAndContinue type=button style='display:inline;width:10%'
	value='save &amp; continue' title='save changes to this tiddler and continue editing'
	onclick='config.macros.tidIDE.saveAndContinue(&quot;%id%&quot;)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=save type=button style='display:inline;width:4%'
	value='save' title='save changes to this tiddler'
	onclick='config.macros.tidIDE.save(&quot;%id%&quot;)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=saveas type=button style='display:inline;width:5%'
	value='save as' title='save changes to a new tiddler'
	onclick='config.macros.tidIDE.save(&quot;%id%&quot;,true)' %disabled%&gt;&lt;!--

--&gt;&lt;input name=insertImageTemplate type=button style='display:inline;width:4%'
	value='Img' title='insert template text for images'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;[img(400px+,250px+)[&quot;, &quot;]]&quot;, 41)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=insertFileTemplate type=button style='display:inline;width:4%'
	value='File' title='insert template text for files'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;file:&quot;, &quot;&quot;, 8)' %disabled%&gt;&lt;!--

--&gt;&lt;input name=insertFormatEM type=button style='display:inline;width:4%'
	value='em' title='insert markup for emphasis formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{{&quot;, &quot;}}}&quot;, 3)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=insertFormatVM type=button style='display:inline;width:4%'
	value='vm' title='insert markup for verbatim formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{{\n&quot;, &quot;\n}}}&quot;, 4)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=insertFormatBLK type=button style='display:inline;width:4%'
	value='blk' title='insert markup for block formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{block{\n&quot;, &quot;\n}}}&quot;, 9)' %disabled%&gt;&lt;!--

----&gt;&lt;input name=insertFormatItalics type=button style='display:inline;width:3%'
	value='it' title='insert markup for italics formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;&amp;#47;&amp;#47;&quot;, &quot;&amp;#47;&amp;#47;&quot;, 2)' %disabled%&gt;&lt;!--

----&gt;&lt;input name=insertFormatBold type=button style='display:inline;width:3%'
	value='B' title='insert markup for Bold formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;&amp;#39;&amp;#39;&quot;, &quot;&amp;#39;&amp;#39;&quot;, 2)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatU type=button style='display:inline;width:3%'
	value='U' title='insert markup for underscore formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;__&quot;, &quot;__&quot;, 2)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormat# type=button style='display:inline;width:3%'
	value='#' title='insert markup for bold faces formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;#&quot;, &quot;#&quot;, 2)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormat* type=button style='display:inline;width:3%'
	value='*' title='insert markup for bullet items formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;*&quot;, &quot;*&quot;, 2)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatOW type=button style='display:inline;width:3%'
	value='--' title='insert markup for Over Write formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;--&quot;, &quot;--&quot;, 2)' %disabled%&gt;&lt;!--


--&gt;&lt;input name=insertFormatC0 type=button style='display:inline;width:3%'
	value='c0' title='insert markup for c0 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c0{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--
--&gt;&lt;input name=insertFormatC1 type=button style='display:inline;width:3%'
	value='c1' title='insert markup for c1 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c1{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatC2 type=button style='display:inline;width:3%'
	value='c2' title='insert markup for c2 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c2{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatC3 type=button style='display:inline;width:3%'
	value='c3' title='insert markup for c3 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c3{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatC4 type=button style='display:inline;width:3%'
	value='c4' title='insert markup for c4 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c4{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--
----&gt;&lt;input name=insertFormatC5 type=button style='display:inline;width:3%'
	value='c5' title='insert markup for c5 formating'
	onclick='config.macros.tidIDE.appendTextToTiddler(&quot;%id%&quot;, &quot;{{c5{\n&quot;, &quot;\n}}}&quot;, 6)' %disabled%&gt;&lt;!--

&lt;!-- tiddler content edit --&gt;
&lt;div&gt;&lt;textarea id='%id%_content' name='content' edit='text' cols=60 rows=%maxrows%
	style='width:100%;'
	onkeyup='var f=this.form; f.dirty=true; f.size.value=this.value.length;'&gt;&lt;/textarea&gt;&lt;/div&gt;

&lt;!-- tag edit and droplist --&gt;
&lt;table width='100%' style='border:0;padding:0;margin:0'&gt;&lt;tr style='border:0;padding:0;margin:0'&gt;
&lt;td style='border:0;padding:0;margin:0'&gt;
	&lt;input type=text name=tags edit='tags' size=60 style='width:100%;' value=''
		onchange='this.form.dirty=true' %disabled%&gt;
&lt;/td&gt;&lt;td width='1' style='border:0;padding:0;margin:0;'&gt;
        &lt;input name=rotateTags type=button  size=1 
	value='Rotate' title='rotate tags'
	onclick='config.macros.tidIDE.rotateTagsCB(&quot;%id%&quot;)' %disabled%&gt;
&lt;/td&gt;&lt;td width='1' style='border:0;padding:0;margin:0;'&gt;
        &lt;input name=popTags type=button  size=1 
	value='Pop' title='pop tags'
	onclick='config.macros.tidIDE.popTagsCB(&quot;%id%&quot;)' %disabled%&gt;
&lt;/td&gt;&lt;td width='1' style='border:0;padding:0;margin:0;'&gt;
        &lt;input name=pushTags type=button  size=1 
	value='Push' title='push tags'
	onclick='config.macros.tidIDE.pushTagsCB(&quot;%id%&quot;)' %disabled%&gt;
&lt;/td&gt;&lt;td width='1' style='border:0;padding:0;margin:0;'&gt;
	&lt;select size=1 name=taglist
		onchange='this.form.dirty=true; this.form.tags.value+=&quot; &quot;+this.value' %disabled%&gt;
	&lt;option value=''&gt;select tags...&lt;/option&gt;
	%taglist%
	&lt;/select&gt;
&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;

&lt;!-- toggles: read-only, minor edit --&gt;
&lt;!-- created/modified dates, author, current tiddler size --&gt;
&lt;div style='float:left;'&gt;

        edits minor &lt;input type=checkbox name=minoredits
	        style='display:inline;width:auto;margin-left:1px; margin-right: 25px;' %disabled% %minorchk%
	        title='check: save datestamps/author as entered, uncheck: auto-update modified/author'
	   onclick='this.form.created.disabled=this.form.modified.disabled=this.form.author.disabled=!this.checked;
	    
        config.options.chkForceMinorUpdate=this.checked;saveOptionCookie(&quot;chkForceMinorUpdate&quot;);'&gt;

	created &lt;input type=text name=created size=15
		style='margin-right: 25px; display:inline;;text-align:center;padding:0;' value=''
		onchange='this.form.dirty=true' %minoredits%&gt;
	modified &lt;input type=text name=modified size=15
		style='margin-right: 25px; display:inline;text-align:center;padding:0;' value=''
		onchange='this.form.dirty=true;' %minoredits%&gt;
	size: &lt;input type=text name=size size=3
		style='margin-right: 15px; display:inline;text-align:center;padding:0;' value=''
		onfocus='this.blur()' onkeydown='return false' DISABLED&gt;
&lt;/div&gt;


&lt;!-- tiddler preview display --&gt;
&lt;div id='%id%_previewpanel' style='display:none;white-space:nowrap'&gt;&lt;/div&gt;
!end
//}}}
***/
 </pre>
</div>
<div title="TiddlerTweakerPlugin" modifier="YourName" created="200708032311" modified="200911112016" tags="TidIDEPackage systemConfig excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TiddlerTweakerPlugin|
|Source|http://www.TiddlyTools.com/#TiddlerTweakerPlugin|
|Version|2.4.4|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|plugin|
|Description|select multiple tiddlers and modify author, created, modified and/or tag values|
~TiddlerTweaker is a 'power tool' for TiddlyWiki authors.  Select multiple tiddlers from a listbox and 'bulk modify' the creator, author, created, modified and/or tag values of those tiddlers using a compact set of form fields.  The values you enter into the fields simultaneously overwrite the existing values in all tiddlers you have selected.
!!!!!Usage
&lt;&lt;&lt;
{{{&lt;&lt;tiddlerTweaker&gt;&gt;}}}
{{smallform{&lt;&lt;tiddlerTweaker&gt;&gt;}}}
By default, any tags you enter into the TiddlerTweaker will //replace// the existing tags in all the tiddlers you have selected.  However, you can also use TiddlerTweaker to quickly filter specified tags from the selected tiddlers, while leaving any other tags assigned to those tiddlers unchanged:
&gt;Any tag preceded by a '+' (plus) or '-' (minus), will be added or removed from the existing tags //instead of replacing the entire tag definition// of each tiddler (e.g., enter '-excludeLists' to remove that tag from all selected tiddlers.  When using this syntax, care should be taken to ensure that //every// tag is preceded by '+' or '-', to avoid inadvertently overwriting any other existing tags on the selected tiddlers.  (note: the '+' or '-' prefix on each tag value is NOT part of the tag value, and is only used by TiddlerTweaker to control how that tag value is processed)
Important Notes:
* TiddlerTweaker is a 'power user' tool that can make changes to many tiddlers at once.  ''You should always have a recent backup of your document (or 'save changes' just *before* tweaking the tiddlers), just in case you accidentally 'shoot yourself in the foot'.''
* The date and author information on any tiddlers you tweak will ONLY be updated if the corresponding checkboxes have been selected.  As a general rule, after using TiddlerTweaker, always ''//remember to save your document//'' when you are done, even though the tiddler timeline tab may not show any recently modified tiddlers.
* Selecting and updating all tiddlers in a document can take a while.  Your browser may warn about an 'unresponsive script'.  Usually, if you allow it to continue, it should complete the processing... eventually.  Nonetheless, be sure to save your work before you begin tweaking lots of tiddlers, just in case something does get stuck.
&lt;&lt;&lt;
!!!!!Revisions
&lt;&lt;&lt;
2009.09.15 2.4.4 added 'edit' button. moved html definition to separate section
2009.09.13 2.4.3 in settiddlers(), convert backslashed chars (\n\b\s\t) in replacement text
2009.06.26 2.4.2 only add brackets around tags containing spaces
2009.06.22 2.4.1 in setFields(), add brackets around all tags shown tweaker edit field
2009.03.30 2.4.0 added 'sort by modifier'
2009.01.22 2.3.0 added support for text pattern find/replace
2008.10.27 2.2.3 in setTiddlers(), fixed Safari bug by replacing static Array.concat(...) with new Array().concat(...)
2008.09.07 2.2.2 added removeCookie() function for compatibility with [[CookieManagerPlugin]]
2008.05.12 2.2.1 replace built-in backstage tweak task with tiddler tweaker control panel (moved from BackstageTweaks)
2008.01.13 2.2.0 added 'auto-selection' links: all, changed, tags, title, text
2007.12.26 2.1.0 added support for managing 'creator' custom field (see [[CoreTweaks]])
2007.11.01 2.0.3 added config.options.txtTweakerSortBy for cookie-based persistence of list display order preference setting.
2007.09.28 2.0.2 in settiddlers() and deltiddlers(), added suspend/resume notification handling (improves performance when operating on multiple tiddlers)
2007.08.03 2.0.1 added shadow definition for [[TiddlerTweaker]] tiddler for use as parameter references with {{{&lt;&lt;tiddler&gt;&gt;, &lt;&lt;slider&gt;&gt; or &lt;&lt;tabs&gt;&gt;}}} macros.
2007.08.03 2.0.0 converted from inline script
2006.01.01 1.0.0 initial release
&lt;&lt;&lt;
!!!!!Code
***/
//{{{
version.extensions.TiddlerTweakerPlugin= {major: 2, minor: 4, revision: 4, date: new Date(2009,9,15)};

// shadow tiddler
config.shadowTiddlers.TiddlerTweaker='&lt;&lt;tiddlerTweaker&gt;&gt;';

// defaults
if (config.options.txtTweakerSortBy==undefined) config.options.txtTweakerSortBy='modified';

// backstage task
if (config.tasks) { // for TW2.2b3 or above
	config.tasks.tweak.tooltip='review/modify tiddler internals: dates, authors, tags, etc.';
	config.tasks.tweak.content='{{smallform small groupbox{&lt;&lt;tiddlerTweaker&gt;&gt;}}}';
}

// if removeCookie() function is not defined by TW core, define it here.
if (window.removeCookie===undefined) {
	window.removeCookie=function(name) {
		document.cookie = name+'=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;'; 
	}
}

config.macros.tiddlerTweaker = {
	handler: function(place,macroName,params,wikifier,paramString,tiddler) {
		var span=createTiddlyElement(place,'span');
		span.innerHTML=store.getTiddlerText('TiddlerTweakerPlugin##html');
		this.init(span.getElementsByTagName('form')[0],config.options.txtTweakerSortBy);
	},
	init: function(f,sortby) { // initialize form controls
		if (!f) return; // form might not be rendered yet...
		while (f.list.options[0]) f.list.options[0]=null; // empty current list content
		var tids=store.getTiddlers(sortby);
		if (sortby=='size') // descending order
			tids.sort(function(a,b) {return a.text.length &gt; b.text.length ? -1 : (a.text.length == b.text.length ? 0 : +1);});
		var who='';
		for (i=0; i&lt;tids.length; i++) { var t=tids[i];
			var label=t.title; var value=t.title;
			switch (sortby) {
				case 'modified':
				case 'created':
					var t=tids[tids.length-i-1]; // reverse order
					var when=t[sortby].formatString('YY.0MM.0DD 0hh:0mm ');
					label=when+t.title;
					value=t.title;
					break;
				case 'size':
					label='['+t.text.length+'] '+label;
					break;
				case 'modifier':
				case 'creator':
					if (who!=t[sortby]) {
						who=t[sortby];
						f.list.options[f.list.length]=new Option('by '+who+':','',false,false);
					}
					label='\xa0\xa0\xa0'+label; // indent
					break;
			}
			f.list.options[f.list.length]=new Option(label,value,false,false);
		}
		f.title.value=f.who.value=f.creator.value=f.tags.value='';
		f.cm.value=f.cd.value=f.cy.value=f.ch.value=f.cn.value='';
		f.mm.value=f.md.value=f.my.value=f.mh.value=f.mn.value='';
		f.stats.disabled=f.set.disabled=f.del.disabled=f.edit.disabled=f.display.disabled=true;
		f.settitle.disabled=false;
		config.options.txtTweakerSortBy=sortby;
		f.sortby.value=sortby; // sync droplist
		if (sortby!='modified') saveOptionCookie('txtTweakerSortBy');
		else removeCookie('txtTweakerSortBy');
	},
	selecttiddlers: function(here) { // enables/disables inputs based on #items selected
		var f=here.form; var list=f.list;
		var c=0; for (i=0;i&lt;list.length;i++) if (list.options[i].selected) c++;
		if (c&gt;1) f.title.disabled=true;
		if (c&gt;1) f.settitle.checked=false;
		f.set.disabled=(c==0);
		f.del.disabled=(c==0);
		f.edit.disabled=(c==0);
		f.display.disabled=(c==0);
		f.settitle.disabled=(c&gt;1);
		f.stats.disabled=(c==0);
		var msg=(c==0)?'select tiddlers':(c+' tiddler'+(c!=1?'s':'')+' selected');
		here.previousSibling.firstChild.firstChild.nextSibling.innerHTML=msg;
		if (c) clearMessage(); else displayMessage('no tiddlers selected');
	},
	setfields: function(here) { // set fields from first selected tiddler
		var f=here.form;
		if (!here.value.length) {
			f.title.value=f.who.value=f.creator.value=f.tags.value='';
			f.cm.value=f.cd.value=f.cy.value=f.ch.value=f.cn.value='';
			f.mm.value=f.md.value=f.my.value=f.mh.value=f.mn.value='';
			return;
		}
		var tid=store.getTiddler(here.value); if (!tid) return;
		f.title.value=tid.title;
		f.who.value=tid.modifier;
		f.creator.value=tid.fields['creator']||''; // custom field - might not exist
		f.tags.value=tid.tags.map(function(t){return String.encodeTiddlyLink(t)}).join(' ');
		var c=tid.created; var m=tid.modified;
		f.cm.value=c.getMonth()+1;
		f.cd.value=c.getDate();
		f.cy.value=c.getFullYear();
		f.ch.value=c.getHours();
		f.cn.value=c.getMinutes();
		f.mm.value=m.getMonth()+1;
		f.md.value=m.getDate();
		f.my.value=m.getFullYear();
		f.mh.value=m.getHours();
		f.mn.value=m.getMinutes();
	},
	settiddlers: function(here) {
		var f=here.form; var list=f.list;
		var tids=[];
		for (i=0;i&lt;list.length;i++) if (list.options[i].selected) tids.push(list.options[i].value);
		if (!tids.length) { alert('please select at least one tiddler'); return; }
		var cdate=new Date(f.cy.value,f.cm.value-1,f.cd.value,f.ch.value,f.cn.value);
		var mdate=new Date(f.my.value,f.mm.value-1,f.md.value,f.mh.value,f.mn.value);
		if (tids.length&gt;1 &amp;&amp; !confirm('Are you sure you want to update these tiddlers:\n\n'+tids.join(', '))) return;
		store.suspendNotifications();
		for (t=0;t&lt;tids.length;t++) {
			var tid=store.getTiddler(tids[t]); if (!tid) continue;
			var title=!f.settitle.checked?tid.title:f.title.value;
			var who=!f.setwho.checked?tid.modifier:f.who.value;
			var text=tid.text;
			if (f.replacetext.checked) {
				var r=f.replacement.value.replace(/\\t/mg,'\t').unescapeLineBreaks();
				text=text.replace(new RegExp(f.pattern.value,'mg'),r);
			}				
			var tags=tid.tags;
			if (f.settags.checked) { 
				var intags=f.tags.value.readBracketedList();
				var addtags=[]; var deltags=[]; var reptags=[];
				for (i=0;i&lt;intags.length;i++) {
					if (intags[i].substr(0,1)=='+')
						addtags.push(intags[i].substr(1));
					else if (intags[i].substr(0,1)=='-')
						deltags.push(intags[i].substr(1));
					else
						reptags.push(intags[i]);
				}
				if (reptags.length)
					tags=reptags;
				if (addtags.length)
					tags=new Array().concat(tags,addtags);
				if (deltags.length)
					for (i=0;i&lt;deltags.length;i++)
						{ var pos=tags.indexOf(deltags[i]); if (pos!=-1) tags.splice(pos,1); }
			}
			if (!f.setcdate.checked) cdate=tid.created;
			if (!f.setmdate.checked) mdate=tid.modified;
			store.saveTiddler(tid.title,title,text,who,mdate,tags,tid.fields);
			if (f.setcreator.checked) store.setValue(tid.title,'creator',f.creator.value); // set creator
			if (f.setcdate.checked) tid.assign(null,null,null,null,null,cdate); // set create date
		}
		store.resumeNotifications();
		this.init(f,f.sortby.value);
	},
	displaytiddlers: function(here,edit) {
		var f=here.form; var list=f.list;
		var tids=[];
		for (i=0; i&lt;list.length;i++) if (list.options[i].selected) tids.push(list.options[i].value);
		if (!tids.length) { alert('please select at least one tiddler'); return; }
		story.displayTiddlers(story.findContainingTiddler(f),tids,edit?DEFAULT_EDIT_TEMPLATE:null);
	},
	deltiddlers: function(here) {
		var f=here.form; var list=f.list;
		var tids=[];
		for (i=0;i&lt;list.length;i++) if (list.options[i].selected) tids.push(list.options[i].value);
		if (!tids.length) { alert('please select at least one tiddler'); return; }
		if (!confirm('Are you sure you want to delete these tiddlers:\n\n'+tids.join(', '))) return;
		store.suspendNotifications();
		for (t=0;t&lt;tids.length;t++) {
			var tid=store.getTiddler(tids[t]); if (!tid) continue;
			if (tid.tags.contains('systemConfig')) {
				var msg=tid.title+' is tagged with systemConfig.'
					+'\n\nRemoving this tiddler may cause unexpected results.  Are you sure?';
				if (!confirm(msg)) continue;
			}
			store.removeTiddler(tid.title);
			story.closeTiddler(tid.title);
		}
		store.resumeNotifications();
		this.init(f,f.sortby.value);
	},
	stats: function(here) {
		var f=here.form; var list=f.list; var tids=[]; var out=''; var tot=0;
		var target=f.nextSibling;
		for (i=0;i&lt;list.length;i++) if (list.options[i].selected) tids.push(list.options[i].value);
		if (!tids.length) { alert('please select at least one tiddler'); return; }
		for (t=0;t&lt;tids.length;t++) {
			var tid=store.getTiddler(tids[t]); if (!tid) continue;
			out+='[['+tid.title+']] '+tid.text.length+'\n'; tot+=tid.text.length;
		}
		var avg=tot/tids.length;
		out=tot+' bytes in '+tids.length+' selected tiddlers ('+avg+' bytes/tiddler)\n&lt;&lt;&lt;\n'+out+'&lt;&lt;&lt;\n';
		removeChildren(target);
		target.innerHTML=&quot;&lt;hr&gt;&lt;font size=-2&gt;&lt;a href='javascript:;' style='float:right' &quot;
			+&quot;onclick='this.parentNode.parentNode.style.display=\&quot;none\&quot;'&gt;close&lt;/a&gt;&lt;/font&gt;&quot;;
		wikify(out,target);
		target.style.display='block';
	}
};
//}}}
/***
//{{{
!html
&lt;style&gt;
.tiddlerTweaker table,
.tiddlerTweaker table tr,
.tiddlerTweaker table td
	{ padding:0;margin:0;border:0;white-space:nowrap; }
&lt;/style&gt;&lt;form class='tiddlerTweaker'&gt;&lt;!--
--&gt;&lt;table style=&quot;width:100%&quot;&gt;&lt;tr valign=&quot;top&quot;&gt;&lt;!--
--&gt;&lt;td style=&quot;text-align:center;width:99%;&quot;&gt;&lt;!--
	--&gt;&lt;font size=-2&gt;&lt;div style=&quot;text-align:left;&quot;&gt;&lt;span style=&quot;float:right&quot;&gt;&lt;!--
	--&gt;&amp;nbsp; &lt;a href=&quot;javascript:;&quot; 
		title=&quot;select all tiddlers&quot;
		onclick=&quot;
		var f=this; while (f&amp;&amp;f.nodeName.toLowerCase()!='form')f=f.parentNode;
		for (var t=0; t&lt;f.list.options.length; t++)
			if (f.list.options[t].value.length) f.list.options[t].selected=true;
		config.macros.tiddlerTweaker.selecttiddlers(f.list);
		return false&quot;&gt;all&lt;/a&gt;&lt;!--
	--&gt;&amp;nbsp; &lt;a href=&quot;javascript:;&quot; 
		title=&quot;select tiddlers that are new/changed since the last file save&quot;
		onclick=&quot;
		var lastmod=new Date(document.lastModified);
		var f=this; while (f&amp;&amp;f.nodeName.toLowerCase()!='form')f=f.parentNode;
		for (var t=0; t&lt;f.list.options.length; t++) {
			var tid=store.getTiddler(f.list.options[t].value);
			f.list.options[t].selected=tid&amp;&amp;tid.modified&gt;lastmod;
		}
		config.macros.tiddlerTweaker.selecttiddlers(f.list);
		return false&quot;&gt;changed&lt;/a&gt;&lt;!--
	--&gt;&amp;nbsp; &lt;a href=&quot;javascript:;&quot; 
		title=&quot;select tiddlers with at least one matching tag&quot;
		onclick=&quot;
		var t=prompt('Enter space-separated tags (match ONE)');
		if (!t||!t.length) return false;
		var tags=t.readBracketedList();
		var f=this; while (f&amp;&amp;f.nodeName.toLowerCase()!='form')f=f.parentNode;
		for (var t=0; t&lt;f.list.options.length; t++) {
			f.list.options[t].selected=false;
			var tid=store.getTiddler(f.list.options[t].value);
			if (tid&amp;&amp;tid.tags.containsAny(tags)) f.list.options[t].selected=true;
		}
		config.macros.tiddlerTweaker.selecttiddlers(f.list);
		return false&quot;&gt;tags&lt;/a&gt;&lt;!--
	--&gt;&amp;nbsp; &lt;a href=&quot;javascript:;&quot; 
		title=&quot;select tiddlers whose titles include matching text&quot;
		onclick=&quot;
		var txt=prompt('Enter a title (or portion of a title) to match');
		if (!txt||!txt.length) return false;
		var f=this; while (f&amp;&amp;f.nodeName.toLowerCase()!='form')f=f.parentNode;
		for (var t=0; t&lt;f.list.options.length; t++) {
			f.list.options[t].selected=f.list.options[t].value.indexOf(txt)!=-1;
		}
		config.macros.tiddlerTweaker.selecttiddlers(f.list);
		return false&quot;&gt;titles&lt;/a&gt;&lt;!--
	--&gt;&amp;nbsp; &lt;a href=&quot;javascript:;&quot; 
		title=&quot;select tiddlers containing matching text&quot;
		onclick=&quot;
		var txt=prompt('Enter tiddler text (content) to match');
		if (!txt||!txt.length) return false;
		var f=this; while (f&amp;&amp;f.nodeName.toLowerCase()!='form')f=f.parentNode;
		for (var t=0; t&lt;f.list.options.length; t++) {
			var tt=store.getTiddlerText(f.list.options[t].value,'');
			f.list.options[t].selected=(tt.indexOf(txt)!=-1);
		}
		config.macros.tiddlerTweaker.selecttiddlers(f.list);
		return false&quot;&gt;text&lt;/a&gt; &amp;nbsp;&lt;!--
	--&gt;&lt;/span&gt;&lt;span&gt;select tiddlers&lt;/span&gt;&lt;!--
	--&gt;&lt;/div&gt;&lt;!--
	--&gt;&lt;/font&gt;&lt;select multiple name=list size=&quot;11&quot; style=&quot;width:99.99%&quot; 
		title=&quot;use click, shift-click and/or ctrl-click to select multiple tiddler titles&quot; 
		onclick=&quot;config.macros.tiddlerTweaker.selecttiddlers(this)&quot; 
		onchange=&quot;config.macros.tiddlerTweaker.setfields(this)&quot;&gt;&lt;!--
	--&gt;&lt;/select&gt;&lt;br&gt;&lt;!--
	--&gt;show&lt;input type=text size=1 value=&quot;11&quot; 
		onchange=&quot;this.form.list.size=this.value; this.form.list.multiple=(this.value&gt;1);&quot;&gt;&lt;!--
	--&gt;by&lt;!--
	--&gt;&lt;select name=sortby size=1 
		onchange=&quot;config.macros.tiddlerTweaker.init(this.form,this.value)&quot;&gt;&lt;!--
	--&gt;&lt;option value=&quot;title&quot;&gt;title&lt;/option&gt;&lt;!--
	--&gt;&lt;option value=&quot;size&quot;&gt;size&lt;/option&gt;&lt;!--
	--&gt;&lt;option value=&quot;modified&quot;&gt;modified&lt;/option&gt;&lt;!--
	--&gt;&lt;option value=&quot;created&quot;&gt;created&lt;/option&gt;&lt;!--
	--&gt;&lt;option value=&quot;modifier&quot;&gt;modifier&lt;/option&gt;&lt;!--
	--&gt;&lt;/select&gt;&lt;!--
	--&gt;&lt;input type=&quot;button&quot; value=&quot;refresh&quot; 
		onclick=&quot;config.macros.tiddlerTweaker.init(this.form,this.form.sortby.value)&quot;&lt;!--
	--&gt; &lt;input type=&quot;button&quot; name=&quot;stats&quot; disabled value=&quot;totals...&quot; 
		onclick=&quot;config.macros.tiddlerTweaker.stats(this)&quot;&gt;&lt;!--
--&gt;&lt;/td&gt;&lt;td style=&quot;width:1%&quot;&gt;&lt;!--
	--&gt;&lt;div style=&quot;text-align:left&quot;&gt;&lt;font size=-2&gt;&amp;nbsp;modify values&lt;/font&gt;&lt;/div&gt;&lt;!--
	--&gt;&lt;table style=&quot;width:100%;&quot;&gt;&lt;tr&gt;&lt;!--
	--&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=settitle unchecked 
			title=&quot;allow changes to tiddler title (rename tiddler)&quot; 
			onclick=&quot;this.form.title.disabled=!this.checked&quot;&gt;title&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=title size=35 style=&quot;width:98%&quot; disabled&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=setcreator unchecked 
			title=&quot;allow changes to tiddler creator&quot; 
			onclick=&quot;this.form.creator.disabled=!this.checked&quot;&gt;created by&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px;&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=creator size=35 style=&quot;width:98%&quot; disabled&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=setwho unchecked 
			title=&quot;allow changes to tiddler author&quot; 
			onclick=&quot;this.form.who.disabled=!this.checked&quot;&gt;modified by&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=who size=35 style=&quot;width:98%&quot; disabled&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=setcdate unchecked 
			title=&quot;allow changes to created date&quot; 
			onclick=&quot;var f=this.form;
				f.cm.disabled=f.cd.disabled=f.cy.disabled=f.ch.disabled=f.cn.disabled=!this.checked&quot;&gt;&lt;!--
		--&gt;created on&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=cm size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; / &lt;input type=text name=cd size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; / &lt;input type=text name=cy size=4 style=&quot;width:3em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; at &lt;input type=text name=ch size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; : &lt;input type=text name=cn size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=setmdate unchecked 
			title=&quot;allow changes to modified date&quot; 
			onclick=&quot;var f=this.form;
				f.mm.disabled=f.md.disabled=f.my.disabled=f.mh.disabled=f.mn.disabled=!this.checked&quot;&gt;&lt;!--
		--&gt;modified on&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=mm size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; / &lt;input type=text name=md size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; / &lt;input type=text name=my size=4 style=&quot;width:3em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; at &lt;input type=text name=mh size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
		--&gt; : &lt;input type=text name=mn size=2 style=&quot;width:2em;padding:0;text-align:center&quot; disabled&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=replacetext unchecked
			title=&quot;find/replace matching text&quot; 
			onclick=&quot;this.form.pattern.disabled=this.form.replacement.disabled=!this.checked&quot;&gt;replace text&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=pattern size=15 value=&quot;&quot; style=&quot;width:40%&quot; disabled 
			title=&quot;enter TEXT PATTERN (regular expression)&quot;&gt; with&lt;!--
		--&gt;&lt;input type=text name=replacement size=15 value=&quot;&quot; style=&quot;width:40%&quot; disabled 
			title=&quot;enter REPLACEMENT TEXT&quot;&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=checkbox name=settags checked 
			title=&quot;allow changes to tiddler tags&quot; 
			onclick=&quot;this.form.tags.disabled=!this.checked&quot;&gt;tags&lt;!--
	--&gt;&lt;/td&gt;&lt;td style=&quot;padding:1px&quot;&gt;&lt;!--
		--&gt;&lt;input type=text name=tags size=35 value=&quot;&quot; style=&quot;width:98%&quot; 
			title=&quot;enter new tags or use '+tag' and '-tag' to add/remove tags from existing tags&quot;&gt;&lt;!--
	--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;!--
	--&gt;&lt;div style=&quot;text-align:center&quot;&gt;&lt;!--
	--&gt;&lt;nobr&gt;&lt;input type=button name=display disabled style=&quot;width:24%&quot; value=&quot;display&quot; 
		title=&quot;show selected tiddlers&quot;
		onclick=&quot;config.macros.tiddlerTweaker.displaytiddlers(this,false)&quot;&gt;&lt;!--
	--&gt; &lt;input type=button name=edit disabled style=&quot;width:23%&quot; value=&quot;edit&quot; 
		title=&quot;edit selected tiddlers&quot;
		onclick=&quot;config.macros.tiddlerTweaker.displaytiddlers(this,true)&quot;&gt;&lt;!--
	--&gt; &lt;input type=button name=del disabled style=&quot;width:24%&quot; value=&quot;delete&quot; 
		title=&quot;remove selected tiddlers&quot;
		onclick=&quot;config.macros.tiddlerTweaker.deltiddlers(this)&quot;&gt;&lt;!--
	--&gt; &lt;input type=button name=set disabled style=&quot;width:24%&quot; value=&quot;update&quot; 
		title=&quot;update selected tiddlers&quot;
		onclick=&quot;config.macros.tiddlerTweaker.settiddlers(this)&quot;&gt;&lt;/nobr&gt;&lt;!--
	--&gt;&lt;/div&gt;&lt;!--
--&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;!--
--&gt;&lt;/form&gt;&lt;span style=&quot;display:none&quot;&gt;&lt;!--content replaced by tiddler &quot;stats&quot;--&gt;&lt;/span&gt;
!end
//}}}
***/
 </pre>
</div>
<div title="TiddlersBarPluginMG" modifier="YourName" created="200909150237" modified="201403011835" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|''Name:''|TiddlersBarPluginMG|
|''Description:''|A bar to switch between tiddlers through tabs (like browser tabs bar).|
|''Version:''|1.2.5|
|''Date:''|Jan 18,2008|
|''Source:''|http://visualtw.ouvaton.org/VisualTW.html|
|''Author:''|Pascal Collin|
|''License:''|[[BSD open source license|License]]|
|''~CoreVersion:''|2.1.0|
|''Browser:''|Firefox 2.0; InternetExplorer 6.0, others|
!Modification
2008.09.06 -  Morris Gray (Added http://tw.lewcid.org/#OpenTopPlugin code to this plugin to overcome jumping to the top when invoking any popup. Deleted the offending code)
!Demos
On [[homepage|http://visualtw.ouvaton.org/VisualTW.html]], open several tiddlers to use the tabs bar.
!Installation
#import this tiddler from [[homepage|http://visualtw.ouvaton.org/VisualTW.html]] (tagged as systemConfig)
#save and reload
#''if you're using a custom [[PageTemplate]]'', add {{{&lt;div id='tiddlersBar' refresh='none' ondblclick='config.macros.tiddlersBar.onTiddlersBarAction(event)'&gt;&lt;/div&gt;}}} before {{{&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;}}}
#optionally, adjust StyleSheetTiddlersBar
!Tips
*Doubleclick on the tiddlers bar (where there is no tab) create a new tiddler.
*Tabs include a button to close {{{x}}} or save {{{!}}} their tiddler.
*By default, click on the current tab close all others tiddlers.
!Configuration options 
&lt;&lt;option chkDisableTabsBar&gt;&gt; Disable the tabs bar (to print, by example).
&lt;&lt;option chkHideTabsBarWhenSingleTab &gt;&gt; Automatically hide the tabs bar when only one tiddler is displayed. 
&lt;&lt;option txtSelectedTiddlerTabButton&gt;&gt; ''selected'' tab command button.
&lt;&lt;option txtPreviousTabKey&gt;&gt; previous tab access key.
&lt;&lt;option txtNextTabKey&gt;&gt; next tab access key.
!Code
***/
//{{{


config.options.chkDisableTabsBar = config.options.chkDisableTabsBar ? config.options.chkDisableTabsBar : false;
config.options.chkHideTabsBarWhenSingleTab  = config.options.chkHideTabsBarWhenSingleTab  ? config.options.chkHideTabsBarWhenSingleTab  : false;
config.options.txtSelectedTiddlerTabButton = config.options.txtSelectedTiddlerTabButton ? config.options.txtSelectedTiddlerTabButton : &quot;do nothing&quot;;
config.options.txtPreviousTabKey = config.options.txtPreviousTabKey ? config.options.txtPreviousTabKey : &quot;&quot;;
config.options.txtNextTabKey = config.options.txtNextTabKey ? config.options.txtNextTabKey : &quot;&quot;;
config.macros.tiddlersBar = {
	tooltip : &quot;see &quot;,
	tooltipClose : &quot;click here to close this tab&quot;,
	tooltipSave : &quot;click here to save this tab&quot;,
	promptRename : &quot;Enter tiddler new name&quot;,
	currentTiddler : &quot;&quot;,
	previousState : false,
	previousKey : config.options.txtPreviousTabKey,
	nextKey : config.options.txtNextTabKey,	
	tabsAnimationSource : null, //use document.getElementById(&quot;tiddlerDisplay&quot;) if you need animation on tab switching.
	handler: function(place,macroName,params) {
		var previous = null;
		if (config.macros.tiddlersBar.isShown())
			story.forEachTiddler(function(title,e){
				if (title==config.macros.tiddlersBar.currentTiddler){
					var d = createTiddlyElement(null,&quot;span&quot;,null,&quot;tab tabSelected&quot;);
					config.macros.tiddlersBar.createActiveTabButton(d,title);
					if (previous &amp;&amp; config.macros.tiddlersBar.previousKey) previous.setAttribute(&quot;accessKey&quot;,config.macros.tiddlersBar.nextKey);
					previous = &quot;active&quot;;
				}
				else {
					var d = createTiddlyElement(place,&quot;span&quot;,null,&quot;tab tabUnselected&quot;);
					var btn = createTiddlyButton(d,title,config.macros.tiddlersBar.tooltip + title,config.macros.tiddlersBar.onSelectTab);
					btn.setAttribute(&quot;tiddler&quot;, title);
					if (previous==&quot;active&quot; &amp;&amp; config.macros.tiddlersBar.nextKey) btn.setAttribute(&quot;accessKey&quot;,config.macros.tiddlersBar.previousKey);
					previous=btn;
				}
				var isDirty =story.isDirty(title);
				var c = createTiddlyButton(d,isDirty ?&quot;!&quot;:&quot;___x&quot;,isDirty?config.macros.tiddlersBar.tooltipSave:config.macros.tiddlersBar.tooltipClose, isDirty ? config.macros.tiddlersBar.onTabSave : config.macros.tiddlersBar.onTabClose,&quot;tabButton&quot;);
				c.setAttribute(&quot;tiddler&quot;, title);
				if (place.childNodes) {
					place.insertBefore(document.createTextNode(&quot; &quot;),place.firstChild); // to allow break line here when many tiddlers are open
					place.insertBefore(d,place.firstChild); 
				}
				else place.appendChild(d);
			})
	}, 
	refresh: function(place,params){
		removeChildren(place);
		config.macros.tiddlersBar.handler(place,&quot;tiddlersBar&quot;,params);
		if (config.macros.tiddlersBar.previousState!=config.macros.tiddlersBar.isShown()) {
			story.refreshAllTiddlers();
			if (config.macros.tiddlersBar.previousState) story.forEachTiddler(function(t,e){e.style.display=&quot;&quot;;});
			config.macros.tiddlersBar.previousState = !config.macros.tiddlersBar.previousState;
		}
	},
	isShown : function(){
		if (config.options.chkDisableTabsBar) return false;
		if (!config.options.chkHideTabsBarWhenSingleTab) return true;
		var cpt=0;
		story.forEachTiddler(function(){cpt++});
		return (cpt&gt;1);
	},
	selectNextTab : function(){  //used when the current tab is closed (to select another tab)
		var previous=&quot;&quot;;
		story.forEachTiddler(function(title){
			if (!config.macros.tiddlersBar.currentTiddler) {
				story.displayTiddler(null,title);
				return;
			}
			if (title==config.macros.tiddlersBar.currentTiddler) {
				if (previous) {
					story.displayTiddler(null,previous);
					return;
				}
				else config.macros.tiddlersBar.currentTiddler=&quot;&quot;; 	// so next tab will be selected
			}
			else previous=title;
			});		
	},
	onSelectTab : function(e){
		var t = this.getAttribute(&quot;tiddler&quot;);
		if (t) story.displayTiddler(null,t);
		return false;
	},
	onTabClose : function(e){
		var t = this.getAttribute(&quot;tiddler&quot;);
		if (t) {
			if(story.hasChanges(t) &amp;&amp; !readOnly) {
				if(!confirm(config.commands.cancelTiddler.warning.format([t])))
				return false;
			}
			story.closeTiddler(t);
		}
		return false;
	},
	onTabSave : function(e) {
		var t = this.getAttribute(&quot;tiddler&quot;);
		if (!e) e=window.event;
		if (t) config.commands.saveTiddler.handler(e,null,t);
		return false;
	},
	onSelectedTabButtonClick : function(event,src,title) {
		var t = this.getAttribute(&quot;tiddler&quot;);
		if (!event) event=window.event;
		if (t &amp;&amp; config.options.txtSelectedTiddlerTabButton &amp;&amp; config.commands[config.options.txtSelectedTiddlerTabButton])
			config.commands[config.options.txtSelectedTiddlerTabButton].handler(event, src, t);
		return false;
	},
	onTiddlersBarAction: function(event) {
		var source = event.target ? event.target.id : event.srcElement.id; // FF uses target and IE uses srcElement;
		if (source==&quot;tiddlersBar&quot;) story.displayTiddler(null,'New Tiddler',DEFAULT_EDIT_TEMPLATE,false,null,null);
	},
	createActiveTabButton : function(place,title) {
		if (config.options.txtSelectedTiddlerTabButton &amp;&amp; config.commands[config.options.txtSelectedTiddlerTabButton]) {
			var btn = createTiddlyButton(place, title, config.commands[config.options.txtSelectedTiddlerTabButton].tooltip ,config.macros.tiddlersBar.onSelectedTabButtonClick);
			btn.setAttribute(&quot;tiddler&quot;, title);
		}
		else
			createTiddlyText(place,title);
	}
}

story.coreCloseTiddler = story.coreCloseTiddler? story.coreCloseTiddler : story.closeTiddler;
story.coreDisplayTiddler = story.coreDisplayTiddler ? story.coreDisplayTiddler : story.displayTiddler;

story.closeTiddler = function(title,animate,unused) {
	if (title==config.macros.tiddlersBar.currentTiddler)
		config.macros.tiddlersBar.selectNextTab();
	story.coreCloseTiddler(title,false,unused); //disable animation to get it closed before calling tiddlersBar.refresh
	var e=document.getElementById(&quot;tiddlersBar&quot;);
	if (e) config.macros.tiddlersBar.refresh(e,null);
}

story.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle){
	story.coreDisplayTiddler(config.macros.tiddlersBar.tabsAnimationSource,tiddler,template,animate,unused,customFields,toggle);
	var title = (tiddler instanceof Tiddler)? tiddler.title : tiddler;  
	if (config.macros.tiddlersBar.isShown()) {
		story.forEachTiddler(function(t,e){
			if (t!=title) e.style.display=&quot;none&quot;;
			else e.style.display=&quot;&quot;;
		})
		config.macros.tiddlersBar.currentTiddler=title;
	}
	var e=document.getElementById(&quot;tiddlersBar&quot;);
	if (e) config.macros.tiddlersBar.refresh(e,null);
}

var coreRefreshPageTemplate = coreRefreshPageTemplate ? coreRefreshPageTemplate : refreshPageTemplate;
refreshPageTemplate = function(title) {
	coreRefreshPageTemplate(title);
	if (config.macros.tiddlersBar) config.macros.tiddlersBar.refresh(document.getElementById(&quot;tiddlersBar&quot;));
}

ensureVisible=function (e) {return 0} //disable bottom scrolling (not useful now)

config.shadowTiddlers.StyleSheetTiddlersBar = &quot;/*{{{*/\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar += &quot;#tiddlersBar .button {border:0}\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar += &quot;#tiddlersBar .tab {white-space:nowrap}\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar += &quot;#tiddlersBar {padding : 1em 0.5em 2px 0.5em}\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar += &quot;.tabUnselected .tabButton, .tabSelected .tabButton {padding : 0 2px 0 2px; margin: 0 0 0 4px;}\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar += &quot;.tiddler, .tabContents {border:1px [[ColorPalette::TertiaryPale]] solid;}\n&quot;;
config.shadowTiddlers.StyleSheetTiddlersBar +=&quot;/*}}}*/&quot;;
store.addNotification(&quot;StyleSheetTiddlersBar&quot;, refreshStyles);

config.refreshers.none = function(){return true;}
config.shadowTiddlers.PageTemplate=config.shadowTiddlers.PageTemplate.replace(/&lt;div id='tiddlerDisplay'&gt;&lt;\/div&gt;/m,&quot;&lt;div id='tiddlersBar' refresh='none' ondblclick='config.macros.tiddlersBar.onTiddlersBarAction(event)'&gt;&lt;/div&gt;\n&lt;div id='tiddlerDisplay'&gt;&lt;/div&gt;&quot;);

//}}}</pre>
</div>
<div title="ToggleFullScreen" modifier="YourName" created="200801202351" modified="200911112015" tags="transclusion bookmarklet excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ToggleFullScreen|
|Source|http://www.TiddlyTools.com/#ToggleFullScreen|
|Version|2.0.1|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|Create a link that shows/hides sidebars and page headers|
Usage
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ToggleFullScreen&gt;&gt;
&lt;&lt;tiddler ToggleFullScreen with: label altlabel&gt;&gt;
}}}
&lt;&lt;&lt;
Example
&lt;&lt;&lt;
{{{&lt;&lt;tiddler ToggleFullScreen with: fullscreen restore&gt;&gt;}}}
&lt;&lt;tiddler ToggleFullScreen##show with: fullscreen restore&gt;&gt;
&lt;&lt;&lt;
!end

!show
&lt;html&gt;&lt;nowiki&gt;&lt;a href='javascript:;' title=&quot;FULLSCREEN: toggle sidebars and page header&quot;
onmouseover=&quot;
	this.href='javascript:void(eval(decodeURIComponent(%22(function(){try{('
	+encodeURIComponent(encodeURIComponent(this.onclick))
	+')()}catch(e){alert(e.description?e.description:e.toString())}})()%22)))';&quot;
onclick=&quot;
	var co=config.options;
	co.chkFullScreen=!co.chkFullScreen;
	var showmm=!co.chkFullScreen &amp;&amp; co.chkShowLeftSidebar!==false;
	var showsb=!co.chkFullScreen &amp;&amp; co.chkShowRightSidebar!==false;
	var showcrumbs=!co.chkFullScreen &amp;&amp; co.chkShowBreadcrumbs!==false
		&amp;&amp; config.macros.breadcrumbs &amp;&amp; config.macros.breadcrumbs.crumbs.length;
	var cw=document.getElementById('contentWrapper');
	var da=document.getElementById('displayArea');
	var mm=document.getElementById('mainMenu');
	var sb=document.getElementById('sidebar');
	var sm=document.getElementById('storyMenu');
	var bc=document.getElementById('breadCrumbs');
	if (cw){
		var elems=cw.getElementsByTagName('*');
		for (var i=0; i&lt;elems.length; i++) if (hasClass(elems[i],'header')) 
			{ elems[i].style.display=co.chkFullScreen?'none':'block'; break; }
	}
	if (mm) {
		mm.style.display=showmm?'block':'none';
		da.style.marginLeft=showmm?(co.txtDisplayAreaLeftMargin||''):'1em';
	}
	if (sb) {
		sb.style.display=showsb?'block':'none';
		da.style.marginRight=showsb?(co.txtDisplayAreaRightMargin||''):'1em';
	}
	if (sm) sm.style.display=!co.chkFullScreen ?'block':'none';
	if (bc) bc.style.display=showcrumbs?'block':'none';

	this.innerHTML=!co.chkFullScreen?'$1':'$2';
	var b=document.getElementById('restoreFromFullscreenButton');
	if (b) removeNode(b);
	else { 
		setStylesheet(store.getTiddlerText('ToggleFullScreen##styles'),'fullScreenStyles');
		var b=createTiddlyElement(null,'span','restoreFromFullscreenButton','selected');
		b.innerHTML='&amp;loz;';
		b.title='RESTORE: redisplay page header, menu and sidebar';
		b.onclick=this.onclick;
		document.body.insertBefore(b,null);
	}
	return false;
&quot;&gt;$1&lt;/a&gt;&lt;/html&gt;
!styles
#restoreFromFullscreenButton {
	position:fixed; top:.3em; right:.3em; z-index:10001;
	cursor:pointer; font-size:8pt; color:ButtonText !important;
	border:2px outset ButtonFace; padding:0px 3px;
	background-color:ButtonFace; -moz-appearance:button;
}
!end
%/&lt;&lt;tiddler {{var src='ToggleFullScreen'; src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');}}
with:	{{'$'+'1'!='$1'?'$1':'fullscreen'}}
	{{'$'+'2'!='$2'?'$2':'restore'}}&gt;&gt;</pre>
</div>
<div title="ToggleLeftSidebar" modifier="Shankar" created="200906151643" modified="201109070341" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|ToggleLeftSidebar|
|Source|http://www.TiddlyTools.com/#ToggleLeftSidebar|
|Version|2.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires|InlineJavascriptPlugin|
|Overrides||
|Description|show/hide left sidebar (MainMenu)|

Usage: &lt;&lt;tiddler ToggleLeftSidebar with: &quot;label&quot;&gt;&gt;

Config settings:
	config.options.chkShowLeftSidebar (true)
	config.options.txtToggleLeftSideBarLabelShow (►)
	config.options.txtToggleLeftSideBarLabelHide (◄)

%/&lt;script label=&quot;$1&quot; title=&quot;show/hide MainMenu content&quot;&gt;
	var co=config.options;
	if (co.chkShowLeftSidebar=='undefined') co.chkShowLeftSidebar=true;
	co.chkShowLeftSidebar=!co.chkShowLeftSidebar;
	var mm=document.getElementById('mainMenu'); if (!mm) return;
	mm.style.display=co.chkShowLeftSidebar?'block':'none';
	document.getElementById('displayArea').style.marginLeft=co.chkShowLeftSidebar?'':'1em';
	saveOptionCookie('chkShowLeftSidebar');
	var labelShow=co.txtToggleLeftSideBarLabelShow||'&amp;#x25BA;';
	var labelHide=co.txtToggleLeftSideBarLabelHide||'&amp;#x25C4;';
	if (typeof(place)!='undefined' &amp;&amp; '$1'=='$'+'1') {
		place.innerHTML=co.chkShowLeftSidebar?labelHide:labelShow;
		place.title=(co.chkShowLeftSidebar?'hide':'show')+' left sidebar';
	}
	var sm=document.getElementById('storyMenu'); if (sm) config.refreshers.content(sm);
&lt;/script&gt;&lt;script&gt;
	var co=config.options;
	if (co.chkShowLeftSidebar=='undefined') co.chkShowLeftSidebar=true;
	var mm=document.getElementById('mainMenu'); if (!mm) return;
	mm.style.display=co.chkShowLeftSidebar?'block':'none';
	document.getElementById('displayArea').style.marginLeft=co.chkShowLeftSidebar?'':'1em';
	if ('$1'=='$'+'1') {
		var labelShow=co.txtToggleLeftSideBarLabelShow||'&amp;#x25BA;';
		var labelHide=co.txtToggleLeftSideBarLabelHide||'&amp;#x25C4;';
		place.lastChild.innerHTML=co.chkShowLeftSidebar?labelHide:labelShow;
		place.lastChild.title=(co.chkShowLeftSidebar?'hide':'show')+' left sidebar';
	}
&lt;/script&gt;</pre>
</div>
<div title="ToggleRightSidebar" modifier="Shankar" created="200909150240" modified="200909150242" tags="script mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
|Name|ToggleRightSidebar|
|Source|http://www.TiddlyTools.com/#ToggleRightSidebar|
|Version|2.0.0|
|Author|Eric Shulman - ELS Design Studios|
|License|http://www.TiddlyTools.com/#LegalStatements &lt;br&gt;and [[Creative Commons Attribution-ShareAlike 2.5 License|http://creativecommons.org/licenses/by-sa/2.5/]]|
|~CoreVersion|2.1|
|Type|script|
|Requires|InlineJavascriptPlugin|
|Overrides||
|Description|show/hide right sidebar (MainMenu)|

Usage: &lt;&lt;tiddler ToggleRightSidebar with: &quot;label&quot;&gt;&gt;

Config settings:
	config.options.chkShowRightSidebar (false)
	config.options.txtToggleRightSideBarLabelShow (►)
	config.options.txtToggleRightSideBarLabelHide (◄)

%/&lt;script label=&quot;$1&quot; title=&quot;show/hide right sidebar content&quot;&gt;
	var co=config.options;
	if (co.chkShowRightSidebar=='undefined') co.chkShowRightSidebar=true;
	co.chkShowRightSidebar=!co.chkShowRightSidebar;
	var sb=document.getElementById('sidebar'); if (!sb) return;
	sb.style.display=co.chkShowRightSidebar?'block':'none';
	document.getElementById('displayArea').style.marginRight=co.chkShowRightSidebar?'':'1em';
	saveOptionCookie('chkShowRightSidebar');
	var labelShow=co.txtToggleRightSideBarLabelShow||(config.browser.isSafari?'&amp;#x25c0;':'&amp;#x25c4;');
	var labelHide=co.txtToggleRightSideBarLabelHide||'&amp;#x25ba;';
	if (typeof(place)!='undefined' &amp;&amp; '$1'=='$'+'1') {
		place.innerHTML=co.chkShowRightSidebar?labelHide:labelShow;
		place.title=(co.chkShowRightSidebar?'hide':'show')+' right sidebar';
	}
	var sm=document.getElementById('storyMenu'); if (sm) config.refreshers.content(sm);
&lt;/script&gt;&lt;script&gt;
	var co=config.options;
	if (co.chkShowRightSidebar=='undefined') co.chkShowRightSidebar=true;
	var sb=document.getElementById('sidebar'); if (!sb) return;
	sb.style.display=co.chkShowRightSidebar?'block':'none';
	document.getElementById('displayArea').style.marginRight=co.chkShowRightSidebar?'':'1em';
	if ('$1'=='$'+'1') {
		var labelShow=co.txtToggleRightSideBarLabelShow||(config.browser.isSafari?'&amp;#x25c0;':'&amp;#x25c4;');
		var labelHide=co.txtToggleRightSideBarLabelHide||'&amp;#x25ba;';
		place.lastChild.innerHTML=co.chkShowRightSidebar?labelHide:labelShow;
		place.lastChild.title=(co.chkShowRightSidebar?'hide':'show')+' right sidebar';
	}
&lt;/script&gt;</pre>
</div>
<div title="ToggleSiteTitles" modifier="Shankar" created="200606230134" modified="201004122321" tags="transclusion mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ToggleSiteTitles|
|Source|http://www.TiddlyTools.com/#ToggleSiteTitles|
|Version|1.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.5|
|Type|transclusion|
|Description|show/hide document 'header' area (containing SiteTitle and SiteSubtitle content)|
Usage:
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ToggleSiteTitles&gt;&gt; OR
&lt;&lt;tiddler ToggleSiteTitles with: label tip&gt;&gt;
}}}
&lt;&lt;&lt;
!end

!show
&lt;&lt;option chkHideSiteTitles&gt;&gt;&lt;&lt;tiddler {{
	var chk=place.lastChild;
	if (!chk.coreOnChange) { // only once
		chk.coreOnChange=chk.onchange;
		chk.onchange=function() {
			if (this.coreOnChange) this.coreOnChange.apply(this,arguments);
			var h=jQuery('#contentWrapper .header')[0];
			var opt=this.getAttribute('option');
			if (h) h.style.display=config.options[opt]?'none':'block';
		};
	}
'';}}&gt;&gt; $1
!end

%/&lt;&lt;tiddler {{'ToggleSiteTitles##'+(tiddler&amp;&amp;tiddler.title=='ToggleSiteTitles'?'info':'show')}} with:
{{&quot;$1&quot;==&quot;$&quot;+&quot;1&quot;?&quot;hide site titles&quot;:&quot;$1&quot;}}
{{&quot;$2&quot;==&quot;$&quot;+&quot;2&quot;?&quot;toggle site title display&quot;:&quot;$2&quot;}}
{{	// init header display
	var opt='chkHideSiteTitles';
	if (config.options[opt]==undefined) config.options[opt]=false;
	var h=jQuery('#contentWrapper .header')[0];
	if (h) h.style.display=config.options[opt]?'none':'block';
}}
&gt;&gt;</pre>
</div>
<div title="ToggleTagPlugin" modifier="Shankar" created="200805121716" modified="200809210415" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name:|ToggleTagPlugin|
|Description:|Makes a checkbox which toggles a tag in a tiddler|
|Version:|3.1.0 ($Rev: 4907 $)|
|Date:|$Date: 2008-05-13 03:15:46 +1000 (Tue, 13 May 2008) $|
|Source:|http://mptw.tiddlyspot.com/#ToggleTagPlugin|
|Author:|Simon Baird &lt;simon.baird@gmail.com&gt;|
|License:|http://mptw.tiddlyspot.com/#TheBSDLicense|
!!Usage
{{{&lt;&lt;toggleTag }}}//{{{TagName TiddlerName LabelText}}}//{{{&gt;&gt;}}}
* TagName - the tag to be toggled, default value &quot;checked&quot;
* TiddlerName - the tiddler to toggle the tag in, default value the current tiddler
* LabelText - the text (gets wikified) to put next to the check box, default value is '{{{[[TagName]]}}}' or '{{{[[TagName]] [[TiddlerName]]}}}'
(If a parameter is '.' then the default will be used)
* TouchMod flag - if non empty then touch the tiddlers mod date. Note, can set config.toggleTagAlwaysTouchModDate to always touch mod date
!!Examples
|Code|Description|Example|h
|{{{&lt;&lt;toggleTag&gt;&gt;}}}|Toggles the default tag (checked) in this tiddler|&lt;&lt;toggleTag&gt;&gt;|
|{{{&lt;&lt;toggleTag TagName&gt;&gt;}}}|Toggles the TagName tag in this tiddler|&lt;&lt;toggleTag TagName&gt;&gt;|
|{{{&lt;&lt;toggleTag TagName TiddlerName&gt;&gt;}}}|Toggles the TagName tag in the TiddlerName tiddler|&lt;&lt;toggleTag TagName TiddlerName&gt;&gt;|
|{{{&lt;&lt;toggleTag TagName TiddlerName 'click me'&gt;&gt;}}}|Same but with custom label|&lt;&lt;toggleTag TagName TiddlerName 'click me'&gt;&gt;|
|{{{&lt;&lt;toggleTag . . 'click me'&gt;&gt;}}}|dot means use default value|&lt;&lt;toggleTag . . 'click me'&gt;&gt;|
!!Notes
* If TiddlerName doesn't exist it will be silently created
* Set label to '-' to specify no label
* See also http://mgtd-alpha.tiddlyspot.com/#ToggleTag2
!!Known issues
* Doesn't smoothly handle the case where you toggle a tag in a tiddler that is current open for editing
* Should convert to use named params
***/
//{{{

if (config.toggleTagAlwaysTouchModDate == undefined) config.toggleTagAlwaysTouchModDate = false;

merge(config.macros,{

	toggleTag: {

		createIfRequired: true,
		shortLabel: &quot;[[%0]]&quot;,
		longLabel: &quot;[[%0]] [[%1]]&quot;,

		handler: function(place,macroName,params,wikifier,paramString,tiddler) {
			var tiddlerTitle = tiddler ? tiddler.title : '';
			var tag   = (params[0] &amp;&amp; params[0] != '.') ? params[0] : &quot;checked&quot;;
			var title = (params[1] &amp;&amp; params[1] != '.') ? params[1] : tiddlerTitle;
			var defaultLabel = (title == tiddlerTitle ? this.shortLabel : this.longLabel);
			var label = (params[2] &amp;&amp; params[2] != '.') ? params[2] : defaultLabel;
			var touchMod = (params[3] &amp;&amp; params[3] != '.') ? params[3] : &quot;&quot;;
			label = (label == '-' ? '' : label); // dash means no label
			var theTiddler = (title == tiddlerTitle ? tiddler : store.getTiddler(title));
			var cb = createTiddlyCheckbox(place, label.format([tag,title]), theTiddler &amp;&amp; theTiddler.isTagged(tag), function(e) {
				if (!store.tiddlerExists(title)) {
					if (config.macros.toggleTag.createIfRequired) {
						var content = store.getTiddlerText(title); // just in case it's a shadow
						store.saveTiddler(title,title,content?content:&quot;&quot;,config.options.txtUserName,new Date(),null);
					}
					else 
						return false;
				}
				if ((touchMod != &quot;&quot; || config.toggleTagAlwaysTouchModDate) &amp;&amp; theTiddler)
						theTiddler.modified = new Date();
				store.setTiddlerTag(title,this.checked,tag);
				return true;
			});
		}
	}
});

//}}}</pre>
</div>
<div title="ToggleTiddlerTags" modifier="Shankar Swamy" created="200804302141" modified="201210142159" tags="transclusion mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ToggleTiddlerTags|
|Source|http://www.TiddlyTools.com/#ToggleTiddlerTags|
|Version|2.0.0|
|Author|Eric Shulman|
|License|http://www.TiddlyTools.com/#LegalStatements|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|command link to show/hide tiddler tags display in all tiddlers at once|
Usage:
&lt;&lt;&lt;
in tiddler content:
{{{
&lt;&lt;tiddler ToggleTiddlerTags&gt;&gt;
&lt;&lt;tiddler ToggleTiddlerTags with: label&gt;&gt;
}}}
or, in ViewTemplate:
{{{
&lt;span class='toolbar' macro='tiddler ToggleTiddlerTags'&gt;&lt;/span&gt;
	OR, if TiddlyTools' CoreTweaks for ticket #610 is installed:
&lt;span class='toolbar' macro='toolbar ... ToggleTiddlerTags...'&gt;&lt;/span&gt;
}}}
or, in ToolbarCommands (with CoreTweaks #610 installed):
{{{
| ViewToolbar| ... ToggleTiddlerTags... |
| EditToolbar| ... ToggleTiddlerTags... |
}}}
&lt;&lt;&lt;
!end

!show
&lt;html&gt;&lt;nowiki&gt;&lt;a href='javascript:;' title='show/hide tiddler tags' onclick=&quot;
	config.options.chkHideTiddlerTags=!config.options.chkHideTiddlerTags;
	var show=config.options.chkHideTiddlerTags?'inline':'none';
	setStylesheet('.tiddler .tagged { display:'+show+'; }','toggleTiddlerTags');
&quot;&gt;$1&lt;/a&gt;&lt;/html&gt;
!end
%/&lt;&lt;tiddler {{'ToggleTiddlerTags##'+(tiddler&amp;&amp;tiddler.title=='ToggleTiddlerTags'?'info':'show')}}
	with: {{&quot;$1&quot;=='$'+'1'?'tags':&quot;$1&quot;}}&gt;&gt;</pre>
</div>
<div title="ToggleTiddlersBar" modifier="Shankar" created="200909150352" modified="201109070529" tags="script mySystem transclusion excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/%
!info
|Name|ToggleTiddlersBar|
|Source|http://a-pm.tiddlyspot.com|
|Version|0.9.0 beta|
|Author|Mario Pietsch|
|License|http://creativecommons.org/licenses/by-sa/3.0/|
|~CoreVersion|2.1|
|Type|transclusion|
|Description|show/hide ~TiddlersBar|

Derived from: ToggleRightSidebar see [[here|http://www.TiddlyTools.com/#ToggleRightSidebar]]

Usage
&lt;&lt;&lt;
{{{
&lt;&lt;tiddler ToggleTiddlersBar&gt;&gt;
&lt;&lt;tiddler ToggleTiddlersBar with: label tooltip&gt;&gt;
}}}
Try this: &lt;&lt;tiddler ToggleTiddlersBar##show
	with: {{config.options.chkDisableTabsBar?'show TiddlersBar':'hide TiddlersBar'}} &quot;ToggleTiddlersBar&quot;&gt;&gt;
&lt;&lt;&lt;
Configuration:
&lt;&lt;&lt;
{{{
config.options.chkDisableTabsBar (false)
config.options.txtToggleTiddlersBarLabelShow ('▼') 
config.options.txtToggleTiddlersBarLabelHide ('▲') 
}}}
&lt;&lt;&lt;
!end
!show
&lt;&lt;tiddler {{
	var co=config.options;
	if (co.chkDisableTabsBar===undefined) co.chkDisableTabsBar=false;
'';}}&gt;&gt;&lt;html&gt;&lt;nowiki&gt;&lt;a href='javascript:;' title=&quot;$2&quot;
onmouseover=&quot;
	this.href='javascript:void(eval(decodeURIComponent(%22(function(){try{('
	+encodeURIComponent(encodeURIComponent(this.onclick))
	+')()}catch(e){alert(e.description?e.description:e.toString())}})()%22)))';&quot;
onclick=&quot;
	var co=config.options;
	var opt='chkDisableTabsBar';
	var show=co[opt]=!co[opt];
	saveOptionCookie(opt);

	var labelShow=co.txtToggleTiddlersBarLabelShow||'▼';
	var labelHide=co.txtToggleTiddlersBarLabelHide||'▲';
	if (this.innerHTML==labelShow||this.innerHTML==labelHide) 
		this.innerHTML=show?labelHide:labelShow;
	this.title=(show?'show':'hide')+' tiddlers bar';	
	story.displayTiddler(null,'');
	story.closeTiddler('');
	return false;
&quot;&gt;$1&lt;/a&gt;&lt;/nowiki&gt;&lt;/html&gt;
!end
%/&lt;&lt;tiddler {{
	var src='ToggleTiddlersBar';
	src+(tiddler&amp;&amp;tiddler.title==src?'##info':'##show');
}} with: {{
	var co=config.options;
	var labelShow=co.txtToggleTiddlersBarLabelShow||'▼';
	var labelHide=co.txtToggleTiddlersBarLabelHide||'▲';
	'$1'!='$'+'1'?'$1':(co.chkDisableTabsBar?labelHide:labelShow);
}} {{
	var tip=(config.options.chkDisableTabsBar?'show':'hide')+' tiddlers bar';
	'$2'!='$'+'2'?'$2':tip;
}}&gt;&gt;</pre>
</div>
<div title="ToolbarCommands" modifier="shankar " created="200909150502" modified="200909261305" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>|~ViewToolbar|newHere closeTiddler closeOthers +editTiddler deleteTiddler &gt; fields syncing permalink references jump|
|~EditToolbar|+saveTiddler saveCloseTiddler -cancelTiddler  cancelCloseTiddler deleteTiddler|
|~InsertCreatedDate|&lt;span macro='view created date MM-DD-YYYY' style='margin-left: 0.5em; margin-right: 0.5em;'&gt;|</pre>
</div>
<div title="TopicsTemplate1" modifier="YourName" created="200909152042" modified="200909210548" tags="template excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{treeview{&lt;&lt;treeview2 &quot;$1&quot; &quot;treeview-gray&quot; 'collapsed: true, 
antisesame: &quot;closed&quot;, animated: &quot;fast&quot;, persist: &quot;cookie&quot;, cookieId: 
&quot;Topics&quot;'&gt;&gt;}}} </pre>
</div>
<div title="TopicsTemplate2" modifier="YourName" created="200909152043" modified="200909210548" tags="template excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>{{treeview{&lt;&lt;treeview2 {{story.findContainingTiddler 
(place).getAttribute 
('tiddler');}} &quot;treeview-gray&quot; 'collapsed: true, 
 antisesame: &quot;closed&quot;, animated: &quot;fast&quot;, persist: &quot;cookie&quot;, cookieId: 
 &quot;Topics&quot;'&gt;&gt;}}} </pre>
</div>
<div title="TopicsViewTemplate" modifier="Shankar" created="200909152046" modified="201109062000" tags="template mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;!--{{{--&gt;
&lt;div class='toolbar' macro='toolbar [[ToolbarCommands::ViewToolbar]]'&gt;&lt;span style='padding-right: 1.8em;' macro='newHere label:&quot;*create subtopic notes*&quot;'&gt;&lt;/span&gt;&lt;span style=&quot;color:#ccc;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;padding-right:1.8em;&quot; macro='tagger'&gt;&lt;/span &gt;&lt;/div&gt;&lt;/div&gt;
&lt;span class='title' macro='view title'&gt;&lt;/span&gt;

&lt;div class='viewer' macro='view text wikified'&gt;&lt;span macro='tiddler TopicsTemplate2'&gt;&lt;/span&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;&lt;/div&gt;
&lt;!--}}}--&gt;</pre>
</div>
<div title="Transform Office Communicator Text" modifier="Shankar Swamy" created="201111230038" modified="201202061929" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script&gt;
//  This version Version 2.0 release from RC7
//  fixed a bug in string substitution: if the name of one of the people
//  in conversation appeared, the function was transforming that
//  also and this version has a fix for it.
//  The transformed text can now be directly saved into a tiddler.  In that 
//  case the text is not copied to the clipboard. If we chose not to save 
//  the text in a tiddler, then the text is copied to the clipboard.
//  Removed checkboxes and added radioboxes

// xmcm --&gt; &quot;Xform Microsoft Communicator Message
var $ = jQuery;
var defString = &quot;Swamy&quot;;
window.xmcmSaveToClipboard=function(textToCopy) {
	function copy(out) {
		if(window.Components) { // FIREFOX
			netscape.security.PrivilegeManager.enablePrivilege('UniversalXPConnect');
			var id='@mozilla.org/widget/clipboardhelper;1';
			var clip=Components.classes[id].getService(Components.interfaces.nsIClipboardHelper);
			clip.copyString(out);
		} else if(window.clipboardData) { // IE
			window.clipboardData.setData('text',out);
		} else if(document.execCommand) { // CHROME, SAFARI, IE6
			var ta=document.createElement('textarea');
			ta.style.position='absolute';
			ta.style.left='-100%';
			document.body.appendChild(ta);
			ta.value=out; ta.select();
			document.execCommand('Copy',false,null);
			document.body.removeChild(ta);
		} else throw('cannot access clipboard');
	}
	
	try	 { copy(textToCopy); }
	catch(e) { // FALLBACK
		alert('Copy to clipboard() failed - you will have to copy the text manually.');
		}
}

window.xmcmTextArea1CB = function() {
   alert(&quot;Text area-1 function&quot;);
}

window.xmcmTextArea2CB = function() {
   alert(&quot;Text area-2 function&quot;);
}

window.xmcmTextArea3CB = function() {
   alert(&quot;Text area-3 function&quot;);
}
window.xmcmButtonCB = function() {
	
        var text1 = ($(&quot;#textarea-1&quot;).val()).trim();
        var text2 = ($(&quot;#textarea-2&quot;).val()).trim();
        var text3 = $(&quot;#textarea-3&quot;).val();
        var text4 = $(&quot;#textarea-4&quot;).val();
        
	if( text3 == &quot;&quot; )
         {
	      alert(&quot;Nothing to transform!&quot;);
              return false;
         }
         
         if( text1.trim() != &quot;&quot;)
         {      
		// generate more robust patterns to match from the minimal string 
                // user might have selected
		var i0 = text3.indexOf(text1);
	 	var i1 = text3.indexOf(&quot;\[&quot;, i0);
	 	text1 = text3.substring(i0, i1);

		//alert(&quot;Inside text1 - text1 = &quot; + text1);
	 	text3 = text3.replace( new RegExp(text1, &quot;gi&quot;), &quot;}}}{{c1{&quot;+text1);
         }
	 if( text2.trim() != &quot;&quot;)
         {
		var i0 = text3.indexOf(text2);
	 	var i1 = text3.indexOf(&quot;\[&quot;, i0);
	 	text2 = text3.substring(i0, i1);

		//alert(&quot;Inside text2&quot;);
 		text3 = text3.replace( new RegExp(text2, &quot;gi&quot;), &quot;}}}{{c2{&quot;+text2);
	 }
         // Sometimes, this leaves a spurious set of &quot;}}}&quot; at the
         // beginning &quot;}}}&quot; and ending &quot;{{{&quot; - remove, if they exist
         text3 = text3.replace( /}}}/, &quot;&quot; );
 	 text3 = text3.replace( /{{{$/, &quot;&quot; );
         if( text1.trim() != &quot;&quot; || text2.trim() != &quot;&quot;)
         {
         	text3 = text3 + &quot;}}}&quot;;
	 }
         $(&quot;#textarea-4&quot;).val(text3);
         $(&quot;#textarea-4&quot;).focus();
         $(&quot;#textarea-4&quot;).select();
         // optionally, save it into a tiddler:
	 var TiddlerName = prompt(&quot;Name of New Notes to Save the Conversation: &quot;,&quot;&quot;);
         if( TiddlerName.trim().length )
         {
		var alwaysTag=new Date().formatString('YYYY-0MM-0DD') + &quot; Note aaTag&quot;
		
		TiddlerName = new Date().formatString('YYYY0MM0DD-0hh0mm') +
		 	      &quot; &quot; + TiddlerName;
		// alert(&quot;Tiddler Name: &quot; + TiddlerName);
		if(store.tiddlerExists(TiddlerName)) {
  			if(!
				confirm(config.messages.overwriteWarning.format([TiddlerName.toString()])))
  		return null;
                }
		var tags=(alwaysTag);
		var title=(TiddlerName);
		
		store.saveTiddler(
  			title,
  			title,
  			text3,
  			//store.getTiddlerText('DN Template'),
  			config.options.txtUserName,
  			new Date(),
  			tags);
		autoSaveChanges(null,[tiddler]); 
                     
                if(  ($('input:radio[name=SilentDisplayEdit]:checked').val() == 'Display') ||
                     ($('input:radio[name=SilentDisplayEdit]:checked').val() == 'Edit')  )
                {
                        //alert(&quot;Here!&quot; + $('input:radio[name=SilentDisplayEdit]:checked').val());
			story.displayTiddler(null,title);
                }

                if(  ($('input:radio[name=SilentDisplayEdit]:checked').val() == 'Edit')  )
                {
                        //alert(&quot;Here!&quot;);
			config.commands.editTiddler.handler(null, null, title);
                }

	        xmcmSaveToClipboard( TiddlerName );
	 } else
         {
         	//copy to clipboard - only if the text was not saved in a tiddler:
	 	window.xmcmSaveToClipboard( text3 );
	 }
         return false;
}

&lt;/script&gt;

&lt;HTML&gt;
Name 1:	&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&lt;input type='text' id='textarea-1' name='textarea-1' size=25 style='background:#8E8E8E' value='Swamy' &gt;&lt;/input&gt;&amp;#32;&amp;#32;&amp;#32;&amp;#32;Name 2:&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&amp;#32;&lt;input type='text' id='textarea-2' name='textarea-2' size=25 style='background:#8E8E8E'&gt;&lt;/input&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Silent:&lt;input type=&quot;radio&quot; name=&quot;SilentDisplayEdit&quot; value=&quot;Silent&quot; checked&gt;&lt;/input&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Display:&lt;input type=&quot;radio&quot; name=&quot;SilentDisplayEdit&quot; value=&quot;Display&quot;&gt;&lt;/input&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;Edit:&lt;input type=&quot;radio&quot; name=&quot;SilentDisplayEdit&quot; value=&quot;Edit&quot;&gt;&lt;/input&gt;
&lt;textarea id='textarea-3' name='textarea-3' rows=30 cols=100 style='background:#989898'&gt;&lt;/textarea&gt;
&lt;button id='myButton' name='myButton' value='Transform Text' onclick='xmcmButtonCB()'&gt;Transform Text&lt;/button&gt;



&lt;/HTML&gt;










</pre>
</div>
<div title="TreeviewPluginPlugin.24" modifier="Shankar" created="200909150204" modified="200909151227" tags="systemConfig mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>/***
|Name|TreeviewPluginPlugin2|
|Source|http://treeview.tiddlyspot.com/|
|Version|0.24|
|Author|MarkS|
|License|Various. See respective libraries for details|
|Type|plugin|
|Requires(1) |jQuery library, treeview plugin libraries and styles |
|Requires(2) |AttachFilePackage and sub-libraries from tiddlytools.com if you want to use embedded images to create the tree|
|Description|Creates a tag tree, formatted as an actual tree |
|Status|Experimental - ALPHA, but built on fairly solid technologies|
|Warning|When creating tag trees, make sure no tiddler loops back on itself, or its likely the script will hang|
!!!!Set up for portability
You will need a version of TW that incorporates the jQuery library. That happens automatically with recent editions of TW. You will also need to install or access the treeview libraries from http:www.dynamicdrive.com. The libraries can be carried as local files, inserted in the MarkupPostBody, or referenced from the dynamicdrive site. Each approach will require a different set up. 
You will also need to link in the stylesheet for the treeview objects. A quick way to do this is to put:
&gt;{{{&lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;http://www.dynamicdrive.com/dynamicindex1/treeview/jquery.treeview.css&quot; /&gt; }}}
into the MarkupPreHead tiddler. However, this won't work if you go off line. It also doesn't work permanently if you are hosting your file on a web server. So you may want to download a copy of the stylesheet and attendant image files and change the MarkupPreHead tiddler to pick up the local copy. Or load the stylesheet and images onto your own server where you will be able to access them.
!!!!Usage
{{{&lt;&lt;treeview2 }}}
&gt;{{{&lt;root tag&gt; [tree style] [startup parameters]}}} 
{{{  &gt;&gt;}}}

!!!!!Where:
''root tag'' is the tag at the top of your tagging tree, i.e. the mother of all tiddlers related to it by using its name as one of their tags.
''tree style'' indicates which type of tree will be displayed,  possibly //treeview//, //filetree//, and //treeview-red//, and //treeview-famfamfam//. There may be other styles too, but those are the ones I know about.
''startup parameters'' are a set of optional parameters given in a comma-separated, key/value string like this:
&gt;{{{'collapsed: false, animated: &quot;normal&quot;, persist: true'}}}
There's a list of possible options at:
  http://www.dynamicdrive.com/dynamicindex1/treeview/index.htm
However, not all settings may actually work under TW. Mainly, you will probably be interested in controlling the presence of animation, and whether the initial state of the tree is opened or closed.
!!!!Images and stylesheet set-up
The tree is constructed from little bits of images. If you don't want to carry these images in a separate directory, nor reference them remotely, you can embed them in your TW file. To do this,  you will need the AttachFilePackage and accompanying plugins from 
&gt; www.tiddlytools.com
and you will need the AttachFilePluginFormatters plugin from the same site.
Then import all the tiddlers from this file tagged as treeviewimage . These images are referenced in the StyleSheet. If you import JqueryTreeviewCss from this file, and then put the name in your StyleSheet, the images should be imported without having to access them remotely.
!!!!Persistence
To make persistence work, you will need to have the treeview cookie library loaded. The easiest way to do that is to put:
&gt;{{{&lt;script src=&quot;http://www.dynamicdrive.com/dynamicindex1/treeview/lib/jquery.cookie.js&quot; type=&quot;text/javascript&quot;&gt;&lt;/script&gt;}}}
into the MarkupPostBody. However, this technique will only work if you have online access. If you will be working offline, then you will either need to download the cookie library to the same directory as your ~TiddlyWiki file and put the following into your MarkupPostBody:
&gt;&gt;{{{&lt;script src=&quot;jquery.cookie.js&quot;&gt;&lt;/script&gt;}}}
or you will need to put the entire contents of the cookie library into script tags inside the MarkupPostBody.
Then, in any macro that wants its tree to be persistently configured, you will need to use configuration parameter:
&gt;&gt;{{{persist: &quot;cookie&quot;, cookieId: &quot;myid&quot;}}}
where //myid// should be an identification that will be unique throughout the entire TW file.
***/
//{{{
config.macros.treeview2 = {
  handler: function (place, macroName, params, wikifier, paramString, tiddler)
  {  // Code here
var lcTag = params[0] ;
var lcClass = params[1] ? params[1] : &quot;treeview&quot; ;
var DEV_MODE = false ; // Make true when developing code or changes won't show up.
try {
  if( MAS === undefined ) MAS = { } ;
} catch(ex) {
  MAS = {} ;
}

MAS.treeviewSettings = function(obj) {
	var defa = {} ;
	defa.collapsed= true;
	defa.unique = true ;
	//defa.persist= &quot;location&quot; ;
	if( obj !== undefined ) {
		try {
		obj = eval(&quot;({&quot; + obj + &quot;})&quot; ) ;
		} catch(ex) {
			alert(&quot;Unable to use your treeview configuration settings!&quot;) ;
			return defa ;
		}
		for (var prop in obj) {
			defa[prop] =obj[prop] ;
		}
	}
	return defa ;
} ;
if( DEV_MODE || MAS.getTiddlersPerTagAsHtmlList === undefined ) {
MAS.getTiddlersPerTagAsHtmlList = function(tagname,setup) { 
  var tids = store.getTaggedTiddlers(tagname) ;
  var temp = &quot;&quot; ;
	var prefix = tids.length &gt; 0 ? &quot;&lt;span class='folder'&gt;&quot; : &quot;&lt;span class='file'&gt;&quot; ; 
	var statetags = store.getTiddler(tagname).tags ;
	var state = &quot;&quot; ;
	var lcSesame = setup[&quot;sesame&quot;] !== undefined ? setup[&quot;sesame&quot;] : &quot;&quot; ;
	var lcAntiSesame = setup[&quot;antisesame&quot;] !== undefined ? setup[&quot;antisesame&quot;] : &quot;&quot; ;
	if(statetags.length &gt; 0 ) {
						 if(lcSesame) state =  statetags.contains(lcSesame) ? ' class=&quot;open&quot;'   : ' class=&quot;closed&quot;'  ;
						 if(lcAntiSesame) state = statetags.contains(lcAntiSesame) ? ' class=&quot;closed&quot;' : ' class=&quot;open&quot;'   ;
	}	
// state=&quot;&quot; ; // DEBUG
  //var rtn =&quot;&lt;li&gt;&quot;  + prefix + tagname + &quot;&lt;/a&gt;&lt;/span&gt;&quot; ;
	var rtn = &quot;&lt;li&quot; + state +&quot;&gt;&quot;  + prefix + &quot;&lt;a href=\&quot;javascript:;\&quot; tiddlylink=\&quot;&quot; + tagname + &quot;\&quot;  refresh=\&quot;link\&quot;    class='tiddlyLink tiddlyLinkExisting' title='Link to &quot; + tagname + &quot;' &gt;&quot; + tagname + &quot;&lt;/a&gt;&lt;/span&gt;&quot; ;
	//wikify(rtn,place) ;
  forever:
  while(true) {  
		if(tids.length == 0 ) break ;
   	rtn = rtn + &quot;&lt;ul&gt;&quot; ;
   	for(var i=0;i&lt;tids.length;i++) {
			temp = MAS.getTiddlersPerTagAsHtmlList(tids[i].title, setup) ;
     	rtn = rtn +  temp  ;
  	}
  	rtn = rtn + &quot;&lt;/ul&gt;\n&quot; ;
		break ;
  } // forever
  rtn = rtn + &quot;&lt;/li&gt;\n&quot; ;
  return rtn ;
}  ; // End of function definition
} // End of checking if function already defined

// The extra set of span tags are needed here because jquery find function ignores
// the outer set of tags. Or at least that's what seems to be happening. So, I give
// it an extra set so it can throw it away without consequence
var loSetup = MAS.treeviewSettings(params[2]) ;
var lcId = &quot;root&quot; + (new Date()).getTime().toString() ;
if(loSetup.cookieId) {
	lcId = &quot;root_&quot; + loSetup.cookieId ; 
}
//var a =  '&lt;span id=&quot;' + lcId + '&quot;&gt;&lt;ul id=&quot;' + &quot;root&quot; + '&quot; &gt;' +  MAS.getTiddlersPerTagAsHtmlList(lcTag, loSetup) + &quot;&lt;/ul&gt;&lt;/span&gt;&quot; ;
var a =  '&lt;ul id=&quot;' + lcId + '&quot; &gt;' +  MAS.getTiddlersPerTagAsHtmlList(lcTag, loSetup) + &quot;&lt;/ul&gt;&quot; ;
var b = jQuery(a) ; 
// A smarter person might have know how to put the onclick function in at the top 
b.find(&quot;a&quot;).each(function(n) {
	this.onclick = onClickTiddlerLink ;
	}) ;
//b.find(lcId).attr(&quot;class&quot;,lcClass) ;
//b.find(&quot;#root&quot;).attr(&quot;class&quot;,lcClass) ;

jQuery(place).append(b) ;

jQuery(place).find(&quot;#&quot; + lcId).attr(&quot;class&quot;,lcClass).treeview(loSetup) ;
  }
};
//}}}</pre>
</div>
<div title="ViewTemplate" modifier="shankar " created="200909151417" modified="200910220238" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;div&gt;&lt;span class='title' macro='view title'&gt;&lt;/span&gt;

&lt;span class='subtitle'&gt;

&lt;span macro='view created date MM-DD-YYYY' style='margin-left: 0.5em; margin-right: 0.5em;'&gt; &lt;/span&gt;
(&lt;span macro='view modified date MM-DD-YYYY' &gt;&lt;/span&gt;)
&lt;span class='toolbar' macro='toolbar +editTiddler' style='margin-left:0.5em;'&gt;&lt;/span&gt; 
&lt;span class='toolbar' macro='toolbar closeTiddler' style='margin-left:0.5em;'&gt;&lt;/span&gt; 
&lt;span class='toolbar' macro='toolbar closeOthers' style='margin-left: 0.5em;'&gt;&lt;/span&gt; 
&lt;span class='toolbar'  macro='toolbar  deleteTiddler ' style='margin-left: 0.5em;'&gt;&lt;/span&gt;
&lt;span style='padding-right: 1.8em;' macro='newHere label:&quot;+subtopic notes&quot;'&gt;
&lt;/span&gt;&lt;span style=&quot;padding-right:1.8em;&quot; macro='tagger'&gt;&lt;/span &gt;
 &lt;/div&gt;

&lt;div class='viewer' macro='view text wikified'&gt;&lt;/div&gt;
&lt;div class='tagged' macro='tags'&gt;&lt;/div&gt;
&lt;div class='tagClear'&gt;
&lt;/div&gt;</pre>
</div>
<div title="aaTag" modifier="YourName" created="201510110408" tags="excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tagging&gt;&gt;
</pre>
</div>
<div title="file.gif" modifier="YourName" created="200905231951" modified="200905301619" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\file.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[file.gif|file.gif]] - {{{type=image/gif, size=145 bytes, encoded=199 bytes}}}|
| local file:|/%LOCAL_LINK%/[[file:///F:/TiddlyWiki/TW jQuery/TreeView/images/file.gif|file:///F:/TiddlyWiki/TW jQuery/TreeView/images/file.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/file.gif|http://www.symbex.net.au/Wiki/images/file.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|file.gif]] or [img[tooltip|file.gif][link]]}}}
[img[tooltip|file.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhDwAOALMAAGpsYoy3oamMQdS9fDmJdP////9tcH98XwAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAAUALAAAAAAPAA4AAAQ+sBRBK5VYiizH5l82eCBX
jCS2GayRhZOpvkVgHwWg0XKM4azCAaATZnA9pAQ3sAUIhOWxZ/xRlcKDdsuVRAAA
Ow==
---END_DATA---
%/</pre>
</div>
<div title="folder-closed.gif" modifier="YourName" created="200906050205" modified="200909150412" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\folder-closed.gif}}}|
| attached on:|4 June 2009 by YourName|
| embedded:|[[folder-closed.gif|folder-closed.gif]] - {{{type=image/gif, size=887 bytes, encoded=1202 bytes}}}|
| local file:|/%LOCAL_LINK%/[[file:///F:/TiddlyWiki/TW jQuery/TreeView/images/folder-closed.gif|file:///F:/TiddlyWiki/TW jQuery/TreeView/images/folder-closed.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/folder-closed.gif|http://www.symbex.net.au/Wiki/images/folder-closed.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|folder-closed.gif]] or [img[tooltip|folder-closed.gif][link]]}}}
[img[tooltip|folder-closed.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEAAOAPcAAJdaH+C6eP/inq1zLf/////Sg59oJMOHNAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAAQALAAAAAAQAA4AAAhUAAkIHEiwoMGDBw8oPIBw
4ACCDxEeEECxQIAACxUSZNiQo8CJFEOKBABRpEkBEQUOOCkyJQEDBWLKnGmAIICZ
OAuQHAhgQE6ZOwcaGEq0aMOjBAICADs=
---END_DATA---
%/</pre>
</div>
<div title="folder.gif" modifier="YourName" created="200905231952" modified="200905301613" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\folder.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[folder.gif|folder.gif]] - {{{type=image/gif, size=141 bytes, encoded=190 bytes}}}|
| local file:|/%LOCAL_LINK%/[[file:///F:/TiddlyWiki/TW jQuery/TreeView/images/folder.gif|file:///F:/TiddlyWiki/TW jQuery/TreeView/images/folder.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/folder.gif|http://www.symbex.net.au/Wiki/images/folder.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|folder.gif]] or [img[tooltip|folder.gif][link]]}}}
[img[tooltip|folder.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEAAOALMAAJdaH+C6eP/inq1zLf/////Sg59oJMOHNAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAAQALAAAAAAQAA4AAAQ6kMhJq7336IPnoB92CGQR
BJtGcR0rjWQsA6A83HhODDEvx4WPoRAkGo8hQPGInAAGzCbFQK1aO1hCBAA7
---END_DATA---
%/</pre>
</div>
<div title="jQueryUI-1.11.4" modifier="YourName" created="201509150033" modified="201510192000" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;script&gt;
(function(e){&quot;function&quot;==typeof define&amp;&amp;define.amd?define([&quot;jquery&quot;],e):e(jQuery)})(function(e){function t(t,s){var n,a,o,r=t.nodeName.toLowerCase();return&quot;area&quot;===r?(n=t.parentNode,a=n.name,t.href&amp;&amp;a&amp;&amp;&quot;map&quot;===n.nodeName.toLowerCase()?(o=e(&quot;img[usemap='#&quot;+a+&quot;']&quot;)[0],!!o&amp;&amp;i(o)):!1):(/^(input|select|textarea|button|object)$/.test(r)?!t.disabled:&quot;a&quot;===r?t.href||s:s)&amp;&amp;i(t)}function i(t){return e.expr.filters.visible(t)&amp;&amp;!e(t).parents().addBack().filter(function(){return&quot;hidden&quot;===e.css(this,&quot;visibility&quot;)}).length}function s(e){for(var t,i;e.length&amp;&amp;e[0]!==document;){if(t=e.css(&quot;position&quot;),(&quot;absolute&quot;===t||&quot;relative&quot;===t||&quot;fixed&quot;===t)&amp;&amp;(i=parseInt(e.css(&quot;zIndex&quot;),10),!isNaN(i)&amp;&amp;0!==i))return i;e=e.parent()}return 0}function n(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId=&quot;ui-datepicker-div&quot;,this._inlineClass=&quot;ui-datepicker-inline&quot;,this._appendClass=&quot;ui-datepicker-append&quot;,this._triggerClass=&quot;ui-datepicker-trigger&quot;,this._dialogClass=&quot;ui-datepicker-dialog&quot;,this._disableClass=&quot;ui-datepicker-disabled&quot;,this._unselectableClass=&quot;ui-datepicker-unselectable&quot;,this._currentClass=&quot;ui-datepicker-current-day&quot;,this._dayOverClass=&quot;ui-datepicker-days-cell-over&quot;,this.regional=[],this.regional[&quot;&quot;]={closeText:&quot;Done&quot;,prevText:&quot;Prev&quot;,nextText:&quot;Next&quot;,currentText:&quot;Today&quot;,monthNames:[&quot;January&quot;,&quot;February&quot;,&quot;March&quot;,&quot;April&quot;,&quot;May&quot;,&quot;June&quot;,&quot;July&quot;,&quot;August&quot;,&quot;September&quot;,&quot;October&quot;,&quot;November&quot;,&quot;December&quot;],monthNamesShort:[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;,&quot;Sep&quot;,&quot;Oct&quot;,&quot;Nov&quot;,&quot;Dec&quot;],dayNames:[&quot;Sunday&quot;,&quot;Monday&quot;,&quot;Tuesday&quot;,&quot;Wednesday&quot;,&quot;Thursday&quot;,&quot;Friday&quot;,&quot;Saturday&quot;],dayNamesShort:[&quot;Sun&quot;,&quot;Mon&quot;,&quot;Tue&quot;,&quot;Wed&quot;,&quot;Thu&quot;,&quot;Fri&quot;,&quot;Sat&quot;],dayNamesMin:[&quot;Su&quot;,&quot;Mo&quot;,&quot;Tu&quot;,&quot;We&quot;,&quot;Th&quot;,&quot;Fr&quot;,&quot;Sa&quot;],weekHeader:&quot;Wk&quot;,dateFormat:&quot;mm/dd/yy&quot;,firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:&quot;&quot;},this._defaults={showOn:&quot;focus&quot;,showAnim:&quot;fadeIn&quot;,showOptions:{},defaultDate:null,appendText:&quot;&quot;,buttonText:&quot;...&quot;,buttonImage:&quot;&quot;,buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:&quot;c-10:c+10&quot;,showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:&quot;+10&quot;,minDate:null,maxDate:null,duration:&quot;fast&quot;,beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:&quot;&quot;,altFormat:&quot;&quot;,constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[&quot;&quot;]),this.regional.en=e.extend(!0,{},this.regional[&quot;&quot;]),this.regional[&quot;en-US&quot;]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e(&quot;&lt;div id='&quot;+this._mainDivId+&quot;' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'&gt;&lt;/div&gt;&quot;))}function a(t){var i=&quot;button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a&quot;;return t.delegate(i,&quot;mouseout&quot;,function(){e(this).removeClass(&quot;ui-state-hover&quot;),-1!==this.className.indexOf(&quot;ui-datepicker-prev&quot;)&amp;&amp;e(this).removeClass(&quot;ui-datepicker-prev-hover&quot;),-1!==this.className.indexOf(&quot;ui-datepicker-next&quot;)&amp;&amp;e(this).removeClass(&quot;ui-datepicker-next-hover&quot;)}).delegate(i,&quot;mouseover&quot;,o)}function o(){e.datepicker._isDisabledDatepicker(v.inline?v.dpDiv.parent()[0]:v.input[0])||(e(this).parents(&quot;.ui-datepicker-calendar&quot;).find(&quot;a&quot;).removeClass(&quot;ui-state-hover&quot;),e(this).addClass(&quot;ui-state-hover&quot;),-1!==this.className.indexOf(&quot;ui-datepicker-prev&quot;)&amp;&amp;e(this).addClass(&quot;ui-datepicker-prev-hover&quot;),-1!==this.className.indexOf(&quot;ui-datepicker-next&quot;)&amp;&amp;e(this).addClass(&quot;ui-datepicker-next-hover&quot;))}function r(t,i){e.extend(t,i);for(var s in i)null==i[s]&amp;&amp;(t[s]=i[s]);return t}function h(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&amp;&amp;this._trigger(&quot;change&quot;)}}e.ui=e.ui||{},e.extend(e.ui,{version:&quot;1.11.4&quot;,keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),e.fn.extend({scrollParent:function(t){var i=this.css(&quot;position&quot;),s=&quot;absolute&quot;===i,n=t?/(auto|scroll|hidden)/:/(auto|scroll)/,a=this.parents().filter(function(){var t=e(this);return s&amp;&amp;&quot;static&quot;===t.css(&quot;position&quot;)?!1:n.test(t.css(&quot;overflow&quot;)+t.css(&quot;overflow-y&quot;)+t.css(&quot;overflow-x&quot;))}).eq(0);return&quot;fixed&quot;!==i&amp;&amp;a.length?a:e(this[0].ownerDocument||document)},uniqueId:function(){var e=0;return function(){return this.each(function(){this.id||(this.id=&quot;ui-id-&quot;+ ++e)})}}(),removeUniqueId:function(){return this.each(function(){/^ui-id-\d+$/.test(this.id)&amp;&amp;e(this).removeAttr(&quot;id&quot;)})}}),e.extend(e.expr[&quot;:&quot;],{data:e.expr.createPseudo?e.expr.createPseudo(function(t){return function(i){return!!e.data(i,t)}}):function(t,i,s){return!!e.data(t,s[3])},focusable:function(i){return t(i,!isNaN(e.attr(i,&quot;tabindex&quot;)))},tabbable:function(i){var s=e.attr(i,&quot;tabindex&quot;),n=isNaN(s);return(n||s&gt;=0)&amp;&amp;t(i,!n)}}),e(&quot;&lt;a&gt;&quot;).outerWidth(1).jquery||e.each([&quot;Width&quot;,&quot;Height&quot;],function(t,i){function s(t,i,s,a){return e.each(n,function(){i-=parseFloat(e.css(t,&quot;padding&quot;+this))||0,s&amp;&amp;(i-=parseFloat(e.css(t,&quot;border&quot;+this+&quot;Width&quot;))||0),a&amp;&amp;(i-=parseFloat(e.css(t,&quot;margin&quot;+this))||0)}),i}var n=&quot;Width&quot;===i?[&quot;Left&quot;,&quot;Right&quot;]:[&quot;Top&quot;,&quot;Bottom&quot;],a=i.toLowerCase(),o={innerWidth:e.fn.innerWidth,innerHeight:e.fn.innerHeight,outerWidth:e.fn.outerWidth,outerHeight:e.fn.outerHeight};e.fn[&quot;inner&quot;+i]=function(t){return void 0===t?o[&quot;inner&quot;+i].call(this):this.each(function(){e(this).css(a,s(this,t)+&quot;px&quot;)})},e.fn[&quot;outer&quot;+i]=function(t,n){return&quot;number&quot;!=typeof t?o[&quot;outer&quot;+i].call(this,t):this.each(function(){e(this).css(a,s(this,t,!0,n)+&quot;px&quot;)})}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e(&quot;&lt;a&gt;&quot;).data(&quot;a-b&quot;,&quot;a&quot;).removeData(&quot;a-b&quot;).data(&quot;a-b&quot;)&amp;&amp;(e.fn.removeData=function(t){return function(i){return arguments.length?t.call(this,e.camelCase(i)):t.call(this)}}(e.fn.removeData)),e.ui.ie=!!/msie [\w.]+/.exec(navigator.userAgent.toLowerCase()),e.fn.extend({focus:function(t){return function(i,s){return&quot;number&quot;==typeof i?this.each(function(){var t=this;setTimeout(function(){e(t).focus(),s&amp;&amp;s.call(t)},i)}):t.apply(this,arguments)}}(e.fn.focus),disableSelection:function(){var e=&quot;onselectstart&quot;in document.createElement(&quot;div&quot;)?&quot;selectstart&quot;:&quot;mousedown&quot;;return function(){return this.bind(e+&quot;.ui-disableSelection&quot;,function(e){e.preventDefault()})}}(),enableSelection:function(){return this.unbind(&quot;.ui-disableSelection&quot;)},zIndex:function(t){if(void 0!==t)return this.css(&quot;zIndex&quot;,t);if(this.length)for(var i,s,n=e(this[0]);n.length&amp;&amp;n[0]!==document;){if(i=n.css(&quot;position&quot;),(&quot;absolute&quot;===i||&quot;relative&quot;===i||&quot;fixed&quot;===i)&amp;&amp;(s=parseInt(n.css(&quot;zIndex&quot;),10),!isNaN(s)&amp;&amp;0!==s))return s;n=n.parent()}return 0}}),e.ui.plugin={add:function(t,i,s){var n,a=e.ui[t].prototype;for(n in s)a.plugins[n]=a.plugins[n]||[],a.plugins[n].push([i,s[n]])},call:function(e,t,i,s){var n,a=e.plugins[t];if(a&amp;&amp;(s||e.element[0].parentNode&amp;&amp;11!==e.element[0].parentNode.nodeType))for(n=0;a.length&gt;n;n++)e.options[a[n][0]]&amp;&amp;a[n][1].apply(e.element,i)}};var l=0,u=Array.prototype.slice;e.cleanData=function(t){return function(i){var s,n,a;for(a=0;null!=(n=i[a]);a++)try{s=e._data(n,&quot;events&quot;),s&amp;&amp;s.remove&amp;&amp;e(n).triggerHandler(&quot;remove&quot;)}catch(o){}t(i)}}(e.cleanData),e.widget=function(t,i,s){var n,a,o,r,h={},l=t.split(&quot;.&quot;)[0];return t=t.split(&quot;.&quot;)[1],n=l+&quot;-&quot;+t,s||(s=i,i=e.Widget),e.expr[&quot;:&quot;][n.toLowerCase()]=function(t){return!!e.data(t,n)},e[l]=e[l]||{},a=e[l][t],o=e[l][t]=function(e,t){return this._createWidget?(arguments.length&amp;&amp;this._createWidget(e,t),void 0):new o(e,t)},e.extend(o,a,{version:s.version,_proto:e.extend({},s),_childConstructors:[]}),r=new i,r.options=e.widget.extend({},r.options),e.each(s,function(t,s){return e.isFunction(s)?(h[t]=function(){var e=function(){return i.prototype[t].apply(this,arguments)},n=function(e){return i.prototype[t].apply(this,e)};return function(){var t,i=this._super,a=this._superApply;return this._super=e,this._superApply=n,t=s.apply(this,arguments),this._super=i,this._superApply=a,t}}(),void 0):(h[t]=s,void 0)}),o.prototype=e.widget.extend(r,{widgetEventPrefix:a?r.widgetEventPrefix||t:t},h,{constructor:o,namespace:l,widgetName:t,widgetFullName:n}),a?(e.each(a._childConstructors,function(t,i){var s=i.prototype;e.widget(s.namespace+&quot;.&quot;+s.widgetName,o,i._proto)}),delete a._childConstructors):i._childConstructors.push(o),e.widget.bridge(t,o),o},e.widget.extend=function(t){for(var i,s,n=u.call(arguments,1),a=0,o=n.length;o&gt;a;a++)for(i in n[a])s=n[a][i],n[a].hasOwnProperty(i)&amp;&amp;void 0!==s&amp;&amp;(t[i]=e.isPlainObject(s)?e.isPlainObject(t[i])?e.widget.extend({},t[i],s):e.widget.extend({},s):s);return t},e.widget.bridge=function(t,i){var s=i.prototype.widgetFullName||t;e.fn[t]=function(n){var a=&quot;string&quot;==typeof n,o=u.call(arguments,1),r=this;return a?this.each(function(){var i,a=e.data(this,s);return&quot;instance&quot;===n?(r=a,!1):a?e.isFunction(a[n])&amp;&amp;&quot;_&quot;!==n.charAt(0)?(i=a[n].apply(a,o),i!==a&amp;&amp;void 0!==i?(r=i&amp;&amp;i.jquery?r.pushStack(i.get()):i,!1):void 0):e.error(&quot;no such method '&quot;+n+&quot;' for &quot;+t+&quot; widget instance&quot;):e.error(&quot;cannot call methods on &quot;+t+&quot; prior to initialization; &quot;+&quot;attempted to call method '&quot;+n+&quot;'&quot;)}):(o.length&amp;&amp;(n=e.widget.extend.apply(null,[n].concat(o))),this.each(function(){var t=e.data(this,s);t?(t.option(n||{}),t._init&amp;&amp;t._init()):e.data(this,s,new i(n,this))})),r}},e.Widget=function(){},e.Widget._childConstructors=[],e.Widget.prototype={widgetName:&quot;widget&quot;,widgetEventPrefix:&quot;&quot;,defaultElement:&quot;&lt;div&gt;&quot;,options:{disabled:!1,create:null},_createWidget:function(t,i){i=e(i||this.defaultElement||this)[0],this.element=e(i),this.uuid=l++,this.eventNamespace=&quot;.&quot;+this.widgetName+this.uuid,this.bindings=e(),this.hoverable=e(),this.focusable=e(),i!==this&amp;&amp;(e.data(i,this.widgetFullName,this),this._on(!0,this.element,{remove:function(e){e.target===i&amp;&amp;this.destroy()}}),this.document=e(i.style?i.ownerDocument:i.document||i),this.window=e(this.document[0].defaultView||this.document[0].parentWindow)),this.options=e.widget.extend({},this.options,this._getCreateOptions(),t),this._create(),this._trigger(&quot;create&quot;,null,this._getCreateEventData()),this._init()},_getCreateOptions:e.noop,_getCreateEventData:e.noop,_create:e.noop,_init:e.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetFullName).removeData(e.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr(&quot;aria-disabled&quot;).removeClass(this.widgetFullName+&quot;-disabled &quot;+&quot;ui-state-disabled&quot;),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass(&quot;ui-state-hover&quot;),this.focusable.removeClass(&quot;ui-state-focus&quot;)},_destroy:e.noop,widget:function(){return this.element},option:function(t,i){var s,n,a,o=t;if(0===arguments.length)return e.widget.extend({},this.options);if(&quot;string&quot;==typeof t)if(o={},s=t.split(&quot;.&quot;),t=s.shift(),s.length){for(n=o[t]=e.widget.extend({},this.options[t]),a=0;s.length-1&gt;a;a++)n[s[a]]=n[s[a]]||{},n=n[s[a]];if(t=s.pop(),1===arguments.length)return void 0===n[t]?null:n[t];n[t]=i}else{if(1===arguments.length)return void 0===this.options[t]?null:this.options[t];o[t]=i}return this._setOptions(o),this},_setOptions:function(e){var t;for(t in e)this._setOption(t,e[t]);return this},_setOption:function(e,t){return this.options[e]=t,&quot;disabled&quot;===e&amp;&amp;(this.widget().toggleClass(this.widgetFullName+&quot;-disabled&quot;,!!t),t&amp;&amp;(this.hoverable.removeClass(&quot;ui-state-hover&quot;),this.focusable.removeClass(&quot;ui-state-focus&quot;))),this},enable:function(){return this._setOptions({disabled:!1})},disable:function(){return this._setOptions({disabled:!0})},_on:function(t,i,s){var n,a=this;&quot;boolean&quot;!=typeof t&amp;&amp;(s=i,i=t,t=!1),s?(i=n=e(i),this.bindings=this.bindings.add(i)):(s=i,i=this.element,n=this.widget()),e.each(s,function(s,o){function r(){return t||a.options.disabled!==!0&amp;&amp;!e(this).hasClass(&quot;ui-state-disabled&quot;)?(&quot;string&quot;==typeof o?a[o]:o).apply(a,arguments):void 0}&quot;string&quot;!=typeof o&amp;&amp;(r.guid=o.guid=o.guid||r.guid||e.guid++);var h=s.match(/^([\w:-]*)\s*(.*)$/),l=h[1]+a.eventNamespace,u=h[2];u?n.delegate(u,l,r):i.bind(l,r)})},_off:function(t,i){i=(i||&quot;&quot;).split(&quot; &quot;).join(this.eventNamespace+&quot; &quot;)+this.eventNamespace,t.unbind(i).undelegate(i),this.bindings=e(this.bindings.not(t).get()),this.focusable=e(this.focusable.not(t).get()),this.hoverable=e(this.hoverable.not(t).get())},_delay:function(e,t){function i(){return(&quot;string&quot;==typeof e?s[e]:e).apply(s,arguments)}var s=this;return setTimeout(i,t||0)},_hoverable:function(t){this.hoverable=this.hoverable.add(t),this._on(t,{mouseenter:function(t){e(t.currentTarget).addClass(&quot;ui-state-hover&quot;)},mouseleave:function(t){e(t.currentTarget).removeClass(&quot;ui-state-hover&quot;)}})},_focusable:function(t){this.focusable=this.focusable.add(t),this._on(t,{focusin:function(t){e(t.currentTarget).addClass(&quot;ui-state-focus&quot;)},focusout:function(t){e(t.currentTarget).removeClass(&quot;ui-state-focus&quot;)}})},_trigger:function(t,i,s){var n,a,o=this.options[t];if(s=s||{},i=e.Event(i),i.type=(t===this.widgetEventPrefix?t:this.widgetEventPrefix+t).toLowerCase(),i.target=this.element[0],a=i.originalEvent)for(n in a)n in i||(i[n]=a[n]);return this.element.trigger(i,s),!(e.isFunction(o)&amp;&amp;o.apply(this.element[0],[i].concat(s))===!1||i.isDefaultPrevented())}},e.each({show:&quot;fadeIn&quot;,hide:&quot;fadeOut&quot;},function(t,i){e.Widget.prototype[&quot;_&quot;+t]=function(s,n,a){&quot;string&quot;==typeof n&amp;&amp;(n={effect:n});var o,r=n?n===!0||&quot;number&quot;==typeof n?i:n.effect||i:t;n=n||{},&quot;number&quot;==typeof n&amp;&amp;(n={duration:n}),o=!e.isEmptyObject(n),n.complete=a,n.delay&amp;&amp;s.delay(n.delay),o&amp;&amp;e.effects&amp;&amp;e.effects.effect[r]?s[t](n):r!==t&amp;&amp;s[r]?s[r](n.duration,n.easing,a):s.queue(function(i){e(this)[t](),a&amp;&amp;a.call(s[0]),i()})}}),e.widget;var d=!1;e(document).mouseup(function(){d=!1}),e.widget(&quot;ui.mouse&quot;,{version:&quot;1.11.4&quot;,options:{cancel:&quot;input,textarea,button,select,option&quot;,distance:1,delay:0},_mouseInit:function(){var t=this;this.element.bind(&quot;mousedown.&quot;+this.widgetName,function(e){return t._mouseDown(e)}).bind(&quot;click.&quot;+this.widgetName,function(i){return!0===e.data(i.target,t.widgetName+&quot;.preventClickEvent&quot;)?(e.removeData(i.target,t.widgetName+&quot;.preventClickEvent&quot;),i.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind(&quot;.&quot;+this.widgetName),this._mouseMoveDelegate&amp;&amp;this.document.unbind(&quot;mousemove.&quot;+this.widgetName,this._mouseMoveDelegate).unbind(&quot;mouseup.&quot;+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(t){if(!d){this._mouseMoved=!1,this._mouseStarted&amp;&amp;this._mouseUp(t),this._mouseDownEvent=t;var i=this,s=1===t.which,n=&quot;string&quot;==typeof this.options.cancel&amp;&amp;t.target.nodeName?e(t.target).closest(this.options.cancel).length:!1;return s&amp;&amp;!n&amp;&amp;this._mouseCapture(t)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){i.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(t)&amp;&amp;this._mouseDelayMet(t)&amp;&amp;(this._mouseStarted=this._mouseStart(t)!==!1,!this._mouseStarted)?(t.preventDefault(),!0):(!0===e.data(t.target,this.widgetName+&quot;.preventClickEvent&quot;)&amp;&amp;e.removeData(t.target,this.widgetName+&quot;.preventClickEvent&quot;),this._mouseMoveDelegate=function(e){return i._mouseMove(e)},this._mouseUpDelegate=function(e){return i._mouseUp(e)},this.document.bind(&quot;mousemove.&quot;+this.widgetName,this._mouseMoveDelegate).bind(&quot;mouseup.&quot;+this.widgetName,this._mouseUpDelegate),t.preventDefault(),d=!0,!0)):!0}},_mouseMove:function(t){if(this._mouseMoved){if(e.ui.ie&amp;&amp;(!document.documentMode||9&gt;document.documentMode)&amp;&amp;!t.button)return this._mouseUp(t);if(!t.which)return this._mouseUp(t)}return(t.which||t.button)&amp;&amp;(this._mouseMoved=!0),this._mouseStarted?(this._mouseDrag(t),t.preventDefault()):(this._mouseDistanceMet(t)&amp;&amp;this._mouseDelayMet(t)&amp;&amp;(this._mouseStarted=this._mouseStart(this._mouseDownEvent,t)!==!1,this._mouseStarted?this._mouseDrag(t):this._mouseUp(t)),!this._mouseStarted)},_mouseUp:function(t){return this.document.unbind(&quot;mousemove.&quot;+this.widgetName,this._mouseMoveDelegate).unbind(&quot;mouseup.&quot;+this.widgetName,this._mouseUpDelegate),this._mouseStarted&amp;&amp;(this._mouseStarted=!1,t.target===this._mouseDownEvent.target&amp;&amp;e.data(t.target,this.widgetName+&quot;.preventClickEvent&quot;,!0),this._mouseStop(t)),d=!1,!1},_mouseDistanceMet:function(e){return Math.max(Math.abs(this._mouseDownEvent.pageX-e.pageX),Math.abs(this._mouseDownEvent.pageY-e.pageY))&gt;=this.options.distance},_mouseDelayMet:function(){return this.mouseDelayMet},_mouseStart:function(){},_mouseDrag:function(){},_mouseStop:function(){},_mouseCapture:function(){return!0}}),function(){function t(e,t,i){return[parseFloat(e[0])*(p.test(e[0])?t/100:1),parseFloat(e[1])*(p.test(e[1])?i/100:1)]}function i(t,i){return parseInt(e.css(t,i),10)||0}function s(t){var i=t[0];return 9===i.nodeType?{width:t.width(),height:t.height(),offset:{top:0,left:0}}:e.isWindow(i)?{width:t.width(),height:t.height(),offset:{top:t.scrollTop(),left:t.scrollLeft()}}:i.preventDefault?{width:0,height:0,offset:{top:i.pageY,left:i.pageX}}:{width:t.outerWidth(),height:t.outerHeight(),offset:t.offset()}}e.ui=e.ui||{};var n,a,o=Math.max,r=Math.abs,h=Math.round,l=/left|center|right/,u=/top|center|bottom/,d=/[\+\-]\d+(\.[\d]+)?%?/,c=/^\w+/,p=/%$/,f=e.fn.position;e.position={scrollbarWidth:function(){if(void 0!==n)return n;var t,i,s=e(&quot;&lt;div style='display:block;position:absolute;width:50px;height:50px;overflow:hidden;'&gt;&lt;div style='height:100px;width:auto;'&gt;&lt;/div&gt;&lt;/div&gt;&quot;),a=s.children()[0];return e(&quot;body&quot;).append(s),t=a.offsetWidth,s.css(&quot;overflow&quot;,&quot;scroll&quot;),i=a.offsetWidth,t===i&amp;&amp;(i=s[0].clientWidth),s.remove(),n=t-i},getScrollInfo:function(t){var i=t.isWindow||t.isDocument?&quot;&quot;:t.element.css(&quot;overflow-x&quot;),s=t.isWindow||t.isDocument?&quot;&quot;:t.element.css(&quot;overflow-y&quot;),n=&quot;scroll&quot;===i||&quot;auto&quot;===i&amp;&amp;t.width&lt;t.element[0].scrollWidth,a=&quot;scroll&quot;===s||&quot;auto&quot;===s&amp;&amp;t.height&lt;t.element[0].scrollHeight;return{width:a?e.position.scrollbarWidth():0,height:n?e.position.scrollbarWidth():0}},getWithinInfo:function(t){var i=e(t||window),s=e.isWindow(i[0]),n=!!i[0]&amp;&amp;9===i[0].nodeType;return{element:i,isWindow:s,isDocument:n,offset:i.offset()||{left:0,top:0},scrollLeft:i.scrollLeft(),scrollTop:i.scrollTop(),width:s||n?i.width():i.outerWidth(),height:s||n?i.height():i.outerHeight()}}},e.fn.position=function(n){if(!n||!n.of)return f.apply(this,arguments);n=e.extend({},n);var p,m,g,v,y,b,_=e(n.of),x=e.position.getWithinInfo(n.within),w=e.position.getScrollInfo(x),k=(n.collision||&quot;flip&quot;).split(&quot; &quot;),T={};return b=s(_),_[0].preventDefault&amp;&amp;(n.at=&quot;left top&quot;),m=b.width,g=b.height,v=b.offset,y=e.extend({},v),e.each([&quot;my&quot;,&quot;at&quot;],function(){var e,t,i=(n[this]||&quot;&quot;).split(&quot; &quot;);1===i.length&amp;&amp;(i=l.test(i[0])?i.concat([&quot;center&quot;]):u.test(i[0])?[&quot;center&quot;].concat(i):[&quot;center&quot;,&quot;center&quot;]),i[0]=l.test(i[0])?i[0]:&quot;center&quot;,i[1]=u.test(i[1])?i[1]:&quot;center&quot;,e=d.exec(i[0]),t=d.exec(i[1]),T[this]=[e?e[0]:0,t?t[0]:0],n[this]=[c.exec(i[0])[0],c.exec(i[1])[0]]}),1===k.length&amp;&amp;(k[1]=k[0]),&quot;right&quot;===n.at[0]?y.left+=m:&quot;center&quot;===n.at[0]&amp;&amp;(y.left+=m/2),&quot;bottom&quot;===n.at[1]?y.top+=g:&quot;center&quot;===n.at[1]&amp;&amp;(y.top+=g/2),p=t(T.at,m,g),y.left+=p[0],y.top+=p[1],this.each(function(){var s,l,u=e(this),d=u.outerWidth(),c=u.outerHeight(),f=i(this,&quot;marginLeft&quot;),b=i(this,&quot;marginTop&quot;),D=d+f+i(this,&quot;marginRight&quot;)+w.width,S=c+b+i(this,&quot;marginBottom&quot;)+w.height,M=e.extend({},y),C=t(T.my,u.outerWidth(),u.outerHeight());&quot;right&quot;===n.my[0]?M.left-=d:&quot;center&quot;===n.my[0]&amp;&amp;(M.left-=d/2),&quot;bottom&quot;===n.my[1]?M.top-=c:&quot;center&quot;===n.my[1]&amp;&amp;(M.top-=c/2),M.left+=C[0],M.top+=C[1],a||(M.left=h(M.left),M.top=h(M.top)),s={marginLeft:f,marginTop:b},e.each([&quot;left&quot;,&quot;top&quot;],function(t,i){e.ui.position[k[t]]&amp;&amp;e.ui.position[k[t]][i](M,{targetWidth:m,targetHeight:g,elemWidth:d,elemHeight:c,collisionPosition:s,collisionWidth:D,collisionHeight:S,offset:[p[0]+C[0],p[1]+C[1]],my:n.my,at:n.at,within:x,elem:u})}),n.using&amp;&amp;(l=function(e){var t=v.left-M.left,i=t+m-d,s=v.top-M.top,a=s+g-c,h={target:{element:_,left:v.left,top:v.top,width:m,height:g},element:{element:u,left:M.left,top:M.top,width:d,height:c},horizontal:0&gt;i?&quot;left&quot;:t&gt;0?&quot;right&quot;:&quot;center&quot;,vertical:0&gt;a?&quot;top&quot;:s&gt;0?&quot;bottom&quot;:&quot;middle&quot;};d&gt;m&amp;&amp;m&gt;r(t+i)&amp;&amp;(h.horizontal=&quot;center&quot;),c&gt;g&amp;&amp;g&gt;r(s+a)&amp;&amp;(h.vertical=&quot;middle&quot;),h.important=o(r(t),r(i))&gt;o(r(s),r(a))?&quot;horizontal&quot;:&quot;vertical&quot;,n.using.call(this,e,h)}),u.offset(e.extend(M,{using:l}))})},e.ui.position={fit:{left:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollLeft:s.offset.left,a=s.width,r=e.left-t.collisionPosition.marginLeft,h=n-r,l=r+t.collisionWidth-a-n;t.collisionWidth&gt;a?h&gt;0&amp;&amp;0&gt;=l?(i=e.left+h+t.collisionWidth-a-n,e.left+=h-i):e.left=l&gt;0&amp;&amp;0&gt;=h?n:h&gt;l?n+a-t.collisionWidth:n:h&gt;0?e.left+=h:l&gt;0?e.left-=l:e.left=o(e.left-r,e.left)},top:function(e,t){var i,s=t.within,n=s.isWindow?s.scrollTop:s.offset.top,a=t.within.height,r=e.top-t.collisionPosition.marginTop,h=n-r,l=r+t.collisionHeight-a-n;t.collisionHeight&gt;a?h&gt;0&amp;&amp;0&gt;=l?(i=e.top+h+t.collisionHeight-a-n,e.top+=h-i):e.top=l&gt;0&amp;&amp;0&gt;=h?n:h&gt;l?n+a-t.collisionHeight:n:h&gt;0?e.top+=h:l&gt;0?e.top-=l:e.top=o(e.top-r,e.top)}},flip:{left:function(e,t){var i,s,n=t.within,a=n.offset.left+n.scrollLeft,o=n.width,h=n.isWindow?n.scrollLeft:n.offset.left,l=e.left-t.collisionPosition.marginLeft,u=l-h,d=l+t.collisionWidth-o-h,c=&quot;left&quot;===t.my[0]?-t.elemWidth:&quot;right&quot;===t.my[0]?t.elemWidth:0,p=&quot;left&quot;===t.at[0]?t.targetWidth:&quot;right&quot;===t.at[0]?-t.targetWidth:0,f=-2*t.offset[0];0&gt;u?(i=e.left+c+p+f+t.collisionWidth-o-a,(0&gt;i||r(u)&gt;i)&amp;&amp;(e.left+=c+p+f)):d&gt;0&amp;&amp;(s=e.left-t.collisionPosition.marginLeft+c+p+f-h,(s&gt;0||d&gt;r(s))&amp;&amp;(e.left+=c+p+f))},top:function(e,t){var i,s,n=t.within,a=n.offset.top+n.scrollTop,o=n.height,h=n.isWindow?n.scrollTop:n.offset.top,l=e.top-t.collisionPosition.marginTop,u=l-h,d=l+t.collisionHeight-o-h,c=&quot;top&quot;===t.my[1],p=c?-t.elemHeight:&quot;bottom&quot;===t.my[1]?t.elemHeight:0,f=&quot;top&quot;===t.at[1]?t.targetHeight:&quot;bottom&quot;===t.at[1]?-t.targetHeight:0,m=-2*t.offset[1];0&gt;u?(s=e.top+p+f+m+t.collisionHeight-o-a,(0&gt;s||r(u)&gt;s)&amp;&amp;(e.top+=p+f+m)):d&gt;0&amp;&amp;(i=e.top-t.collisionPosition.marginTop+p+f+m-h,(i&gt;0||d&gt;r(i))&amp;&amp;(e.top+=p+f+m))}},flipfit:{left:function(){e.ui.position.flip.left.apply(this,arguments),e.ui.position.fit.left.apply(this,arguments)},top:function(){e.ui.position.flip.top.apply(this,arguments),e.ui.position.fit.top.apply(this,arguments)}}},function(){var t,i,s,n,o,r=document.getElementsByTagName(&quot;body&quot;)[0],h=document.createElement(&quot;div&quot;);t=document.createElement(r?&quot;div&quot;:&quot;body&quot;),s={visibility:&quot;hidden&quot;,width:0,height:0,border:0,margin:0,background:&quot;none&quot;},r&amp;&amp;e.extend(s,{position:&quot;absolute&quot;,left:&quot;-1000px&quot;,top:&quot;-1000px&quot;});for(o in s)t.style[o]=s[o];t.appendChild(h),i=r||document.documentElement,i.insertBefore(t,i.firstChild),h.style.cssText=&quot;position: absolute; left: 10.7432222px;&quot;,n=e(h).offset().left,a=n&gt;10&amp;&amp;11&gt;n,t.innerHTML=&quot;&quot;,i.removeChild(t)}()}(),e.ui.position,e.widget(&quot;ui.accordion&quot;,{version:&quot;1.11.4&quot;,options:{active:0,animate:{},collapsible:!1,event:&quot;click&quot;,header:&quot;&gt; li &gt; :first-child,&gt; :not(li):even&quot;,heightStyle:&quot;auto&quot;,icons:{activeHeader:&quot;ui-icon-triangle-1-s&quot;,header:&quot;ui-icon-triangle-1-e&quot;},activate:null,beforeActivate:null},hideProps:{borderTopWidth:&quot;hide&quot;,borderBottomWidth:&quot;hide&quot;,paddingTop:&quot;hide&quot;,paddingBottom:&quot;hide&quot;,height:&quot;hide&quot;},showProps:{borderTopWidth:&quot;show&quot;,borderBottomWidth:&quot;show&quot;,paddingTop:&quot;show&quot;,paddingBottom:&quot;show&quot;,height:&quot;show&quot;},_create:function(){var t=this.options;this.prevShow=this.prevHide=e(),this.element.addClass(&quot;ui-accordion ui-widget ui-helper-reset&quot;).attr(&quot;role&quot;,&quot;tablist&quot;),t.collapsible||t.active!==!1&amp;&amp;null!=t.active||(t.active=0),this._processPanels(),0&gt;t.active&amp;&amp;(t.active+=this.headers.length),this._refresh()},_getCreateEventData:function(){return{header:this.active,panel:this.active.length?this.active.next():e()}},_createIcons:function(){var t=this.options.icons;t&amp;&amp;(e(&quot;&lt;span&gt;&quot;).addClass(&quot;ui-accordion-header-icon ui-icon &quot;+t.header).prependTo(this.headers),this.active.children(&quot;.ui-accordion-header-icon&quot;).removeClass(t.header).addClass(t.activeHeader),this.headers.addClass(&quot;ui-accordion-icons&quot;))},_destroyIcons:function(){this.headers.removeClass(&quot;ui-accordion-icons&quot;).children(&quot;.ui-accordion-header-icon&quot;).remove()},_destroy:function(){var e;this.element.removeClass(&quot;ui-accordion ui-widget ui-helper-reset&quot;).removeAttr(&quot;role&quot;),this.headers.removeClass(&quot;ui-accordion-header ui-accordion-header-active ui-state-default ui-corner-all ui-state-active ui-state-disabled ui-corner-top&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-expanded&quot;).removeAttr(&quot;aria-selected&quot;).removeAttr(&quot;aria-controls&quot;).removeAttr(&quot;tabIndex&quot;).removeUniqueId(),this._destroyIcons(),e=this.headers.next().removeClass(&quot;ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content ui-accordion-content-active ui-state-disabled&quot;).css(&quot;display&quot;,&quot;&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-hidden&quot;).removeAttr(&quot;aria-labelledby&quot;).removeUniqueId(),&quot;content&quot;!==this.options.heightStyle&amp;&amp;e.css(&quot;height&quot;,&quot;&quot;)},_setOption:function(e,t){return&quot;active&quot;===e?(this._activate(t),void 0):(&quot;event&quot;===e&amp;&amp;(this.options.event&amp;&amp;this._off(this.headers,this.options.event),this._setupEvents(t)),this._super(e,t),&quot;collapsible&quot;!==e||t||this.options.active!==!1||this._activate(0),&quot;icons&quot;===e&amp;&amp;(this._destroyIcons(),t&amp;&amp;this._createIcons()),&quot;disabled&quot;===e&amp;&amp;(this.element.toggleClass(&quot;ui-state-disabled&quot;,!!t).attr(&quot;aria-disabled&quot;,t),this.headers.add(this.headers.next()).toggleClass(&quot;ui-state-disabled&quot;,!!t)),void 0)},_keydown:function(t){if(!t.altKey&amp;&amp;!t.ctrlKey){var i=e.ui.keyCode,s=this.headers.length,n=this.headers.index(t.target),a=!1;switch(t.keyCode){case i.RIGHT:case i.DOWN:a=this.headers[(n+1)%s];break;case i.LEFT:case i.UP:a=this.headers[(n-1+s)%s];break;case i.SPACE:case i.ENTER:this._eventHandler(t);break;case i.HOME:a=this.headers[0];break;case i.END:a=this.headers[s-1]}a&amp;&amp;(e(t.target).attr(&quot;tabIndex&quot;,-1),e(a).attr(&quot;tabIndex&quot;,0),a.focus(),t.preventDefault())}},_panelKeyDown:function(t){t.keyCode===e.ui.keyCode.UP&amp;&amp;t.ctrlKey&amp;&amp;e(t.currentTarget).prev().focus()},refresh:function(){var t=this.options;this._processPanels(),t.active===!1&amp;&amp;t.collapsible===!0||!this.headers.length?(t.active=!1,this.active=e()):t.active===!1?this._activate(0):this.active.length&amp;&amp;!e.contains(this.element[0],this.active[0])?this.headers.length===this.headers.find(&quot;.ui-state-disabled&quot;).length?(t.active=!1,this.active=e()):this._activate(Math.max(0,t.active-1)):t.active=this.headers.index(this.active),this._destroyIcons(),this._refresh()},_processPanels:function(){var e=this.headers,t=this.panels;this.headers=this.element.find(this.options.header).addClass(&quot;ui-accordion-header ui-state-default ui-corner-all&quot;),this.panels=this.headers.next().addClass(&quot;ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom&quot;).filter(&quot;:not(.ui-accordion-content-active)&quot;).hide(),t&amp;&amp;(this._off(e.not(this.headers)),this._off(t.not(this.panels)))},_refresh:function(){var t,i=this.options,s=i.heightStyle,n=this.element.parent();this.active=this._findActive(i.active).addClass(&quot;ui-accordion-header-active ui-state-active ui-corner-top&quot;).removeClass(&quot;ui-corner-all&quot;),this.active.next().addClass(&quot;ui-accordion-content-active&quot;).show(),this.headers.attr(&quot;role&quot;,&quot;tab&quot;).each(function(){var t=e(this),i=t.uniqueId().attr(&quot;id&quot;),s=t.next(),n=s.uniqueId().attr(&quot;id&quot;);t.attr(&quot;aria-controls&quot;,n),s.attr(&quot;aria-labelledby&quot;,i)}).next().attr(&quot;role&quot;,&quot;tabpanel&quot;),this.headers.not(this.active).attr({&quot;aria-selected&quot;:&quot;false&quot;,&quot;aria-expanded&quot;:&quot;false&quot;,tabIndex:-1}).next().attr({&quot;aria-hidden&quot;:&quot;true&quot;}).hide(),this.active.length?this.active.attr({&quot;aria-selected&quot;:&quot;true&quot;,&quot;aria-expanded&quot;:&quot;true&quot;,tabIndex:0}).next().attr({&quot;aria-hidden&quot;:&quot;false&quot;}):this.headers.eq(0).attr(&quot;tabIndex&quot;,0),this._createIcons(),this._setupEvents(i.event),&quot;fill&quot;===s?(t=n.height(),this.element.siblings(&quot;:visible&quot;).each(function(){var i=e(this),s=i.css(&quot;position&quot;);&quot;absolute&quot;!==s&amp;&amp;&quot;fixed&quot;!==s&amp;&amp;(t-=i.outerHeight(!0))}),this.headers.each(function(){t-=e(this).outerHeight(!0)}),this.headers.next().each(function(){e(this).height(Math.max(0,t-e(this).innerHeight()+e(this).height()))}).css(&quot;overflow&quot;,&quot;auto&quot;)):&quot;auto&quot;===s&amp;&amp;(t=0,this.headers.next().each(function(){t=Math.max(t,e(this).css(&quot;height&quot;,&quot;&quot;).height())}).height(t))},_activate:function(t){var i=this._findActive(t)[0];i!==this.active[0]&amp;&amp;(i=i||this.active[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return&quot;number&quot;==typeof t?this.headers.eq(t):e()},_setupEvents:function(t){var i={keydown:&quot;_keydown&quot;};t&amp;&amp;e.each(t.split(&quot; &quot;),function(e,t){i[t]=&quot;_eventHandler&quot;}),this._off(this.headers.add(this.headers.next())),this._on(this.headers,i),this._on(this.headers.next(),{keydown:&quot;_panelKeyDown&quot;}),this._hoverable(this.headers),this._focusable(this.headers)},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n[0]===s[0],o=a&amp;&amp;i.collapsible,r=o?e():n.next(),h=s.next(),l={oldHeader:s,oldPanel:h,newHeader:o?e():n,newPanel:r};t.preventDefault(),a&amp;&amp;!i.collapsible||this._trigger(&quot;beforeActivate&quot;,t,l)===!1||(i.active=o?!1:this.headers.index(n),this.active=a?e():n,this._toggle(l),s.removeClass(&quot;ui-accordion-header-active ui-state-active&quot;),i.icons&amp;&amp;s.children(&quot;.ui-accordion-header-icon&quot;).removeClass(i.icons.activeHeader).addClass(i.icons.header),a||(n.removeClass(&quot;ui-corner-all&quot;).addClass(&quot;ui-accordion-header-active ui-state-active ui-corner-top&quot;),i.icons&amp;&amp;n.children(&quot;.ui-accordion-header-icon&quot;).removeClass(i.icons.header).addClass(i.icons.activeHeader),n.next().addClass(&quot;ui-accordion-content-active&quot;)))},_toggle:function(t){var i=t.newPanel,s=this.prevShow.length?this.prevShow:t.oldPanel;this.prevShow.add(this.prevHide).stop(!0,!0),this.prevShow=i,this.prevHide=s,this.options.animate?this._animate(i,s,t):(s.hide(),i.show(),this._toggleComplete(t)),s.attr({&quot;aria-hidden&quot;:&quot;true&quot;}),s.prev().attr({&quot;aria-selected&quot;:&quot;false&quot;,&quot;aria-expanded&quot;:&quot;false&quot;}),i.length&amp;&amp;s.length?s.prev().attr({tabIndex:-1,&quot;aria-expanded&quot;:&quot;false&quot;}):i.length&amp;&amp;this.headers.filter(function(){return 0===parseInt(e(this).attr(&quot;tabIndex&quot;),10)}).attr(&quot;tabIndex&quot;,-1),i.attr(&quot;aria-hidden&quot;,&quot;false&quot;).prev().attr({&quot;aria-selected&quot;:&quot;true&quot;,&quot;aria-expanded&quot;:&quot;true&quot;,tabIndex:0})},_animate:function(e,t,i){var s,n,a,o=this,r=0,h=e.css(&quot;box-sizing&quot;),l=e.length&amp;&amp;(!t.length||e.index()&lt;t.index()),u=this.options.animate||{},d=l&amp;&amp;u.down||u,c=function(){o._toggleComplete(i)};return&quot;number&quot;==typeof d&amp;&amp;(a=d),&quot;string&quot;==typeof d&amp;&amp;(n=d),n=n||d.easing||u.easing,a=a||d.duration||u.duration,t.length?e.length?(s=e.show().outerHeight(),t.animate(this.hideProps,{duration:a,easing:n,step:function(e,t){t.now=Math.round(e)}}),e.hide().animate(this.showProps,{duration:a,easing:n,complete:c,step:function(e,i){i.now=Math.round(e),&quot;height&quot;!==i.prop?&quot;content-box&quot;===h&amp;&amp;(r+=i.now):&quot;content&quot;!==o.options.heightStyle&amp;&amp;(i.now=Math.round(s-t.outerHeight()-r),r=0)}}),void 0):t.animate(this.hideProps,a,n,c):e.animate(this.showProps,a,n,c)},_toggleComplete:function(e){var t=e.oldPanel;t.removeClass(&quot;ui-accordion-content-active&quot;).prev().removeClass(&quot;ui-corner-top&quot;).addClass(&quot;ui-corner-all&quot;),t.length&amp;&amp;(t.parent()[0].className=t.parent()[0].className),this._trigger(&quot;activate&quot;,null,e)}}),e.widget(&quot;ui.menu&quot;,{version:&quot;1.11.4&quot;,defaultElement:&quot;&lt;ul&gt;&quot;,delay:300,options:{icons:{submenu:&quot;ui-icon-carat-1-e&quot;},items:&quot;&gt; *&quot;,menus:&quot;ul&quot;,position:{my:&quot;left-1 top&quot;,at:&quot;right top&quot;},role:&quot;menu&quot;,blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.mouseHandled=!1,this.element.uniqueId().addClass(&quot;ui-menu ui-widget ui-widget-content&quot;).toggleClass(&quot;ui-menu-icons&quot;,!!this.element.find(&quot;.ui-icon&quot;).length).attr({role:this.options.role,tabIndex:0}),this.options.disabled&amp;&amp;this.element.addClass(&quot;ui-state-disabled&quot;).attr(&quot;aria-disabled&quot;,&quot;true&quot;),this._on({&quot;mousedown .ui-menu-item&quot;:function(e){e.preventDefault()},&quot;click .ui-menu-item&quot;:function(t){var i=e(t.target);!this.mouseHandled&amp;&amp;i.not(&quot;.ui-state-disabled&quot;).length&amp;&amp;(this.select(t),t.isPropagationStopped()||(this.mouseHandled=!0),i.has(&quot;.ui-menu&quot;).length?this.expand(t):!this.element.is(&quot;:focus&quot;)&amp;&amp;e(this.document[0].activeElement).closest(&quot;.ui-menu&quot;).length&amp;&amp;(this.element.trigger(&quot;focus&quot;,[!0]),this.active&amp;&amp;1===this.active.parents(&quot;.ui-menu&quot;).length&amp;&amp;clearTimeout(this.timer)))},&quot;mouseenter .ui-menu-item&quot;:function(t){if(!this.previousFilter){var i=e(t.currentTarget);
i.siblings(&quot;.ui-state-active&quot;).removeClass(&quot;ui-state-active&quot;),this.focus(t,i)}},mouseleave:&quot;collapseAll&quot;,&quot;mouseleave .ui-menu&quot;:&quot;collapseAll&quot;,focus:function(e,t){var i=this.active||this.element.find(this.options.items).eq(0);t||this.focus(e,i)},blur:function(t){this._delay(function(){e.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(t)})},keydown:&quot;_keydown&quot;}),this.refresh(),this._on(this.document,{click:function(e){this._closeOnDocumentClick(e)&amp;&amp;this.collapseAll(e),this.mouseHandled=!1}})},_destroy:function(){this.element.removeAttr(&quot;aria-activedescendant&quot;).find(&quot;.ui-menu&quot;).addBack().removeClass(&quot;ui-menu ui-widget ui-widget-content ui-menu-icons ui-front&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;tabIndex&quot;).removeAttr(&quot;aria-labelledby&quot;).removeAttr(&quot;aria-expanded&quot;).removeAttr(&quot;aria-hidden&quot;).removeAttr(&quot;aria-disabled&quot;).removeUniqueId().show(),this.element.find(&quot;.ui-menu-item&quot;).removeClass(&quot;ui-menu-item&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-disabled&quot;).removeUniqueId().removeClass(&quot;ui-state-hover&quot;).removeAttr(&quot;tabIndex&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-haspopup&quot;).children().each(function(){var t=e(this);t.data(&quot;ui-menu-submenu-carat&quot;)&amp;&amp;t.remove()}),this.element.find(&quot;.ui-menu-divider&quot;).removeClass(&quot;ui-menu-divider ui-widget-content&quot;)},_keydown:function(t){var i,s,n,a,o=!0;switch(t.keyCode){case e.ui.keyCode.PAGE_UP:this.previousPage(t);break;case e.ui.keyCode.PAGE_DOWN:this.nextPage(t);break;case e.ui.keyCode.HOME:this._move(&quot;first&quot;,&quot;first&quot;,t);break;case e.ui.keyCode.END:this._move(&quot;last&quot;,&quot;last&quot;,t);break;case e.ui.keyCode.UP:this.previous(t);break;case e.ui.keyCode.DOWN:this.next(t);break;case e.ui.keyCode.LEFT:this.collapse(t);break;case e.ui.keyCode.RIGHT:this.active&amp;&amp;!this.active.is(&quot;.ui-state-disabled&quot;)&amp;&amp;this.expand(t);break;case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this._activate(t);break;case e.ui.keyCode.ESCAPE:this.collapse(t);break;default:o=!1,s=this.previousFilter||&quot;&quot;,n=String.fromCharCode(t.keyCode),a=!1,clearTimeout(this.filterTimer),n===s?a=!0:n=s+n,i=this._filterMenuItems(n),i=a&amp;&amp;-1!==i.index(this.active.next())?this.active.nextAll(&quot;.ui-menu-item&quot;):i,i.length||(n=String.fromCharCode(t.keyCode),i=this._filterMenuItems(n)),i.length?(this.focus(t,i),this.previousFilter=n,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter}o&amp;&amp;t.preventDefault()},_activate:function(e){this.active.is(&quot;.ui-state-disabled&quot;)||(this.active.is(&quot;[aria-haspopup='true']&quot;)?this.expand(e):this.select(e))},refresh:function(){var t,i,s=this,n=this.options.icons.submenu,a=this.element.find(this.options.menus);this.element.toggleClass(&quot;ui-menu-icons&quot;,!!this.element.find(&quot;.ui-icon&quot;).length),a.filter(&quot;:not(.ui-menu)&quot;).addClass(&quot;ui-menu ui-widget ui-widget-content ui-front&quot;).hide().attr({role:this.options.role,&quot;aria-hidden&quot;:&quot;true&quot;,&quot;aria-expanded&quot;:&quot;false&quot;}).each(function(){var t=e(this),i=t.parent(),s=e(&quot;&lt;span&gt;&quot;).addClass(&quot;ui-menu-icon ui-icon &quot;+n).data(&quot;ui-menu-submenu-carat&quot;,!0);i.attr(&quot;aria-haspopup&quot;,&quot;true&quot;).prepend(s),t.attr(&quot;aria-labelledby&quot;,i.attr(&quot;id&quot;))}),t=a.add(this.element),i=t.find(this.options.items),i.not(&quot;.ui-menu-item&quot;).each(function(){var t=e(this);s._isDivider(t)&amp;&amp;t.addClass(&quot;ui-widget-content ui-menu-divider&quot;)}),i.not(&quot;.ui-menu-item, .ui-menu-divider&quot;).addClass(&quot;ui-menu-item&quot;).uniqueId().attr({tabIndex:-1,role:this._itemRole()}),i.filter(&quot;.ui-state-disabled&quot;).attr(&quot;aria-disabled&quot;,&quot;true&quot;),this.active&amp;&amp;!e.contains(this.element[0],this.active[0])&amp;&amp;this.blur()},_itemRole:function(){return{menu:&quot;menuitem&quot;,listbox:&quot;option&quot;}[this.options.role]},_setOption:function(e,t){&quot;icons&quot;===e&amp;&amp;this.element.find(&quot;.ui-menu-icon&quot;).removeClass(this.options.icons.submenu).addClass(t.submenu),&quot;disabled&quot;===e&amp;&amp;this.element.toggleClass(&quot;ui-state-disabled&quot;,!!t).attr(&quot;aria-disabled&quot;,t),this._super(e,t)},focus:function(e,t){var i,s;this.blur(e,e&amp;&amp;&quot;focus&quot;===e.type),this._scrollIntoView(t),this.active=t.first(),s=this.active.addClass(&quot;ui-state-focus&quot;).removeClass(&quot;ui-state-active&quot;),this.options.role&amp;&amp;this.element.attr(&quot;aria-activedescendant&quot;,s.attr(&quot;id&quot;)),this.active.parent().closest(&quot;.ui-menu-item&quot;).addClass(&quot;ui-state-active&quot;),e&amp;&amp;&quot;keydown&quot;===e.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),i=t.children(&quot;.ui-menu&quot;),i.length&amp;&amp;e&amp;&amp;/^mouse/.test(e.type)&amp;&amp;this._startOpening(i),this.activeMenu=t.parent(),this._trigger(&quot;focus&quot;,e,{item:t})},_scrollIntoView:function(t){var i,s,n,a,o,r;this._hasScroll()&amp;&amp;(i=parseFloat(e.css(this.activeMenu[0],&quot;borderTopWidth&quot;))||0,s=parseFloat(e.css(this.activeMenu[0],&quot;paddingTop&quot;))||0,n=t.offset().top-this.activeMenu.offset().top-i-s,a=this.activeMenu.scrollTop(),o=this.activeMenu.height(),r=t.outerHeight(),0&gt;n?this.activeMenu.scrollTop(a+n):n+r&gt;o&amp;&amp;this.activeMenu.scrollTop(a+n-o+r))},blur:function(e,t){t||clearTimeout(this.timer),this.active&amp;&amp;(this.active.removeClass(&quot;ui-state-focus&quot;),this.active=null,this._trigger(&quot;blur&quot;,e,{item:this.active}))},_startOpening:function(e){clearTimeout(this.timer),&quot;true&quot;===e.attr(&quot;aria-hidden&quot;)&amp;&amp;(this.timer=this._delay(function(){this._close(),this._open(e)},this.delay))},_open:function(t){var i=e.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(&quot;.ui-menu&quot;).not(t.parents(&quot;.ui-menu&quot;)).hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;),t.show().removeAttr(&quot;aria-hidden&quot;).attr(&quot;aria-expanded&quot;,&quot;true&quot;).position(i)},collapseAll:function(t,i){clearTimeout(this.timer),this.timer=this._delay(function(){var s=i?this.element:e(t&amp;&amp;t.target).closest(this.element.find(&quot;.ui-menu&quot;));s.length||(s=this.element),this._close(s),this.blur(t),this.activeMenu=s},this.delay)},_close:function(e){e||(e=this.active?this.active.parent():this.element),e.find(&quot;.ui-menu&quot;).hide().attr(&quot;aria-hidden&quot;,&quot;true&quot;).attr(&quot;aria-expanded&quot;,&quot;false&quot;).end().find(&quot;.ui-state-active&quot;).not(&quot;.ui-state-focus&quot;).removeClass(&quot;ui-state-active&quot;)},_closeOnDocumentClick:function(t){return!e(t.target).closest(&quot;.ui-menu&quot;).length},_isDivider:function(e){return!/[^\-\u2014\u2013\s]/.test(e.text())},collapse:function(e){var t=this.active&amp;&amp;this.active.parent().closest(&quot;.ui-menu-item&quot;,this.element);t&amp;&amp;t.length&amp;&amp;(this._close(),this.focus(e,t))},expand:function(e){var t=this.active&amp;&amp;this.active.children(&quot;.ui-menu &quot;).find(this.options.items).first();t&amp;&amp;t.length&amp;&amp;(this._open(t.parent()),this._delay(function(){this.focus(e,t)}))},next:function(e){this._move(&quot;next&quot;,&quot;first&quot;,e)},previous:function(e){this._move(&quot;prev&quot;,&quot;last&quot;,e)},isFirstItem:function(){return this.active&amp;&amp;!this.active.prevAll(&quot;.ui-menu-item&quot;).length},isLastItem:function(){return this.active&amp;&amp;!this.active.nextAll(&quot;.ui-menu-item&quot;).length},_move:function(e,t,i){var s;this.active&amp;&amp;(s=&quot;first&quot;===e||&quot;last&quot;===e?this.active[&quot;first&quot;===e?&quot;prevAll&quot;:&quot;nextAll&quot;](&quot;.ui-menu-item&quot;).eq(-1):this.active[e+&quot;All&quot;](&quot;.ui-menu-item&quot;).eq(0)),s&amp;&amp;s.length&amp;&amp;this.active||(s=this.activeMenu.find(this.options.items)[t]()),this.focus(i,s)},nextPage:function(t){var i,s,n;return this.active?(this.isLastItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.nextAll(&quot;.ui-menu-item&quot;).each(function(){return i=e(this),0&gt;i.offset().top-s-n}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items)[this.active?&quot;last&quot;:&quot;first&quot;]())),void 0):(this.next(t),void 0)},previousPage:function(t){var i,s,n;return this.active?(this.isFirstItem()||(this._hasScroll()?(s=this.active.offset().top,n=this.element.height(),this.active.prevAll(&quot;.ui-menu-item&quot;).each(function(){return i=e(this),i.offset().top-s+n&gt;0}),this.focus(t,i)):this.focus(t,this.activeMenu.find(this.options.items).first())),void 0):(this.next(t),void 0)},_hasScroll:function(){return this.element.outerHeight()&lt;this.element.prop(&quot;scrollHeight&quot;)},select:function(t){this.active=this.active||e(t.target).closest(&quot;.ui-menu-item&quot;);var i={item:this.active};this.active.has(&quot;.ui-menu&quot;).length||this.collapseAll(t,!0),this._trigger(&quot;select&quot;,t,i)},_filterMenuItems:function(t){var i=t.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,&quot;\\$&amp;&quot;),s=RegExp(&quot;^&quot;+i,&quot;i&quot;);return this.activeMenu.find(this.options.items).filter(&quot;.ui-menu-item&quot;).filter(function(){return s.test(e.trim(e(this).text()))})}}),e.widget(&quot;ui.autocomplete&quot;,{version:&quot;1.11.4&quot;,defaultElement:&quot;&lt;input&gt;&quot;,options:{appendTo:null,autoFocus:!1,delay:300,minLength:1,position:{my:&quot;left top&quot;,at:&quot;left bottom&quot;,collision:&quot;none&quot;},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},requestIndex:0,pending:0,_create:function(){var t,i,s,n=this.element[0].nodeName.toLowerCase(),a=&quot;textarea&quot;===n,o=&quot;input&quot;===n;this.isMultiLine=a?!0:o?!1:this.element.prop(&quot;isContentEditable&quot;),this.valueMethod=this.element[a||o?&quot;val&quot;:&quot;text&quot;],this.isNewMenu=!0,this.element.addClass(&quot;ui-autocomplete-input&quot;).attr(&quot;autocomplete&quot;,&quot;off&quot;),this._on(this.element,{keydown:function(n){if(this.element.prop(&quot;readOnly&quot;))return t=!0,s=!0,i=!0,void 0;t=!1,s=!1,i=!1;var a=e.ui.keyCode;switch(n.keyCode){case a.PAGE_UP:t=!0,this._move(&quot;previousPage&quot;,n);break;case a.PAGE_DOWN:t=!0,this._move(&quot;nextPage&quot;,n);break;case a.UP:t=!0,this._keyEvent(&quot;previous&quot;,n);break;case a.DOWN:t=!0,this._keyEvent(&quot;next&quot;,n);break;case a.ENTER:this.menu.active&amp;&amp;(t=!0,n.preventDefault(),this.menu.select(n));break;case a.TAB:this.menu.active&amp;&amp;this.menu.select(n);break;case a.ESCAPE:this.menu.element.is(&quot;:visible&quot;)&amp;&amp;(this.isMultiLine||this._value(this.term),this.close(n),n.preventDefault());break;default:i=!0,this._searchTimeout(n)}},keypress:function(s){if(t)return t=!1,(!this.isMultiLine||this.menu.element.is(&quot;:visible&quot;))&amp;&amp;s.preventDefault(),void 0;if(!i){var n=e.ui.keyCode;switch(s.keyCode){case n.PAGE_UP:this._move(&quot;previousPage&quot;,s);break;case n.PAGE_DOWN:this._move(&quot;nextPage&quot;,s);break;case n.UP:this._keyEvent(&quot;previous&quot;,s);break;case n.DOWN:this._keyEvent(&quot;next&quot;,s)}}},input:function(e){return s?(s=!1,e.preventDefault(),void 0):(this._searchTimeout(e),void 0)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(clearTimeout(this.searching),this.close(e),this._change(e),void 0)}}),this._initSource(),this.menu=e(&quot;&lt;ul&gt;&quot;).addClass(&quot;ui-autocomplete ui-front&quot;).appendTo(this._appendTo()).menu({role:null}).hide().menu(&quot;instance&quot;),this._on(this.menu.element,{mousedown:function(t){t.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var i=this.menu.element[0];e(t.target).closest(&quot;.ui-menu-item&quot;).length||this._delay(function(){var t=this;this.document.one(&quot;mousedown&quot;,function(s){s.target===t.element[0]||s.target===i||e.contains(i,s.target)||t.close()})})},menufocus:function(t,i){var s,n;return this.isNewMenu&amp;&amp;(this.isNewMenu=!1,t.originalEvent&amp;&amp;/^mouse/.test(t.originalEvent.type))?(this.menu.blur(),this.document.one(&quot;mousemove&quot;,function(){e(t.target).trigger(t.originalEvent)}),void 0):(n=i.item.data(&quot;ui-autocomplete-item&quot;),!1!==this._trigger(&quot;focus&quot;,t,{item:n})&amp;&amp;t.originalEvent&amp;&amp;/^key/.test(t.originalEvent.type)&amp;&amp;this._value(n.value),s=i.item.attr(&quot;aria-label&quot;)||n.value,s&amp;&amp;e.trim(s).length&amp;&amp;(this.liveRegion.children().hide(),e(&quot;&lt;div&gt;&quot;).text(s).appendTo(this.liveRegion)),void 0)},menuselect:function(e,t){var i=t.item.data(&quot;ui-autocomplete-item&quot;),s=this.previous;this.element[0]!==this.document[0].activeElement&amp;&amp;(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s,this.selectedItem=i})),!1!==this._trigger(&quot;select&quot;,e,{item:i})&amp;&amp;this._value(i.value),this.term=this._value(),this.close(e),this.selectedItem=i}}),this.liveRegion=e(&quot;&lt;span&gt;&quot;,{role:&quot;status&quot;,&quot;aria-live&quot;:&quot;assertive&quot;,&quot;aria-relevant&quot;:&quot;additions&quot;}).addClass(&quot;ui-helper-hidden-accessible&quot;).appendTo(this.document[0].body),this._on(this.window,{beforeunload:function(){this.element.removeAttr(&quot;autocomplete&quot;)}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass(&quot;ui-autocomplete-input&quot;).removeAttr(&quot;autocomplete&quot;),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(e,t){this._super(e,t),&quot;source&quot;===e&amp;&amp;this._initSource(),&quot;appendTo&quot;===e&amp;&amp;this.menu.element.appendTo(this._appendTo()),&quot;disabled&quot;===e&amp;&amp;t&amp;&amp;this.xhr&amp;&amp;this.xhr.abort()},_appendTo:function(){var t=this.options.appendTo;return t&amp;&amp;(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&amp;&amp;t[0]||(t=this.element.closest(&quot;.ui-front&quot;)),t.length||(t=this.document[0].body),t},_initSource:function(){var t,i,s=this;e.isArray(this.options.source)?(t=this.options.source,this.source=function(i,s){s(e.ui.autocomplete.filter(t,i.term))}):&quot;string&quot;==typeof this.options.source?(i=this.options.source,this.source=function(t,n){s.xhr&amp;&amp;s.xhr.abort(),s.xhr=e.ajax({url:i,data:t,dataType:&quot;json&quot;,success:function(e){n(e)},error:function(){n([])}})}):this.source=this.options.source},_searchTimeout:function(e){clearTimeout(this.searching),this.searching=this._delay(function(){var t=this.term===this._value(),i=this.menu.element.is(&quot;:visible&quot;),s=e.altKey||e.ctrlKey||e.metaKey||e.shiftKey;(!t||t&amp;&amp;!i&amp;&amp;!s)&amp;&amp;(this.selectedItem=null,this.search(null,e))},this.options.delay)},search:function(e,t){return e=null!=e?e:this._value(),this.term=this._value(),e.length&lt;this.options.minLength?this.close(t):this._trigger(&quot;search&quot;,t)!==!1?this._search(e):void 0},_search:function(e){this.pending++,this.element.addClass(&quot;ui-autocomplete-loading&quot;),this.cancelSearch=!1,this.source({term:e},this._response())},_response:function(){var t=++this.requestIndex;return e.proxy(function(e){t===this.requestIndex&amp;&amp;this.__response(e),this.pending--,this.pending||this.element.removeClass(&quot;ui-autocomplete-loading&quot;)},this)},__response:function(e){e&amp;&amp;(e=this._normalize(e)),this._trigger(&quot;response&quot;,null,{content:e}),!this.options.disabled&amp;&amp;e&amp;&amp;e.length&amp;&amp;!this.cancelSearch?(this._suggest(e),this._trigger(&quot;open&quot;)):this._close()},close:function(e){this.cancelSearch=!0,this._close(e)},_close:function(e){this.menu.element.is(&quot;:visible&quot;)&amp;&amp;(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger(&quot;close&quot;,e))},_change:function(e){this.previous!==this._value()&amp;&amp;this._trigger(&quot;change&quot;,e,{item:this.selectedItem})},_normalize:function(t){return t.length&amp;&amp;t[0].label&amp;&amp;t[0].value?t:e.map(t,function(t){return&quot;string&quot;==typeof t?{label:t,value:t}:e.extend({},t,{label:t.label||t.value,value:t.value||t.label})})},_suggest:function(t){var i=this.menu.element.empty();this._renderMenu(i,t),this.isNewMenu=!0,this.menu.refresh(),i.show(),this._resizeMenu(),i.position(e.extend({of:this.element},this.options.position)),this.options.autoFocus&amp;&amp;this.menu.next()},_resizeMenu:function(){var e=this.menu.element;e.outerWidth(Math.max(e.width(&quot;&quot;).outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(t,i){var s=this;e.each(i,function(e,i){s._renderItemData(t,i)})},_renderItemData:function(e,t){return this._renderItem(e,t).data(&quot;ui-autocomplete-item&quot;,t)},_renderItem:function(t,i){return e(&quot;&lt;li&gt;&quot;).text(i.label).appendTo(t)},_move:function(e,t){return this.menu.element.is(&quot;:visible&quot;)?this.menu.isFirstItem()&amp;&amp;/^previous/.test(e)||this.menu.isLastItem()&amp;&amp;/^next/.test(e)?(this.isMultiLine||this._value(this.term),this.menu.blur(),void 0):(this.menu[e](t),void 0):(this.search(null,t),void 0)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(e,t){(!this.isMultiLine||this.menu.element.is(&quot;:visible&quot;))&amp;&amp;(this._move(e,t),t.preventDefault())}}),e.extend(e.ui.autocomplete,{escapeRegex:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,&quot;\\$&amp;&quot;)},filter:function(t,i){var s=RegExp(e.ui.autocomplete.escapeRegex(i),&quot;i&quot;);return e.grep(t,function(e){return s.test(e.label||e.value||e)})}}),e.widget(&quot;ui.autocomplete&quot;,e.ui.autocomplete,{options:{messages:{noResults:&quot;No search results.&quot;,results:function(e){return e+(e&gt;1?&quot; results are&quot;:&quot; result is&quot;)+&quot; available, use up and down arrow keys to navigate.&quot;}}},__response:function(t){var i;this._superApply(arguments),this.options.disabled||this.cancelSearch||(i=t&amp;&amp;t.length?this.options.messages.results(t.length):this.options.messages.noResults,this.liveRegion.children().hide(),e(&quot;&lt;div&gt;&quot;).text(i).appendTo(this.liveRegion))}}),e.ui.autocomplete;var c,p=&quot;ui-button ui-widget ui-state-default ui-corner-all&quot;,f=&quot;ui-button-icons-only ui-button-icon-only ui-button-text-icons ui-button-text-icon-primary ui-button-text-icon-secondary ui-button-text-only&quot;,m=function(){var t=e(this);setTimeout(function(){t.find(&quot;:ui-button&quot;).button(&quot;refresh&quot;)},1)},g=function(t){var i=t.name,s=t.form,n=e([]);return i&amp;&amp;(i=i.replace(/'/g,&quot;\\'&quot;),n=s?e(s).find(&quot;[name='&quot;+i+&quot;'][type=radio]&quot;):e(&quot;[name='&quot;+i+&quot;'][type=radio]&quot;,t.ownerDocument).filter(function(){return!this.form})),n};e.widget(&quot;ui.button&quot;,{version:&quot;1.11.4&quot;,defaultElement:&quot;&lt;button&gt;&quot;,options:{disabled:null,text:!0,label:null,icons:{primary:null,secondary:null}},_create:function(){this.element.closest(&quot;form&quot;).unbind(&quot;reset&quot;+this.eventNamespace).bind(&quot;reset&quot;+this.eventNamespace,m),&quot;boolean&quot;!=typeof this.options.disabled?this.options.disabled=!!this.element.prop(&quot;disabled&quot;):this.element.prop(&quot;disabled&quot;,this.options.disabled),this._determineButtonType(),this.hasTitle=!!this.buttonElement.attr(&quot;title&quot;);var t=this,i=this.options,s=&quot;checkbox&quot;===this.type||&quot;radio&quot;===this.type,n=s?&quot;&quot;:&quot;ui-state-active&quot;;null===i.label&amp;&amp;(i.label=&quot;input&quot;===this.type?this.buttonElement.val():this.buttonElement.html()),this._hoverable(this.buttonElement),this.buttonElement.addClass(p).attr(&quot;role&quot;,&quot;button&quot;).bind(&quot;mouseenter&quot;+this.eventNamespace,function(){i.disabled||this===c&amp;&amp;e(this).addClass(&quot;ui-state-active&quot;)}).bind(&quot;mouseleave&quot;+this.eventNamespace,function(){i.disabled||e(this).removeClass(n)}).bind(&quot;click&quot;+this.eventNamespace,function(e){i.disabled&amp;&amp;(e.preventDefault(),e.stopImmediatePropagation())}),this._on({focus:function(){this.buttonElement.addClass(&quot;ui-state-focus&quot;)},blur:function(){this.buttonElement.removeClass(&quot;ui-state-focus&quot;)}}),s&amp;&amp;this.element.bind(&quot;change&quot;+this.eventNamespace,function(){t.refresh()}),&quot;checkbox&quot;===this.type?this.buttonElement.bind(&quot;click&quot;+this.eventNamespace,function(){return i.disabled?!1:void 0}):&quot;radio&quot;===this.type?this.buttonElement.bind(&quot;click&quot;+this.eventNamespace,function(){if(i.disabled)return!1;e(this).addClass(&quot;ui-state-active&quot;),t.buttonElement.attr(&quot;aria-pressed&quot;,&quot;true&quot;);var s=t.element[0];g(s).not(s).map(function(){return e(this).button(&quot;widget&quot;)[0]}).removeClass(&quot;ui-state-active&quot;).attr(&quot;aria-pressed&quot;,&quot;false&quot;)}):(this.buttonElement.bind(&quot;mousedown&quot;+this.eventNamespace,function(){return i.disabled?!1:(e(this).addClass(&quot;ui-state-active&quot;),c=this,t.document.one(&quot;mouseup&quot;,function(){c=null}),void 0)}).bind(&quot;mouseup&quot;+this.eventNamespace,function(){return i.disabled?!1:(e(this).removeClass(&quot;ui-state-active&quot;),void 0)}).bind(&quot;keydown&quot;+this.eventNamespace,function(t){return i.disabled?!1:((t.keyCode===e.ui.keyCode.SPACE||t.keyCode===e.ui.keyCode.ENTER)&amp;&amp;e(this).addClass(&quot;ui-state-active&quot;),void 0)}).bind(&quot;keyup&quot;+this.eventNamespace+&quot; blur&quot;+this.eventNamespace,function(){e(this).removeClass(&quot;ui-state-active&quot;)}),this.buttonElement.is(&quot;a&quot;)&amp;&amp;this.buttonElement.keyup(function(t){t.keyCode===e.ui.keyCode.SPACE&amp;&amp;e(this).click()})),this._setOption(&quot;disabled&quot;,i.disabled),this._resetButton()},_determineButtonType:function(){var e,t,i;this.type=this.element.is(&quot;[type=checkbox]&quot;)?&quot;checkbox&quot;:this.element.is(&quot;[type=radio]&quot;)?&quot;radio&quot;:this.element.is(&quot;input&quot;)?&quot;input&quot;:&quot;button&quot;,&quot;checkbox&quot;===this.type||&quot;radio&quot;===this.type?(e=this.element.parents().last(),t=&quot;label[for='&quot;+this.element.attr(&quot;id&quot;)+&quot;']&quot;,this.buttonElement=e.find(t),this.buttonElement.length||(e=e.length?e.siblings():this.element.siblings(),this.buttonElement=e.filter(t),this.buttonElement.length||(this.buttonElement=e.find(t))),this.element.addClass(&quot;ui-helper-hidden-accessible&quot;),i=this.element.is(&quot;:checked&quot;),i&amp;&amp;this.buttonElement.addClass(&quot;ui-state-active&quot;),this.buttonElement.prop(&quot;aria-pressed&quot;,i)):this.buttonElement=this.element},widget:function(){return this.buttonElement},_destroy:function(){this.element.removeClass(&quot;ui-helper-hidden-accessible&quot;),this.buttonElement.removeClass(p+&quot; ui-state-active &quot;+f).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-pressed&quot;).html(this.buttonElement.find(&quot;.ui-button-text&quot;).html()),this.hasTitle||this.buttonElement.removeAttr(&quot;title&quot;)},_setOption:function(e,t){return this._super(e,t),&quot;disabled&quot;===e?(this.widget().toggleClass(&quot;ui-state-disabled&quot;,!!t),this.element.prop(&quot;disabled&quot;,!!t),t&amp;&amp;(&quot;checkbox&quot;===this.type||&quot;radio&quot;===this.type?this.buttonElement.removeClass(&quot;ui-state-focus&quot;):this.buttonElement.removeClass(&quot;ui-state-focus ui-state-active&quot;)),void 0):(this._resetButton(),void 0)},refresh:function(){var t=this.element.is(&quot;input, button&quot;)?this.element.is(&quot;:disabled&quot;):this.element.hasClass(&quot;ui-button-disabled&quot;);t!==this.options.disabled&amp;&amp;this._setOption(&quot;disabled&quot;,t),&quot;radio&quot;===this.type?g(this.element[0]).each(function(){e(this).is(&quot;:checked&quot;)?e(this).button(&quot;widget&quot;).addClass(&quot;ui-state-active&quot;).attr(&quot;aria-pressed&quot;,&quot;true&quot;):e(this).button(&quot;widget&quot;).removeClass(&quot;ui-state-active&quot;).attr(&quot;aria-pressed&quot;,&quot;false&quot;)}):&quot;checkbox&quot;===this.type&amp;&amp;(this.element.is(&quot;:checked&quot;)?this.buttonElement.addClass(&quot;ui-state-active&quot;).attr(&quot;aria-pressed&quot;,&quot;true&quot;):this.buttonElement.removeClass(&quot;ui-state-active&quot;).attr(&quot;aria-pressed&quot;,&quot;false&quot;))},_resetButton:function(){if(&quot;input&quot;===this.type)return this.options.label&amp;&amp;this.element.val(this.options.label),void 0;var t=this.buttonElement.removeClass(f),i=e(&quot;&lt;span&gt;&lt;/span&gt;&quot;,this.document[0]).addClass(&quot;ui-button-text&quot;).html(this.options.label).appendTo(t.empty()).text(),s=this.options.icons,n=s.primary&amp;&amp;s.secondary,a=[];s.primary||s.secondary?(this.options.text&amp;&amp;a.push(&quot;ui-button-text-icon&quot;+(n?&quot;s&quot;:s.primary?&quot;-primary&quot;:&quot;-secondary&quot;)),s.primary&amp;&amp;t.prepend(&quot;&lt;span class='ui-button-icon-primary ui-icon &quot;+s.primary+&quot;'&gt;&lt;/span&gt;&quot;),s.secondary&amp;&amp;t.append(&quot;&lt;span class='ui-button-icon-secondary ui-icon &quot;+s.secondary+&quot;'&gt;&lt;/span&gt;&quot;),this.options.text||(a.push(n?&quot;ui-button-icons-only&quot;:&quot;ui-button-icon-only&quot;),this.hasTitle||t.attr(&quot;title&quot;,e.trim(i)))):a.push(&quot;ui-button-text-only&quot;),t.addClass(a.join(&quot; &quot;))}}),e.widget(&quot;ui.buttonset&quot;,{version:&quot;1.11.4&quot;,options:{items:&quot;button, input[type=button], input[type=submit], input[type=reset], input[type=checkbox], input[type=radio], a, :data(ui-button)&quot;},_create:function(){this.element.addClass(&quot;ui-buttonset&quot;)},_init:function(){this.refresh()},_setOption:function(e,t){&quot;disabled&quot;===e&amp;&amp;this.buttons.button(&quot;option&quot;,e,t),this._super(e,t)},refresh:function(){var t=&quot;rtl&quot;===this.element.css(&quot;direction&quot;),i=this.element.find(this.options.items),s=i.filter(&quot;:ui-button&quot;);i.not(&quot;:ui-button&quot;).button(),s.button(&quot;refresh&quot;),this.buttons=i.map(function(){return e(this).button(&quot;widget&quot;)[0]}).removeClass(&quot;ui-corner-all ui-corner-left ui-corner-right&quot;).filter(&quot;:first&quot;).addClass(t?&quot;ui-corner-right&quot;:&quot;ui-corner-left&quot;).end().filter(&quot;:last&quot;).addClass(t?&quot;ui-corner-left&quot;:&quot;ui-corner-right&quot;).end().end()},_destroy:function(){this.element.removeClass(&quot;ui-buttonset&quot;),this.buttons.map(function(){return e(this).button(&quot;widget&quot;)[0]}).removeClass(&quot;ui-corner-left ui-corner-right&quot;).end().button(&quot;destroy&quot;)}}),e.ui.button,e.extend(e.ui,{datepicker:{version:&quot;1.11.4&quot;}});var v;e.extend(n.prototype,{markerClassName:&quot;hasDatepicker&quot;,maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return r(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var s,n,a;s=t.nodeName.toLowerCase(),n=&quot;div&quot;===s||&quot;span&quot;===s,t.id||(this.uuid+=1,t.id=&quot;dp&quot;+this.uuid),a=this._newInst(e(t),n),a.settings=e.extend({},i||{}),&quot;input&quot;===s?this._connectDatepicker(t,a):n&amp;&amp;this._inlineDatepicker(t,a)},_newInst:function(t,i){var s=t[0].id.replace(/([^A-Za-z0-9_\-])/g,&quot;\\\\$1&quot;);return{id:s,input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e(&quot;&lt;div class='&quot;+this._inlineClass+&quot; ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'&gt;&lt;/div&gt;&quot;)):this.dpDiv}},_connectDatepicker:function(t,i){var s=e(t);i.append=e([]),i.trigger=e([]),s.hasClass(this.markerClassName)||(this._attachments(s,i),s.addClass(this.markerClassName).keydown(this._doKeyDown).keypress(this._doKeyPress).keyup(this._doKeyUp),this._autoSize(i),e.data(t,&quot;datepicker&quot;,i),i.settings.disabled&amp;&amp;this._disableDatepicker(t))},_attachments:function(t,i){var s,n,a,o=this._get(i,&quot;appendText&quot;),r=this._get(i,&quot;isRTL&quot;);i.append&amp;&amp;i.append.remove(),o&amp;&amp;(i.append=e(&quot;&lt;span class='&quot;+this._appendClass+&quot;'&gt;&quot;+o+&quot;&lt;/span&gt;&quot;),t[r?&quot;before&quot;:&quot;after&quot;](i.append)),t.unbind(&quot;focus&quot;,this._showDatepicker),i.trigger&amp;&amp;i.trigger.remove(),s=this._get(i,&quot;showOn&quot;),(&quot;focus&quot;===s||&quot;both&quot;===s)&amp;&amp;t.focus(this._showDatepicker),(&quot;button&quot;===s||&quot;both&quot;===s)&amp;&amp;(n=this._get(i,&quot;buttonText&quot;),a=this._get(i,&quot;buttonImage&quot;),i.trigger=e(this._get(i,&quot;buttonImageOnly&quot;)?e(&quot;&lt;img/&gt;&quot;).addClass(this._triggerClass).attr({src:a,alt:n,title:n}):e(&quot;&lt;button type='button'&gt;&lt;/button&gt;&quot;).addClass(this._triggerClass).html(a?e(&quot;&lt;img/&gt;&quot;).attr({src:a,alt:n,title:n}):n)),t[r?&quot;before&quot;:&quot;after&quot;](i.trigger),i.trigger.click(function(){return e.datepicker._datepickerShowing&amp;&amp;e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&amp;&amp;e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1}))},_autoSize:function(e){if(this._get(e,&quot;autoSize&quot;)&amp;&amp;!e.inline){var t,i,s,n,a=new Date(2009,11,20),o=this._get(e,&quot;dateFormat&quot;);o.match(/[DM]/)&amp;&amp;(t=function(e){for(i=0,s=0,n=0;e.length&gt;n;n++)e[n].length&gt;i&amp;&amp;(i=e[n].length,s=n);return s},a.setMonth(t(this._get(e,o.match(/MM/)?&quot;monthNames&quot;:&quot;monthNamesShort&quot;))),a.setDate(t(this._get(e,o.match(/DD/)?&quot;dayNames&quot;:&quot;dayNamesShort&quot;))+20-a.getDay())),e.input.attr(&quot;size&quot;,this._formatDate(e,a).length)}},_inlineDatepicker:function(t,i){var s=e(t);s.hasClass(this.markerClassName)||(s.addClass(this.markerClassName).append(i.dpDiv),e.data(t,&quot;datepicker&quot;,i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&amp;&amp;this._disableDatepicker(t),i.dpDiv.css(&quot;display&quot;,&quot;block&quot;))},_dialogDatepicker:function(t,i,s,n,a){var o,h,l,u,d,c=this._dialogInst;return c||(this.uuid+=1,o=&quot;dp&quot;+this.uuid,this._dialogInput=e(&quot;&lt;input type='text' id='&quot;+o+&quot;' style='position: absolute; top: -100px; width: 0px;'/&gt;&quot;),this._dialogInput.keydown(this._doKeyDown),e(&quot;body&quot;).append(this._dialogInput),c=this._dialogInst=this._newInst(this._dialogInput,!1),c.settings={},e.data(this._dialogInput[0],&quot;datepicker&quot;,c)),r(c.settings,n||{}),i=i&amp;&amp;i.constructor===Date?this._formatDate(c,i):i,this._dialogInput.val(i),this._pos=a?a.length?a:[a.pageX,a.pageY]:null,this._pos||(h=document.documentElement.clientWidth,l=document.documentElement.clientHeight,u=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[h/2-100+u,l/2-150+d]),this._dialogInput.css(&quot;left&quot;,this._pos[0]+20+&quot;px&quot;).css(&quot;top&quot;,this._pos[1]+&quot;px&quot;),c.settings.onSelect=s,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&amp;&amp;e.blockUI(this.dpDiv),e.data(this._dialogInput[0],&quot;datepicker&quot;,c),this},_destroyDatepicker:function(t){var i,s=e(t),n=e.data(t,&quot;datepicker&quot;);s.hasClass(this.markerClassName)&amp;&amp;(i=t.nodeName.toLowerCase(),e.removeData(t,&quot;datepicker&quot;),&quot;input&quot;===i?(n.append.remove(),n.trigger.remove(),s.removeClass(this.markerClassName).unbind(&quot;focus&quot;,this._showDatepicker).unbind(&quot;keydown&quot;,this._doKeyDown).unbind(&quot;keypress&quot;,this._doKeyPress).unbind(&quot;keyup&quot;,this._doKeyUp)):(&quot;div&quot;===i||&quot;span&quot;===i)&amp;&amp;s.removeClass(this.markerClassName).empty(),v===n&amp;&amp;(v=null))},_enableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,&quot;datepicker&quot;);n.hasClass(this.markerClassName)&amp;&amp;(i=t.nodeName.toLowerCase(),&quot;input&quot;===i?(t.disabled=!1,a.trigger.filter(&quot;button&quot;).each(function(){this.disabled=!1}).end().filter(&quot;img&quot;).css({opacity:&quot;1.0&quot;,cursor:&quot;&quot;})):(&quot;div&quot;===i||&quot;span&quot;===i)&amp;&amp;(s=n.children(&quot;.&quot;+this._inlineClass),s.children().removeClass(&quot;ui-state-disabled&quot;),s.find(&quot;select.ui-datepicker-month, select.ui-datepicker-year&quot;).prop(&quot;disabled&quot;,!1)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}))},_disableDatepicker:function(t){var i,s,n=e(t),a=e.data(t,&quot;datepicker&quot;);n.hasClass(this.markerClassName)&amp;&amp;(i=t.nodeName.toLowerCase(),&quot;input&quot;===i?(t.disabled=!0,a.trigger.filter(&quot;button&quot;).each(function(){this.disabled=!0}).end().filter(&quot;img&quot;).css({opacity:&quot;0.5&quot;,cursor:&quot;default&quot;})):(&quot;div&quot;===i||&quot;span&quot;===i)&amp;&amp;(s=n.children(&quot;.&quot;+this._inlineClass),s.children().addClass(&quot;ui-state-disabled&quot;),s.find(&quot;select.ui-datepicker-month, select.ui-datepicker-year&quot;).prop(&quot;disabled&quot;,!0)),this._disabledInputs=e.map(this._disabledInputs,function(e){return e===t?null:e}),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;this._disabledInputs.length&gt;t;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,&quot;datepicker&quot;)}catch(i){throw&quot;Missing instance data for this datepicker&quot;}},_optionDatepicker:function(t,i,s){var n,a,o,h,l=this._getInst(t);return 2===arguments.length&amp;&amp;&quot;string&quot;==typeof i?&quot;defaults&quot;===i?e.extend({},e.datepicker._defaults):l?&quot;all&quot;===i?e.extend({},l.settings):this._get(l,i):null:(n=i||{},&quot;string&quot;==typeof i&amp;&amp;(n={},n[i]=s),l&amp;&amp;(this._curInst===l&amp;&amp;this._hideDatepicker(),a=this._getDateDatepicker(t,!0),o=this._getMinMaxDate(l,&quot;min&quot;),h=this._getMinMaxDate(l,&quot;max&quot;),r(l.settings,n),null!==o&amp;&amp;void 0!==n.dateFormat&amp;&amp;void 0===n.minDate&amp;&amp;(l.settings.minDate=this._formatDate(l,o)),null!==h&amp;&amp;void 0!==n.dateFormat&amp;&amp;void 0===n.maxDate&amp;&amp;(l.settings.maxDate=this._formatDate(l,h)),&quot;disabled&quot;in n&amp;&amp;(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),l),this._autoSize(l),this._setDate(l,a),this._updateAlternate(l),this._updateDatepicker(l)),void 0)},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&amp;&amp;this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&amp;&amp;(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&amp;&amp;!i.inline&amp;&amp;this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,s,n,a=e.datepicker._getInst(t.target),o=!0,r=a.dpDiv.is(&quot;.ui-datepicker-rtl&quot;);if(a._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return n=e(&quot;td.&quot;+e.datepicker._dayOverClass+&quot;:not(.&quot;+e.datepicker._currentClass+&quot;)&quot;,a.dpDiv),n[0]&amp;&amp;e.datepicker._selectDay(t.target,a.selectedMonth,a.selectedYear,n[0]),i=e.datepicker._get(a,&quot;onSelect&quot;),i?(s=e.datepicker._formatDate(a),i.apply(a.input?a.input[0]:null,[s,a])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,&quot;stepBigMonths&quot;):-e.datepicker._get(a,&quot;stepMonths&quot;),&quot;M&quot;);break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,&quot;stepBigMonths&quot;):+e.datepicker._get(a,&quot;stepMonths&quot;),&quot;M&quot;);break;case 35:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._adjustDate(t.target,r?1:-1,&quot;D&quot;),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&amp;&amp;e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(a,&quot;stepBigMonths&quot;):-e.datepicker._get(a,&quot;stepMonths&quot;),&quot;M&quot;);break;case 38:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._adjustDate(t.target,-7,&quot;D&quot;),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._adjustDate(t.target,r?-1:1,&quot;D&quot;),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&amp;&amp;e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(a,&quot;stepBigMonths&quot;):+e.datepicker._get(a,&quot;stepMonths&quot;),&quot;M&quot;);break;case 40:(t.ctrlKey||t.metaKey)&amp;&amp;e.datepicker._adjustDate(t.target,7,&quot;D&quot;),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&amp;&amp;t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&amp;&amp;(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,s,n=e.datepicker._getInst(t.target);
return e.datepicker._get(n,&quot;constrainInput&quot;)?(i=e.datepicker._possibleChars(e.datepicker._get(n,&quot;dateFormat&quot;)),s=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||&quot; &quot;&gt;s||!i||i.indexOf(s)&gt;-1):void 0},_doKeyUp:function(t){var i,s=e.datepicker._getInst(t.target);if(s.input.val()!==s.lastVal)try{i=e.datepicker.parseDate(e.datepicker._get(s,&quot;dateFormat&quot;),s.input?s.input.val():null,e.datepicker._getFormatConfig(s)),i&amp;&amp;(e.datepicker._setDateFromField(s),e.datepicker._updateAlternate(s),e.datepicker._updateDatepicker(s))}catch(n){}return!0},_showDatepicker:function(t){if(t=t.target||t,&quot;input&quot;!==t.nodeName.toLowerCase()&amp;&amp;(t=e(&quot;input&quot;,t.parentNode)[0]),!e.datepicker._isDisabledDatepicker(t)&amp;&amp;e.datepicker._lastInput!==t){var i,n,a,o,h,l,u;i=e.datepicker._getInst(t),e.datepicker._curInst&amp;&amp;e.datepicker._curInst!==i&amp;&amp;(e.datepicker._curInst.dpDiv.stop(!0,!0),i&amp;&amp;e.datepicker._datepickerShowing&amp;&amp;e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),n=e.datepicker._get(i,&quot;beforeShow&quot;),a=n?n.apply(t,[t,i]):{},a!==!1&amp;&amp;(r(i.settings,a),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&amp;&amp;(t.value=&quot;&quot;),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each(function(){return o|=&quot;fixed&quot;===e(this).css(&quot;position&quot;),!o}),h={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:&quot;absolute&quot;,display:&quot;block&quot;,top:&quot;-1000px&quot;}),e.datepicker._updateDatepicker(i),h=e.datepicker._checkOffset(i,h,o),i.dpDiv.css({position:e.datepicker._inDialog&amp;&amp;e.blockUI?&quot;static&quot;:o?&quot;fixed&quot;:&quot;absolute&quot;,display:&quot;none&quot;,left:h.left+&quot;px&quot;,top:h.top+&quot;px&quot;}),i.inline||(l=e.datepicker._get(i,&quot;showAnim&quot;),u=e.datepicker._get(i,&quot;duration&quot;),i.dpDiv.css(&quot;z-index&quot;,s(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&amp;&amp;e.effects.effect[l]?i.dpDiv.show(l,e.datepicker._get(i,&quot;showOptions&quot;),u):i.dpDiv[l||&quot;show&quot;](l?u:null),e.datepicker._shouldFocusInput(i)&amp;&amp;i.input.focus(),e.datepicker._curInst=i))}},_updateDatepicker:function(t){this.maxRows=4,v=t,t.dpDiv.empty().append(this._generateHTML(t)),this._attachHandlers(t);var i,s=this._getNumberOfMonths(t),n=s[1],a=17,r=t.dpDiv.find(&quot;.&quot;+this._dayOverClass+&quot; a&quot;);r.length&gt;0&amp;&amp;o.apply(r.get(0)),t.dpDiv.removeClass(&quot;ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4&quot;).width(&quot;&quot;),n&gt;1&amp;&amp;t.dpDiv.addClass(&quot;ui-datepicker-multi-&quot;+n).css(&quot;width&quot;,a*n+&quot;em&quot;),t.dpDiv[(1!==s[0]||1!==s[1]?&quot;add&quot;:&quot;remove&quot;)+&quot;Class&quot;](&quot;ui-datepicker-multi&quot;),t.dpDiv[(this._get(t,&quot;isRTL&quot;)?&quot;add&quot;:&quot;remove&quot;)+&quot;Class&quot;](&quot;ui-datepicker-rtl&quot;),t===e.datepicker._curInst&amp;&amp;e.datepicker._datepickerShowing&amp;&amp;e.datepicker._shouldFocusInput(t)&amp;&amp;t.input.focus(),t.yearshtml&amp;&amp;(i=t.yearshtml,setTimeout(function(){i===t.yearshtml&amp;&amp;t.yearshtml&amp;&amp;t.dpDiv.find(&quot;select.ui-datepicker-year:first&quot;).replaceWith(t.yearshtml),i=t.yearshtml=null},0))},_shouldFocusInput:function(e){return e.input&amp;&amp;e.input.is(&quot;:visible&quot;)&amp;&amp;!e.input.is(&quot;:disabled&quot;)&amp;&amp;!e.input.is(&quot;:focus&quot;)},_checkOffset:function(t,i,s){var n=t.dpDiv.outerWidth(),a=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,r=t.input?t.input.outerHeight():0,h=document.documentElement.clientWidth+(s?0:e(document).scrollLeft()),l=document.documentElement.clientHeight+(s?0:e(document).scrollTop());return i.left-=this._get(t,&quot;isRTL&quot;)?n-o:0,i.left-=s&amp;&amp;i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=s&amp;&amp;i.top===t.input.offset().top+r?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n&gt;h&amp;&amp;h&gt;n?Math.abs(i.left+n-h):0),i.top-=Math.min(i.top,i.top+a&gt;l&amp;&amp;l&gt;a?Math.abs(a+r):0),i},_findPos:function(t){for(var i,s=this._getInst(t),n=this._get(s,&quot;isRTL&quot;);t&amp;&amp;(&quot;hidden&quot;===t.type||1!==t.nodeType||e.expr.filters.hidden(t));)t=t[n?&quot;previousSibling&quot;:&quot;nextSibling&quot;];return i=e(t).offset(),[i.left,i.top]},_hideDatepicker:function(t){var i,s,n,a,o=this._curInst;!o||t&amp;&amp;o!==e.data(t,&quot;datepicker&quot;)||this._datepickerShowing&amp;&amp;(i=this._get(o,&quot;showAnim&quot;),s=this._get(o,&quot;duration&quot;),n=function(){e.datepicker._tidyDialog(o)},e.effects&amp;&amp;(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,&quot;showOptions&quot;),s,n):o.dpDiv[&quot;slideDown&quot;===i?&quot;slideUp&quot;:&quot;fadeIn&quot;===i?&quot;fadeOut&quot;:&quot;hide&quot;](i?s:null,n),i||n(),this._datepickerShowing=!1,a=this._get(o,&quot;onClose&quot;),a&amp;&amp;a.apply(o.input?o.input[0]:null,[o.input?o.input.val():&quot;&quot;,o]),this._lastInput=null,this._inDialog&amp;&amp;(this._dialogInput.css({position:&quot;absolute&quot;,left:&quot;0&quot;,top:&quot;-100px&quot;}),e.blockUI&amp;&amp;(e.unblockUI(),e(&quot;body&quot;).append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).unbind(&quot;.ui-datepicker-calendar&quot;)},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),s=e.datepicker._getInst(i[0]);(i[0].id!==e.datepicker._mainDivId&amp;&amp;0===i.parents(&quot;#&quot;+e.datepicker._mainDivId).length&amp;&amp;!i.hasClass(e.datepicker.markerClassName)&amp;&amp;!i.closest(&quot;.&quot;+e.datepicker._triggerClass).length&amp;&amp;e.datepicker._datepickerShowing&amp;&amp;(!e.datepicker._inDialog||!e.blockUI)||i.hasClass(e.datepicker.markerClassName)&amp;&amp;e.datepicker._curInst!==s)&amp;&amp;e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,s){var n=e(t),a=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(a,i+(&quot;M&quot;===s?this._get(a,&quot;showCurrentAtPos&quot;):0),s),this._updateDatepicker(a))},_gotoToday:function(t){var i,s=e(t),n=this._getInst(s[0]);this._get(n,&quot;gotoCurrent&quot;)&amp;&amp;n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(s)},_selectMonthYear:function(t,i,s){var n=e(t),a=this._getInst(n[0]);a[&quot;selected&quot;+(&quot;M&quot;===s?&quot;Month&quot;:&quot;Year&quot;)]=a[&quot;draw&quot;+(&quot;M&quot;===s?&quot;Month&quot;:&quot;Year&quot;)]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(a),this._adjustDate(n)},_selectDay:function(t,i,s,n){var a,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||(a=this._getInst(o[0]),a.selectedDay=a.currentDay=e(&quot;a&quot;,n).html(),a.selectedMonth=a.currentMonth=i,a.selectedYear=a.currentYear=s,this._selectDate(t,this._formatDate(a,a.currentDay,a.currentMonth,a.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,&quot;&quot;)},_selectDate:function(t,i){var s,n=e(t),a=this._getInst(n[0]);i=null!=i?i:this._formatDate(a),a.input&amp;&amp;a.input.val(i),this._updateAlternate(a),s=this._get(a,&quot;onSelect&quot;),s?s.apply(a.input?a.input[0]:null,[i,a]):a.input&amp;&amp;a.input.trigger(&quot;change&quot;),a.inline?this._updateDatepicker(a):(this._hideDatepicker(),this._lastInput=a.input[0],&quot;object&quot;!=typeof a.input[0]&amp;&amp;a.input.focus(),this._lastInput=null)},_updateAlternate:function(t){var i,s,n,a=this._get(t,&quot;altField&quot;);a&amp;&amp;(i=this._get(t,&quot;altFormat&quot;)||this._get(t,&quot;dateFormat&quot;),s=this._getDate(t),n=this.formatDate(i,s,this._getFormatConfig(t)),e(a).each(function(){e(this).val(n)}))},noWeekends:function(e){var t=e.getDay();return[t&gt;0&amp;&amp;6&gt;t,&quot;&quot;]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,s){if(null==t||null==i)throw&quot;Invalid arguments&quot;;if(i=&quot;object&quot;==typeof i?&quot;&quot;+i:i+&quot;&quot;,&quot;&quot;===i)return null;var n,a,o,r,h=0,l=(s?s.shortYearCutoff:null)||this._defaults.shortYearCutoff,u=&quot;string&quot;!=typeof l?l:(new Date).getFullYear()%100+parseInt(l,10),d=(s?s.dayNamesShort:null)||this._defaults.dayNamesShort,c=(s?s.dayNames:null)||this._defaults.dayNames,p=(s?s.monthNamesShort:null)||this._defaults.monthNamesShort,f=(s?s.monthNames:null)||this._defaults.monthNames,m=-1,g=-1,v=-1,y=-1,b=!1,_=function(e){var i=t.length&gt;n+1&amp;&amp;t.charAt(n+1)===e;return i&amp;&amp;n++,i},x=function(e){var t=_(e),s=&quot;@&quot;===e?14:&quot;!&quot;===e?20:&quot;y&quot;===e&amp;&amp;t?4:&quot;o&quot;===e?3:2,n=&quot;y&quot;===e?s:1,a=RegExp(&quot;^\\d{&quot;+n+&quot;,&quot;+s+&quot;}&quot;),o=i.substring(h).match(a);if(!o)throw&quot;Missing number at position &quot;+h;return h+=o[0].length,parseInt(o[0],10)},w=function(t,s,n){var a=-1,o=e.map(_(t)?n:s,function(e,t){return[[t,e]]}).sort(function(e,t){return-(e[1].length-t[1].length)});if(e.each(o,function(e,t){var s=t[1];return i.substr(h,s.length).toLowerCase()===s.toLowerCase()?(a=t[0],h+=s.length,!1):void 0}),-1!==a)return a+1;throw&quot;Unknown name at position &quot;+h},k=function(){if(i.charAt(h)!==t.charAt(n))throw&quot;Unexpected literal at position &quot;+h;h++};for(n=0;t.length&gt;n;n++)if(b)&quot;'&quot;!==t.charAt(n)||_(&quot;'&quot;)?k():b=!1;else switch(t.charAt(n)){case&quot;d&quot;:v=x(&quot;d&quot;);break;case&quot;D&quot;:w(&quot;D&quot;,d,c);break;case&quot;o&quot;:y=x(&quot;o&quot;);break;case&quot;m&quot;:g=x(&quot;m&quot;);break;case&quot;M&quot;:g=w(&quot;M&quot;,p,f);break;case&quot;y&quot;:m=x(&quot;y&quot;);break;case&quot;@&quot;:r=new Date(x(&quot;@&quot;)),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case&quot;!&quot;:r=new Date((x(&quot;!&quot;)-this._ticksTo1970)/1e4),m=r.getFullYear(),g=r.getMonth()+1,v=r.getDate();break;case&quot;'&quot;:_(&quot;'&quot;)?k():b=!0;break;default:k()}if(i.length&gt;h&amp;&amp;(o=i.substr(h),!/^\s+/.test(o)))throw&quot;Extra/unparsed characters found in date: &quot;+o;if(-1===m?m=(new Date).getFullYear():100&gt;m&amp;&amp;(m+=(new Date).getFullYear()-(new Date).getFullYear()%100+(u&gt;=m?0:-100)),y&gt;-1)for(g=1,v=y;;){if(a=this._getDaysInMonth(m,g-1),a&gt;=v)break;g++,v-=a}if(r=this._daylightSavingAdjust(new Date(m,g-1,v)),r.getFullYear()!==m||r.getMonth()+1!==g||r.getDate()!==v)throw&quot;Invalid date&quot;;return r},ATOM:&quot;yy-mm-dd&quot;,COOKIE:&quot;D, dd M yy&quot;,ISO_8601:&quot;yy-mm-dd&quot;,RFC_822:&quot;D, d M y&quot;,RFC_850:&quot;DD, dd-M-y&quot;,RFC_1036:&quot;D, d M y&quot;,RFC_1123:&quot;D, d M yy&quot;,RFC_2822:&quot;D, d M yy&quot;,RSS:&quot;D, d M y&quot;,TICKS:&quot;!&quot;,TIMESTAMP:&quot;@&quot;,W3C:&quot;yy-mm-dd&quot;,_ticksTo1970:1e7*60*60*24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925)),formatDate:function(e,t,i){if(!t)return&quot;&quot;;var s,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,a=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,r=(i?i.monthNames:null)||this._defaults.monthNames,h=function(t){var i=e.length&gt;s+1&amp;&amp;e.charAt(s+1)===t;return i&amp;&amp;s++,i},l=function(e,t,i){var s=&quot;&quot;+t;if(h(e))for(;i&gt;s.length;)s=&quot;0&quot;+s;return s},u=function(e,t,i,s){return h(e)?s[t]:i[t]},d=&quot;&quot;,c=!1;if(t)for(s=0;e.length&gt;s;s++)if(c)&quot;'&quot;!==e.charAt(s)||h(&quot;'&quot;)?d+=e.charAt(s):c=!1;else switch(e.charAt(s)){case&quot;d&quot;:d+=l(&quot;d&quot;,t.getDate(),2);break;case&quot;D&quot;:d+=u(&quot;D&quot;,t.getDay(),n,a);break;case&quot;o&quot;:d+=l(&quot;o&quot;,Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case&quot;m&quot;:d+=l(&quot;m&quot;,t.getMonth()+1,2);break;case&quot;M&quot;:d+=u(&quot;M&quot;,t.getMonth(),o,r);break;case&quot;y&quot;:d+=h(&quot;y&quot;)?t.getFullYear():(10&gt;t.getYear()%100?&quot;0&quot;:&quot;&quot;)+t.getYear()%100;break;case&quot;@&quot;:d+=t.getTime();break;case&quot;!&quot;:d+=1e4*t.getTime()+this._ticksTo1970;break;case&quot;'&quot;:h(&quot;'&quot;)?d+=&quot;'&quot;:c=!0;break;default:d+=e.charAt(s)}return d},_possibleChars:function(e){var t,i=&quot;&quot;,s=!1,n=function(i){var s=e.length&gt;t+1&amp;&amp;e.charAt(t+1)===i;return s&amp;&amp;t++,s};for(t=0;e.length&gt;t;t++)if(s)&quot;'&quot;!==e.charAt(t)||n(&quot;'&quot;)?i+=e.charAt(t):s=!1;else switch(e.charAt(t)){case&quot;d&quot;:case&quot;m&quot;:case&quot;y&quot;:case&quot;@&quot;:i+=&quot;0123456789&quot;;break;case&quot;D&quot;:case&quot;M&quot;:return null;case&quot;'&quot;:n(&quot;'&quot;)?i+=&quot;'&quot;:s=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,&quot;dateFormat&quot;),s=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),a=n,o=this._getFormatConfig(e);try{a=this.parseDate(i,s,o)||n}catch(r){s=t?&quot;&quot;:s}e.selectedDay=a.getDate(),e.drawMonth=e.selectedMonth=a.getMonth(),e.drawYear=e.selectedYear=a.getFullYear(),e.currentDay=s?a.getDate():0,e.currentMonth=s?a.getMonth():0,e.currentYear=s?a.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,&quot;defaultDate&quot;),new Date))},_determineDate:function(t,i,s){var n=function(e){var t=new Date;return t.setDate(t.getDate()+e),t},a=function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,&quot;dateFormat&quot;),i,e.datepicker._getFormatConfig(t))}catch(s){}for(var n=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,a=n.getFullYear(),o=n.getMonth(),r=n.getDate(),h=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,l=h.exec(i);l;){switch(l[2]||&quot;d&quot;){case&quot;d&quot;:case&quot;D&quot;:r+=parseInt(l[1],10);break;case&quot;w&quot;:case&quot;W&quot;:r+=7*parseInt(l[1],10);break;case&quot;m&quot;:case&quot;M&quot;:o+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o));break;case&quot;y&quot;:case&quot;Y&quot;:a+=parseInt(l[1],10),r=Math.min(r,e.datepicker._getDaysInMonth(a,o))}l=h.exec(i)}return new Date(a,o,r)},o=null==i||&quot;&quot;===i?s:&quot;string&quot;==typeof i?a(i):&quot;number&quot;==typeof i?isNaN(i)?s:n(i):new Date(i.getTime());return o=o&amp;&amp;&quot;Invalid Date&quot;==&quot;&quot;+o?s:o,o&amp;&amp;(o.setHours(0),o.setMinutes(0),o.setSeconds(0),o.setMilliseconds(0)),this._daylightSavingAdjust(o)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()&gt;12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var s=!t,n=e.selectedMonth,a=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&amp;&amp;a===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&amp;&amp;e.input.val(s?&quot;&quot;:this._formatDate(e))},_getDate:function(e){var t=!e.currentYear||e.input&amp;&amp;&quot;&quot;===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return t},_attachHandlers:function(t){var i=this._get(t,&quot;stepMonths&quot;),s=&quot;#&quot;+t.id.replace(/\\\\/g,&quot;\\&quot;);t.dpDiv.find(&quot;[data-handler]&quot;).map(function(){var t={prev:function(){e.datepicker._adjustDate(s,-i,&quot;M&quot;)},next:function(){e.datepicker._adjustDate(s,+i,&quot;M&quot;)},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(s)},selectDay:function(){return e.datepicker._selectDay(s,+this.getAttribute(&quot;data-month&quot;),+this.getAttribute(&quot;data-year&quot;),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(s,this,&quot;M&quot;),!1},selectYear:function(){return e.datepicker._selectMonthYear(s,this,&quot;Y&quot;),!1}};e(this).bind(this.getAttribute(&quot;data-event&quot;),t[this.getAttribute(&quot;data-handler&quot;)])})},_generateHTML:function(e){var t,i,s,n,a,o,r,h,l,u,d,c,p,f,m,g,v,y,b,_,x,w,k,T,D,S,M,C,N,A,P,I,H,z,F,E,O,j,W,L=new Date,R=this._daylightSavingAdjust(new Date(L.getFullYear(),L.getMonth(),L.getDate())),Y=this._get(e,&quot;isRTL&quot;),B=this._get(e,&quot;showButtonPanel&quot;),J=this._get(e,&quot;hideIfNoPrevNext&quot;),q=this._get(e,&quot;navigationAsDateFormat&quot;),K=this._getNumberOfMonths(e),V=this._get(e,&quot;showCurrentAtPos&quot;),U=this._get(e,&quot;stepMonths&quot;),Q=1!==K[0]||1!==K[1],G=this._daylightSavingAdjust(e.currentDay?new Date(e.currentYear,e.currentMonth,e.currentDay):new Date(9999,9,9)),X=this._getMinMaxDate(e,&quot;min&quot;),$=this._getMinMaxDate(e,&quot;max&quot;),Z=e.drawMonth-V,et=e.drawYear;if(0&gt;Z&amp;&amp;(Z+=12,et--),$)for(t=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth()-K[0]*K[1]+1,$.getDate())),t=X&amp;&amp;X&gt;t?X:t;this._daylightSavingAdjust(new Date(et,Z,1))&gt;t;)Z--,0&gt;Z&amp;&amp;(Z=11,et--);for(e.drawMonth=Z,e.drawYear=et,i=this._get(e,&quot;prevText&quot;),i=q?this.formatDate(i,this._daylightSavingAdjust(new Date(et,Z-U,1)),this._getFormatConfig(e)):i,s=this._canAdjustMonth(e,-1,et,Z)?&quot;&lt;a class='ui-datepicker-prev ui-corner-all' data-handler='prev' data-event='click' title='&quot;+i+&quot;'&gt;&lt;span class='ui-icon ui-icon-circle-triangle-&quot;+(Y?&quot;e&quot;:&quot;w&quot;)+&quot;'&gt;&quot;+i+&quot;&lt;/span&gt;&lt;/a&gt;&quot;:J?&quot;&quot;:&quot;&lt;a class='ui-datepicker-prev ui-corner-all ui-state-disabled' title='&quot;+i+&quot;'&gt;&lt;span class='ui-icon ui-icon-circle-triangle-&quot;+(Y?&quot;e&quot;:&quot;w&quot;)+&quot;'&gt;&quot;+i+&quot;&lt;/span&gt;&lt;/a&gt;&quot;,n=this._get(e,&quot;nextText&quot;),n=q?this.formatDate(n,this._daylightSavingAdjust(new Date(et,Z+U,1)),this._getFormatConfig(e)):n,a=this._canAdjustMonth(e,1,et,Z)?&quot;&lt;a class='ui-datepicker-next ui-corner-all' data-handler='next' data-event='click' title='&quot;+n+&quot;'&gt;&lt;span class='ui-icon ui-icon-circle-triangle-&quot;+(Y?&quot;w&quot;:&quot;e&quot;)+&quot;'&gt;&quot;+n+&quot;&lt;/span&gt;&lt;/a&gt;&quot;:J?&quot;&quot;:&quot;&lt;a class='ui-datepicker-next ui-corner-all ui-state-disabled' title='&quot;+n+&quot;'&gt;&lt;span class='ui-icon ui-icon-circle-triangle-&quot;+(Y?&quot;w&quot;:&quot;e&quot;)+&quot;'&gt;&quot;+n+&quot;&lt;/span&gt;&lt;/a&gt;&quot;,o=this._get(e,&quot;currentText&quot;),r=this._get(e,&quot;gotoCurrent&quot;)&amp;&amp;e.currentDay?G:R,o=q?this.formatDate(o,r,this._getFormatConfig(e)):o,h=e.inline?&quot;&quot;:&quot;&lt;button type='button' class='ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all' data-handler='hide' data-event='click'&gt;&quot;+this._get(e,&quot;closeText&quot;)+&quot;&lt;/button&gt;&quot;,l=B?&quot;&lt;div class='ui-datepicker-buttonpane ui-widget-content'&gt;&quot;+(Y?h:&quot;&quot;)+(this._isInRange(e,r)?&quot;&lt;button type='button' class='ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all' data-handler='today' data-event='click'&gt;&quot;+o+&quot;&lt;/button&gt;&quot;:&quot;&quot;)+(Y?&quot;&quot;:h)+&quot;&lt;/div&gt;&quot;:&quot;&quot;,u=parseInt(this._get(e,&quot;firstDay&quot;),10),u=isNaN(u)?0:u,d=this._get(e,&quot;showWeek&quot;),c=this._get(e,&quot;dayNames&quot;),p=this._get(e,&quot;dayNamesMin&quot;),f=this._get(e,&quot;monthNames&quot;),m=this._get(e,&quot;monthNamesShort&quot;),g=this._get(e,&quot;beforeShowDay&quot;),v=this._get(e,&quot;showOtherMonths&quot;),y=this._get(e,&quot;selectOtherMonths&quot;),b=this._getDefaultDate(e),_=&quot;&quot;,w=0;K[0]&gt;w;w++){for(k=&quot;&quot;,this.maxRows=4,T=0;K[1]&gt;T;T++){if(D=this._daylightSavingAdjust(new Date(et,Z,e.selectedDay)),S=&quot; ui-corner-all&quot;,M=&quot;&quot;,Q){if(M+=&quot;&lt;div class='ui-datepicker-group&quot;,K[1]&gt;1)switch(T){case 0:M+=&quot; ui-datepicker-group-first&quot;,S=&quot; ui-corner-&quot;+(Y?&quot;right&quot;:&quot;left&quot;);break;case K[1]-1:M+=&quot; ui-datepicker-group-last&quot;,S=&quot; ui-corner-&quot;+(Y?&quot;left&quot;:&quot;right&quot;);break;default:M+=&quot; ui-datepicker-group-middle&quot;,S=&quot;&quot;}M+=&quot;'&gt;&quot;}for(M+=&quot;&lt;div class='ui-datepicker-header ui-widget-header ui-helper-clearfix&quot;+S+&quot;'&gt;&quot;+(/all|left/.test(S)&amp;&amp;0===w?Y?a:s:&quot;&quot;)+(/all|right/.test(S)&amp;&amp;0===w?Y?s:a:&quot;&quot;)+this._generateMonthYearHeader(e,Z,et,X,$,w&gt;0||T&gt;0,f,m)+&quot;&lt;/div&gt;&lt;table class='ui-datepicker-calendar'&gt;&lt;thead&gt;&quot;+&quot;&lt;tr&gt;&quot;,C=d?&quot;&lt;th class='ui-datepicker-week-col'&gt;&quot;+this._get(e,&quot;weekHeader&quot;)+&quot;&lt;/th&gt;&quot;:&quot;&quot;,x=0;7&gt;x;x++)N=(x+u)%7,C+=&quot;&lt;th scope='col'&quot;+((x+u+6)%7&gt;=5?&quot; class='ui-datepicker-week-end'&quot;:&quot;&quot;)+&quot;&gt;&quot;+&quot;&lt;span title='&quot;+c[N]+&quot;'&gt;&quot;+p[N]+&quot;&lt;/span&gt;&lt;/th&gt;&quot;;for(M+=C+&quot;&lt;/tr&gt;&lt;/thead&gt;&lt;tbody&gt;&quot;,A=this._getDaysInMonth(et,Z),et===e.selectedYear&amp;&amp;Z===e.selectedMonth&amp;&amp;(e.selectedDay=Math.min(e.selectedDay,A)),P=(this._getFirstDayOfMonth(et,Z)-u+7)%7,I=Math.ceil((P+A)/7),H=Q?this.maxRows&gt;I?this.maxRows:I:I,this.maxRows=H,z=this._daylightSavingAdjust(new Date(et,Z,1-P)),F=0;H&gt;F;F++){for(M+=&quot;&lt;tr&gt;&quot;,E=d?&quot;&lt;td class='ui-datepicker-week-col'&gt;&quot;+this._get(e,&quot;calculateWeek&quot;)(z)+&quot;&lt;/td&gt;&quot;:&quot;&quot;,x=0;7&gt;x;x++)O=g?g.apply(e.input?e.input[0]:null,[z]):[!0,&quot;&quot;],j=z.getMonth()!==Z,W=j&amp;&amp;!y||!O[0]||X&amp;&amp;X&gt;z||$&amp;&amp;z&gt;$,E+=&quot;&lt;td class='&quot;+((x+u+6)%7&gt;=5?&quot; ui-datepicker-week-end&quot;:&quot;&quot;)+(j?&quot; ui-datepicker-other-month&quot;:&quot;&quot;)+(z.getTime()===D.getTime()&amp;&amp;Z===e.selectedMonth&amp;&amp;e._keyEvent||b.getTime()===z.getTime()&amp;&amp;b.getTime()===D.getTime()?&quot; &quot;+this._dayOverClass:&quot;&quot;)+(W?&quot; &quot;+this._unselectableClass+&quot; ui-state-disabled&quot;:&quot;&quot;)+(j&amp;&amp;!v?&quot;&quot;:&quot; &quot;+O[1]+(z.getTime()===G.getTime()?&quot; &quot;+this._currentClass:&quot;&quot;)+(z.getTime()===R.getTime()?&quot; ui-datepicker-today&quot;:&quot;&quot;))+&quot;'&quot;+(j&amp;&amp;!v||!O[2]?&quot;&quot;:&quot; title='&quot;+O[2].replace(/'/g,&quot;&amp;#39;&quot;)+&quot;'&quot;)+(W?&quot;&quot;:&quot; data-handler='selectDay' data-event='click' data-month='&quot;+z.getMonth()+&quot;' data-year='&quot;+z.getFullYear()+&quot;'&quot;)+&quot;&gt;&quot;+(j&amp;&amp;!v?&quot;&amp;#xa0;&quot;:W?&quot;&lt;span class='ui-state-default'&gt;&quot;+z.getDate()+&quot;&lt;/span&gt;&quot;:&quot;&lt;a class='ui-state-default&quot;+(z.getTime()===R.getTime()?&quot; ui-state-highlight&quot;:&quot;&quot;)+(z.getTime()===G.getTime()?&quot; ui-state-active&quot;:&quot;&quot;)+(j?&quot; ui-priority-secondary&quot;:&quot;&quot;)+&quot;' href='#'&gt;&quot;+z.getDate()+&quot;&lt;/a&gt;&quot;)+&quot;&lt;/td&gt;&quot;,z.setDate(z.getDate()+1),z=this._daylightSavingAdjust(z);M+=E+&quot;&lt;/tr&gt;&quot;}Z++,Z&gt;11&amp;&amp;(Z=0,et++),M+=&quot;&lt;/tbody&gt;&lt;/table&gt;&quot;+(Q?&quot;&lt;/div&gt;&quot;+(K[0]&gt;0&amp;&amp;T===K[1]-1?&quot;&lt;div class='ui-datepicker-row-break'&gt;&lt;/div&gt;&quot;:&quot;&quot;):&quot;&quot;),k+=M}_+=k}return _+=l,e._keyEvent=!1,_},_generateMonthYearHeader:function(e,t,i,s,n,a,o,r){var h,l,u,d,c,p,f,m,g=this._get(e,&quot;changeMonth&quot;),v=this._get(e,&quot;changeYear&quot;),y=this._get(e,&quot;showMonthAfterYear&quot;),b=&quot;&lt;div class='ui-datepicker-title'&gt;&quot;,_=&quot;&quot;;if(a||!g)_+=&quot;&lt;span class='ui-datepicker-month'&gt;&quot;+o[t]+&quot;&lt;/span&gt;&quot;;else{for(h=s&amp;&amp;s.getFullYear()===i,l=n&amp;&amp;n.getFullYear()===i,_+=&quot;&lt;select class='ui-datepicker-month' data-handler='selectMonth' data-event='change'&gt;&quot;,u=0;12&gt;u;u++)(!h||u&gt;=s.getMonth())&amp;&amp;(!l||n.getMonth()&gt;=u)&amp;&amp;(_+=&quot;&lt;option value='&quot;+u+&quot;'&quot;+(u===t?&quot; selected='selected'&quot;:&quot;&quot;)+&quot;&gt;&quot;+r[u]+&quot;&lt;/option&gt;&quot;);_+=&quot;&lt;/select&gt;&quot;}if(y||(b+=_+(!a&amp;&amp;g&amp;&amp;v?&quot;&quot;:&quot;&amp;#xa0;&quot;)),!e.yearshtml)if(e.yearshtml=&quot;&quot;,a||!v)b+=&quot;&lt;span class='ui-datepicker-year'&gt;&quot;+i+&quot;&lt;/span&gt;&quot;;else{for(d=this._get(e,&quot;yearRange&quot;).split(&quot;:&quot;),c=(new Date).getFullYear(),p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?c+parseInt(e,10):parseInt(e,10);return isNaN(t)?c:t},f=p(d[0]),m=Math.max(f,p(d[1]||&quot;&quot;)),f=s?Math.max(f,s.getFullYear()):f,m=n?Math.min(m,n.getFullYear()):m,e.yearshtml+=&quot;&lt;select class='ui-datepicker-year' data-handler='selectYear' data-event='change'&gt;&quot;;m&gt;=f;f++)e.yearshtml+=&quot;&lt;option value='&quot;+f+&quot;'&quot;+(f===i?&quot; selected='selected'&quot;:&quot;&quot;)+&quot;&gt;&quot;+f+&quot;&lt;/option&gt;&quot;;e.yearshtml+=&quot;&lt;/select&gt;&quot;,b+=e.yearshtml,e.yearshtml=null}return b+=this._get(e,&quot;yearSuffix&quot;),y&amp;&amp;(b+=(!a&amp;&amp;g&amp;&amp;v?&quot;&quot;:&quot;&amp;#xa0;&quot;)+_),b+=&quot;&lt;/div&gt;&quot;},_adjustInstDate:function(e,t,i){var s=e.drawYear+(&quot;Y&quot;===i?t:0),n=e.drawMonth+(&quot;M&quot;===i?t:0),a=Math.min(e.selectedDay,this._getDaysInMonth(s,n))+(&quot;D&quot;===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(s,n,a)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),(&quot;M&quot;===i||&quot;Y&quot;===i)&amp;&amp;this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,&quot;min&quot;),s=this._getMinMaxDate(e,&quot;max&quot;),n=i&amp;&amp;i&gt;t?i:t;return s&amp;&amp;n&gt;s?s:n},_notifyChange:function(e){var t=this._get(e,&quot;onChangeMonthYear&quot;);t&amp;&amp;t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,&quot;numberOfMonths&quot;);return null==t?[1,1]:&quot;number&quot;==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+&quot;Date&quot;),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,s){var n=this._getNumberOfMonths(e),a=this._daylightSavingAdjust(new Date(i,s+(0&gt;t?t:n[0]*n[1]),1));return 0&gt;t&amp;&amp;a.setDate(this._getDaysInMonth(a.getFullYear(),a.getMonth())),this._isInRange(e,a)},_isInRange:function(e,t){var i,s,n=this._getMinMaxDate(e,&quot;min&quot;),a=this._getMinMaxDate(e,&quot;max&quot;),o=null,r=null,h=this._get(e,&quot;yearRange&quot;);return h&amp;&amp;(i=h.split(&quot;:&quot;),s=(new Date).getFullYear(),o=parseInt(i[0],10),r=parseInt(i[1],10),i[0].match(/[+\-].*/)&amp;&amp;(o+=s),i[1].match(/[+\-].*/)&amp;&amp;(r+=s)),(!n||t.getTime()&gt;=n.getTime())&amp;&amp;(!a||t.getTime()&lt;=a.getTime())&amp;&amp;(!o||t.getFullYear()&gt;=o)&amp;&amp;(!r||r&gt;=t.getFullYear())},_getFormatConfig:function(e){var t=this._get(e,&quot;shortYearCutoff&quot;);return t=&quot;string&quot;!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),{shortYearCutoff:t,dayNamesShort:this._get(e,&quot;dayNamesShort&quot;),dayNames:this._get(e,&quot;dayNames&quot;),monthNamesShort:this._get(e,&quot;monthNamesShort&quot;),monthNames:this._get(e,&quot;monthNames&quot;)}},_formatDate:function(e,t,i,s){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?&quot;object&quot;==typeof t?t:this._daylightSavingAdjust(new Date(s,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,&quot;dateFormat&quot;),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).mousedown(e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e(&quot;#&quot;+e.datepicker._mainDivId).length&amp;&amp;e(&quot;body&quot;).append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return&quot;string&quot;!=typeof t||&quot;isDisabled&quot;!==t&amp;&amp;&quot;getDate&quot;!==t&amp;&amp;&quot;widget&quot;!==t?&quot;option&quot;===t&amp;&amp;2===arguments.length&amp;&amp;&quot;string&quot;==typeof arguments[1]?e.datepicker[&quot;_&quot;+t+&quot;Datepicker&quot;].apply(e.datepicker,[this[0]].concat(i)):this.each(function(){&quot;string&quot;==typeof t?e.datepicker[&quot;_&quot;+t+&quot;Datepicker&quot;].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)}):e.datepicker[&quot;_&quot;+t+&quot;Datepicker&quot;].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new n,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version=&quot;1.11.4&quot;,e.datepicker,e.widget(&quot;ui.draggable&quot;,e.ui.mouse,{version:&quot;1.11.4&quot;,widgetEventPrefix:&quot;drag&quot;,options:{addClasses:!0,appendTo:&quot;parent&quot;,axis:!1,connectToSortable:!1,containment:!1,cursor:&quot;auto&quot;,cursorAt:!1,grid:!1,handle:!1,helper:&quot;original&quot;,iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:&quot;default&quot;,scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:&quot;both&quot;,snapTolerance:20,stack:!1,zIndex:!1,drag:null,start:null,stop:null},_create:function(){&quot;original&quot;===this.options.helper&amp;&amp;this._setPositionRelative(),this.options.addClasses&amp;&amp;this.element.addClass(&quot;ui-draggable&quot;),this.options.disabled&amp;&amp;this.element.addClass(&quot;ui-draggable-disabled&quot;),this._setHandleClassName(),this._mouseInit()},_setOption:function(e,t){this._super(e,t),&quot;handle&quot;===e&amp;&amp;(this._removeHandleClassName(),this._setHandleClassName())},_destroy:function(){return(this.helper||this.element).is(&quot;.ui-draggable-dragging&quot;)?(this.destroyOnClear=!0,void 0):(this.element.removeClass(&quot;ui-draggable ui-draggable-dragging ui-draggable-disabled&quot;),this._removeHandleClassName(),this._mouseDestroy(),void 0)},_mouseCapture:function(t){var i=this.options;return this._blurActiveElement(t),this.helper||i.disabled||e(t.target).closest(&quot;.ui-resizable-handle&quot;).length&gt;0?!1:(this.handle=this._getHandle(t),this.handle?(this._blockFrames(i.iframeFix===!0?&quot;iframe&quot;:i.iframeFix),!0):!1)},_blockFrames:function(t){this.iframeBlocks=this.document.find(t).map(function(){var t=e(this);return e(&quot;&lt;div&gt;&quot;).css(&quot;position&quot;,&quot;absolute&quot;).appendTo(t.parent()).outerWidth(t.outerWidth()).outerHeight(t.outerHeight()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&amp;&amp;(this.iframeBlocks.remove(),delete this.iframeBlocks)},_blurActiveElement:function(t){var i=this.document[0];if(this.handleElement.is(t.target))try{i.activeElement&amp;&amp;&quot;body&quot;!==i.activeElement.nodeName.toLowerCase()&amp;&amp;e(i.activeElement).blur()}catch(s){}},_mouseStart:function(t){var i=this.options;return this.helper=this._createHelper(t),this.helper.addClass(&quot;ui-draggable-dragging&quot;),this._cacheHelperProportions(),e.ui.ddmanager&amp;&amp;(e.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css(&quot;position&quot;),this.scrollParent=this.helper.scrollParent(!0),this.offsetParent=this.helper.offsetParent(),this.hasFixedAncestor=this.helper.parents().filter(function(){return&quot;fixed&quot;===e(this).css(&quot;position&quot;)}).length&gt;0,this.positionAbs=this.element.offset(),this._refreshOffsets(t),this.originalPosition=this.position=this._generatePosition(t,!1),this.originalPageX=t.pageX,this.originalPageY=t.pageY,i.cursorAt&amp;&amp;this._adjustOffsetFromHelper(i.cursorAt),this._setContainment(),this._trigger(&quot;start&quot;,t)===!1?(this._clear(),!1):(this._cacheHelperProportions(),e.ui.ddmanager&amp;&amp;!i.dropBehaviour&amp;&amp;e.ui.ddmanager.prepareOffsets(this,t),this._normalizeRightBottom(),this._mouseDrag(t,!0),e.ui.ddmanager&amp;&amp;e.ui.ddmanager.dragStart(this,t),!0)},_refreshOffsets:function(e){this.offset={top:this.positionAbs.top-this.margins.top,left:this.positionAbs.left-this.margins.left,scroll:!1,parent:this._getParentOffset(),relative:this._getRelativeOffset()},this.offset.click={left:e.pageX-this.offset.left,top:e.pageY-this.offset.top}},_mouseDrag:function(t,i){if(this.hasFixedAncestor&amp;&amp;(this.offset.parent=this._getParentOffset()),this.position=this._generatePosition(t,!0),this.positionAbs=this._convertPositionTo(&quot;absolute&quot;),!i){var s=this._uiHash();if(this._trigger(&quot;drag&quot;,t,s)===!1)return this._mouseUp({}),!1;this.position=s.position}return this.helper[0].style.left=this.position.left+&quot;px&quot;,this.helper[0].style.top=this.position.top+&quot;px&quot;,e.ui.ddmanager&amp;&amp;e.ui.ddmanager.drag(this,t),!1},_mouseStop:function(t){var i=this,s=!1;return e.ui.ddmanager&amp;&amp;!this.options.dropBehaviour&amp;&amp;(s=e.ui.ddmanager.drop(this,t)),this.dropped&amp;&amp;(s=this.dropped,this.dropped=!1),&quot;invalid&quot;===this.options.revert&amp;&amp;!s||&quot;valid&quot;===this.options.revert&amp;&amp;s||this.options.revert===!0||e.isFunction(this.options.revert)&amp;&amp;this.options.revert.call(this.element,s)?e(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){i._trigger(&quot;stop&quot;,t)!==!1&amp;&amp;i._clear()}):this._trigger(&quot;stop&quot;,t)!==!1&amp;&amp;this._clear(),!1},_mouseUp:function(t){return this._unblockFrames(),e.ui.ddmanager&amp;&amp;e.ui.ddmanager.dragStop(this,t),this.handleElement.is(t.target)&amp;&amp;this.element.focus(),e.ui.mouse.prototype._mouseUp.call(this,t)},cancel:function(){return this.helper.is(&quot;.ui-draggable-dragging&quot;)?this._mouseUp({}):this._clear(),this},_getHandle:function(t){return this.options.handle?!!e(t.target).closest(this.element.find(this.options.handle)).length:!0},_setHandleClassName:function(){this.handleElement=this.options.handle?this.element.find(this.options.handle):this.element,this.handleElement.addClass(&quot;ui-draggable-handle&quot;)},_removeHandleClassName:function(){this.handleElement.removeClass(&quot;ui-draggable-handle&quot;)},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper),n=s?e(i.helper.apply(this.element[0],[t])):&quot;clone&quot;===i.helper?this.element.clone().removeAttr(&quot;id&quot;):this.element;return n.parents(&quot;body&quot;).length||n.appendTo(&quot;parent&quot;===i.appendTo?this.element[0].parentNode:i.appendTo),s&amp;&amp;n[0]===this.element[0]&amp;&amp;this._setPositionRelative(),n[0]===this.element[0]||/(fixed|absolute)/.test(n.css(&quot;position&quot;))||n.css(&quot;position&quot;,&quot;absolute&quot;),n},_setPositionRelative:function(){/^(?:r|a|f)/.test(this.element.css(&quot;position&quot;))||(this.element[0].style.position=&quot;relative&quot;)},_adjustOffsetFromHelper:function(t){&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;)),e.isArray(t)&amp;&amp;(t={left:+t[0],top:+t[1]||0}),&quot;left&quot;in t&amp;&amp;(this.offset.click.left=t.left+this.margins.left),&quot;right&quot;in t&amp;&amp;(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),&quot;top&quot;in t&amp;&amp;(this.offset.click.top=t.top+this.margins.top),&quot;bottom&quot;in t&amp;&amp;(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_isRootNode:function(e){return/(html|body)/i.test(e.tagName)||e===this.document[0]},_getParentOffset:function(){var t=this.offsetParent.offset(),i=this.document[0];return&quot;absolute&quot;===this.cssPosition&amp;&amp;this.scrollParent[0]!==i&amp;&amp;e.contains(this.scrollParent[0],this.offsetParent[0])&amp;&amp;(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),this._isRootNode(this.offsetParent[0])&amp;&amp;(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css(&quot;borderTopWidth&quot;),10)||0),left:t.left+(parseInt(this.offsetParent.css(&quot;borderLeftWidth&quot;),10)||0)}},_getRelativeOffset:function(){if(&quot;relative&quot;!==this.cssPosition)return{top:0,left:0};var e=this.element.position(),t=this._isRootNode(this.scrollParent[0]);return{top:e.top-(parseInt(this.helper.css(&quot;top&quot;),10)||0)+(t?0:this.scrollParent.scrollTop()),left:e.left-(parseInt(this.helper.css(&quot;left&quot;),10)||0)+(t?0:this.scrollParent.scrollLeft())}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css(&quot;marginLeft&quot;),10)||0,top:parseInt(this.element.css(&quot;marginTop&quot;),10)||0,right:parseInt(this.element.css(&quot;marginRight&quot;),10)||0,bottom:parseInt(this.element.css(&quot;marginBottom&quot;),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options,a=this.document[0];return this.relativeContainer=null,n.containment?&quot;window&quot;===n.containment?(this.containment=[e(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,e(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,e(window).scrollLeft()+e(window).width()-this.helperProportions.width-this.margins.left,e(window).scrollTop()+(e(window).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):&quot;document&quot;===n.containment?(this.containment=[0,0,e(a).width()-this.helperProportions.width-this.margins.left,(e(a).height()||a.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top],void 0):n.containment.constructor===Array?(this.containment=n.containment,void 0):(&quot;parent&quot;===n.containment&amp;&amp;(n.containment=this.helper[0].parentNode),i=e(n.containment),s=i[0],s&amp;&amp;(t=/(scroll|auto)/.test(i.css(&quot;overflow&quot;)),this.containment=[(parseInt(i.css(&quot;borderLeftWidth&quot;),10)||0)+(parseInt(i.css(&quot;paddingLeft&quot;),10)||0),(parseInt(i.css(&quot;borderTopWidth&quot;),10)||0)+(parseInt(i.css(&quot;paddingTop&quot;),10)||0),(t?Math.max(s.scrollWidth,s.offsetWidth):s.offsetWidth)-(parseInt(i.css(&quot;borderRightWidth&quot;),10)||0)-(parseInt(i.css(&quot;paddingRight&quot;),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(t?Math.max(s.scrollHeight,s.offsetHeight):s.offsetHeight)-(parseInt(i.css(&quot;borderBottomWidth&quot;),10)||0)-(parseInt(i.css(&quot;paddingBottom&quot;),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relativeContainer=i),void 0):(this.containment=null,void 0)
},_convertPositionTo:function(e,t){t||(t=this.position);var i=&quot;absolute&quot;===e?1:-1,s=this._isRootNode(this.scrollParent[0]);return{top:t.top+this.offset.relative.top*i+this.offset.parent.top*i-(&quot;fixed&quot;===this.cssPosition?-this.offset.scroll.top:s?0:this.offset.scroll.top)*i,left:t.left+this.offset.relative.left*i+this.offset.parent.left*i-(&quot;fixed&quot;===this.cssPosition?-this.offset.scroll.left:s?0:this.offset.scroll.left)*i}},_generatePosition:function(e,t){var i,s,n,a,o=this.options,r=this._isRootNode(this.scrollParent[0]),h=e.pageX,l=e.pageY;return r&amp;&amp;this.offset.scroll||(this.offset.scroll={top:this.scrollParent.scrollTop(),left:this.scrollParent.scrollLeft()}),t&amp;&amp;(this.containment&amp;&amp;(this.relativeContainer?(s=this.relativeContainer.offset(),i=[this.containment[0]+s.left,this.containment[1]+s.top,this.containment[2]+s.left,this.containment[3]+s.top]):i=this.containment,e.pageX-this.offset.click.left&lt;i[0]&amp;&amp;(h=i[0]+this.offset.click.left),e.pageY-this.offset.click.top&lt;i[1]&amp;&amp;(l=i[1]+this.offset.click.top),e.pageX-this.offset.click.left&gt;i[2]&amp;&amp;(h=i[2]+this.offset.click.left),e.pageY-this.offset.click.top&gt;i[3]&amp;&amp;(l=i[3]+this.offset.click.top)),o.grid&amp;&amp;(n=o.grid[1]?this.originalPageY+Math.round((l-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY,l=i?n-this.offset.click.top&gt;=i[1]||n-this.offset.click.top&gt;i[3]?n:n-this.offset.click.top&gt;=i[1]?n-o.grid[1]:n+o.grid[1]:n,a=o.grid[0]?this.originalPageX+Math.round((h-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX,h=i?a-this.offset.click.left&gt;=i[0]||a-this.offset.click.left&gt;i[2]?a:a-this.offset.click.left&gt;=i[0]?a-o.grid[0]:a+o.grid[0]:a),&quot;y&quot;===o.axis&amp;&amp;(h=this.originalPageX),&quot;x&quot;===o.axis&amp;&amp;(l=this.originalPageY)),{top:l-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(&quot;fixed&quot;===this.cssPosition?-this.offset.scroll.top:r?0:this.offset.scroll.top),left:h-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(&quot;fixed&quot;===this.cssPosition?-this.offset.scroll.left:r?0:this.offset.scroll.left)}},_clear:function(){this.helper.removeClass(&quot;ui-draggable-dragging&quot;),this.helper[0]===this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1,this.destroyOnClear&amp;&amp;this.destroy()},_normalizeRightBottom:function(){&quot;y&quot;!==this.options.axis&amp;&amp;&quot;auto&quot;!==this.helper.css(&quot;right&quot;)&amp;&amp;(this.helper.width(this.helper.width()),this.helper.css(&quot;right&quot;,&quot;auto&quot;)),&quot;x&quot;!==this.options.axis&amp;&amp;&quot;auto&quot;!==this.helper.css(&quot;bottom&quot;)&amp;&amp;(this.helper.height(this.helper.height()),this.helper.css(&quot;bottom&quot;,&quot;auto&quot;))},_trigger:function(t,i,s){return s=s||this._uiHash(),e.ui.plugin.call(this,t,[i,s,this],!0),/^(drag|start|stop)/.test(t)&amp;&amp;(this.positionAbs=this._convertPositionTo(&quot;absolute&quot;),s.offset=this.positionAbs),e.Widget.prototype._trigger.call(this,t,i,s)},plugins:{},_uiHash:function(){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;connectToSortable&quot;,{start:function(t,i,s){var n=e.extend({},i,{item:s.element});s.sortables=[],e(s.options.connectToSortable).each(function(){var i=e(this).sortable(&quot;instance&quot;);i&amp;&amp;!i.options.disabled&amp;&amp;(s.sortables.push(i),i.refreshPositions(),i._trigger(&quot;activate&quot;,t,n))})},stop:function(t,i,s){var n=e.extend({},i,{item:s.element});s.cancelHelperRemoval=!1,e.each(s.sortables,function(){var e=this;e.isOver?(e.isOver=0,s.cancelHelperRemoval=!0,e.cancelHelperRemoval=!1,e._storedCSS={position:e.placeholder.css(&quot;position&quot;),top:e.placeholder.css(&quot;top&quot;),left:e.placeholder.css(&quot;left&quot;)},e._mouseStop(t),e.options.helper=e.options._helper):(e.cancelHelperRemoval=!0,e._trigger(&quot;deactivate&quot;,t,n))})},drag:function(t,i,s){e.each(s.sortables,function(){var n=!1,a=this;a.positionAbs=s.positionAbs,a.helperProportions=s.helperProportions,a.offset.click=s.offset.click,a._intersectsWith(a.containerCache)&amp;&amp;(n=!0,e.each(s.sortables,function(){return this.positionAbs=s.positionAbs,this.helperProportions=s.helperProportions,this.offset.click=s.offset.click,this!==a&amp;&amp;this._intersectsWith(this.containerCache)&amp;&amp;e.contains(a.element[0],this.element[0])&amp;&amp;(n=!1),n})),n?(a.isOver||(a.isOver=1,s._parent=i.helper.parent(),a.currentItem=i.helper.appendTo(a.element).data(&quot;ui-sortable-item&quot;,!0),a.options._helper=a.options.helper,a.options.helper=function(){return i.helper[0]},t.target=a.currentItem[0],a._mouseCapture(t,!0),a._mouseStart(t,!0,!0),a.offset.click.top=s.offset.click.top,a.offset.click.left=s.offset.click.left,a.offset.parent.left-=s.offset.parent.left-a.offset.parent.left,a.offset.parent.top-=s.offset.parent.top-a.offset.parent.top,s._trigger(&quot;toSortable&quot;,t),s.dropped=a.element,e.each(s.sortables,function(){this.refreshPositions()}),s.currentItem=s.element,a.fromOutside=s),a.currentItem&amp;&amp;(a._mouseDrag(t),i.position=a.position)):a.isOver&amp;&amp;(a.isOver=0,a.cancelHelperRemoval=!0,a.options._revert=a.options.revert,a.options.revert=!1,a._trigger(&quot;out&quot;,t,a._uiHash(a)),a._mouseStop(t,!0),a.options.revert=a.options._revert,a.options.helper=a.options._helper,a.placeholder&amp;&amp;a.placeholder.remove(),i.helper.appendTo(s._parent),s._refreshOffsets(t),i.position=s._generatePosition(t,!0),s._trigger(&quot;fromSortable&quot;,t),s.dropped=!1,e.each(s.sortables,function(){this.refreshPositions()}))})}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;cursor&quot;,{start:function(t,i,s){var n=e(&quot;body&quot;),a=s.options;n.css(&quot;cursor&quot;)&amp;&amp;(a._cursor=n.css(&quot;cursor&quot;)),n.css(&quot;cursor&quot;,a.cursor)},stop:function(t,i,s){var n=s.options;n._cursor&amp;&amp;e(&quot;body&quot;).css(&quot;cursor&quot;,n._cursor)}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;opacity&quot;,{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css(&quot;opacity&quot;)&amp;&amp;(a._opacity=n.css(&quot;opacity&quot;)),n.css(&quot;opacity&quot;,a.opacity)},stop:function(t,i,s){var n=s.options;n._opacity&amp;&amp;e(i.helper).css(&quot;opacity&quot;,n._opacity)}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;scroll&quot;,{start:function(e,t,i){i.scrollParentNotHidden||(i.scrollParentNotHidden=i.helper.scrollParent(!1)),i.scrollParentNotHidden[0]!==i.document[0]&amp;&amp;&quot;HTML&quot;!==i.scrollParentNotHidden[0].tagName&amp;&amp;(i.overflowOffset=i.scrollParentNotHidden.offset())},drag:function(t,i,s){var n=s.options,a=!1,o=s.scrollParentNotHidden[0],r=s.document[0];o!==r&amp;&amp;&quot;HTML&quot;!==o.tagName?(n.axis&amp;&amp;&quot;x&quot;===n.axis||(s.overflowOffset.top+o.offsetHeight-t.pageY&lt;n.scrollSensitivity?o.scrollTop=a=o.scrollTop+n.scrollSpeed:t.pageY-s.overflowOffset.top&lt;n.scrollSensitivity&amp;&amp;(o.scrollTop=a=o.scrollTop-n.scrollSpeed)),n.axis&amp;&amp;&quot;y&quot;===n.axis||(s.overflowOffset.left+o.offsetWidth-t.pageX&lt;n.scrollSensitivity?o.scrollLeft=a=o.scrollLeft+n.scrollSpeed:t.pageX-s.overflowOffset.left&lt;n.scrollSensitivity&amp;&amp;(o.scrollLeft=a=o.scrollLeft-n.scrollSpeed))):(n.axis&amp;&amp;&quot;x&quot;===n.axis||(t.pageY-e(r).scrollTop()&lt;n.scrollSensitivity?a=e(r).scrollTop(e(r).scrollTop()-n.scrollSpeed):e(window).height()-(t.pageY-e(r).scrollTop())&lt;n.scrollSensitivity&amp;&amp;(a=e(r).scrollTop(e(r).scrollTop()+n.scrollSpeed))),n.axis&amp;&amp;&quot;y&quot;===n.axis||(t.pageX-e(r).scrollLeft()&lt;n.scrollSensitivity?a=e(r).scrollLeft(e(r).scrollLeft()-n.scrollSpeed):e(window).width()-(t.pageX-e(r).scrollLeft())&lt;n.scrollSensitivity&amp;&amp;(a=e(r).scrollLeft(e(r).scrollLeft()+n.scrollSpeed)))),a!==!1&amp;&amp;e.ui.ddmanager&amp;&amp;!n.dropBehaviour&amp;&amp;e.ui.ddmanager.prepareOffsets(s,t)}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;snap&quot;,{start:function(t,i,s){var n=s.options;s.snapElements=[],e(n.snap.constructor!==String?n.snap.items||&quot;:data(ui-draggable)&quot;:n.snap).each(function(){var t=e(this),i=t.offset();this!==s.element[0]&amp;&amp;s.snapElements.push({item:this,width:t.outerWidth(),height:t.outerHeight(),top:i.top,left:i.left})})},drag:function(t,i,s){var n,a,o,r,h,l,u,d,c,p,f=s.options,m=f.snapTolerance,g=i.offset.left,v=g+s.helperProportions.width,y=i.offset.top,b=y+s.helperProportions.height;for(c=s.snapElements.length-1;c&gt;=0;c--)h=s.snapElements[c].left-s.margins.left,l=h+s.snapElements[c].width,u=s.snapElements[c].top-s.margins.top,d=u+s.snapElements[c].height,h-m&gt;v||g&gt;l+m||u-m&gt;b||y&gt;d+m||!e.contains(s.snapElements[c].item.ownerDocument,s.snapElements[c].item)?(s.snapElements[c].snapping&amp;&amp;s.options.snap.release&amp;&amp;s.options.snap.release.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=!1):(&quot;inner&quot;!==f.snapMode&amp;&amp;(n=m&gt;=Math.abs(u-b),a=m&gt;=Math.abs(d-y),o=m&gt;=Math.abs(h-v),r=m&gt;=Math.abs(l-g),n&amp;&amp;(i.position.top=s._convertPositionTo(&quot;relative&quot;,{top:u-s.helperProportions.height,left:0}).top),a&amp;&amp;(i.position.top=s._convertPositionTo(&quot;relative&quot;,{top:d,left:0}).top),o&amp;&amp;(i.position.left=s._convertPositionTo(&quot;relative&quot;,{top:0,left:h-s.helperProportions.width}).left),r&amp;&amp;(i.position.left=s._convertPositionTo(&quot;relative&quot;,{top:0,left:l}).left)),p=n||a||o||r,&quot;outer&quot;!==f.snapMode&amp;&amp;(n=m&gt;=Math.abs(u-y),a=m&gt;=Math.abs(d-b),o=m&gt;=Math.abs(h-g),r=m&gt;=Math.abs(l-v),n&amp;&amp;(i.position.top=s._convertPositionTo(&quot;relative&quot;,{top:u,left:0}).top),a&amp;&amp;(i.position.top=s._convertPositionTo(&quot;relative&quot;,{top:d-s.helperProportions.height,left:0}).top),o&amp;&amp;(i.position.left=s._convertPositionTo(&quot;relative&quot;,{top:0,left:h}).left),r&amp;&amp;(i.position.left=s._convertPositionTo(&quot;relative&quot;,{top:0,left:l-s.helperProportions.width}).left)),!s.snapElements[c].snapping&amp;&amp;(n||a||o||r||p)&amp;&amp;s.options.snap.snap&amp;&amp;s.options.snap.snap.call(s.element,t,e.extend(s._uiHash(),{snapItem:s.snapElements[c].item})),s.snapElements[c].snapping=n||a||o||r||p)}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;stack&quot;,{start:function(t,i,s){var n,a=s.options,o=e.makeArray(e(a.stack)).sort(function(t,i){return(parseInt(e(t).css(&quot;zIndex&quot;),10)||0)-(parseInt(e(i).css(&quot;zIndex&quot;),10)||0)});o.length&amp;&amp;(n=parseInt(e(o[0]).css(&quot;zIndex&quot;),10)||0,e(o).each(function(t){e(this).css(&quot;zIndex&quot;,n+t)}),this.css(&quot;zIndex&quot;,n+o.length))}}),e.ui.plugin.add(&quot;draggable&quot;,&quot;zIndex&quot;,{start:function(t,i,s){var n=e(i.helper),a=s.options;n.css(&quot;zIndex&quot;)&amp;&amp;(a._zIndex=n.css(&quot;zIndex&quot;)),n.css(&quot;zIndex&quot;,a.zIndex)},stop:function(t,i,s){var n=s.options;n._zIndex&amp;&amp;e(i.helper).css(&quot;zIndex&quot;,n._zIndex)}}),e.ui.draggable,e.widget(&quot;ui.resizable&quot;,e.ui.mouse,{version:&quot;1.11.4&quot;,widgetEventPrefix:&quot;resize&quot;,options:{alsoResize:!1,animate:!1,animateDuration:&quot;slow&quot;,animateEasing:&quot;swing&quot;,aspectRatio:!1,autoHide:!1,containment:!1,ghost:!1,grid:!1,handles:&quot;e,s,se&quot;,helper:!1,maxHeight:null,maxWidth:null,minHeight:10,minWidth:10,zIndex:90,resize:null,start:null,stop:null},_num:function(e){return parseInt(e,10)||0},_isNumber:function(e){return!isNaN(parseInt(e,10))},_hasScroll:function(t,i){if(&quot;hidden&quot;===e(t).css(&quot;overflow&quot;))return!1;var s=i&amp;&amp;&quot;left&quot;===i?&quot;scrollLeft&quot;:&quot;scrollTop&quot;,n=!1;return t[s]&gt;0?!0:(t[s]=1,n=t[s]&gt;0,t[s]=0,n)},_create:function(){var t,i,s,n,a,o=this,r=this.options;if(this.element.addClass(&quot;ui-resizable&quot;),e.extend(this,{_aspectRatio:!!r.aspectRatio,aspectRatio:r.aspectRatio,originalElement:this.element,_proportionallyResizeElements:[],_helper:r.helper||r.ghost||r.animate?r.helper||&quot;ui-resizable-helper&quot;:null}),this.element[0].nodeName.match(/^(canvas|textarea|input|select|button|img)$/i)&amp;&amp;(this.element.wrap(e(&quot;&lt;div class='ui-wrapper' style='overflow: hidden;'&gt;&lt;/div&gt;&quot;).css({position:this.element.css(&quot;position&quot;),width:this.element.outerWidth(),height:this.element.outerHeight(),top:this.element.css(&quot;top&quot;),left:this.element.css(&quot;left&quot;)})),this.element=this.element.parent().data(&quot;ui-resizable&quot;,this.element.resizable(&quot;instance&quot;)),this.elementIsWrapper=!0,this.element.css({marginLeft:this.originalElement.css(&quot;marginLeft&quot;),marginTop:this.originalElement.css(&quot;marginTop&quot;),marginRight:this.originalElement.css(&quot;marginRight&quot;),marginBottom:this.originalElement.css(&quot;marginBottom&quot;)}),this.originalElement.css({marginLeft:0,marginTop:0,marginRight:0,marginBottom:0}),this.originalResizeStyle=this.originalElement.css(&quot;resize&quot;),this.originalElement.css(&quot;resize&quot;,&quot;none&quot;),this._proportionallyResizeElements.push(this.originalElement.css({position:&quot;static&quot;,zoom:1,display:&quot;block&quot;})),this.originalElement.css({margin:this.originalElement.css(&quot;margin&quot;)}),this._proportionallyResize()),this.handles=r.handles||(e(&quot;.ui-resizable-handle&quot;,this.element).length?{n:&quot;.ui-resizable-n&quot;,e:&quot;.ui-resizable-e&quot;,s:&quot;.ui-resizable-s&quot;,w:&quot;.ui-resizable-w&quot;,se:&quot;.ui-resizable-se&quot;,sw:&quot;.ui-resizable-sw&quot;,ne:&quot;.ui-resizable-ne&quot;,nw:&quot;.ui-resizable-nw&quot;}:&quot;e,s,se&quot;),this._handles=e(),this.handles.constructor===String)for(&quot;all&quot;===this.handles&amp;&amp;(this.handles=&quot;n,e,s,w,se,sw,ne,nw&quot;),t=this.handles.split(&quot;,&quot;),this.handles={},i=0;t.length&gt;i;i++)s=e.trim(t[i]),a=&quot;ui-resizable-&quot;+s,n=e(&quot;&lt;div class='ui-resizable-handle &quot;+a+&quot;'&gt;&lt;/div&gt;&quot;),n.css({zIndex:r.zIndex}),&quot;se&quot;===s&amp;&amp;n.addClass(&quot;ui-icon ui-icon-gripsmall-diagonal-se&quot;),this.handles[s]=&quot;.ui-resizable-&quot;+s,this.element.append(n);this._renderAxis=function(t){var i,s,n,a;t=t||this.element;for(i in this.handles)this.handles[i].constructor===String?this.handles[i]=this.element.children(this.handles[i]).first().show():(this.handles[i].jquery||this.handles[i].nodeType)&amp;&amp;(this.handles[i]=e(this.handles[i]),this._on(this.handles[i],{mousedown:o._mouseDown})),this.elementIsWrapper&amp;&amp;this.originalElement[0].nodeName.match(/^(textarea|input|select|button)$/i)&amp;&amp;(s=e(this.handles[i],this.element),a=/sw|ne|nw|se|n|s/.test(i)?s.outerHeight():s.outerWidth(),n=[&quot;padding&quot;,/ne|nw|n/.test(i)?&quot;Top&quot;:/se|sw|s/.test(i)?&quot;Bottom&quot;:/^e$/.test(i)?&quot;Right&quot;:&quot;Left&quot;].join(&quot;&quot;),t.css(n,a),this._proportionallyResize()),this._handles=this._handles.add(this.handles[i])},this._renderAxis(this.element),this._handles=this._handles.add(this.element.find(&quot;.ui-resizable-handle&quot;)),this._handles.disableSelection(),this._handles.mouseover(function(){o.resizing||(this.className&amp;&amp;(n=this.className.match(/ui-resizable-(se|sw|ne|nw|n|e|s|w)/i)),o.axis=n&amp;&amp;n[1]?n[1]:&quot;se&quot;)}),r.autoHide&amp;&amp;(this._handles.hide(),e(this.element).addClass(&quot;ui-resizable-autohide&quot;).mouseenter(function(){r.disabled||(e(this).removeClass(&quot;ui-resizable-autohide&quot;),o._handles.show())}).mouseleave(function(){r.disabled||o.resizing||(e(this).addClass(&quot;ui-resizable-autohide&quot;),o._handles.hide())})),this._mouseInit()},_destroy:function(){this._mouseDestroy();var t,i=function(t){e(t).removeClass(&quot;ui-resizable ui-resizable-disabled ui-resizable-resizing&quot;).removeData(&quot;resizable&quot;).removeData(&quot;ui-resizable&quot;).unbind(&quot;.resizable&quot;).find(&quot;.ui-resizable-handle&quot;).remove()};return this.elementIsWrapper&amp;&amp;(i(this.element),t=this.element,this.originalElement.css({position:t.css(&quot;position&quot;),width:t.outerWidth(),height:t.outerHeight(),top:t.css(&quot;top&quot;),left:t.css(&quot;left&quot;)}).insertAfter(t),t.remove()),this.originalElement.css(&quot;resize&quot;,this.originalResizeStyle),i(this.originalElement),this},_mouseCapture:function(t){var i,s,n=!1;for(i in this.handles)s=e(this.handles[i])[0],(s===t.target||e.contains(s,t.target))&amp;&amp;(n=!0);return!this.options.disabled&amp;&amp;n},_mouseStart:function(t){var i,s,n,a=this.options,o=this.element;return this.resizing=!0,this._renderProxy(),i=this._num(this.helper.css(&quot;left&quot;)),s=this._num(this.helper.css(&quot;top&quot;)),a.containment&amp;&amp;(i+=e(a.containment).scrollLeft()||0,s+=e(a.containment).scrollTop()||0),this.offset=this.helper.offset(),this.position={left:i,top:s},this.size=this._helper?{width:this.helper.width(),height:this.helper.height()}:{width:o.width(),height:o.height()},this.originalSize=this._helper?{width:o.outerWidth(),height:o.outerHeight()}:{width:o.width(),height:o.height()},this.sizeDiff={width:o.outerWidth()-o.width(),height:o.outerHeight()-o.height()},this.originalPosition={left:i,top:s},this.originalMousePosition={left:t.pageX,top:t.pageY},this.aspectRatio=&quot;number&quot;==typeof a.aspectRatio?a.aspectRatio:this.originalSize.width/this.originalSize.height||1,n=e(&quot;.ui-resizable-&quot;+this.axis).css(&quot;cursor&quot;),e(&quot;body&quot;).css(&quot;cursor&quot;,&quot;auto&quot;===n?this.axis+&quot;-resize&quot;:n),o.addClass(&quot;ui-resizable-resizing&quot;),this._propagate(&quot;start&quot;,t),!0},_mouseDrag:function(t){var i,s,n=this.originalMousePosition,a=this.axis,o=t.pageX-n.left||0,r=t.pageY-n.top||0,h=this._change[a];return this._updatePrevProperties(),h?(i=h.apply(this,[t,o,r]),this._updateVirtualBoundaries(t.shiftKey),(this._aspectRatio||t.shiftKey)&amp;&amp;(i=this._updateRatio(i,t)),i=this._respectSize(i,t),this._updateCache(i),this._propagate(&quot;resize&quot;,t),s=this._applyChanges(),!this._helper&amp;&amp;this._proportionallyResizeElements.length&amp;&amp;this._proportionallyResize(),e.isEmptyObject(s)||(this._updatePrevProperties(),this._trigger(&quot;resize&quot;,t,this.ui()),this._applyChanges()),!1):!1},_mouseStop:function(t){this.resizing=!1;var i,s,n,a,o,r,h,l=this.options,u=this;return this._helper&amp;&amp;(i=this._proportionallyResizeElements,s=i.length&amp;&amp;/textarea/i.test(i[0].nodeName),n=s&amp;&amp;this._hasScroll(i[0],&quot;left&quot;)?0:u.sizeDiff.height,a=s?0:u.sizeDiff.width,o={width:u.helper.width()-a,height:u.helper.height()-n},r=parseInt(u.element.css(&quot;left&quot;),10)+(u.position.left-u.originalPosition.left)||null,h=parseInt(u.element.css(&quot;top&quot;),10)+(u.position.top-u.originalPosition.top)||null,l.animate||this.element.css(e.extend(o,{top:h,left:r})),u.helper.height(u.size.height),u.helper.width(u.size.width),this._helper&amp;&amp;!l.animate&amp;&amp;this._proportionallyResize()),e(&quot;body&quot;).css(&quot;cursor&quot;,&quot;auto&quot;),this.element.removeClass(&quot;ui-resizable-resizing&quot;),this._propagate(&quot;stop&quot;,t),this._helper&amp;&amp;this.helper.remove(),!1},_updatePrevProperties:function(){this.prevPosition={top:this.position.top,left:this.position.left},this.prevSize={width:this.size.width,height:this.size.height}},_applyChanges:function(){var e={};return this.position.top!==this.prevPosition.top&amp;&amp;(e.top=this.position.top+&quot;px&quot;),this.position.left!==this.prevPosition.left&amp;&amp;(e.left=this.position.left+&quot;px&quot;),this.size.width!==this.prevSize.width&amp;&amp;(e.width=this.size.width+&quot;px&quot;),this.size.height!==this.prevSize.height&amp;&amp;(e.height=this.size.height+&quot;px&quot;),this.helper.css(e),e},_updateVirtualBoundaries:function(e){var t,i,s,n,a,o=this.options;a={minWidth:this._isNumber(o.minWidth)?o.minWidth:0,maxWidth:this._isNumber(o.maxWidth)?o.maxWidth:1/0,minHeight:this._isNumber(o.minHeight)?o.minHeight:0,maxHeight:this._isNumber(o.maxHeight)?o.maxHeight:1/0},(this._aspectRatio||e)&amp;&amp;(t=a.minHeight*this.aspectRatio,s=a.minWidth/this.aspectRatio,i=a.maxHeight*this.aspectRatio,n=a.maxWidth/this.aspectRatio,t&gt;a.minWidth&amp;&amp;(a.minWidth=t),s&gt;a.minHeight&amp;&amp;(a.minHeight=s),a.maxWidth&gt;i&amp;&amp;(a.maxWidth=i),a.maxHeight&gt;n&amp;&amp;(a.maxHeight=n)),this._vBoundaries=a},_updateCache:function(e){this.offset=this.helper.offset(),this._isNumber(e.left)&amp;&amp;(this.position.left=e.left),this._isNumber(e.top)&amp;&amp;(this.position.top=e.top),this._isNumber(e.height)&amp;&amp;(this.size.height=e.height),this._isNumber(e.width)&amp;&amp;(this.size.width=e.width)},_updateRatio:function(e){var t=this.position,i=this.size,s=this.axis;return this._isNumber(e.height)?e.width=e.height*this.aspectRatio:this._isNumber(e.width)&amp;&amp;(e.height=e.width/this.aspectRatio),&quot;sw&quot;===s&amp;&amp;(e.left=t.left+(i.width-e.width),e.top=null),&quot;nw&quot;===s&amp;&amp;(e.top=t.top+(i.height-e.height),e.left=t.left+(i.width-e.width)),e},_respectSize:function(e){var t=this._vBoundaries,i=this.axis,s=this._isNumber(e.width)&amp;&amp;t.maxWidth&amp;&amp;t.maxWidth&lt;e.width,n=this._isNumber(e.height)&amp;&amp;t.maxHeight&amp;&amp;t.maxHeight&lt;e.height,a=this._isNumber(e.width)&amp;&amp;t.minWidth&amp;&amp;t.minWidth&gt;e.width,o=this._isNumber(e.height)&amp;&amp;t.minHeight&amp;&amp;t.minHeight&gt;e.height,r=this.originalPosition.left+this.originalSize.width,h=this.position.top+this.size.height,l=/sw|nw|w/.test(i),u=/nw|ne|n/.test(i);return a&amp;&amp;(e.width=t.minWidth),o&amp;&amp;(e.height=t.minHeight),s&amp;&amp;(e.width=t.maxWidth),n&amp;&amp;(e.height=t.maxHeight),a&amp;&amp;l&amp;&amp;(e.left=r-t.minWidth),s&amp;&amp;l&amp;&amp;(e.left=r-t.maxWidth),o&amp;&amp;u&amp;&amp;(e.top=h-t.minHeight),n&amp;&amp;u&amp;&amp;(e.top=h-t.maxHeight),e.width||e.height||e.left||!e.top?e.width||e.height||e.top||!e.left||(e.left=null):e.top=null,e},_getPaddingPlusBorderDimensions:function(e){for(var t=0,i=[],s=[e.css(&quot;borderTopWidth&quot;),e.css(&quot;borderRightWidth&quot;),e.css(&quot;borderBottomWidth&quot;),e.css(&quot;borderLeftWidth&quot;)],n=[e.css(&quot;paddingTop&quot;),e.css(&quot;paddingRight&quot;),e.css(&quot;paddingBottom&quot;),e.css(&quot;paddingLeft&quot;)];4&gt;t;t++)i[t]=parseInt(s[t],10)||0,i[t]+=parseInt(n[t],10)||0;return{height:i[0]+i[2],width:i[1]+i[3]}},_proportionallyResize:function(){if(this._proportionallyResizeElements.length)for(var e,t=0,i=this.helper||this.element;this._proportionallyResizeElements.length&gt;t;t++)e=this._proportionallyResizeElements[t],this.outerDimensions||(this.outerDimensions=this._getPaddingPlusBorderDimensions(e)),e.css({height:i.height()-this.outerDimensions.height||0,width:i.width()-this.outerDimensions.width||0})},_renderProxy:function(){var t=this.element,i=this.options;this.elementOffset=t.offset(),this._helper?(this.helper=this.helper||e(&quot;&lt;div style='overflow:hidden;'&gt;&lt;/div&gt;&quot;),this.helper.addClass(this._helper).css({width:this.element.outerWidth()-1,height:this.element.outerHeight()-1,position:&quot;absolute&quot;,left:this.elementOffset.left+&quot;px&quot;,top:this.elementOffset.top+&quot;px&quot;,zIndex:++i.zIndex}),this.helper.appendTo(&quot;body&quot;).disableSelection()):this.helper=this.element},_change:{e:function(e,t){return{width:this.originalSize.width+t}},w:function(e,t){var i=this.originalSize,s=this.originalPosition;return{left:s.left+t,width:i.width-t}},n:function(e,t,i){var s=this.originalSize,n=this.originalPosition;return{top:n.top+i,height:s.height-i}},s:function(e,t,i){return{height:this.originalSize.height+i}},se:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},sw:function(t,i,s){return e.extend(this._change.s.apply(this,arguments),this._change.w.apply(this,[t,i,s]))},ne:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.e.apply(this,[t,i,s]))},nw:function(t,i,s){return e.extend(this._change.n.apply(this,arguments),this._change.w.apply(this,[t,i,s]))}},_propagate:function(t,i){e.ui.plugin.call(this,t,[i,this.ui()]),&quot;resize&quot;!==t&amp;&amp;this._trigger(t,i,this.ui())},plugins:{},ui:function(){return{originalElement:this.originalElement,element:this.element,helper:this.helper,position:this.position,size:this.size,originalSize:this.originalSize,originalPosition:this.originalPosition}}}),e.ui.plugin.add(&quot;resizable&quot;,&quot;animate&quot;,{stop:function(t){var i=e(this).resizable(&quot;instance&quot;),s=i.options,n=i._proportionallyResizeElements,a=n.length&amp;&amp;/textarea/i.test(n[0].nodeName),o=a&amp;&amp;i._hasScroll(n[0],&quot;left&quot;)?0:i.sizeDiff.height,r=a?0:i.sizeDiff.width,h={width:i.size.width-r,height:i.size.height-o},l=parseInt(i.element.css(&quot;left&quot;),10)+(i.position.left-i.originalPosition.left)||null,u=parseInt(i.element.css(&quot;top&quot;),10)+(i.position.top-i.originalPosition.top)||null;i.element.animate(e.extend(h,u&amp;&amp;l?{top:u,left:l}:{}),{duration:s.animateDuration,easing:s.animateEasing,step:function(){var s={width:parseInt(i.element.css(&quot;width&quot;),10),height:parseInt(i.element.css(&quot;height&quot;),10),top:parseInt(i.element.css(&quot;top&quot;),10),left:parseInt(i.element.css(&quot;left&quot;),10)};n&amp;&amp;n.length&amp;&amp;e(n[0]).css({width:s.width,height:s.height}),i._updateCache(s),i._propagate(&quot;resize&quot;,t)}})}}),e.ui.plugin.add(&quot;resizable&quot;,&quot;containment&quot;,{start:function(){var t,i,s,n,a,o,r,h=e(this).resizable(&quot;instance&quot;),l=h.options,u=h.element,d=l.containment,c=d instanceof e?d.get(0):/parent/.test(d)?u.parent().get(0):d;c&amp;&amp;(h.containerElement=e(c),/document/.test(d)||d===document?(h.containerOffset={left:0,top:0},h.containerPosition={left:0,top:0},h.parentData={element:e(document),left:0,top:0,width:e(document).width(),height:e(document).height()||document.body.parentNode.scrollHeight}):(t=e(c),i=[],e([&quot;Top&quot;,&quot;Right&quot;,&quot;Left&quot;,&quot;Bottom&quot;]).each(function(e,s){i[e]=h._num(t.css(&quot;padding&quot;+s))}),h.containerOffset=t.offset(),h.containerPosition=t.position(),h.containerSize={height:t.innerHeight()-i[3],width:t.innerWidth()-i[1]},s=h.containerOffset,n=h.containerSize.height,a=h.containerSize.width,o=h._hasScroll(c,&quot;left&quot;)?c.scrollWidth:a,r=h._hasScroll(c)?c.scrollHeight:n,h.parentData={element:c,left:s.left,top:s.top,width:o,height:r}))},resize:function(t){var i,s,n,a,o=e(this).resizable(&quot;instance&quot;),r=o.options,h=o.containerOffset,l=o.position,u=o._aspectRatio||t.shiftKey,d={top:0,left:0},c=o.containerElement,p=!0;c[0]!==document&amp;&amp;/static/.test(c.css(&quot;position&quot;))&amp;&amp;(d=h),l.left&lt;(o._helper?h.left:0)&amp;&amp;(o.size.width=o.size.width+(o._helper?o.position.left-h.left:o.position.left-d.left),u&amp;&amp;(o.size.height=o.size.width/o.aspectRatio,p=!1),o.position.left=r.helper?h.left:0),l.top&lt;(o._helper?h.top:0)&amp;&amp;(o.size.height=o.size.height+(o._helper?o.position.top-h.top:o.position.top),u&amp;&amp;(o.size.width=o.size.height*o.aspectRatio,p=!1),o.position.top=o._helper?h.top:0),n=o.containerElement.get(0)===o.element.parent().get(0),a=/relative|absolute/.test(o.containerElement.css(&quot;position&quot;)),n&amp;&amp;a?(o.offset.left=o.parentData.left+o.position.left,o.offset.top=o.parentData.top+o.position.top):(o.offset.left=o.element.offset().left,o.offset.top=o.element.offset().top),i=Math.abs(o.sizeDiff.width+(o._helper?o.offset.left-d.left:o.offset.left-h.left)),s=Math.abs(o.sizeDiff.height+(o._helper?o.offset.top-d.top:o.offset.top-h.top)),i+o.size.width&gt;=o.parentData.width&amp;&amp;(o.size.width=o.parentData.width-i,u&amp;&amp;(o.size.height=o.size.width/o.aspectRatio,p=!1)),s+o.size.height&gt;=o.parentData.height&amp;&amp;(o.size.height=o.parentData.height-s,u&amp;&amp;(o.size.width=o.size.height*o.aspectRatio,p=!1)),p||(o.position.left=o.prevPosition.left,o.position.top=o.prevPosition.top,o.size.width=o.prevSize.width,o.size.height=o.prevSize.height)},stop:function(){var t=e(this).resizable(&quot;instance&quot;),i=t.options,s=t.containerOffset,n=t.containerPosition,a=t.containerElement,o=e(t.helper),r=o.offset(),h=o.outerWidth()-t.sizeDiff.width,l=o.outerHeight()-t.sizeDiff.height;t._helper&amp;&amp;!i.animate&amp;&amp;/relative/.test(a.css(&quot;position&quot;))&amp;&amp;e(this).css({left:r.left-n.left-s.left,width:h,height:l}),t._helper&amp;&amp;!i.animate&amp;&amp;/static/.test(a.css(&quot;position&quot;))&amp;&amp;e(this).css({left:r.left-n.left-s.left,width:h,height:l})}}),e.ui.plugin.add(&quot;resizable&quot;,&quot;alsoResize&quot;,{start:function(){var t=e(this).resizable(&quot;instance&quot;),i=t.options;e(i.alsoResize).each(function(){var t=e(this);t.data(&quot;ui-resizable-alsoresize&quot;,{width:parseInt(t.width(),10),height:parseInt(t.height(),10),left:parseInt(t.css(&quot;left&quot;),10),top:parseInt(t.css(&quot;top&quot;),10)})})},resize:function(t,i){var s=e(this).resizable(&quot;instance&quot;),n=s.options,a=s.originalSize,o=s.originalPosition,r={height:s.size.height-a.height||0,width:s.size.width-a.width||0,top:s.position.top-o.top||0,left:s.position.left-o.left||0};e(n.alsoResize).each(function(){var t=e(this),s=e(this).data(&quot;ui-resizable-alsoresize&quot;),n={},a=t.parents(i.originalElement[0]).length?[&quot;width&quot;,&quot;height&quot;]:[&quot;width&quot;,&quot;height&quot;,&quot;top&quot;,&quot;left&quot;];e.each(a,function(e,t){var i=(s[t]||0)+(r[t]||0);i&amp;&amp;i&gt;=0&amp;&amp;(n[t]=i||null)}),t.css(n)})},stop:function(){e(this).removeData(&quot;resizable-alsoresize&quot;)}}),e.ui.plugin.add(&quot;resizable&quot;,&quot;ghost&quot;,{start:function(){var t=e(this).resizable(&quot;instance&quot;),i=t.options,s=t.size;t.ghost=t.originalElement.clone(),t.ghost.css({opacity:.25,display:&quot;block&quot;,position:&quot;relative&quot;,height:s.height,width:s.width,margin:0,left:0,top:0}).addClass(&quot;ui-resizable-ghost&quot;).addClass(&quot;string&quot;==typeof i.ghost?i.ghost:&quot;&quot;),t.ghost.appendTo(t.helper)},resize:function(){var t=e(this).resizable(&quot;instance&quot;);t.ghost&amp;&amp;t.ghost.css({position:&quot;relative&quot;,height:t.size.height,width:t.size.width})},stop:function(){var t=e(this).resizable(&quot;instance&quot;);t.ghost&amp;&amp;t.helper&amp;&amp;t.helper.get(0).removeChild(t.ghost.get(0))}}),e.ui.plugin.add(&quot;resizable&quot;,&quot;grid&quot;,{resize:function(){var t,i=e(this).resizable(&quot;instance&quot;),s=i.options,n=i.size,a=i.originalSize,o=i.originalPosition,r=i.axis,h=&quot;number&quot;==typeof s.grid?[s.grid,s.grid]:s.grid,l=h[0]||1,u=h[1]||1,d=Math.round((n.width-a.width)/l)*l,c=Math.round((n.height-a.height)/u)*u,p=a.width+d,f=a.height+c,m=s.maxWidth&amp;&amp;p&gt;s.maxWidth,g=s.maxHeight&amp;&amp;f&gt;s.maxHeight,v=s.minWidth&amp;&amp;s.minWidth&gt;p,y=s.minHeight&amp;&amp;s.minHeight&gt;f;s.grid=h,v&amp;&amp;(p+=l),y&amp;&amp;(f+=u),m&amp;&amp;(p-=l),g&amp;&amp;(f-=u),/^(se|s|e)$/.test(r)?(i.size.width=p,i.size.height=f):/^(ne)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.top=o.top-c):/^(sw)$/.test(r)?(i.size.width=p,i.size.height=f,i.position.left=o.left-d):((0&gt;=f-u||0&gt;=p-l)&amp;&amp;(t=i._getPaddingPlusBorderDimensions(this)),f-u&gt;0?(i.size.height=f,i.position.top=o.top-c):(f=u-t.height,i.size.height=f,i.position.top=o.top+a.height-f),p-l&gt;0?(i.size.width=p,i.position.left=o.left-d):(p=l-t.width,i.size.width=p,i.position.left=o.left+a.width-p))}}),e.ui.resizable,e.widget(&quot;ui.dialog&quot;,{version:&quot;1.11.4&quot;,options:{appendTo:&quot;body&quot;,autoOpen:!0,buttons:[],closeOnEscape:!0,closeText:&quot;Close&quot;,dialogClass:&quot;&quot;,draggable:!0,hide:null,height:&quot;auto&quot;,maxHeight:null,maxWidth:null,minHeight:150,minWidth:150,modal:!1,position:{my:&quot;center&quot;,at:&quot;center&quot;,of:window,collision:&quot;fit&quot;,using:function(t){var i=e(this).css(t).offset().top;0&gt;i&amp;&amp;e(this).css(&quot;top&quot;,t.top-i)}},resizable:!0,show:null,title:null,width:300,beforeClose:null,close:null,drag:null,dragStart:null,dragStop:null,focus:null,open:null,resize:null,resizeStart:null,resizeStop:null},sizeRelatedOptions:{buttons:!0,height:!0,maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0,width:!0},resizableRelatedOptions:{maxHeight:!0,maxWidth:!0,minHeight:!0,minWidth:!0},_create:function(){this.originalCss={display:this.element[0].style.display,width:this.element[0].style.width,minHeight:this.element[0].style.minHeight,maxHeight:this.element[0].style.maxHeight,height:this.element[0].style.height},this.originalPosition={parent:this.element.parent(),index:this.element.parent().children().index(this.element)},this.originalTitle=this.element.attr(&quot;title&quot;),this.options.title=this.options.title||this.originalTitle,this._createWrapper(),this.element.show().removeAttr(&quot;title&quot;).addClass(&quot;ui-dialog-content ui-widget-content&quot;).appendTo(this.uiDialog),this._createTitlebar(),this._createButtonPane(),this.options.draggable&amp;&amp;e.fn.draggable&amp;&amp;this._makeDraggable(),this.options.resizable&amp;&amp;e.fn.resizable&amp;&amp;this._makeResizable(),this._isOpen=!1,this._trackFocus()},_init:function(){this.options.autoOpen&amp;&amp;this.open()},_appendTo:function(){var t=this.options.appendTo;return t&amp;&amp;(t.jquery||t.nodeType)?e(t):this.document.find(t||&quot;body&quot;).eq(0)},_destroy:function(){var e,t=this.originalPosition;this._untrackInstance(),this._destroyOverlay(),this.element.removeUniqueId().removeClass(&quot;ui-dialog-content ui-widget-content&quot;).css(this.originalCss).detach(),this.uiDialog.stop(!0,!0).remove(),this.originalTitle&amp;&amp;this.element.attr(&quot;title&quot;,this.originalTitle),e=t.parent.children().eq(t.index),e.length&amp;&amp;e[0]!==this.element[0]?e.before(this.element):t.parent.append(this.element)},widget:function(){return this.uiDialog},disable:e.noop,enable:e.noop,close:function(t){var i,s=this;if(this._isOpen&amp;&amp;this._trigger(&quot;beforeClose&quot;,t)!==!1){if(this._isOpen=!1,this._focusedElement=null,this._destroyOverlay(),this._untrackInstance(),!this.opener.filter(&quot;:focusable&quot;).focus().length)try{i=this.document[0].activeElement,i&amp;&amp;&quot;body&quot;!==i.nodeName.toLowerCase()&amp;&amp;e(i).blur()}catch(n){}this._hide(this.uiDialog,this.options.hide,function(){s._trigger(&quot;close&quot;,t)})}},isOpen:function(){return this._isOpen},moveToTop:function(){this._moveToTop()},_moveToTop:function(t,i){var s=!1,n=this.uiDialog.siblings(&quot;.ui-front:visible&quot;).map(function(){return+e(this).css(&quot;z-index&quot;)}).get(),a=Math.max.apply(null,n);return a&gt;=+this.uiDialog.css(&quot;z-index&quot;)&amp;&amp;(this.uiDialog.css(&quot;z-index&quot;,a+1),s=!0),s&amp;&amp;!i&amp;&amp;this._trigger(&quot;focus&quot;,t),s},open:function(){var t=this;return this._isOpen?(this._moveToTop()&amp;&amp;this._focusTabbable(),void 0):(this._isOpen=!0,this.opener=e(this.document[0].activeElement),this._size(),this._position(),this._createOverlay(),this._moveToTop(null,!0),this.overlay&amp;&amp;this.overlay.css(&quot;z-index&quot;,this.uiDialog.css(&quot;z-index&quot;)-1),this._show(this.uiDialog,this.options.show,function(){t._focusTabbable(),t._trigger(&quot;focus&quot;)}),this._makeFocusTarget(),this._trigger(&quot;open&quot;),void 0)},_focusTabbable:function(){var e=this._focusedElement;e||(e=this.element.find(&quot;[autofocus]&quot;)),e.length||(e=this.element.find(&quot;:tabbable&quot;)),e.length||(e=this.uiDialogButtonPane.find(&quot;:tabbable&quot;)),e.length||(e=this.uiDialogTitlebarClose.filter(&quot;:tabbable&quot;)),e.length||(e=this.uiDialog),e.eq(0).focus()},_keepFocus:function(t){function i(){var t=this.document[0].activeElement,i=this.uiDialog[0]===t||e.contains(this.uiDialog[0],t);i||this._focusTabbable()}t.preventDefault(),i.call(this),this._delay(i)},_createWrapper:function(){this.uiDialog=e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-dialog ui-widget ui-widget-content ui-corner-all ui-front &quot;+this.options.dialogClass).hide().attr({tabIndex:-1,role:&quot;dialog&quot;}).appendTo(this._appendTo()),this._on(this.uiDialog,{keydown:function(t){if(this.options.closeOnEscape&amp;&amp;!t.isDefaultPrevented()&amp;&amp;t.keyCode&amp;&amp;t.keyCode===e.ui.keyCode.ESCAPE)return t.preventDefault(),this.close(t),void 0;
if(t.keyCode===e.ui.keyCode.TAB&amp;&amp;!t.isDefaultPrevented()){var i=this.uiDialog.find(&quot;:tabbable&quot;),s=i.filter(&quot;:first&quot;),n=i.filter(&quot;:last&quot;);t.target!==n[0]&amp;&amp;t.target!==this.uiDialog[0]||t.shiftKey?t.target!==s[0]&amp;&amp;t.target!==this.uiDialog[0]||!t.shiftKey||(this._delay(function(){n.focus()}),t.preventDefault()):(this._delay(function(){s.focus()}),t.preventDefault())}},mousedown:function(e){this._moveToTop(e)&amp;&amp;this._focusTabbable()}}),this.element.find(&quot;[aria-describedby]&quot;).length||this.uiDialog.attr({&quot;aria-describedby&quot;:this.element.uniqueId().attr(&quot;id&quot;)})},_createTitlebar:function(){var t;this.uiDialogTitlebar=e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix&quot;).prependTo(this.uiDialog),this._on(this.uiDialogTitlebar,{mousedown:function(t){e(t.target).closest(&quot;.ui-dialog-titlebar-close&quot;)||this.uiDialog.focus()}}),this.uiDialogTitlebarClose=e(&quot;&lt;button type='button'&gt;&lt;/button&gt;&quot;).button({label:this.options.closeText,icons:{primary:&quot;ui-icon-closethick&quot;},text:!1}).addClass(&quot;ui-dialog-titlebar-close&quot;).appendTo(this.uiDialogTitlebar),this._on(this.uiDialogTitlebarClose,{click:function(e){e.preventDefault(),this.close(e)}}),t=e(&quot;&lt;span&gt;&quot;).uniqueId().addClass(&quot;ui-dialog-title&quot;).prependTo(this.uiDialogTitlebar),this._title(t),this.uiDialog.attr({&quot;aria-labelledby&quot;:t.attr(&quot;id&quot;)})},_title:function(e){this.options.title||e.html(&quot;&amp;#160;&quot;),e.text(this.options.title)},_createButtonPane:function(){this.uiDialogButtonPane=e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-dialog-buttonpane ui-widget-content ui-helper-clearfix&quot;),this.uiButtonSet=e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-dialog-buttonset&quot;).appendTo(this.uiDialogButtonPane),this._createButtons()},_createButtons:function(){var t=this,i=this.options.buttons;return this.uiDialogButtonPane.remove(),this.uiButtonSet.empty(),e.isEmptyObject(i)||e.isArray(i)&amp;&amp;!i.length?(this.uiDialog.removeClass(&quot;ui-dialog-buttons&quot;),void 0):(e.each(i,function(i,s){var n,a;s=e.isFunction(s)?{click:s,text:i}:s,s=e.extend({type:&quot;button&quot;},s),n=s.click,s.click=function(){n.apply(t.element[0],arguments)},a={icons:s.icons,text:s.showText},delete s.icons,delete s.showText,e(&quot;&lt;button&gt;&lt;/button&gt;&quot;,s).button(a).appendTo(t.uiButtonSet)}),this.uiDialog.addClass(&quot;ui-dialog-buttons&quot;),this.uiDialogButtonPane.appendTo(this.uiDialog),void 0)},_makeDraggable:function(){function t(e){return{position:e.position,offset:e.offset}}var i=this,s=this.options;this.uiDialog.draggable({cancel:&quot;.ui-dialog-content, .ui-dialog-titlebar-close&quot;,handle:&quot;.ui-dialog-titlebar&quot;,containment:&quot;document&quot;,start:function(s,n){e(this).addClass(&quot;ui-dialog-dragging&quot;),i._blockFrames(),i._trigger(&quot;dragStart&quot;,s,t(n))},drag:function(e,s){i._trigger(&quot;drag&quot;,e,t(s))},stop:function(n,a){var o=a.offset.left-i.document.scrollLeft(),r=a.offset.top-i.document.scrollTop();s.position={my:&quot;left top&quot;,at:&quot;left&quot;+(o&gt;=0?&quot;+&quot;:&quot;&quot;)+o+&quot; &quot;+&quot;top&quot;+(r&gt;=0?&quot;+&quot;:&quot;&quot;)+r,of:i.window},e(this).removeClass(&quot;ui-dialog-dragging&quot;),i._unblockFrames(),i._trigger(&quot;dragStop&quot;,n,t(a))}})},_makeResizable:function(){function t(e){return{originalPosition:e.originalPosition,originalSize:e.originalSize,position:e.position,size:e.size}}var i=this,s=this.options,n=s.resizable,a=this.uiDialog.css(&quot;position&quot;),o=&quot;string&quot;==typeof n?n:&quot;n,e,s,w,se,sw,ne,nw&quot;;this.uiDialog.resizable({cancel:&quot;.ui-dialog-content&quot;,containment:&quot;document&quot;,alsoResize:this.element,maxWidth:s.maxWidth,maxHeight:s.maxHeight,minWidth:s.minWidth,minHeight:this._minHeight(),handles:o,start:function(s,n){e(this).addClass(&quot;ui-dialog-resizing&quot;),i._blockFrames(),i._trigger(&quot;resizeStart&quot;,s,t(n))},resize:function(e,s){i._trigger(&quot;resize&quot;,e,t(s))},stop:function(n,a){var o=i.uiDialog.offset(),r=o.left-i.document.scrollLeft(),h=o.top-i.document.scrollTop();s.height=i.uiDialog.height(),s.width=i.uiDialog.width(),s.position={my:&quot;left top&quot;,at:&quot;left&quot;+(r&gt;=0?&quot;+&quot;:&quot;&quot;)+r+&quot; &quot;+&quot;top&quot;+(h&gt;=0?&quot;+&quot;:&quot;&quot;)+h,of:i.window},e(this).removeClass(&quot;ui-dialog-resizing&quot;),i._unblockFrames(),i._trigger(&quot;resizeStop&quot;,n,t(a))}}).css(&quot;position&quot;,a)},_trackFocus:function(){this._on(this.widget(),{focusin:function(t){this._makeFocusTarget(),this._focusedElement=e(t.target)}})},_makeFocusTarget:function(){this._untrackInstance(),this._trackingInstances().unshift(this)},_untrackInstance:function(){var t=this._trackingInstances(),i=e.inArray(this,t);-1!==i&amp;&amp;t.splice(i,1)},_trackingInstances:function(){var e=this.document.data(&quot;ui-dialog-instances&quot;);return e||(e=[],this.document.data(&quot;ui-dialog-instances&quot;,e)),e},_minHeight:function(){var e=this.options;return&quot;auto&quot;===e.height?e.minHeight:Math.min(e.minHeight,e.height)},_position:function(){var e=this.uiDialog.is(&quot;:visible&quot;);e||this.uiDialog.show(),this.uiDialog.position(this.options.position),e||this.uiDialog.hide()},_setOptions:function(t){var i=this,s=!1,n={};e.each(t,function(e,t){i._setOption(e,t),e in i.sizeRelatedOptions&amp;&amp;(s=!0),e in i.resizableRelatedOptions&amp;&amp;(n[e]=t)}),s&amp;&amp;(this._size(),this._position()),this.uiDialog.is(&quot;:data(ui-resizable)&quot;)&amp;&amp;this.uiDialog.resizable(&quot;option&quot;,n)},_setOption:function(e,t){var i,s,n=this.uiDialog;&quot;dialogClass&quot;===e&amp;&amp;n.removeClass(this.options.dialogClass).addClass(t),&quot;disabled&quot;!==e&amp;&amp;(this._super(e,t),&quot;appendTo&quot;===e&amp;&amp;this.uiDialog.appendTo(this._appendTo()),&quot;buttons&quot;===e&amp;&amp;this._createButtons(),&quot;closeText&quot;===e&amp;&amp;this.uiDialogTitlebarClose.button({label:&quot;&quot;+t}),&quot;draggable&quot;===e&amp;&amp;(i=n.is(&quot;:data(ui-draggable)&quot;),i&amp;&amp;!t&amp;&amp;n.draggable(&quot;destroy&quot;),!i&amp;&amp;t&amp;&amp;this._makeDraggable()),&quot;position&quot;===e&amp;&amp;this._position(),&quot;resizable&quot;===e&amp;&amp;(s=n.is(&quot;:data(ui-resizable)&quot;),s&amp;&amp;!t&amp;&amp;n.resizable(&quot;destroy&quot;),s&amp;&amp;&quot;string&quot;==typeof t&amp;&amp;n.resizable(&quot;option&quot;,&quot;handles&quot;,t),s||t===!1||this._makeResizable()),&quot;title&quot;===e&amp;&amp;this._title(this.uiDialogTitlebar.find(&quot;.ui-dialog-title&quot;)))},_size:function(){var e,t,i,s=this.options;this.element.show().css({width:&quot;auto&quot;,minHeight:0,maxHeight:&quot;none&quot;,height:0}),s.minWidth&gt;s.width&amp;&amp;(s.width=s.minWidth),e=this.uiDialog.css({height:&quot;auto&quot;,width:s.width}).outerHeight(),t=Math.max(0,s.minHeight-e),i=&quot;number&quot;==typeof s.maxHeight?Math.max(0,s.maxHeight-e):&quot;none&quot;,&quot;auto&quot;===s.height?this.element.css({minHeight:t,maxHeight:i,height:&quot;auto&quot;}):this.element.height(Math.max(0,s.height-e)),this.uiDialog.is(&quot;:data(ui-resizable)&quot;)&amp;&amp;this.uiDialog.resizable(&quot;option&quot;,&quot;minHeight&quot;,this._minHeight())},_blockFrames:function(){this.iframeBlocks=this.document.find(&quot;iframe&quot;).map(function(){var t=e(this);return e(&quot;&lt;div&gt;&quot;).css({position:&quot;absolute&quot;,width:t.outerWidth(),height:t.outerHeight()}).appendTo(t.parent()).offset(t.offset())[0]})},_unblockFrames:function(){this.iframeBlocks&amp;&amp;(this.iframeBlocks.remove(),delete this.iframeBlocks)},_allowInteraction:function(t){return e(t.target).closest(&quot;.ui-dialog&quot;).length?!0:!!e(t.target).closest(&quot;.ui-datepicker&quot;).length},_createOverlay:function(){if(this.options.modal){var t=!0;this._delay(function(){t=!1}),this.document.data(&quot;ui-dialog-overlays&quot;)||this._on(this.document,{focusin:function(e){t||this._allowInteraction(e)||(e.preventDefault(),this._trackingInstances()[0]._focusTabbable())}}),this.overlay=e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-widget-overlay ui-front&quot;).appendTo(this._appendTo()),this._on(this.overlay,{mousedown:&quot;_keepFocus&quot;}),this.document.data(&quot;ui-dialog-overlays&quot;,(this.document.data(&quot;ui-dialog-overlays&quot;)||0)+1)}},_destroyOverlay:function(){if(this.options.modal&amp;&amp;this.overlay){var e=this.document.data(&quot;ui-dialog-overlays&quot;)-1;e?this.document.data(&quot;ui-dialog-overlays&quot;,e):this.document.unbind(&quot;focusin&quot;).removeData(&quot;ui-dialog-overlays&quot;),this.overlay.remove(),this.overlay=null}}}),e.widget(&quot;ui.droppable&quot;,{version:&quot;1.11.4&quot;,widgetEventPrefix:&quot;drop&quot;,options:{accept:&quot;*&quot;,activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:&quot;default&quot;,tolerance:&quot;intersect&quot;,activate:null,deactivate:null,drop:null,out:null,over:null},_create:function(){var t,i=this.options,s=i.accept;this.isover=!1,this.isout=!0,this.accept=e.isFunction(s)?s:function(e){return e.is(s)},this.proportions=function(){return arguments.length?(t=arguments[0],void 0):t?t:t={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight}},this._addToManager(i.scope),i.addClasses&amp;&amp;this.element.addClass(&quot;ui-droppable&quot;)},_addToManager:function(t){e.ui.ddmanager.droppables[t]=e.ui.ddmanager.droppables[t]||[],e.ui.ddmanager.droppables[t].push(this)},_splice:function(e){for(var t=0;e.length&gt;t;t++)e[t]===this&amp;&amp;e.splice(t,1)},_destroy:function(){var t=e.ui.ddmanager.droppables[this.options.scope];this._splice(t),this.element.removeClass(&quot;ui-droppable ui-droppable-disabled&quot;)},_setOption:function(t,i){if(&quot;accept&quot;===t)this.accept=e.isFunction(i)?i:function(e){return e.is(i)};else if(&quot;scope&quot;===t){var s=e.ui.ddmanager.droppables[this.options.scope];this._splice(s),this._addToManager(i)}this._super(t,i)},_activate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&amp;&amp;this.element.addClass(this.options.activeClass),i&amp;&amp;this._trigger(&quot;activate&quot;,t,this.ui(i))},_deactivate:function(t){var i=e.ui.ddmanager.current;this.options.activeClass&amp;&amp;this.element.removeClass(this.options.activeClass),i&amp;&amp;this._trigger(&quot;deactivate&quot;,t,this.ui(i))},_over:function(t){var i=e.ui.ddmanager.current;i&amp;&amp;(i.currentItem||i.element)[0]!==this.element[0]&amp;&amp;this.accept.call(this.element[0],i.currentItem||i.element)&amp;&amp;(this.options.hoverClass&amp;&amp;this.element.addClass(this.options.hoverClass),this._trigger(&quot;over&quot;,t,this.ui(i)))},_out:function(t){var i=e.ui.ddmanager.current;i&amp;&amp;(i.currentItem||i.element)[0]!==this.element[0]&amp;&amp;this.accept.call(this.element[0],i.currentItem||i.element)&amp;&amp;(this.options.hoverClass&amp;&amp;this.element.removeClass(this.options.hoverClass),this._trigger(&quot;out&quot;,t,this.ui(i)))},_drop:function(t,i){var s=i||e.ui.ddmanager.current,n=!1;return s&amp;&amp;(s.currentItem||s.element)[0]!==this.element[0]?(this.element.find(&quot;:data(ui-droppable)&quot;).not(&quot;.ui-draggable-dragging&quot;).each(function(){var i=e(this).droppable(&quot;instance&quot;);return i.options.greedy&amp;&amp;!i.options.disabled&amp;&amp;i.options.scope===s.options.scope&amp;&amp;i.accept.call(i.element[0],s.currentItem||s.element)&amp;&amp;e.ui.intersect(s,e.extend(i,{offset:i.element.offset()}),i.options.tolerance,t)?(n=!0,!1):void 0}),n?!1:this.accept.call(this.element[0],s.currentItem||s.element)?(this.options.activeClass&amp;&amp;this.element.removeClass(this.options.activeClass),this.options.hoverClass&amp;&amp;this.element.removeClass(this.options.hoverClass),this._trigger(&quot;drop&quot;,t,this.ui(s)),this.element):!1):!1},ui:function(e){return{draggable:e.currentItem||e.element,helper:e.helper,position:e.position,offset:e.positionAbs}}}),e.ui.intersect=function(){function e(e,t,i){return e&gt;=t&amp;&amp;t+i&gt;e}return function(t,i,s,n){if(!i.offset)return!1;var a=(t.positionAbs||t.position.absolute).left+t.margins.left,o=(t.positionAbs||t.position.absolute).top+t.margins.top,r=a+t.helperProportions.width,h=o+t.helperProportions.height,l=i.offset.left,u=i.offset.top,d=l+i.proportions().width,c=u+i.proportions().height;switch(s){case&quot;fit&quot;:return a&gt;=l&amp;&amp;d&gt;=r&amp;&amp;o&gt;=u&amp;&amp;c&gt;=h;case&quot;intersect&quot;:return a+t.helperProportions.width/2&gt;l&amp;&amp;d&gt;r-t.helperProportions.width/2&amp;&amp;o+t.helperProportions.height/2&gt;u&amp;&amp;c&gt;h-t.helperProportions.height/2;case&quot;pointer&quot;:return e(n.pageY,u,i.proportions().height)&amp;&amp;e(n.pageX,l,i.proportions().width);case&quot;touch&quot;:return(o&gt;=u&amp;&amp;c&gt;=o||h&gt;=u&amp;&amp;c&gt;=h||u&gt;o&amp;&amp;h&gt;c)&amp;&amp;(a&gt;=l&amp;&amp;d&gt;=a||r&gt;=l&amp;&amp;d&gt;=r||l&gt;a&amp;&amp;r&gt;d);default:return!1}}}(),e.ui.ddmanager={current:null,droppables:{&quot;default&quot;:[]},prepareOffsets:function(t,i){var s,n,a=e.ui.ddmanager.droppables[t.options.scope]||[],o=i?i.type:null,r=(t.currentItem||t.element).find(&quot;:data(ui-droppable)&quot;).addBack();e:for(s=0;a.length&gt;s;s++)if(!(a[s].options.disabled||t&amp;&amp;!a[s].accept.call(a[s].element[0],t.currentItem||t.element))){for(n=0;r.length&gt;n;n++)if(r[n]===a[s].element[0]){a[s].proportions().height=0;continue e}a[s].visible=&quot;none&quot;!==a[s].element.css(&quot;display&quot;),a[s].visible&amp;&amp;(&quot;mousedown&quot;===o&amp;&amp;a[s]._activate.call(a[s],i),a[s].offset=a[s].element.offset(),a[s].proportions({width:a[s].element[0].offsetWidth,height:a[s].element[0].offsetHeight}))}},drop:function(t,i){var s=!1;return e.each((e.ui.ddmanager.droppables[t.options.scope]||[]).slice(),function(){this.options&amp;&amp;(!this.options.disabled&amp;&amp;this.visible&amp;&amp;e.ui.intersect(t,this,this.options.tolerance,i)&amp;&amp;(s=this._drop.call(this,i)||s),!this.options.disabled&amp;&amp;this.visible&amp;&amp;this.accept.call(this.element[0],t.currentItem||t.element)&amp;&amp;(this.isout=!0,this.isover=!1,this._deactivate.call(this,i)))}),s},dragStart:function(t,i){t.element.parentsUntil(&quot;body&quot;).bind(&quot;scroll.droppable&quot;,function(){t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)})},drag:function(t,i){t.options.refreshPositions&amp;&amp;e.ui.ddmanager.prepareOffsets(t,i),e.each(e.ui.ddmanager.droppables[t.options.scope]||[],function(){if(!this.options.disabled&amp;&amp;!this.greedyChild&amp;&amp;this.visible){var s,n,a,o=e.ui.intersect(t,this,this.options.tolerance,i),r=!o&amp;&amp;this.isover?&quot;isout&quot;:o&amp;&amp;!this.isover?&quot;isover&quot;:null;r&amp;&amp;(this.options.greedy&amp;&amp;(n=this.options.scope,a=this.element.parents(&quot;:data(ui-droppable)&quot;).filter(function(){return e(this).droppable(&quot;instance&quot;).options.scope===n}),a.length&amp;&amp;(s=e(a[0]).droppable(&quot;instance&quot;),s.greedyChild=&quot;isover&quot;===r)),s&amp;&amp;&quot;isover&quot;===r&amp;&amp;(s.isover=!1,s.isout=!0,s._out.call(s,i)),this[r]=!0,this[&quot;isout&quot;===r?&quot;isover&quot;:&quot;isout&quot;]=!1,this[&quot;isover&quot;===r?&quot;_over&quot;:&quot;_out&quot;].call(this,i),s&amp;&amp;&quot;isout&quot;===r&amp;&amp;(s.isout=!1,s.isover=!0,s._over.call(s,i)))}})},dragStop:function(t,i){t.element.parentsUntil(&quot;body&quot;).unbind(&quot;scroll.droppable&quot;),t.options.refreshPositions||e.ui.ddmanager.prepareOffsets(t,i)}},e.ui.droppable;var y=&quot;ui-effects-&quot;,b=e;e.effects={effect:{}},function(e,t){function i(e,t,i){var s=d[t.type]||{};return null==e?i||!t.def?null:t.def:(e=s.floor?~~e:parseFloat(e),isNaN(e)?t.def:s.mod?(e+s.mod)%s.mod:0&gt;e?0:e&gt;s.max?s.max:e)}function s(i){var s=l(),n=s._rgba=[];return i=i.toLowerCase(),f(h,function(e,a){var o,r=a.re.exec(i),h=r&amp;&amp;a.parse(r),l=a.space||&quot;rgba&quot;;return h?(o=s[l](h),s[u[l].cache]=o[u[l].cache],n=s._rgba=o._rgba,!1):t}),n.length?(&quot;0,0,0,0&quot;===n.join()&amp;&amp;e.extend(n,a.transparent),s):a[i]}function n(e,t,i){return i=(i+1)%1,1&gt;6*i?e+6*(t-e)*i:1&gt;2*i?t:2&gt;3*i?e+6*(t-e)*(2/3-i):e}var a,o=&quot;backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color columnRuleColor outlineColor textDecorationColor textEmphasisColor&quot;,r=/^([\-+])=\s*(\d+\.?\d*)/,h=[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/#([a-f0-9]{2})([a-f0-9]{2})([a-f0-9]{2})/,parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16)]}},{re:/#([a-f0-9])([a-f0-9])([a-f0-9])/,parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16)]}},{re:/hsla?\(\s*(\d+(?:\.\d+)?)\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d?(?:\.\d+)?)\s*)?\)/,space:&quot;hsla&quot;,parse:function(e){return[e[1],e[2]/100,e[3]/100,e[4]]}}],l=e.Color=function(t,i,s,n){return new e.Color.fn.parse(t,i,s,n)},u={rgba:{props:{red:{idx:0,type:&quot;byte&quot;},green:{idx:1,type:&quot;byte&quot;},blue:{idx:2,type:&quot;byte&quot;}}},hsla:{props:{hue:{idx:0,type:&quot;degrees&quot;},saturation:{idx:1,type:&quot;percent&quot;},lightness:{idx:2,type:&quot;percent&quot;}}}},d={&quot;byte&quot;:{floor:!0,max:255},percent:{max:1},degrees:{mod:360,floor:!0}},c=l.support={},p=e(&quot;&lt;p&gt;&quot;)[0],f=e.each;p.style.cssText=&quot;background-color:rgba(1,1,1,.5)&quot;,c.rgba=p.style.backgroundColor.indexOf(&quot;rgba&quot;)&gt;-1,f(u,function(e,t){t.cache=&quot;_&quot;+e,t.props.alpha={idx:3,type:&quot;percent&quot;,def:1}}),l.fn=e.extend(l.prototype,{parse:function(n,o,r,h){if(n===t)return this._rgba=[null,null,null,null],this;(n.jquery||n.nodeType)&amp;&amp;(n=e(n).css(o),o=t);var d=this,c=e.type(n),p=this._rgba=[];return o!==t&amp;&amp;(n=[n,o,r,h],c=&quot;array&quot;),&quot;string&quot;===c?this.parse(s(n)||a._default):&quot;array&quot;===c?(f(u.rgba.props,function(e,t){p[t.idx]=i(n[t.idx],t)}),this):&quot;object&quot;===c?(n instanceof l?f(u,function(e,t){n[t.cache]&amp;&amp;(d[t.cache]=n[t.cache].slice())}):f(u,function(t,s){var a=s.cache;f(s.props,function(e,t){if(!d[a]&amp;&amp;s.to){if(&quot;alpha&quot;===e||null==n[e])return;d[a]=s.to(d._rgba)}d[a][t.idx]=i(n[e],t,!0)}),d[a]&amp;&amp;0&gt;e.inArray(null,d[a].slice(0,3))&amp;&amp;(d[a][3]=1,s.from&amp;&amp;(d._rgba=s.from(d[a])))}),this):t},is:function(e){var i=l(e),s=!0,n=this;return f(u,function(e,a){var o,r=i[a.cache];return r&amp;&amp;(o=n[a.cache]||a.to&amp;&amp;a.to(n._rgba)||[],f(a.props,function(e,i){return null!=r[i.idx]?s=r[i.idx]===o[i.idx]:t})),s}),s},_space:function(){var e=[],t=this;return f(u,function(i,s){t[s.cache]&amp;&amp;e.push(i)}),e.pop()},transition:function(e,t){var s=l(e),n=s._space(),a=u[n],o=0===this.alpha()?l(&quot;transparent&quot;):this,r=o[a.cache]||a.to(o._rgba),h=r.slice();return s=s[a.cache],f(a.props,function(e,n){var a=n.idx,o=r[a],l=s[a],u=d[n.type]||{};null!==l&amp;&amp;(null===o?h[a]=l:(u.mod&amp;&amp;(l-o&gt;u.mod/2?o+=u.mod:o-l&gt;u.mod/2&amp;&amp;(o-=u.mod)),h[a]=i((l-o)*t+o,n)))}),this[n](h)},blend:function(t){if(1===this._rgba[3])return this;var i=this._rgba.slice(),s=i.pop(),n=l(t)._rgba;return l(e.map(i,function(e,t){return(1-s)*n[t]+s*e}))},toRgbaString:function(){var t=&quot;rgba(&quot;,i=e.map(this._rgba,function(e,t){return null==e?t&gt;2?1:0:e});return 1===i[3]&amp;&amp;(i.pop(),t=&quot;rgb(&quot;),t+i.join()+&quot;)&quot;},toHslaString:function(){var t=&quot;hsla(&quot;,i=e.map(this.hsla(),function(e,t){return null==e&amp;&amp;(e=t&gt;2?1:0),t&amp;&amp;3&gt;t&amp;&amp;(e=Math.round(100*e)+&quot;%&quot;),e});return 1===i[3]&amp;&amp;(i.pop(),t=&quot;hsl(&quot;),t+i.join()+&quot;)&quot;},toHexString:function(t){var i=this._rgba.slice(),s=i.pop();return t&amp;&amp;i.push(~~(255*s)),&quot;#&quot;+e.map(i,function(e){return e=(e||0).toString(16),1===e.length?&quot;0&quot;+e:e}).join(&quot;&quot;)},toString:function(){return 0===this._rgba[3]?&quot;transparent&quot;:this.toRgbaString()}}),l.fn.parse.prototype=l.fn,u.hsla.to=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t,i,s=e[0]/255,n=e[1]/255,a=e[2]/255,o=e[3],r=Math.max(s,n,a),h=Math.min(s,n,a),l=r-h,u=r+h,d=.5*u;return t=h===r?0:s===r?60*(n-a)/l+360:n===r?60*(a-s)/l+120:60*(s-n)/l+240,i=0===l?0:.5&gt;=d?l/u:l/(2-u),[Math.round(t)%360,i,d,null==o?1:o]},u.hsla.from=function(e){if(null==e[0]||null==e[1]||null==e[2])return[null,null,null,e[3]];var t=e[0]/360,i=e[1],s=e[2],a=e[3],o=.5&gt;=s?s*(1+i):s+i-s*i,r=2*s-o;return[Math.round(255*n(r,o,t+1/3)),Math.round(255*n(r,o,t)),Math.round(255*n(r,o,t-1/3)),a]},f(u,function(s,n){var a=n.props,o=n.cache,h=n.to,u=n.from;l.fn[s]=function(s){if(h&amp;&amp;!this[o]&amp;&amp;(this[o]=h(this._rgba)),s===t)return this[o].slice();var n,r=e.type(s),d=&quot;array&quot;===r||&quot;object&quot;===r?s:arguments,c=this[o].slice();return f(a,function(e,t){var s=d[&quot;object&quot;===r?e:t.idx];null==s&amp;&amp;(s=c[t.idx]),c[t.idx]=i(s,t)}),u?(n=l(u(c)),n[o]=c,n):l(c)},f(a,function(t,i){l.fn[t]||(l.fn[t]=function(n){var a,o=e.type(n),h=&quot;alpha&quot;===t?this._hsla?&quot;hsla&quot;:&quot;rgba&quot;:s,l=this[h](),u=l[i.idx];return&quot;undefined&quot;===o?u:(&quot;function&quot;===o&amp;&amp;(n=n.call(this,u),o=e.type(n)),null==n&amp;&amp;i.empty?this:(&quot;string&quot;===o&amp;&amp;(a=r.exec(n),a&amp;&amp;(n=u+parseFloat(a[2])*(&quot;+&quot;===a[1]?1:-1))),l[i.idx]=n,this[h](l)))})})}),l.hook=function(t){var i=t.split(&quot; &quot;);f(i,function(t,i){e.cssHooks[i]={set:function(t,n){var a,o,r=&quot;&quot;;if(&quot;transparent&quot;!==n&amp;&amp;(&quot;string&quot;!==e.type(n)||(a=s(n)))){if(n=l(a||n),!c.rgba&amp;&amp;1!==n._rgba[3]){for(o=&quot;backgroundColor&quot;===i?t.parentNode:t;(&quot;&quot;===r||&quot;transparent&quot;===r)&amp;&amp;o&amp;&amp;o.style;)try{r=e.css(o,&quot;backgroundColor&quot;),o=o.parentNode}catch(h){}n=n.blend(r&amp;&amp;&quot;transparent&quot;!==r?r:&quot;_default&quot;)}n=n.toRgbaString()}try{t.style[i]=n}catch(h){}}},e.fx.step[i]=function(t){t.colorInit||(t.start=l(t.elem,i),t.end=l(t.end),t.colorInit=!0),e.cssHooks[i].set(t.elem,t.start.transition(t.end,t.pos))}})},l.hook(o),e.cssHooks.borderColor={expand:function(e){var t={};return f([&quot;Top&quot;,&quot;Right&quot;,&quot;Bottom&quot;,&quot;Left&quot;],function(i,s){t[&quot;border&quot;+s+&quot;Color&quot;]=e}),t}},a=e.Color.names={aqua:&quot;#00ffff&quot;,black:&quot;#000000&quot;,blue:&quot;#0000ff&quot;,fuchsia:&quot;#ff00ff&quot;,gray:&quot;#808080&quot;,green:&quot;#008000&quot;,lime:&quot;#00ff00&quot;,maroon:&quot;#800000&quot;,navy:&quot;#000080&quot;,olive:&quot;#808000&quot;,purple:&quot;#800080&quot;,red:&quot;#ff0000&quot;,silver:&quot;#c0c0c0&quot;,teal:&quot;#008080&quot;,white:&quot;#ffffff&quot;,yellow:&quot;#ffff00&quot;,transparent:[null,null,null,0],_default:&quot;#ffffff&quot;}}(b),function(){function t(t){var i,s,n=t.ownerDocument.defaultView?t.ownerDocument.defaultView.getComputedStyle(t,null):t.currentStyle,a={};if(n&amp;&amp;n.length&amp;&amp;n[0]&amp;&amp;n[n[0]])for(s=n.length;s--;)i=n[s],&quot;string&quot;==typeof n[i]&amp;&amp;(a[e.camelCase(i)]=n[i]);else for(i in n)&quot;string&quot;==typeof n[i]&amp;&amp;(a[i]=n[i]);return a}function i(t,i){var s,a,o={};for(s in i)a=i[s],t[s]!==a&amp;&amp;(n[s]||(e.fx.step[s]||!isNaN(parseFloat(a)))&amp;&amp;(o[s]=a));return o}var s=[&quot;add&quot;,&quot;remove&quot;,&quot;toggle&quot;],n={border:1,borderBottom:1,borderColor:1,borderLeft:1,borderRight:1,borderTop:1,borderWidth:1,margin:1,padding:1};e.each([&quot;borderLeftStyle&quot;,&quot;borderRightStyle&quot;,&quot;borderBottomStyle&quot;,&quot;borderTopStyle&quot;],function(t,i){e.fx.step[i]=function(e){(&quot;none&quot;!==e.end&amp;&amp;!e.setAttr||1===e.pos&amp;&amp;!e.setAttr)&amp;&amp;(b.style(e.elem,i,e.end),e.setAttr=!0)}}),e.fn.addBack||(e.fn.addBack=function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}),e.effects.animateClass=function(n,a,o,r){var h=e.speed(a,o,r);return this.queue(function(){var a,o=e(this),r=o.attr(&quot;class&quot;)||&quot;&quot;,l=h.children?o.find(&quot;*&quot;).addBack():o;l=l.map(function(){var i=e(this);return{el:i,start:t(this)}}),a=function(){e.each(s,function(e,t){n[t]&amp;&amp;o[t+&quot;Class&quot;](n[t])})},a(),l=l.map(function(){return this.end=t(this.el[0]),this.diff=i(this.start,this.end),this}),o.attr(&quot;class&quot;,r),l=l.map(function(){var t=this,i=e.Deferred(),s=e.extend({},h,{queue:!1,complete:function(){i.resolve(t)}});return this.el.animate(this.diff,s),i.promise()}),e.when.apply(e,l.get()).done(function(){a(),e.each(arguments,function(){var t=this.el;e.each(this.diff,function(e){t.css(e,&quot;&quot;)})}),h.complete.call(o[0])})})},e.fn.extend({addClass:function(t){return function(i,s,n,a){return s?e.effects.animateClass.call(this,{add:i},s,n,a):t.apply(this,arguments)}}(e.fn.addClass),removeClass:function(t){return function(i,s,n,a){return arguments.length&gt;1?e.effects.animateClass.call(this,{remove:i},s,n,a):t.apply(this,arguments)}}(e.fn.removeClass),toggleClass:function(t){return function(i,s,n,a,o){return&quot;boolean&quot;==typeof s||void 0===s?n?e.effects.animateClass.call(this,s?{add:i}:{remove:i},n,a,o):t.apply(this,arguments):e.effects.animateClass.call(this,{toggle:i},s,n,a)}}(e.fn.toggleClass),switchClass:function(t,i,s,n,a){return e.effects.animateClass.call(this,{add:i,remove:t},s,n,a)}})}(),function(){function t(t,i,s,n){return e.isPlainObject(t)&amp;&amp;(i=t,t=t.effect),t={effect:t},null==i&amp;&amp;(i={}),e.isFunction(i)&amp;&amp;(n=i,s=null,i={}),(&quot;number&quot;==typeof i||e.fx.speeds[i])&amp;&amp;(n=s,s=i,i={}),e.isFunction(s)&amp;&amp;(n=s,s=null),i&amp;&amp;e.extend(t,i),s=s||i.duration,t.duration=e.fx.off?0:&quot;number&quot;==typeof s?s:s in e.fx.speeds?e.fx.speeds[s]:e.fx.speeds._default,t.complete=n||i.complete,t}function i(t){return!t||&quot;number&quot;==typeof t||e.fx.speeds[t]?!0:&quot;string&quot;!=typeof t||e.effects.effect[t]?e.isFunction(t)?!0:&quot;object&quot;!=typeof t||t.effect?!1:!0:!0}e.extend(e.effects,{version:&quot;1.11.4&quot;,save:function(e,t){for(var i=0;t.length&gt;i;i++)null!==t[i]&amp;&amp;e.data(y+t[i],e[0].style[t[i]])},restore:function(e,t){var i,s;for(s=0;t.length&gt;s;s++)null!==t[s]&amp;&amp;(i=e.data(y+t[s]),void 0===i&amp;&amp;(i=&quot;&quot;),e.css(t[s],i))},setMode:function(e,t){return&quot;toggle&quot;===t&amp;&amp;(t=e.is(&quot;:hidden&quot;)?&quot;show&quot;:&quot;hide&quot;),t},getBaseline:function(e,t){var i,s;switch(e[0]){case&quot;top&quot;:i=0;break;case&quot;middle&quot;:i=.5;break;case&quot;bottom&quot;:i=1;break;default:i=e[0]/t.height}switch(e[1]){case&quot;left&quot;:s=0;break;case&quot;center&quot;:s=.5;break;case&quot;right&quot;:s=1;break;default:s=e[1]/t.width}return{x:s,y:i}},createWrapper:function(t){if(t.parent().is(&quot;.ui-effects-wrapper&quot;))return t.parent();var i={width:t.outerWidth(!0),height:t.outerHeight(!0),&quot;float&quot;:t.css(&quot;float&quot;)},s=e(&quot;&lt;div&gt;&lt;/div&gt;&quot;).addClass(&quot;ui-effects-wrapper&quot;).css({fontSize:&quot;100%&quot;,background:&quot;transparent&quot;,border:&quot;none&quot;,margin:0,padding:0}),n={width:t.width(),height:t.height()},a=document.activeElement;try{a.id}catch(o){a=document.body}return t.wrap(s),(t[0]===a||e.contains(t[0],a))&amp;&amp;e(a).focus(),s=t.parent(),&quot;static&quot;===t.css(&quot;position&quot;)?(s.css({position:&quot;relative&quot;}),t.css({position:&quot;relative&quot;})):(e.extend(i,{position:t.css(&quot;position&quot;),zIndex:t.css(&quot;z-index&quot;)}),e.each([&quot;top&quot;,&quot;left&quot;,&quot;bottom&quot;,&quot;right&quot;],function(e,s){i[s]=t.css(s),isNaN(parseInt(i[s],10))&amp;&amp;(i[s]=&quot;auto&quot;)}),t.css({position:&quot;relative&quot;,top:0,left:0,right:&quot;auto&quot;,bottom:&quot;auto&quot;})),t.css(n),s.css(i).show()},removeWrapper:function(t){var i=document.activeElement;return t.parent().is(&quot;.ui-effects-wrapper&quot;)&amp;&amp;(t.parent().replaceWith(t),(t[0]===i||e.contains(t[0],i))&amp;&amp;e(i).focus()),t},setTransition:function(t,i,s,n){return n=n||{},e.each(i,function(e,i){var a=t.cssUnit(i);a[0]&gt;0&amp;&amp;(n[i]=a[0]*s+a[1])}),n}}),e.fn.extend({effect:function(){function i(t){function i(){e.isFunction(a)&amp;&amp;a.call(n[0]),e.isFunction(t)&amp;&amp;t()}var n=e(this),a=s.complete,r=s.mode;(n.is(&quot;:hidden&quot;)?&quot;hide&quot;===r:&quot;show&quot;===r)?(n[r](),i()):o.call(n[0],s,i)}var s=t.apply(this,arguments),n=s.mode,a=s.queue,o=e.effects.effect[s.effect];return e.fx.off||!o?n?this[n](s.duration,s.complete):this.each(function(){s.complete&amp;&amp;s.complete.call(this)}):a===!1?this.each(i):this.queue(a||&quot;fx&quot;,i)},show:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode=&quot;show&quot;,this.effect.call(this,n)}}(e.fn.show),hide:function(e){return function(s){if(i(s))return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode=&quot;hide&quot;,this.effect.call(this,n)}}(e.fn.hide),toggle:function(e){return function(s){if(i(s)||&quot;boolean&quot;==typeof s)return e.apply(this,arguments);var n=t.apply(this,arguments);return n.mode=&quot;toggle&quot;,this.effect.call(this,n)}}(e.fn.toggle),cssUnit:function(t){var i=this.css(t),s=[];return e.each([&quot;em&quot;,&quot;px&quot;,&quot;%&quot;,&quot;pt&quot;],function(e,t){i.indexOf(t)&gt;0&amp;&amp;(s=[parseFloat(i),t])}),s}})}(),function(){var t={};e.each([&quot;Quad&quot;,&quot;Cubic&quot;,&quot;Quart&quot;,&quot;Quint&quot;,&quot;Expo&quot;],function(e,i){t[i]=function(t){return Math.pow(t,e+2)}}),e.extend(t,{Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Circ:function(e){return 1-Math.sqrt(1-e*e)},Elastic:function(e){return 0===e||1===e?e:-Math.pow(2,8*(e-1))*Math.sin((80*(e-1)-7.5)*Math.PI/15)},Back:function(e){return e*e*(3*e-2)},Bounce:function(e){for(var t,i=4;((t=Math.pow(2,--i))-1)/11&gt;e;);return 1/Math.pow(4,3-i)-7.5625*Math.pow((3*t-2)/22-e,2)}}),e.each(t,function(t,i){e.easing[&quot;easeIn&quot;+t]=i,e.easing[&quot;easeOut&quot;+t]=function(e){return 1-i(1-e)},e.easing[&quot;easeInOut&quot;+t]=function(e){return.5&gt;e?i(2*e)/2:1-i(-2*e+2)/2}})}(),e.effects,e.effects.effect.blind=function(t,i){var s,n,a,o=e(this),r=/up|down|vertical/,h=/up|left|vertical|horizontal/,l=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;height&quot;,&quot;width&quot;],u=e.effects.setMode(o,t.mode||&quot;hide&quot;),d=t.direction||&quot;up&quot;,c=r.test(d),p=c?&quot;height&quot;:&quot;width&quot;,f=c?&quot;top&quot;:&quot;left&quot;,m=h.test(d),g={},v=&quot;show&quot;===u;o.parent().is(&quot;.ui-effects-wrapper&quot;)?e.effects.save(o.parent(),l):e.effects.save(o,l),o.show(),s=e.effects.createWrapper(o).css({overflow:&quot;hidden&quot;}),n=s[p](),a=parseFloat(s.css(f))||0,g[p]=v?n:0,m||(o.css(c?&quot;bottom&quot;:&quot;right&quot;,0).css(c?&quot;top&quot;:&quot;left&quot;,&quot;auto&quot;).css({position:&quot;absolute&quot;}),g[f]=v?a:n+a),v&amp;&amp;(s.css(p,0),m||s.css(f,a+n)),s.animate(g,{duration:t.duration,easing:t.easing,queue:!1,complete:function(){&quot;hide&quot;===u&amp;&amp;o.hide(),e.effects.restore(o,l),e.effects.removeWrapper(o),i()}})},e.effects.effect.bounce=function(t,i){var s,n,a,o=e(this),r=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;height&quot;,&quot;width&quot;],h=e.effects.setMode(o,t.mode||&quot;effect&quot;),l=&quot;hide&quot;===h,u=&quot;show&quot;===h,d=t.direction||&quot;up&quot;,c=t.distance,p=t.times||5,f=2*p+(u||l?1:0),m=t.duration/f,g=t.easing,v=&quot;up&quot;===d||&quot;down&quot;===d?&quot;top&quot;:&quot;left&quot;,y=&quot;up&quot;===d||&quot;left&quot;===d,b=o.queue(),_=b.length;for((u||l)&amp;&amp;r.push(&quot;opacity&quot;),e.effects.save(o,r),o.show(),e.effects.createWrapper(o),c||(c=o[&quot;top&quot;===v?&quot;outerHeight&quot;:&quot;outerWidth&quot;]()/3),u&amp;&amp;(a={opacity:1},a[v]=0,o.css(&quot;opacity&quot;,0).css(v,y?2*-c:2*c).animate(a,m,g)),l&amp;&amp;(c/=Math.pow(2,p-1)),a={},a[v]=0,s=0;p&gt;s;s++)n={},n[v]=(y?&quot;-=&quot;:&quot;+=&quot;)+c,o.animate(n,m,g).animate(a,m,g),c=l?2*c:c/2;l&amp;&amp;(n={opacity:0},n[v]=(y?&quot;-=&quot;:&quot;+=&quot;)+c,o.animate(n,m,g)),o.queue(function(){l&amp;&amp;o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}),_&gt;1&amp;&amp;b.splice.apply(b,[1,0].concat(b.splice(_,f+1))),o.dequeue()},e.effects.effect.clip=function(t,i){var s,n,a,o=e(this),r=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;height&quot;,&quot;width&quot;],h=e.effects.setMode(o,t.mode||&quot;hide&quot;),l=&quot;show&quot;===h,u=t.direction||&quot;vertical&quot;,d=&quot;vertical&quot;===u,c=d?&quot;height&quot;:&quot;width&quot;,p=d?&quot;top&quot;:&quot;left&quot;,f={};e.effects.save(o,r),o.show(),s=e.effects.createWrapper(o).css({overflow:&quot;hidden&quot;}),n=&quot;IMG&quot;===o[0].tagName?s:o,a=n[c](),l&amp;&amp;(n.css(c,0),n.css(p,a/2)),f[c]=l?a:0,f[p]=l?0:a/2,n.animate(f,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){l||o.hide(),e.effects.restore(o,r),e.effects.removeWrapper(o),i()}})},e.effects.effect.drop=function(t,i){var s,n=e(this),a=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;opacity&quot;,&quot;height&quot;,&quot;width&quot;],o=e.effects.setMode(n,t.mode||&quot;hide&quot;),r=&quot;show&quot;===o,h=t.direction||&quot;left&quot;,l=&quot;up&quot;===h||&quot;down&quot;===h?&quot;top&quot;:&quot;left&quot;,u=&quot;up&quot;===h||&quot;left&quot;===h?&quot;pos&quot;:&quot;neg&quot;,d={opacity:r?1:0};e.effects.save(n,a),n.show(),e.effects.createWrapper(n),s=t.distance||n[&quot;top&quot;===l?&quot;outerHeight&quot;:&quot;outerWidth&quot;](!0)/2,r&amp;&amp;n.css(&quot;opacity&quot;,0).css(l,&quot;pos&quot;===u?-s:s),d[l]=(r?&quot;pos&quot;===u?&quot;+=&quot;:&quot;-=&quot;:&quot;pos&quot;===u?&quot;-=&quot;:&quot;+=&quot;)+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){&quot;hide&quot;===o&amp;&amp;n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.explode=function(t,i){function s(){b.push(this),b.length===d*c&amp;&amp;n()}function n(){p.css({visibility:&quot;visible&quot;}),e(b).remove(),m||p.hide(),i()}var a,o,r,h,l,u,d=t.pieces?Math.round(Math.sqrt(t.pieces)):3,c=d,p=e(this),f=e.effects.setMode(p,t.mode||&quot;hide&quot;),m=&quot;show&quot;===f,g=p.show().css(&quot;visibility&quot;,&quot;hidden&quot;).offset(),v=Math.ceil(p.outerWidth()/c),y=Math.ceil(p.outerHeight()/d),b=[];for(a=0;d&gt;a;a++)for(h=g.top+a*y,u=a-(d-1)/2,o=0;c&gt;o;o++)r=g.left+o*v,l=o-(c-1)/2,p.clone().appendTo(&quot;body&quot;).wrap(&quot;&lt;div&gt;&lt;/div&gt;&quot;).css({position:&quot;absolute&quot;,visibility:&quot;visible&quot;,left:-o*v,top:-a*y}).parent().addClass(&quot;ui-effects-explode&quot;).css({position:&quot;absolute&quot;,overflow:&quot;hidden&quot;,width:v,height:y,left:r+(m?l*v:0),top:h+(m?u*y:0),opacity:m?0:1}).animate({left:r+(m?0:l*v),top:h+(m?0:u*y),opacity:m?1:0},t.duration||500,t.easing,s)},e.effects.effect.fade=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||&quot;toggle&quot;);s.animate({opacity:n},{queue:!1,duration:t.duration,easing:t.easing,complete:i})},e.effects.effect.fold=function(t,i){var s,n,a=e(this),o=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;height&quot;,&quot;width&quot;],r=e.effects.setMode(a,t.mode||&quot;hide&quot;),h=&quot;show&quot;===r,l=&quot;hide&quot;===r,u=t.size||15,d=/([0-9]+)%/.exec(u),c=!!t.horizFirst,p=h!==c,f=p?[&quot;width&quot;,&quot;height&quot;]:[&quot;height&quot;,&quot;width&quot;],m=t.duration/2,g={},v={};e.effects.save(a,o),a.show(),s=e.effects.createWrapper(a).css({overflow:&quot;hidden&quot;}),n=p?[s.width(),s.height()]:[s.height(),s.width()],d&amp;&amp;(u=parseInt(d[1],10)/100*n[l?0:1]),h&amp;&amp;s.css(c?{height:0,width:u}:{height:u,width:0}),g[f[0]]=h?n[0]:u,v[f[1]]=h?n[1]:0,s.animate(g,m,t.easing).animate(v,m,t.easing,function(){l&amp;&amp;a.hide(),e.effects.restore(a,o),e.effects.removeWrapper(a),i()})},e.effects.effect.highlight=function(t,i){var s=e(this),n=[&quot;backgroundImage&quot;,&quot;backgroundColor&quot;,&quot;opacity&quot;],a=e.effects.setMode(s,t.mode||&quot;show&quot;),o={backgroundColor:s.css(&quot;backgroundColor&quot;)};&quot;hide&quot;===a&amp;&amp;(o.opacity=0),e.effects.save(s,n),s.show().css({backgroundImage:&quot;none&quot;,backgroundColor:t.color||&quot;#ffff99&quot;}).animate(o,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){&quot;hide&quot;===a&amp;&amp;s.hide(),e.effects.restore(s,n),i()}})},e.effects.effect.size=function(t,i){var s,n,a,o=e(this),r=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;width&quot;,&quot;height&quot;,&quot;overflow&quot;,&quot;opacity&quot;],h=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;overflow&quot;,&quot;opacity&quot;],l=[&quot;width&quot;,&quot;height&quot;,&quot;overflow&quot;],u=[&quot;fontSize&quot;],d=[&quot;borderTopWidth&quot;,&quot;borderBottomWidth&quot;,&quot;paddingTop&quot;,&quot;paddingBottom&quot;],c=[&quot;borderLeftWidth&quot;,&quot;borderRightWidth&quot;,&quot;paddingLeft&quot;,&quot;paddingRight&quot;],p=e.effects.setMode(o,t.mode||&quot;effect&quot;),f=t.restore||&quot;effect&quot;!==p,m=t.scale||&quot;both&quot;,g=t.origin||[&quot;middle&quot;,&quot;center&quot;],v=o.css(&quot;position&quot;),y=f?r:h,b={height:0,width:0,outerHeight:0,outerWidth:0};&quot;show&quot;===p&amp;&amp;o.show(),s={height:o.height(),width:o.width(),outerHeight:o.outerHeight(),outerWidth:o.outerWidth()},&quot;toggle&quot;===t.mode&amp;&amp;&quot;show&quot;===p?(o.from=t.to||b,o.to=t.from||s):(o.from=t.from||(&quot;show&quot;===p?b:s),o.to=t.to||(&quot;hide&quot;===p?b:s)),a={from:{y:o.from.height/s.height,x:o.from.width/s.width},to:{y:o.to.height/s.height,x:o.to.width/s.width}},(&quot;box&quot;===m||&quot;both&quot;===m)&amp;&amp;(a.from.y!==a.to.y&amp;&amp;(y=y.concat(d),o.from=e.effects.setTransition(o,d,a.from.y,o.from),o.to=e.effects.setTransition(o,d,a.to.y,o.to)),a.from.x!==a.to.x&amp;&amp;(y=y.concat(c),o.from=e.effects.setTransition(o,c,a.from.x,o.from),o.to=e.effects.setTransition(o,c,a.to.x,o.to))),(&quot;content&quot;===m||&quot;both&quot;===m)&amp;&amp;a.from.y!==a.to.y&amp;&amp;(y=y.concat(u).concat(l),o.from=e.effects.setTransition(o,u,a.from.y,o.from),o.to=e.effects.setTransition(o,u,a.to.y,o.to)),e.effects.save(o,y),o.show(),e.effects.createWrapper(o),o.css(&quot;overflow&quot;,&quot;hidden&quot;).css(o.from),g&amp;&amp;(n=e.effects.getBaseline(g,s),o.from.top=(s.outerHeight-o.outerHeight())*n.y,o.from.left=(s.outerWidth-o.outerWidth())*n.x,o.to.top=(s.outerHeight-o.to.outerHeight)*n.y,o.to.left=(s.outerWidth-o.to.outerWidth)*n.x),o.css(o.from),(&quot;content&quot;===m||&quot;both&quot;===m)&amp;&amp;(d=d.concat([&quot;marginTop&quot;,&quot;marginBottom&quot;]).concat(u),c=c.concat([&quot;marginLeft&quot;,&quot;marginRight&quot;]),l=r.concat(d).concat(c),o.find(&quot;*[width]&quot;).each(function(){var i=e(this),s={height:i.height(),width:i.width(),outerHeight:i.outerHeight(),outerWidth:i.outerWidth()};
f&amp;&amp;e.effects.save(i,l),i.from={height:s.height*a.from.y,width:s.width*a.from.x,outerHeight:s.outerHeight*a.from.y,outerWidth:s.outerWidth*a.from.x},i.to={height:s.height*a.to.y,width:s.width*a.to.x,outerHeight:s.height*a.to.y,outerWidth:s.width*a.to.x},a.from.y!==a.to.y&amp;&amp;(i.from=e.effects.setTransition(i,d,a.from.y,i.from),i.to=e.effects.setTransition(i,d,a.to.y,i.to)),a.from.x!==a.to.x&amp;&amp;(i.from=e.effects.setTransition(i,c,a.from.x,i.from),i.to=e.effects.setTransition(i,c,a.to.x,i.to)),i.css(i.from),i.animate(i.to,t.duration,t.easing,function(){f&amp;&amp;e.effects.restore(i,l)})})),o.animate(o.to,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){0===o.to.opacity&amp;&amp;o.css(&quot;opacity&quot;,o.from.opacity),&quot;hide&quot;===p&amp;&amp;o.hide(),e.effects.restore(o,y),f||(&quot;static&quot;===v?o.css({position:&quot;relative&quot;,top:o.to.top,left:o.to.left}):e.each([&quot;top&quot;,&quot;left&quot;],function(e,t){o.css(t,function(t,i){var s=parseInt(i,10),n=e?o.to.left:o.to.top;return&quot;auto&quot;===i?n+&quot;px&quot;:s+n+&quot;px&quot;})})),e.effects.removeWrapper(o),i()}})},e.effects.effect.scale=function(t,i){var s=e(this),n=e.extend(!0,{},t),a=e.effects.setMode(s,t.mode||&quot;effect&quot;),o=parseInt(t.percent,10)||(0===parseInt(t.percent,10)?0:&quot;hide&quot;===a?0:100),r=t.direction||&quot;both&quot;,h=t.origin,l={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()},u={y:&quot;horizontal&quot;!==r?o/100:1,x:&quot;vertical&quot;!==r?o/100:1};n.effect=&quot;size&quot;,n.queue=!1,n.complete=i,&quot;effect&quot;!==a&amp;&amp;(n.origin=h||[&quot;middle&quot;,&quot;center&quot;],n.restore=!0),n.from=t.from||(&quot;show&quot;===a?{height:0,width:0,outerHeight:0,outerWidth:0}:l),n.to={height:l.height*u.y,width:l.width*u.x,outerHeight:l.outerHeight*u.y,outerWidth:l.outerWidth*u.x},n.fade&amp;&amp;(&quot;show&quot;===a&amp;&amp;(n.from.opacity=0,n.to.opacity=1),&quot;hide&quot;===a&amp;&amp;(n.from.opacity=1,n.to.opacity=0)),s.effect(n)},e.effects.effect.puff=function(t,i){var s=e(this),n=e.effects.setMode(s,t.mode||&quot;hide&quot;),a=&quot;hide&quot;===n,o=parseInt(t.percent,10)||150,r=o/100,h={height:s.height(),width:s.width(),outerHeight:s.outerHeight(),outerWidth:s.outerWidth()};e.extend(t,{effect:&quot;scale&quot;,queue:!1,fade:!0,mode:n,complete:i,percent:a?o:100,from:a?h:{height:h.height*r,width:h.width*r,outerHeight:h.outerHeight*r,outerWidth:h.outerWidth*r}}),s.effect(t)},e.effects.effect.pulsate=function(t,i){var s,n=e(this),a=e.effects.setMode(n,t.mode||&quot;show&quot;),o=&quot;show&quot;===a,r=&quot;hide&quot;===a,h=o||&quot;hide&quot;===a,l=2*(t.times||5)+(h?1:0),u=t.duration/l,d=0,c=n.queue(),p=c.length;for((o||!n.is(&quot;:visible&quot;))&amp;&amp;(n.css(&quot;opacity&quot;,0).show(),d=1),s=1;l&gt;s;s++)n.animate({opacity:d},u,t.easing),d=1-d;n.animate({opacity:d},u,t.easing),n.queue(function(){r&amp;&amp;n.hide(),i()}),p&gt;1&amp;&amp;c.splice.apply(c,[1,0].concat(c.splice(p,l+1))),n.dequeue()},e.effects.effect.shake=function(t,i){var s,n=e(this),a=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;height&quot;,&quot;width&quot;],o=e.effects.setMode(n,t.mode||&quot;effect&quot;),r=t.direction||&quot;left&quot;,h=t.distance||20,l=t.times||3,u=2*l+1,d=Math.round(t.duration/u),c=&quot;up&quot;===r||&quot;down&quot;===r?&quot;top&quot;:&quot;left&quot;,p=&quot;up&quot;===r||&quot;left&quot;===r,f={},m={},g={},v=n.queue(),y=v.length;for(e.effects.save(n,a),n.show(),e.effects.createWrapper(n),f[c]=(p?&quot;-=&quot;:&quot;+=&quot;)+h,m[c]=(p?&quot;+=&quot;:&quot;-=&quot;)+2*h,g[c]=(p?&quot;-=&quot;:&quot;+=&quot;)+2*h,n.animate(f,d,t.easing),s=1;l&gt;s;s++)n.animate(m,d,t.easing).animate(g,d,t.easing);n.animate(m,d,t.easing).animate(f,d/2,t.easing).queue(function(){&quot;hide&quot;===o&amp;&amp;n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}),y&gt;1&amp;&amp;v.splice.apply(v,[1,0].concat(v.splice(y,u+1))),n.dequeue()},e.effects.effect.slide=function(t,i){var s,n=e(this),a=[&quot;position&quot;,&quot;top&quot;,&quot;bottom&quot;,&quot;left&quot;,&quot;right&quot;,&quot;width&quot;,&quot;height&quot;],o=e.effects.setMode(n,t.mode||&quot;show&quot;),r=&quot;show&quot;===o,h=t.direction||&quot;left&quot;,l=&quot;up&quot;===h||&quot;down&quot;===h?&quot;top&quot;:&quot;left&quot;,u=&quot;up&quot;===h||&quot;left&quot;===h,d={};e.effects.save(n,a),n.show(),s=t.distance||n[&quot;top&quot;===l?&quot;outerHeight&quot;:&quot;outerWidth&quot;](!0),e.effects.createWrapper(n).css({overflow:&quot;hidden&quot;}),r&amp;&amp;n.css(l,u?isNaN(s)?&quot;-&quot;+s:-s:s),d[l]=(r?u?&quot;+=&quot;:&quot;-=&quot;:u?&quot;-=&quot;:&quot;+=&quot;)+s,n.animate(d,{queue:!1,duration:t.duration,easing:t.easing,complete:function(){&quot;hide&quot;===o&amp;&amp;n.hide(),e.effects.restore(n,a),e.effects.removeWrapper(n),i()}})},e.effects.effect.transfer=function(t,i){var s=e(this),n=e(t.to),a=&quot;fixed&quot;===n.css(&quot;position&quot;),o=e(&quot;body&quot;),r=a?o.scrollTop():0,h=a?o.scrollLeft():0,l=n.offset(),u={top:l.top-r,left:l.left-h,height:n.innerHeight(),width:n.innerWidth()},d=s.offset(),c=e(&quot;&lt;div class='ui-effects-transfer'&gt;&lt;/div&gt;&quot;).appendTo(document.body).addClass(t.className).css({top:d.top-r,left:d.left-h,height:s.innerHeight(),width:s.innerWidth(),position:a?&quot;fixed&quot;:&quot;absolute&quot;}).animate(u,t.duration,t.easing,function(){c.remove(),i()})},e.widget(&quot;ui.progressbar&quot;,{version:&quot;1.11.4&quot;,options:{max:100,value:0,change:null,complete:null},min:0,_create:function(){this.oldValue=this.options.value=this._constrainedValue(),this.element.addClass(&quot;ui-progressbar ui-widget ui-widget-content ui-corner-all&quot;).attr({role:&quot;progressbar&quot;,&quot;aria-valuemin&quot;:this.min}),this.valueDiv=e(&quot;&lt;div class='ui-progressbar-value ui-widget-header ui-corner-left'&gt;&lt;/div&gt;&quot;).appendTo(this.element),this._refreshValue()},_destroy:function(){this.element.removeClass(&quot;ui-progressbar ui-widget ui-widget-content ui-corner-all&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-valuemin&quot;).removeAttr(&quot;aria-valuemax&quot;).removeAttr(&quot;aria-valuenow&quot;),this.valueDiv.remove()},value:function(e){return void 0===e?this.options.value:(this.options.value=this._constrainedValue(e),this._refreshValue(),void 0)},_constrainedValue:function(e){return void 0===e&amp;&amp;(e=this.options.value),this.indeterminate=e===!1,&quot;number&quot;!=typeof e&amp;&amp;(e=0),this.indeterminate?!1:Math.min(this.options.max,Math.max(this.min,e))},_setOptions:function(e){var t=e.value;delete e.value,this._super(e),this.options.value=this._constrainedValue(t),this._refreshValue()},_setOption:function(e,t){&quot;max&quot;===e&amp;&amp;(t=Math.max(this.min,t)),&quot;disabled&quot;===e&amp;&amp;this.element.toggleClass(&quot;ui-state-disabled&quot;,!!t).attr(&quot;aria-disabled&quot;,t),this._super(e,t)},_percentage:function(){return this.indeterminate?100:100*(this.options.value-this.min)/(this.options.max-this.min)},_refreshValue:function(){var t=this.options.value,i=this._percentage();this.valueDiv.toggle(this.indeterminate||t&gt;this.min).toggleClass(&quot;ui-corner-right&quot;,t===this.options.max).width(i.toFixed(0)+&quot;%&quot;),this.element.toggleClass(&quot;ui-progressbar-indeterminate&quot;,this.indeterminate),this.indeterminate?(this.element.removeAttr(&quot;aria-valuenow&quot;),this.overlayDiv||(this.overlayDiv=e(&quot;&lt;div class='ui-progressbar-overlay'&gt;&lt;/div&gt;&quot;).appendTo(this.valueDiv))):(this.element.attr({&quot;aria-valuemax&quot;:this.options.max,&quot;aria-valuenow&quot;:t}),this.overlayDiv&amp;&amp;(this.overlayDiv.remove(),this.overlayDiv=null)),this.oldValue!==t&amp;&amp;(this.oldValue=t,this._trigger(&quot;change&quot;)),t===this.options.max&amp;&amp;this._trigger(&quot;complete&quot;)}}),e.widget(&quot;ui.selectable&quot;,e.ui.mouse,{version:&quot;1.11.4&quot;,options:{appendTo:&quot;body&quot;,autoRefresh:!0,distance:0,filter:&quot;*&quot;,tolerance:&quot;touch&quot;,selected:null,selecting:null,start:null,stop:null,unselected:null,unselecting:null},_create:function(){var t,i=this;this.element.addClass(&quot;ui-selectable&quot;),this.dragged=!1,this.refresh=function(){t=e(i.options.filter,i.element[0]),t.addClass(&quot;ui-selectee&quot;),t.each(function(){var t=e(this),i=t.offset();e.data(this,&quot;selectable-item&quot;,{element:this,$element:t,left:i.left,top:i.top,right:i.left+t.outerWidth(),bottom:i.top+t.outerHeight(),startselected:!1,selected:t.hasClass(&quot;ui-selected&quot;),selecting:t.hasClass(&quot;ui-selecting&quot;),unselecting:t.hasClass(&quot;ui-unselecting&quot;)})})},this.refresh(),this.selectees=t.addClass(&quot;ui-selectee&quot;),this._mouseInit(),this.helper=e(&quot;&lt;div class='ui-selectable-helper'&gt;&lt;/div&gt;&quot;)},_destroy:function(){this.selectees.removeClass(&quot;ui-selectee&quot;).removeData(&quot;selectable-item&quot;),this.element.removeClass(&quot;ui-selectable ui-selectable-disabled&quot;),this._mouseDestroy()},_mouseStart:function(t){var i=this,s=this.options;this.opos=[t.pageX,t.pageY],this.options.disabled||(this.selectees=e(s.filter,this.element[0]),this._trigger(&quot;start&quot;,t),e(s.appendTo).append(this.helper),this.helper.css({left:t.pageX,top:t.pageY,width:0,height:0}),s.autoRefresh&amp;&amp;this.refresh(),this.selectees.filter(&quot;.ui-selected&quot;).each(function(){var s=e.data(this,&quot;selectable-item&quot;);s.startselected=!0,t.metaKey||t.ctrlKey||(s.$element.removeClass(&quot;ui-selected&quot;),s.selected=!1,s.$element.addClass(&quot;ui-unselecting&quot;),s.unselecting=!0,i._trigger(&quot;unselecting&quot;,t,{unselecting:s.element}))}),e(t.target).parents().addBack().each(function(){var s,n=e.data(this,&quot;selectable-item&quot;);return n?(s=!t.metaKey&amp;&amp;!t.ctrlKey||!n.$element.hasClass(&quot;ui-selected&quot;),n.$element.removeClass(s?&quot;ui-unselecting&quot;:&quot;ui-selected&quot;).addClass(s?&quot;ui-selecting&quot;:&quot;ui-unselecting&quot;),n.unselecting=!s,n.selecting=s,n.selected=s,s?i._trigger(&quot;selecting&quot;,t,{selecting:n.element}):i._trigger(&quot;unselecting&quot;,t,{unselecting:n.element}),!1):void 0}))},_mouseDrag:function(t){if(this.dragged=!0,!this.options.disabled){var i,s=this,n=this.options,a=this.opos[0],o=this.opos[1],r=t.pageX,h=t.pageY;return a&gt;r&amp;&amp;(i=r,r=a,a=i),o&gt;h&amp;&amp;(i=h,h=o,o=i),this.helper.css({left:a,top:o,width:r-a,height:h-o}),this.selectees.each(function(){var i=e.data(this,&quot;selectable-item&quot;),l=!1;i&amp;&amp;i.element!==s.element[0]&amp;&amp;(&quot;touch&quot;===n.tolerance?l=!(i.left&gt;r||a&gt;i.right||i.top&gt;h||o&gt;i.bottom):&quot;fit&quot;===n.tolerance&amp;&amp;(l=i.left&gt;a&amp;&amp;r&gt;i.right&amp;&amp;i.top&gt;o&amp;&amp;h&gt;i.bottom),l?(i.selected&amp;&amp;(i.$element.removeClass(&quot;ui-selected&quot;),i.selected=!1),i.unselecting&amp;&amp;(i.$element.removeClass(&quot;ui-unselecting&quot;),i.unselecting=!1),i.selecting||(i.$element.addClass(&quot;ui-selecting&quot;),i.selecting=!0,s._trigger(&quot;selecting&quot;,t,{selecting:i.element}))):(i.selecting&amp;&amp;((t.metaKey||t.ctrlKey)&amp;&amp;i.startselected?(i.$element.removeClass(&quot;ui-selecting&quot;),i.selecting=!1,i.$element.addClass(&quot;ui-selected&quot;),i.selected=!0):(i.$element.removeClass(&quot;ui-selecting&quot;),i.selecting=!1,i.startselected&amp;&amp;(i.$element.addClass(&quot;ui-unselecting&quot;),i.unselecting=!0),s._trigger(&quot;unselecting&quot;,t,{unselecting:i.element}))),i.selected&amp;&amp;(t.metaKey||t.ctrlKey||i.startselected||(i.$element.removeClass(&quot;ui-selected&quot;),i.selected=!1,i.$element.addClass(&quot;ui-unselecting&quot;),i.unselecting=!0,s._trigger(&quot;unselecting&quot;,t,{unselecting:i.element})))))}),!1}},_mouseStop:function(t){var i=this;return this.dragged=!1,e(&quot;.ui-unselecting&quot;,this.element[0]).each(function(){var s=e.data(this,&quot;selectable-item&quot;);s.$element.removeClass(&quot;ui-unselecting&quot;),s.unselecting=!1,s.startselected=!1,i._trigger(&quot;unselected&quot;,t,{unselected:s.element})}),e(&quot;.ui-selecting&quot;,this.element[0]).each(function(){var s=e.data(this,&quot;selectable-item&quot;);s.$element.removeClass(&quot;ui-selecting&quot;).addClass(&quot;ui-selected&quot;),s.selecting=!1,s.selected=!0,s.startselected=!0,i._trigger(&quot;selected&quot;,t,{selected:s.element})}),this._trigger(&quot;stop&quot;,t),this.helper.remove(),!1}}),e.widget(&quot;ui.selectmenu&quot;,{version:&quot;1.11.4&quot;,defaultElement:&quot;&lt;select&gt;&quot;,options:{appendTo:null,disabled:null,icons:{button:&quot;ui-icon-triangle-1-s&quot;},position:{my:&quot;left top&quot;,at:&quot;left bottom&quot;,collision:&quot;none&quot;},width:null,change:null,close:null,focus:null,open:null,select:null},_create:function(){var e=this.element.uniqueId().attr(&quot;id&quot;);this.ids={element:e,button:e+&quot;-button&quot;,menu:e+&quot;-menu&quot;},this._drawButton(),this._drawMenu(),this.options.disabled&amp;&amp;this.disable()},_drawButton:function(){var t=this;this.label=e(&quot;label[for='&quot;+this.ids.element+&quot;']&quot;).attr(&quot;for&quot;,this.ids.button),this._on(this.label,{click:function(e){this.button.focus(),e.preventDefault()}}),this.element.hide(),this.button=e(&quot;&lt;span&gt;&quot;,{&quot;class&quot;:&quot;ui-selectmenu-button ui-widget ui-state-default ui-corner-all&quot;,tabindex:this.options.disabled?-1:0,id:this.ids.button,role:&quot;combobox&quot;,&quot;aria-expanded&quot;:&quot;false&quot;,&quot;aria-autocomplete&quot;:&quot;list&quot;,&quot;aria-owns&quot;:this.ids.menu,&quot;aria-haspopup&quot;:&quot;true&quot;}).insertAfter(this.element),e(&quot;&lt;span&gt;&quot;,{&quot;class&quot;:&quot;ui-icon &quot;+this.options.icons.button}).prependTo(this.button),this.buttonText=e(&quot;&lt;span&gt;&quot;,{&quot;class&quot;:&quot;ui-selectmenu-text&quot;}).appendTo(this.button),this._setText(this.buttonText,this.element.find(&quot;option:selected&quot;).text()),this._resizeButton(),this._on(this.button,this._buttonEvents),this.button.one(&quot;focusin&quot;,function(){t.menuItems||t._refreshMenu()}),this._hoverable(this.button),this._focusable(this.button)},_drawMenu:function(){var t=this;this.menu=e(&quot;&lt;ul&gt;&quot;,{&quot;aria-hidden&quot;:&quot;true&quot;,&quot;aria-labelledby&quot;:this.ids.button,id:this.ids.menu}),this.menuWrap=e(&quot;&lt;div&gt;&quot;,{&quot;class&quot;:&quot;ui-selectmenu-menu ui-front&quot;}).append(this.menu).appendTo(this._appendTo()),this.menuInstance=this.menu.menu({role:&quot;listbox&quot;,select:function(e,i){e.preventDefault(),t._setSelection(),t._select(i.item.data(&quot;ui-selectmenu-item&quot;),e)},focus:function(e,i){var s=i.item.data(&quot;ui-selectmenu-item&quot;);null!=t.focusIndex&amp;&amp;s.index!==t.focusIndex&amp;&amp;(t._trigger(&quot;focus&quot;,e,{item:s}),t.isOpen||t._select(s,e)),t.focusIndex=s.index,t.button.attr(&quot;aria-activedescendant&quot;,t.menuItems.eq(s.index).attr(&quot;id&quot;))}}).menu(&quot;instance&quot;),this.menu.addClass(&quot;ui-corner-bottom&quot;).removeClass(&quot;ui-corner-all&quot;),this.menuInstance._off(this.menu,&quot;mouseleave&quot;),this.menuInstance._closeOnDocumentClick=function(){return!1},this.menuInstance._isDivider=function(){return!1}},refresh:function(){this._refreshMenu(),this._setText(this.buttonText,this._getSelectedItem().text()),this.options.width||this._resizeButton()},_refreshMenu:function(){this.menu.empty();var e,t=this.element.find(&quot;option&quot;);t.length&amp;&amp;(this._parseOptions(t),this._renderMenu(this.menu,this.items),this.menuInstance.refresh(),this.menuItems=this.menu.find(&quot;li&quot;).not(&quot;.ui-selectmenu-optgroup&quot;),e=this._getSelectedItem(),this.menuInstance.focus(null,e),this._setAria(e.data(&quot;ui-selectmenu-item&quot;)),this._setOption(&quot;disabled&quot;,this.element.prop(&quot;disabled&quot;)))},open:function(e){this.options.disabled||(this.menuItems?(this.menu.find(&quot;.ui-state-focus&quot;).removeClass(&quot;ui-state-focus&quot;),this.menuInstance.focus(null,this._getSelectedItem())):this._refreshMenu(),this.isOpen=!0,this._toggleAttr(),this._resizeMenu(),this._position(),this._on(this.document,this._documentClick),this._trigger(&quot;open&quot;,e))},_position:function(){this.menuWrap.position(e.extend({of:this.button},this.options.position))},close:function(e){this.isOpen&amp;&amp;(this.isOpen=!1,this._toggleAttr(),this.range=null,this._off(this.document),this._trigger(&quot;close&quot;,e))},widget:function(){return this.button},menuWidget:function(){return this.menu},_renderMenu:function(t,i){var s=this,n=&quot;&quot;;e.each(i,function(i,a){a.optgroup!==n&amp;&amp;(e(&quot;&lt;li&gt;&quot;,{&quot;class&quot;:&quot;ui-selectmenu-optgroup ui-menu-divider&quot;+(a.element.parent(&quot;optgroup&quot;).prop(&quot;disabled&quot;)?&quot; ui-state-disabled&quot;:&quot;&quot;),text:a.optgroup}).appendTo(t),n=a.optgroup),s._renderItemData(t,a)})},_renderItemData:function(e,t){return this._renderItem(e,t).data(&quot;ui-selectmenu-item&quot;,t)},_renderItem:function(t,i){var s=e(&quot;&lt;li&gt;&quot;);return i.disabled&amp;&amp;s.addClass(&quot;ui-state-disabled&quot;),this._setText(s,i.label),s.appendTo(t)},_setText:function(e,t){t?e.text(t):e.html(&quot;&amp;#160;&quot;)},_move:function(e,t){var i,s,n=&quot;.ui-menu-item&quot;;this.isOpen?i=this.menuItems.eq(this.focusIndex):(i=this.menuItems.eq(this.element[0].selectedIndex),n+=&quot;:not(.ui-state-disabled)&quot;),s=&quot;first&quot;===e||&quot;last&quot;===e?i[&quot;first&quot;===e?&quot;prevAll&quot;:&quot;nextAll&quot;](n).eq(-1):i[e+&quot;All&quot;](n).eq(0),s.length&amp;&amp;this.menuInstance.focus(t,s)},_getSelectedItem:function(){return this.menuItems.eq(this.element[0].selectedIndex)},_toggle:function(e){this[this.isOpen?&quot;close&quot;:&quot;open&quot;](e)},_setSelection:function(){var e;this.range&amp;&amp;(window.getSelection?(e=window.getSelection(),e.removeAllRanges(),e.addRange(this.range)):this.range.select(),this.button.focus())},_documentClick:{mousedown:function(t){this.isOpen&amp;&amp;(e(t.target).closest(&quot;.ui-selectmenu-menu, #&quot;+this.ids.button).length||this.close(t))}},_buttonEvents:{mousedown:function(){var e;window.getSelection?(e=window.getSelection(),e.rangeCount&amp;&amp;(this.range=e.getRangeAt(0))):this.range=document.selection.createRange()},click:function(e){this._setSelection(),this._toggle(e)},keydown:function(t){var i=!0;switch(t.keyCode){case e.ui.keyCode.TAB:case e.ui.keyCode.ESCAPE:this.close(t),i=!1;break;case e.ui.keyCode.ENTER:this.isOpen&amp;&amp;this._selectFocusedItem(t);break;case e.ui.keyCode.UP:t.altKey?this._toggle(t):this._move(&quot;prev&quot;,t);break;case e.ui.keyCode.DOWN:t.altKey?this._toggle(t):this._move(&quot;next&quot;,t);break;case e.ui.keyCode.SPACE:this.isOpen?this._selectFocusedItem(t):this._toggle(t);break;case e.ui.keyCode.LEFT:this._move(&quot;prev&quot;,t);break;case e.ui.keyCode.RIGHT:this._move(&quot;next&quot;,t);break;case e.ui.keyCode.HOME:case e.ui.keyCode.PAGE_UP:this._move(&quot;first&quot;,t);break;case e.ui.keyCode.END:case e.ui.keyCode.PAGE_DOWN:this._move(&quot;last&quot;,t);break;default:this.menu.trigger(t),i=!1}i&amp;&amp;t.preventDefault()}},_selectFocusedItem:function(e){var t=this.menuItems.eq(this.focusIndex);t.hasClass(&quot;ui-state-disabled&quot;)||this._select(t.data(&quot;ui-selectmenu-item&quot;),e)},_select:function(e,t){var i=this.element[0].selectedIndex;this.element[0].selectedIndex=e.index,this._setText(this.buttonText,e.label),this._setAria(e),this._trigger(&quot;select&quot;,t,{item:e}),e.index!==i&amp;&amp;this._trigger(&quot;change&quot;,t,{item:e}),this.close(t)},_setAria:function(e){var t=this.menuItems.eq(e.index).attr(&quot;id&quot;);this.button.attr({&quot;aria-labelledby&quot;:t,&quot;aria-activedescendant&quot;:t}),this.menu.attr(&quot;aria-activedescendant&quot;,t)},_setOption:function(e,t){&quot;icons&quot;===e&amp;&amp;this.button.find(&quot;span.ui-icon&quot;).removeClass(this.options.icons.button).addClass(t.button),this._super(e,t),&quot;appendTo&quot;===e&amp;&amp;this.menuWrap.appendTo(this._appendTo()),&quot;disabled&quot;===e&amp;&amp;(this.menuInstance.option(&quot;disabled&quot;,t),this.button.toggleClass(&quot;ui-state-disabled&quot;,t).attr(&quot;aria-disabled&quot;,t),this.element.prop(&quot;disabled&quot;,t),t?(this.button.attr(&quot;tabindex&quot;,-1),this.close()):this.button.attr(&quot;tabindex&quot;,0)),&quot;width&quot;===e&amp;&amp;this._resizeButton()},_appendTo:function(){var t=this.options.appendTo;return t&amp;&amp;(t=t.jquery||t.nodeType?e(t):this.document.find(t).eq(0)),t&amp;&amp;t[0]||(t=this.element.closest(&quot;.ui-front&quot;)),t.length||(t=this.document[0].body),t},_toggleAttr:function(){this.button.toggleClass(&quot;ui-corner-top&quot;,this.isOpen).toggleClass(&quot;ui-corner-all&quot;,!this.isOpen).attr(&quot;aria-expanded&quot;,this.isOpen),this.menuWrap.toggleClass(&quot;ui-selectmenu-open&quot;,this.isOpen),this.menu.attr(&quot;aria-hidden&quot;,!this.isOpen)},_resizeButton:function(){var e=this.options.width;e||(e=this.element.show().outerWidth(),this.element.hide()),this.button.outerWidth(e)},_resizeMenu:function(){this.menu.outerWidth(Math.max(this.button.outerWidth(),this.menu.width(&quot;&quot;).outerWidth()+1))},_getCreateOptions:function(){return{disabled:this.element.prop(&quot;disabled&quot;)}},_parseOptions:function(t){var i=[];t.each(function(t,s){var n=e(s),a=n.parent(&quot;optgroup&quot;);i.push({element:n,index:t,value:n.val(),label:n.text(),optgroup:a.attr(&quot;label&quot;)||&quot;&quot;,disabled:a.prop(&quot;disabled&quot;)||n.prop(&quot;disabled&quot;)})}),this.items=i},_destroy:function(){this.menuWrap.remove(),this.button.remove(),this.element.show(),this.element.removeUniqueId(),this.label.attr(&quot;for&quot;,this.ids.element)}}),e.widget(&quot;ui.slider&quot;,e.ui.mouse,{version:&quot;1.11.4&quot;,widgetEventPrefix:&quot;slide&quot;,options:{animate:!1,distance:0,max:100,min:0,orientation:&quot;horizontal&quot;,range:!1,step:1,value:0,values:null,change:null,slide:null,start:null,stop:null},numPages:5,_create:function(){this._keySliding=!1,this._mouseSliding=!1,this._animateOff=!0,this._handleIndex=null,this._detectOrientation(),this._mouseInit(),this._calculateNewMax(),this.element.addClass(&quot;ui-slider ui-slider-&quot;+this.orientation+&quot; ui-widget&quot;+&quot; ui-widget-content&quot;+&quot; ui-corner-all&quot;),this._refresh(),this._setOption(&quot;disabled&quot;,this.options.disabled),this._animateOff=!1},_refresh:function(){this._createRange(),this._createHandles(),this._setupEvents(),this._refreshValue()},_createHandles:function(){var t,i,s=this.options,n=this.element.find(&quot;.ui-slider-handle&quot;).addClass(&quot;ui-state-default ui-corner-all&quot;),a=&quot;&lt;span class='ui-slider-handle ui-state-default ui-corner-all' tabindex='0'&gt;&lt;/span&gt;&quot;,o=[];for(i=s.values&amp;&amp;s.values.length||1,n.length&gt;i&amp;&amp;(n.slice(i).remove(),n=n.slice(0,i)),t=n.length;i&gt;t;t++)o.push(a);this.handles=n.add(e(o.join(&quot;&quot;)).appendTo(this.element)),this.handle=this.handles.eq(0),this.handles.each(function(t){e(this).data(&quot;ui-slider-handle-index&quot;,t)})},_createRange:function(){var t=this.options,i=&quot;&quot;;t.range?(t.range===!0&amp;&amp;(t.values?t.values.length&amp;&amp;2!==t.values.length?t.values=[t.values[0],t.values[0]]:e.isArray(t.values)&amp;&amp;(t.values=t.values.slice(0)):t.values=[this._valueMin(),this._valueMin()]),this.range&amp;&amp;this.range.length?this.range.removeClass(&quot;ui-slider-range-min ui-slider-range-max&quot;).css({left:&quot;&quot;,bottom:&quot;&quot;}):(this.range=e(&quot;&lt;div&gt;&lt;/div&gt;&quot;).appendTo(this.element),i=&quot;ui-slider-range ui-widget-header ui-corner-all&quot;),this.range.addClass(i+(&quot;min&quot;===t.range||&quot;max&quot;===t.range?&quot; ui-slider-range-&quot;+t.range:&quot;&quot;))):(this.range&amp;&amp;this.range.remove(),this.range=null)},_setupEvents:function(){this._off(this.handles),this._on(this.handles,this._handleEvents),this._hoverable(this.handles),this._focusable(this.handles)},_destroy:function(){this.handles.remove(),this.range&amp;&amp;this.range.remove(),this.element.removeClass(&quot;ui-slider ui-slider-horizontal ui-slider-vertical ui-widget ui-widget-content ui-corner-all&quot;),this._mouseDestroy()},_mouseCapture:function(t){var i,s,n,a,o,r,h,l,u=this,d=this.options;return d.disabled?!1:(this.elementSize={width:this.element.outerWidth(),height:this.element.outerHeight()},this.elementOffset=this.element.offset(),i={x:t.pageX,y:t.pageY},s=this._normValueFromMouse(i),n=this._valueMax()-this._valueMin()+1,this.handles.each(function(t){var i=Math.abs(s-u.values(t));(n&gt;i||n===i&amp;&amp;(t===u._lastChangedValue||u.values(t)===d.min))&amp;&amp;(n=i,a=e(this),o=t)}),r=this._start(t,o),r===!1?!1:(this._mouseSliding=!0,this._handleIndex=o,a.addClass(&quot;ui-state-active&quot;).focus(),h=a.offset(),l=!e(t.target).parents().addBack().is(&quot;.ui-slider-handle&quot;),this._clickOffset=l?{left:0,top:0}:{left:t.pageX-h.left-a.width()/2,top:t.pageY-h.top-a.height()/2-(parseInt(a.css(&quot;borderTopWidth&quot;),10)||0)-(parseInt(a.css(&quot;borderBottomWidth&quot;),10)||0)+(parseInt(a.css(&quot;marginTop&quot;),10)||0)},this.handles.hasClass(&quot;ui-state-hover&quot;)||this._slide(t,o,s),this._animateOff=!0,!0))},_mouseStart:function(){return!0},_mouseDrag:function(e){var t={x:e.pageX,y:e.pageY},i=this._normValueFromMouse(t);return this._slide(e,this._handleIndex,i),!1},_mouseStop:function(e){return this.handles.removeClass(&quot;ui-state-active&quot;),this._mouseSliding=!1,this._stop(e,this._handleIndex),this._change(e,this._handleIndex),this._handleIndex=null,this._clickOffset=null,this._animateOff=!1,!1},_detectOrientation:function(){this.orientation=&quot;vertical&quot;===this.options.orientation?&quot;vertical&quot;:&quot;horizontal&quot;},_normValueFromMouse:function(e){var t,i,s,n,a;return&quot;horizontal&quot;===this.orientation?(t=this.elementSize.width,i=e.x-this.elementOffset.left-(this._clickOffset?this._clickOffset.left:0)):(t=this.elementSize.height,i=e.y-this.elementOffset.top-(this._clickOffset?this._clickOffset.top:0)),s=i/t,s&gt;1&amp;&amp;(s=1),0&gt;s&amp;&amp;(s=0),&quot;vertical&quot;===this.orientation&amp;&amp;(s=1-s),n=this._valueMax()-this._valueMin(),a=this._valueMin()+s*n,this._trimAlignValue(a)},_start:function(e,t){var i={handle:this.handles[t],value:this.value()};return this.options.values&amp;&amp;this.options.values.length&amp;&amp;(i.value=this.values(t),i.values=this.values()),this._trigger(&quot;start&quot;,e,i)},_slide:function(e,t,i){var s,n,a;this.options.values&amp;&amp;this.options.values.length?(s=this.values(t?0:1),2===this.options.values.length&amp;&amp;this.options.range===!0&amp;&amp;(0===t&amp;&amp;i&gt;s||1===t&amp;&amp;s&gt;i)&amp;&amp;(i=s),i!==this.values(t)&amp;&amp;(n=this.values(),n[t]=i,a=this._trigger(&quot;slide&quot;,e,{handle:this.handles[t],value:i,values:n}),s=this.values(t?0:1),a!==!1&amp;&amp;this.values(t,i))):i!==this.value()&amp;&amp;(a=this._trigger(&quot;slide&quot;,e,{handle:this.handles[t],value:i}),a!==!1&amp;&amp;this.value(i))},_stop:function(e,t){var i={handle:this.handles[t],value:this.value()};this.options.values&amp;&amp;this.options.values.length&amp;&amp;(i.value=this.values(t),i.values=this.values()),this._trigger(&quot;stop&quot;,e,i)},_change:function(e,t){if(!this._keySliding&amp;&amp;!this._mouseSliding){var i={handle:this.handles[t],value:this.value()};this.options.values&amp;&amp;this.options.values.length&amp;&amp;(i.value=this.values(t),i.values=this.values()),this._lastChangedValue=t,this._trigger(&quot;change&quot;,e,i)}},value:function(e){return arguments.length?(this.options.value=this._trimAlignValue(e),this._refreshValue(),this._change(null,0),void 0):this._value()},values:function(t,i){var s,n,a;if(arguments.length&gt;1)return this.options.values[t]=this._trimAlignValue(i),this._refreshValue(),this._change(null,t),void 0;if(!arguments.length)return this._values();if(!e.isArray(arguments[0]))return this.options.values&amp;&amp;this.options.values.length?this._values(t):this.value();for(s=this.options.values,n=arguments[0],a=0;s.length&gt;a;a+=1)s[a]=this._trimAlignValue(n[a]),this._change(null,a);this._refreshValue()},_setOption:function(t,i){var s,n=0;switch(&quot;range&quot;===t&amp;&amp;this.options.range===!0&amp;&amp;(&quot;min&quot;===i?(this.options.value=this._values(0),this.options.values=null):&quot;max&quot;===i&amp;&amp;(this.options.value=this._values(this.options.values.length-1),this.options.values=null)),e.isArray(this.options.values)&amp;&amp;(n=this.options.values.length),&quot;disabled&quot;===t&amp;&amp;this.element.toggleClass(&quot;ui-state-disabled&quot;,!!i),this._super(t,i),t){case&quot;orientation&quot;:this._detectOrientation(),this.element.removeClass(&quot;ui-slider-horizontal ui-slider-vertical&quot;).addClass(&quot;ui-slider-&quot;+this.orientation),this._refreshValue(),this.handles.css(&quot;horizontal&quot;===i?&quot;bottom&quot;:&quot;left&quot;,&quot;&quot;);break;case&quot;value&quot;:this._animateOff=!0,this._refreshValue(),this._change(null,0),this._animateOff=!1;break;case&quot;values&quot;:for(this._animateOff=!0,this._refreshValue(),s=0;n&gt;s;s+=1)this._change(null,s);this._animateOff=!1;break;case&quot;step&quot;:case&quot;min&quot;:case&quot;max&quot;:this._animateOff=!0,this._calculateNewMax(),this._refreshValue(),this._animateOff=!1;break;case&quot;range&quot;:this._animateOff=!0,this._refresh(),this._animateOff=!1}},_value:function(){var e=this.options.value;return e=this._trimAlignValue(e)},_values:function(e){var t,i,s;if(arguments.length)return t=this.options.values[e],t=this._trimAlignValue(t);if(this.options.values&amp;&amp;this.options.values.length){for(i=this.options.values.slice(),s=0;i.length&gt;s;s+=1)i[s]=this._trimAlignValue(i[s]);return i}return[]},_trimAlignValue:function(e){if(this._valueMin()&gt;=e)return this._valueMin();if(e&gt;=this._valueMax())return this._valueMax();var t=this.options.step&gt;0?this.options.step:1,i=(e-this._valueMin())%t,s=e-i;return 2*Math.abs(i)&gt;=t&amp;&amp;(s+=i&gt;0?t:-t),parseFloat(s.toFixed(5))},_calculateNewMax:function(){var e=this.options.max,t=this._valueMin(),i=this.options.step,s=Math.floor(+(e-t).toFixed(this._precision())/i)*i;e=s+t,this.max=parseFloat(e.toFixed(this._precision()))},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&amp;&amp;(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=&quot;&quot;+e,i=t.indexOf(&quot;.&quot;);return-1===i?0:t.length-i-1},_valueMin:function(){return this.options.min},_valueMax:function(){return this.max},_refreshValue:function(){var t,i,s,n,a,o=this.options.range,r=this.options,h=this,l=this._animateOff?!1:r.animate,u={};this.options.values&amp;&amp;this.options.values.length?this.handles.each(function(s){i=100*((h.values(s)-h._valueMin())/(h._valueMax()-h._valueMin())),u[&quot;horizontal&quot;===h.orientation?&quot;left&quot;:&quot;bottom&quot;]=i+&quot;%&quot;,e(this).stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;](u,r.animate),h.options.range===!0&amp;&amp;(&quot;horizontal&quot;===h.orientation?(0===s&amp;&amp;h.range.stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;]({left:i+&quot;%&quot;},r.animate),1===s&amp;&amp;h.range[l?&quot;animate&quot;:&quot;css&quot;]({width:i-t+&quot;%&quot;},{queue:!1,duration:r.animate})):(0===s&amp;&amp;h.range.stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;]({bottom:i+&quot;%&quot;},r.animate),1===s&amp;&amp;h.range[l?&quot;animate&quot;:&quot;css&quot;]({height:i-t+&quot;%&quot;},{queue:!1,duration:r.animate}))),t=i}):(s=this.value(),n=this._valueMin(),a=this._valueMax(),i=a!==n?100*((s-n)/(a-n)):0,u[&quot;horizontal&quot;===this.orientation?&quot;left&quot;:&quot;bottom&quot;]=i+&quot;%&quot;,this.handle.stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;](u,r.animate),&quot;min&quot;===o&amp;&amp;&quot;horizontal&quot;===this.orientation&amp;&amp;this.range.stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;]({width:i+&quot;%&quot;},r.animate),&quot;max&quot;===o&amp;&amp;&quot;horizontal&quot;===this.orientation&amp;&amp;this.range[l?&quot;animate&quot;:&quot;css&quot;]({width:100-i+&quot;%&quot;},{queue:!1,duration:r.animate}),&quot;min&quot;===o&amp;&amp;&quot;vertical&quot;===this.orientation&amp;&amp;this.range.stop(1,1)[l?&quot;animate&quot;:&quot;css&quot;]({height:i+&quot;%&quot;},r.animate),&quot;max&quot;===o&amp;&amp;&quot;vertical&quot;===this.orientation&amp;&amp;this.range[l?&quot;animate&quot;:&quot;css&quot;]({height:100-i+&quot;%&quot;},{queue:!1,duration:r.animate}))},_handleEvents:{keydown:function(t){var i,s,n,a,o=e(t.target).data(&quot;ui-slider-handle-index&quot;);switch(t.keyCode){case e.ui.keyCode.HOME:case e.ui.keyCode.END:case e.ui.keyCode.PAGE_UP:case e.ui.keyCode.PAGE_DOWN:case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(t.preventDefault(),!this._keySliding&amp;&amp;(this._keySliding=!0,e(t.target).addClass(&quot;ui-state-active&quot;),i=this._start(t,o),i===!1))return}switch(a=this.options.step,s=n=this.options.values&amp;&amp;this.options.values.length?this.values(o):this.value(),t.keyCode){case e.ui.keyCode.HOME:n=this._valueMin();break;case e.ui.keyCode.END:n=this._valueMax();break;case e.ui.keyCode.PAGE_UP:n=this._trimAlignValue(s+(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.PAGE_DOWN:n=this._trimAlignValue(s-(this._valueMax()-this._valueMin())/this.numPages);break;case e.ui.keyCode.UP:case e.ui.keyCode.RIGHT:if(s===this._valueMax())return;n=this._trimAlignValue(s+a);break;case e.ui.keyCode.DOWN:case e.ui.keyCode.LEFT:if(s===this._valueMin())return;n=this._trimAlignValue(s-a)}this._slide(t,o,n)},keyup:function(t){var i=e(t.target).data(&quot;ui-slider-handle-index&quot;);this._keySliding&amp;&amp;(this._keySliding=!1,this._stop(t,i),this._change(t,i),e(t.target).removeClass(&quot;ui-state-active&quot;))}}}),e.widget(&quot;ui.sortable&quot;,e.ui.mouse,{version:&quot;1.11.4&quot;,widgetEventPrefix:&quot;sort&quot;,ready:!1,options:{appendTo:&quot;parent&quot;,axis:!1,connectWith:!1,containment:!1,cursor:&quot;auto&quot;,cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:&quot;original&quot;,items:&quot;&gt; *&quot;,opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:&quot;default&quot;,tolerance:&quot;intersect&quot;,zIndex:1e3,activate:null,beforeStop:null,change:null,deactivate:null,out:null,over:null,receive:null,remove:null,sort:null,start:null,stop:null,update:null},_isOverAxis:function(e,t,i){return e&gt;=t&amp;&amp;t+i&gt;e},_isFloating:function(e){return/left|right/.test(e.css(&quot;float&quot;))||/inline|table-cell/.test(e.css(&quot;display&quot;))},_create:function(){this.containerCache={},this.element.addClass(&quot;ui-sortable&quot;),this.refresh(),this.offset=this.element.offset(),this._mouseInit(),this._setHandleClassName(),this.ready=!0},_setOption:function(e,t){this._super(e,t),&quot;handle&quot;===e&amp;&amp;this._setHandleClassName()},_setHandleClassName:function(){this.element.find(&quot;.ui-sortable-handle&quot;).removeClass(&quot;ui-sortable-handle&quot;),e.each(this.items,function(){(this.instance.options.handle?this.item.find(this.instance.options.handle):this.item).addClass(&quot;ui-sortable-handle&quot;)})},_destroy:function(){this.element.removeClass(&quot;ui-sortable ui-sortable-disabled&quot;).find(&quot;.ui-sortable-handle&quot;).removeClass(&quot;ui-sortable-handle&quot;),this._mouseDestroy();for(var e=this.items.length-1;e&gt;=0;e--)this.items[e].item.removeData(this.widgetName+&quot;-item&quot;);return this},_mouseCapture:function(t,i){var s=null,n=!1,a=this;return this.reverting?!1:this.options.disabled||&quot;static&quot;===this.options.type?!1:(this._refreshItems(t),e(t.target).parents().each(function(){return e.data(this,a.widgetName+&quot;-item&quot;)===a?(s=e(this),!1):void 0}),e.data(t.target,a.widgetName+&quot;-item&quot;)===a&amp;&amp;(s=e(t.target)),s?!this.options.handle||i||(e(this.options.handle,s).find(&quot;*&quot;).addBack().each(function(){this===t.target&amp;&amp;(n=!0)}),n)?(this.currentItem=s,this._removeCurrentsFromItems(),!0):!1:!1)},_mouseStart:function(t,i,s){var n,a,o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(t),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},e.extend(this.offset,{click:{left:t.pageX-this.offset.left,top:t.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css(&quot;position&quot;,&quot;absolute&quot;),this.cssPosition=this.helper.css(&quot;position&quot;),this.originalPosition=this._generatePosition(t),this.originalPageX=t.pageX,this.originalPageY=t.pageY,o.cursorAt&amp;&amp;this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!==this.currentItem[0]&amp;&amp;this.currentItem.hide(),this._createPlaceholder(),o.containment&amp;&amp;this._setContainment(),o.cursor&amp;&amp;&quot;auto&quot;!==o.cursor&amp;&amp;(a=this.document.find(&quot;body&quot;),this.storedCursor=a.css(&quot;cursor&quot;),a.css(&quot;cursor&quot;,o.cursor),this.storedStylesheet=e(&quot;&lt;style&gt;*{ cursor: &quot;+o.cursor+&quot; !important; }&lt;/style&gt;&quot;).appendTo(a)),o.opacity&amp;&amp;(this.helper.css(&quot;opacity&quot;)&amp;&amp;(this._storedOpacity=this.helper.css(&quot;opacity&quot;)),this.helper.css(&quot;opacity&quot;,o.opacity)),o.zIndex&amp;&amp;(this.helper.css(&quot;zIndex&quot;)&amp;&amp;(this._storedZIndex=this.helper.css(&quot;zIndex&quot;)),this.helper.css(&quot;zIndex&quot;,o.zIndex)),this.scrollParent[0]!==this.document[0]&amp;&amp;&quot;HTML&quot;!==this.scrollParent[0].tagName&amp;&amp;(this.overflowOffset=this.scrollParent.offset()),this._trigger(&quot;start&quot;,t,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!s)for(n=this.containers.length-1;n&gt;=0;n--)this.containers[n]._trigger(&quot;activate&quot;,t,this._uiHash(this));
return e.ui.ddmanager&amp;&amp;(e.ui.ddmanager.current=this),e.ui.ddmanager&amp;&amp;!o.dropBehaviour&amp;&amp;e.ui.ddmanager.prepareOffsets(this,t),this.dragging=!0,this.helper.addClass(&quot;ui-sortable-helper&quot;),this._mouseDrag(t),!0},_mouseDrag:function(t){var i,s,n,a,o=this.options,r=!1;for(this.position=this._generatePosition(t),this.positionAbs=this._convertPositionTo(&quot;absolute&quot;),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll&amp;&amp;(this.scrollParent[0]!==this.document[0]&amp;&amp;&quot;HTML&quot;!==this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-t.pageY&lt;o.scrollSensitivity?this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop+o.scrollSpeed:t.pageY-this.overflowOffset.top&lt;o.scrollSensitivity&amp;&amp;(this.scrollParent[0].scrollTop=r=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-t.pageX&lt;o.scrollSensitivity?this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft+o.scrollSpeed:t.pageX-this.overflowOffset.left&lt;o.scrollSensitivity&amp;&amp;(this.scrollParent[0].scrollLeft=r=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(t.pageY-this.document.scrollTop()&lt;o.scrollSensitivity?r=this.document.scrollTop(this.document.scrollTop()-o.scrollSpeed):this.window.height()-(t.pageY-this.document.scrollTop())&lt;o.scrollSensitivity&amp;&amp;(r=this.document.scrollTop(this.document.scrollTop()+o.scrollSpeed)),t.pageX-this.document.scrollLeft()&lt;o.scrollSensitivity?r=this.document.scrollLeft(this.document.scrollLeft()-o.scrollSpeed):this.window.width()-(t.pageX-this.document.scrollLeft())&lt;o.scrollSensitivity&amp;&amp;(r=this.document.scrollLeft(this.document.scrollLeft()+o.scrollSpeed))),r!==!1&amp;&amp;e.ui.ddmanager&amp;&amp;!o.dropBehaviour&amp;&amp;e.ui.ddmanager.prepareOffsets(this,t)),this.positionAbs=this._convertPositionTo(&quot;absolute&quot;),this.options.axis&amp;&amp;&quot;y&quot;===this.options.axis||(this.helper[0].style.left=this.position.left+&quot;px&quot;),this.options.axis&amp;&amp;&quot;x&quot;===this.options.axis||(this.helper[0].style.top=this.position.top+&quot;px&quot;),i=this.items.length-1;i&gt;=0;i--)if(s=this.items[i],n=s.item[0],a=this._intersectsWithPointer(s),a&amp;&amp;s.instance===this.currentContainer&amp;&amp;n!==this.currentItem[0]&amp;&amp;this.placeholder[1===a?&quot;next&quot;:&quot;prev&quot;]()[0]!==n&amp;&amp;!e.contains(this.placeholder[0],n)&amp;&amp;(&quot;semi-dynamic&quot;===this.options.type?!e.contains(this.element[0],n):!0)){if(this.direction=1===a?&quot;down&quot;:&quot;up&quot;,&quot;pointer&quot;!==this.options.tolerance&amp;&amp;!this._intersectsWithSides(s))break;this._rearrange(t,s),this._trigger(&quot;change&quot;,t,this._uiHash());break}return this._contactContainers(t),e.ui.ddmanager&amp;&amp;e.ui.ddmanager.drag(this,t),this._trigger(&quot;sort&quot;,t,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(t,i){if(t){if(e.ui.ddmanager&amp;&amp;!this.options.dropBehaviour&amp;&amp;e.ui.ddmanager.drop(this,t),this.options.revert){var s=this,n=this.placeholder.offset(),a=this.options.axis,o={};a&amp;&amp;&quot;x&quot;!==a||(o.left=n.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollLeft)),a&amp;&amp;&quot;y&quot;!==a||(o.top=n.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]===this.document[0].body?0:this.offsetParent[0].scrollTop)),this.reverting=!0,e(this.helper).animate(o,parseInt(this.options.revert,10)||500,function(){s._clear(t)})}else this._clear(t,i);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),&quot;original&quot;===this.options.helper?this.currentItem.css(this._storedCSS).removeClass(&quot;ui-sortable-helper&quot;):this.currentItem.show();for(var t=this.containers.length-1;t&gt;=0;t--)this.containers[t]._trigger(&quot;deactivate&quot;,null,this._uiHash(this)),this.containers[t].containerCache.over&amp;&amp;(this.containers[t]._trigger(&quot;out&quot;,null,this._uiHash(this)),this.containers[t].containerCache.over=0)}return this.placeholder&amp;&amp;(this.placeholder[0].parentNode&amp;&amp;this.placeholder[0].parentNode.removeChild(this.placeholder[0]),&quot;original&quot;!==this.options.helper&amp;&amp;this.helper&amp;&amp;this.helper[0].parentNode&amp;&amp;this.helper.remove(),e.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?e(this.domPosition.prev).after(this.currentItem):e(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(t){var i=this._getItemsAsjQuery(t&amp;&amp;t.connected),s=[];return t=t||{},e(i).each(function(){var i=(e(t.item||this).attr(t.attribute||&quot;id&quot;)||&quot;&quot;).match(t.expression||/(.+)[\-=_](.+)/);i&amp;&amp;s.push((t.key||i[1]+&quot;[]&quot;)+&quot;=&quot;+(t.key&amp;&amp;t.expression?i[1]:i[2]))}),!s.length&amp;&amp;t.key&amp;&amp;s.push(t.key+&quot;=&quot;),s.join(&quot;&amp;&quot;)},toArray:function(t){var i=this._getItemsAsjQuery(t&amp;&amp;t.connected),s=[];return t=t||{},i.each(function(){s.push(e(t.item||this).attr(t.attribute||&quot;id&quot;)||&quot;&quot;)}),s},_intersectsWith:function(e){var t=this.positionAbs.left,i=t+this.helperProportions.width,s=this.positionAbs.top,n=s+this.helperProportions.height,a=e.left,o=a+e.width,r=e.top,h=r+e.height,l=this.offset.click.top,u=this.offset.click.left,d=&quot;x&quot;===this.options.axis||s+l&gt;r&amp;&amp;h&gt;s+l,c=&quot;y&quot;===this.options.axis||t+u&gt;a&amp;&amp;o&gt;t+u,p=d&amp;&amp;c;return&quot;pointer&quot;===this.options.tolerance||this.options.forcePointerForContainers||&quot;pointer&quot;!==this.options.tolerance&amp;&amp;this.helperProportions[this.floating?&quot;width&quot;:&quot;height&quot;]&gt;e[this.floating?&quot;width&quot;:&quot;height&quot;]?p:t+this.helperProportions.width/2&gt;a&amp;&amp;o&gt;i-this.helperProportions.width/2&amp;&amp;s+this.helperProportions.height/2&gt;r&amp;&amp;h&gt;n-this.helperProportions.height/2},_intersectsWithPointer:function(e){var t=&quot;x&quot;===this.options.axis||this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top,e.height),i=&quot;y&quot;===this.options.axis||this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left,e.width),s=t&amp;&amp;i,n=this._getDragVerticalDirection(),a=this._getDragHorizontalDirection();return s?this.floating?a&amp;&amp;&quot;right&quot;===a||&quot;down&quot;===n?2:1:n&amp;&amp;(&quot;down&quot;===n?2:1):!1},_intersectsWithSides:function(e){var t=this._isOverAxis(this.positionAbs.top+this.offset.click.top,e.top+e.height/2,e.height),i=this._isOverAxis(this.positionAbs.left+this.offset.click.left,e.left+e.width/2,e.width),s=this._getDragVerticalDirection(),n=this._getDragHorizontalDirection();return this.floating&amp;&amp;n?&quot;right&quot;===n&amp;&amp;i||&quot;left&quot;===n&amp;&amp;!i:s&amp;&amp;(&quot;down&quot;===s&amp;&amp;t||&quot;up&quot;===s&amp;&amp;!t)},_getDragVerticalDirection:function(){var e=this.positionAbs.top-this.lastPositionAbs.top;return 0!==e&amp;&amp;(e&gt;0?&quot;down&quot;:&quot;up&quot;)},_getDragHorizontalDirection:function(){var e=this.positionAbs.left-this.lastPositionAbs.left;return 0!==e&amp;&amp;(e&gt;0?&quot;right&quot;:&quot;left&quot;)},refresh:function(e){return this._refreshItems(e),this._setHandleClassName(),this.refreshPositions(),this},_connectWith:function(){var e=this.options;return e.connectWith.constructor===String?[e.connectWith]:e.connectWith},_getItemsAsjQuery:function(t){function i(){r.push(this)}var s,n,a,o,r=[],h=[],l=this._connectWith();if(l&amp;&amp;t)for(s=l.length-1;s&gt;=0;s--)for(a=e(l[s],this.document[0]),n=a.length-1;n&gt;=0;n--)o=e.data(a[n],this.widgetFullName),o&amp;&amp;o!==this&amp;&amp;!o.options.disabled&amp;&amp;h.push([e.isFunction(o.options.items)?o.options.items.call(o.element):e(o.options.items,o.element).not(&quot;.ui-sortable-helper&quot;).not(&quot;.ui-sortable-placeholder&quot;),o]);for(h.push([e.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):e(this.options.items,this.element).not(&quot;.ui-sortable-helper&quot;).not(&quot;.ui-sortable-placeholder&quot;),this]),s=h.length-1;s&gt;=0;s--)h[s][0].each(i);return e(r)},_removeCurrentsFromItems:function(){var t=this.currentItem.find(&quot;:data(&quot;+this.widgetName+&quot;-item)&quot;);this.items=e.grep(this.items,function(e){for(var i=0;t.length&gt;i;i++)if(t[i]===e.item[0])return!1;return!0})},_refreshItems:function(t){this.items=[],this.containers=[this];var i,s,n,a,o,r,h,l,u=this.items,d=[[e.isFunction(this.options.items)?this.options.items.call(this.element[0],t,{item:this.currentItem}):e(this.options.items,this.element),this]],c=this._connectWith();if(c&amp;&amp;this.ready)for(i=c.length-1;i&gt;=0;i--)for(n=e(c[i],this.document[0]),s=n.length-1;s&gt;=0;s--)a=e.data(n[s],this.widgetFullName),a&amp;&amp;a!==this&amp;&amp;!a.options.disabled&amp;&amp;(d.push([e.isFunction(a.options.items)?a.options.items.call(a.element[0],t,{item:this.currentItem}):e(a.options.items,a.element),a]),this.containers.push(a));for(i=d.length-1;i&gt;=0;i--)for(o=d[i][1],r=d[i][0],s=0,l=r.length;l&gt;s;s++)h=e(r[s]),h.data(this.widgetName+&quot;-item&quot;,o),u.push({item:h,instance:o,width:0,height:0,left:0,top:0})},refreshPositions:function(t){this.floating=this.items.length?&quot;x&quot;===this.options.axis||this._isFloating(this.items[0].item):!1,this.offsetParent&amp;&amp;this.helper&amp;&amp;(this.offset.parent=this._getParentOffset());var i,s,n,a;for(i=this.items.length-1;i&gt;=0;i--)s=this.items[i],s.instance!==this.currentContainer&amp;&amp;this.currentContainer&amp;&amp;s.item[0]!==this.currentItem[0]||(n=this.options.toleranceElement?e(this.options.toleranceElement,s.item):s.item,t||(s.width=n.outerWidth(),s.height=n.outerHeight()),a=n.offset(),s.left=a.left,s.top=a.top);if(this.options.custom&amp;&amp;this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(i=this.containers.length-1;i&gt;=0;i--)a=this.containers[i].element.offset(),this.containers[i].containerCache.left=a.left,this.containers[i].containerCache.top=a.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight();return this},_createPlaceholder:function(t){t=t||this;var i,s=t.options;s.placeholder&amp;&amp;s.placeholder.constructor!==String||(i=s.placeholder,s.placeholder={element:function(){var s=t.currentItem[0].nodeName.toLowerCase(),n=e(&quot;&lt;&quot;+s+&quot;&gt;&quot;,t.document[0]).addClass(i||t.currentItem[0].className+&quot; ui-sortable-placeholder&quot;).removeClass(&quot;ui-sortable-helper&quot;);return&quot;tbody&quot;===s?t._createTrPlaceholder(t.currentItem.find(&quot;tr&quot;).eq(0),e(&quot;&lt;tr&gt;&quot;,t.document[0]).appendTo(n)):&quot;tr&quot;===s?t._createTrPlaceholder(t.currentItem,n):&quot;img&quot;===s&amp;&amp;n.attr(&quot;src&quot;,t.currentItem.attr(&quot;src&quot;)),i||n.css(&quot;visibility&quot;,&quot;hidden&quot;),n},update:function(e,n){(!i||s.forcePlaceholderSize)&amp;&amp;(n.height()||n.height(t.currentItem.innerHeight()-parseInt(t.currentItem.css(&quot;paddingTop&quot;)||0,10)-parseInt(t.currentItem.css(&quot;paddingBottom&quot;)||0,10)),n.width()||n.width(t.currentItem.innerWidth()-parseInt(t.currentItem.css(&quot;paddingLeft&quot;)||0,10)-parseInt(t.currentItem.css(&quot;paddingRight&quot;)||0,10)))}}),t.placeholder=e(s.placeholder.element.call(t.element,t.currentItem)),t.currentItem.after(t.placeholder),s.placeholder.update(t,t.placeholder)},_createTrPlaceholder:function(t,i){var s=this;t.children().each(function(){e(&quot;&lt;td&gt;&amp;#160;&lt;/td&gt;&quot;,s.document[0]).attr(&quot;colspan&quot;,e(this).attr(&quot;colspan&quot;)||1).appendTo(i)})},_contactContainers:function(t){var i,s,n,a,o,r,h,l,u,d,c=null,p=null;for(i=this.containers.length-1;i&gt;=0;i--)if(!e.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(c&amp;&amp;e.contains(this.containers[i].element[0],c.element[0]))continue;c=this.containers[i],p=i}else this.containers[i].containerCache.over&amp;&amp;(this.containers[i]._trigger(&quot;out&quot;,t,this._uiHash(this)),this.containers[i].containerCache.over=0);if(c)if(1===this.containers.length)this.containers[p].containerCache.over||(this.containers[p]._trigger(&quot;over&quot;,t,this._uiHash(this)),this.containers[p].containerCache.over=1);else{for(n=1e4,a=null,u=c.floating||this._isFloating(this.currentItem),o=u?&quot;left&quot;:&quot;top&quot;,r=u?&quot;width&quot;:&quot;height&quot;,d=u?&quot;clientX&quot;:&quot;clientY&quot;,s=this.items.length-1;s&gt;=0;s--)e.contains(this.containers[p].element[0],this.items[s].item[0])&amp;&amp;this.items[s].item[0]!==this.currentItem[0]&amp;&amp;(h=this.items[s].item.offset()[o],l=!1,t[d]-h&gt;this.items[s][r]/2&amp;&amp;(l=!0),n&gt;Math.abs(t[d]-h)&amp;&amp;(n=Math.abs(t[d]-h),a=this.items[s],this.direction=l?&quot;up&quot;:&quot;down&quot;));if(!a&amp;&amp;!this.options.dropOnEmpty)return;if(this.currentContainer===this.containers[p])return this.currentContainer.containerCache.over||(this.containers[p]._trigger(&quot;over&quot;,t,this._uiHash()),this.currentContainer.containerCache.over=1),void 0;a?this._rearrange(t,a,null,!0):this._rearrange(t,null,this.containers[p].element,!0),this._trigger(&quot;change&quot;,t,this._uiHash()),this.containers[p]._trigger(&quot;change&quot;,t,this._uiHash(this)),this.currentContainer=this.containers[p],this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[p]._trigger(&quot;over&quot;,t,this._uiHash(this)),this.containers[p].containerCache.over=1}},_createHelper:function(t){var i=this.options,s=e.isFunction(i.helper)?e(i.helper.apply(this.element[0],[t,this.currentItem])):&quot;clone&quot;===i.helper?this.currentItem.clone():this.currentItem;return s.parents(&quot;body&quot;).length||e(&quot;parent&quot;!==i.appendTo?i.appendTo:this.currentItem[0].parentNode)[0].appendChild(s[0]),s[0]===this.currentItem[0]&amp;&amp;(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css(&quot;position&quot;),top:this.currentItem.css(&quot;top&quot;),left:this.currentItem.css(&quot;left&quot;)}),(!s[0].style.width||i.forceHelperSize)&amp;&amp;s.width(this.currentItem.width()),(!s[0].style.height||i.forceHelperSize)&amp;&amp;s.height(this.currentItem.height()),s},_adjustOffsetFromHelper:function(t){&quot;string&quot;==typeof t&amp;&amp;(t=t.split(&quot; &quot;)),e.isArray(t)&amp;&amp;(t={left:+t[0],top:+t[1]||0}),&quot;left&quot;in t&amp;&amp;(this.offset.click.left=t.left+this.margins.left),&quot;right&quot;in t&amp;&amp;(this.offset.click.left=this.helperProportions.width-t.right+this.margins.left),&quot;top&quot;in t&amp;&amp;(this.offset.click.top=t.top+this.margins.top),&quot;bottom&quot;in t&amp;&amp;(this.offset.click.top=this.helperProportions.height-t.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var t=this.offsetParent.offset();return&quot;absolute&quot;===this.cssPosition&amp;&amp;this.scrollParent[0]!==this.document[0]&amp;&amp;e.contains(this.scrollParent[0],this.offsetParent[0])&amp;&amp;(t.left+=this.scrollParent.scrollLeft(),t.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]===this.document[0].body||this.offsetParent[0].tagName&amp;&amp;&quot;html&quot;===this.offsetParent[0].tagName.toLowerCase()&amp;&amp;e.ui.ie)&amp;&amp;(t={top:0,left:0}),{top:t.top+(parseInt(this.offsetParent.css(&quot;borderTopWidth&quot;),10)||0),left:t.left+(parseInt(this.offsetParent.css(&quot;borderLeftWidth&quot;),10)||0)}},_getRelativeOffset:function(){if(&quot;relative&quot;===this.cssPosition){var e=this.currentItem.position();return{top:e.top-(parseInt(this.helper.css(&quot;top&quot;),10)||0)+this.scrollParent.scrollTop(),left:e.left-(parseInt(this.helper.css(&quot;left&quot;),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css(&quot;marginLeft&quot;),10)||0,top:parseInt(this.currentItem.css(&quot;marginTop&quot;),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var t,i,s,n=this.options;&quot;parent&quot;===n.containment&amp;&amp;(n.containment=this.helper[0].parentNode),(&quot;document&quot;===n.containment||&quot;window&quot;===n.containment)&amp;&amp;(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,&quot;document&quot;===n.containment?this.document.width():this.window.width()-this.helperProportions.width-this.margins.left,(&quot;document&quot;===n.containment?this.document.width():this.window.height()||this.document[0].body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(n.containment)||(t=e(n.containment)[0],i=e(n.containment).offset(),s=&quot;hidden&quot;!==e(t).css(&quot;overflow&quot;),this.containment=[i.left+(parseInt(e(t).css(&quot;borderLeftWidth&quot;),10)||0)+(parseInt(e(t).css(&quot;paddingLeft&quot;),10)||0)-this.margins.left,i.top+(parseInt(e(t).css(&quot;borderTopWidth&quot;),10)||0)+(parseInt(e(t).css(&quot;paddingTop&quot;),10)||0)-this.margins.top,i.left+(s?Math.max(t.scrollWidth,t.offsetWidth):t.offsetWidth)-(parseInt(e(t).css(&quot;borderLeftWidth&quot;),10)||0)-(parseInt(e(t).css(&quot;paddingRight&quot;),10)||0)-this.helperProportions.width-this.margins.left,i.top+(s?Math.max(t.scrollHeight,t.offsetHeight):t.offsetHeight)-(parseInt(e(t).css(&quot;borderTopWidth&quot;),10)||0)-(parseInt(e(t).css(&quot;paddingBottom&quot;),10)||0)-this.helperProportions.height-this.margins.top])},_convertPositionTo:function(t,i){i||(i=this.position);var s=&quot;absolute&quot;===t?1:-1,n=&quot;absolute&quot;!==this.cssPosition||this.scrollParent[0]!==this.document[0]&amp;&amp;e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,a=/(html|body)/i.test(n[0].tagName);return{top:i.top+this.offset.relative.top*s+this.offset.parent.top*s-(&quot;fixed&quot;===this.cssPosition?-this.scrollParent.scrollTop():a?0:n.scrollTop())*s,left:i.left+this.offset.relative.left*s+this.offset.parent.left*s-(&quot;fixed&quot;===this.cssPosition?-this.scrollParent.scrollLeft():a?0:n.scrollLeft())*s}},_generatePosition:function(t){var i,s,n=this.options,a=t.pageX,o=t.pageY,r=&quot;absolute&quot;!==this.cssPosition||this.scrollParent[0]!==this.document[0]&amp;&amp;e.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,h=/(html|body)/i.test(r[0].tagName);return&quot;relative&quot;!==this.cssPosition||this.scrollParent[0]!==this.document[0]&amp;&amp;this.scrollParent[0]!==this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset()),this.originalPosition&amp;&amp;(this.containment&amp;&amp;(t.pageX-this.offset.click.left&lt;this.containment[0]&amp;&amp;(a=this.containment[0]+this.offset.click.left),t.pageY-this.offset.click.top&lt;this.containment[1]&amp;&amp;(o=this.containment[1]+this.offset.click.top),t.pageX-this.offset.click.left&gt;this.containment[2]&amp;&amp;(a=this.containment[2]+this.offset.click.left),t.pageY-this.offset.click.top&gt;this.containment[3]&amp;&amp;(o=this.containment[3]+this.offset.click.top)),n.grid&amp;&amp;(i=this.originalPageY+Math.round((o-this.originalPageY)/n.grid[1])*n.grid[1],o=this.containment?i-this.offset.click.top&gt;=this.containment[1]&amp;&amp;i-this.offset.click.top&lt;=this.containment[3]?i:i-this.offset.click.top&gt;=this.containment[1]?i-n.grid[1]:i+n.grid[1]:i,s=this.originalPageX+Math.round((a-this.originalPageX)/n.grid[0])*n.grid[0],a=this.containment?s-this.offset.click.left&gt;=this.containment[0]&amp;&amp;s-this.offset.click.left&lt;=this.containment[2]?s:s-this.offset.click.left&gt;=this.containment[0]?s-n.grid[0]:s+n.grid[0]:s)),{top:o-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+(&quot;fixed&quot;===this.cssPosition?-this.scrollParent.scrollTop():h?0:r.scrollTop()),left:a-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+(&quot;fixed&quot;===this.cssPosition?-this.scrollParent.scrollLeft():h?0:r.scrollLeft())}},_rearrange:function(e,t,i,s){i?i[0].appendChild(this.placeholder[0]):t.item[0].parentNode.insertBefore(this.placeholder[0],&quot;down&quot;===this.direction?t.item[0]:t.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var n=this.counter;this._delay(function(){n===this.counter&amp;&amp;this.refreshPositions(!s)})},_clear:function(e,t){function i(e,t,i){return function(s){i._trigger(e,s,t._uiHash(t))}}this.reverting=!1;var s,n=[];if(!this._noFinalSort&amp;&amp;this.currentItem.parent().length&amp;&amp;this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]===this.currentItem[0]){for(s in this._storedCSS)(&quot;auto&quot;===this._storedCSS[s]||&quot;static&quot;===this._storedCSS[s])&amp;&amp;(this._storedCSS[s]=&quot;&quot;);this.currentItem.css(this._storedCSS).removeClass(&quot;ui-sortable-helper&quot;)}else this.currentItem.show();for(this.fromOutside&amp;&amp;!t&amp;&amp;n.push(function(e){this._trigger(&quot;receive&quot;,e,this._uiHash(this.fromOutside))}),!this.fromOutside&amp;&amp;this.domPosition.prev===this.currentItem.prev().not(&quot;.ui-sortable-helper&quot;)[0]&amp;&amp;this.domPosition.parent===this.currentItem.parent()[0]||t||n.push(function(e){this._trigger(&quot;update&quot;,e,this._uiHash())}),this!==this.currentContainer&amp;&amp;(t||(n.push(function(e){this._trigger(&quot;remove&quot;,e,this._uiHash())}),n.push(function(e){return function(t){e._trigger(&quot;receive&quot;,t,this._uiHash(this))}}.call(this,this.currentContainer)),n.push(function(e){return function(t){e._trigger(&quot;update&quot;,t,this._uiHash(this))}}.call(this,this.currentContainer)))),s=this.containers.length-1;s&gt;=0;s--)t||n.push(i(&quot;deactivate&quot;,this,this.containers[s])),this.containers[s].containerCache.over&amp;&amp;(n.push(i(&quot;out&quot;,this,this.containers[s])),this.containers[s].containerCache.over=0);if(this.storedCursor&amp;&amp;(this.document.find(&quot;body&quot;).css(&quot;cursor&quot;,this.storedCursor),this.storedStylesheet.remove()),this._storedOpacity&amp;&amp;this.helper.css(&quot;opacity&quot;,this._storedOpacity),this._storedZIndex&amp;&amp;this.helper.css(&quot;zIndex&quot;,&quot;auto&quot;===this._storedZIndex?&quot;&quot;:this._storedZIndex),this.dragging=!1,t||this._trigger(&quot;beforeStop&quot;,e,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.cancelHelperRemoval||(this.helper[0]!==this.currentItem[0]&amp;&amp;this.helper.remove(),this.helper=null),!t){for(s=0;n.length&gt;s;s++)n[s].call(this,e);this._trigger(&quot;stop&quot;,e,this._uiHash())}return this.fromOutside=!1,!this.cancelHelperRemoval},_trigger:function(){e.Widget.prototype._trigger.apply(this,arguments)===!1&amp;&amp;this.cancel()},_uiHash:function(t){var i=t||this;return{helper:i.helper,placeholder:i.placeholder||e([]),position:i.position,originalPosition:i.originalPosition,offset:i.positionAbs,item:i.currentItem,sender:t?t.element:null}}}),e.widget(&quot;ui.spinner&quot;,{version:&quot;1.11.4&quot;,defaultElement:&quot;&lt;input&gt;&quot;,widgetEventPrefix:&quot;spin&quot;,options:{culture:null,icons:{down:&quot;ui-icon-triangle-1-s&quot;,up:&quot;ui-icon-triangle-1-n&quot;},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption(&quot;max&quot;,this.options.max),this._setOption(&quot;min&quot;,this.options.min),this._setOption(&quot;step&quot;,this.options.step),&quot;&quot;!==this.value()&amp;&amp;this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr(&quot;autocomplete&quot;)}})},_getCreateOptions:function(){var t={},i=this.element;return e.each([&quot;min&quot;,&quot;max&quot;,&quot;step&quot;],function(e,s){var n=i.attr(s);void 0!==n&amp;&amp;n.length&amp;&amp;(t[s]=n)}),t},_events:{keydown:function(e){this._start(e)&amp;&amp;this._keydown(e)&amp;&amp;e.preventDefault()},keyup:&quot;_stop&quot;,focus:function(){this.previous=this.element.val()},blur:function(e){return this.cancelBlur?(delete this.cancelBlur,void 0):(this._stop(),this._refresh(),this.previous!==this.element.val()&amp;&amp;this._trigger(&quot;change&quot;,e),void 0)},mousewheel:function(e,t){if(t){if(!this.spinning&amp;&amp;!this._start(e))return!1;this._spin((t&gt;0?1:-1)*this.options.step,e),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay(function(){this.spinning&amp;&amp;this._stop(e)},100),e.preventDefault()}},&quot;mousedown .ui-spinner-button&quot;:function(t){function i(){var e=this.element[0]===this.document[0].activeElement;e||(this.element.focus(),this.previous=s,this._delay(function(){this.previous=s}))}var s;s=this.element[0]===this.document[0].activeElement?this.previous:this.element.val(),t.preventDefault(),i.call(this),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur,i.call(this)}),this._start(t)!==!1&amp;&amp;this._repeat(null,e(t.currentTarget).hasClass(&quot;ui-spinner-up&quot;)?1:-1,t)},&quot;mouseup .ui-spinner-button&quot;:&quot;_stop&quot;,&quot;mouseenter .ui-spinner-button&quot;:function(t){return e(t.currentTarget).hasClass(&quot;ui-state-active&quot;)?this._start(t)===!1?!1:(this._repeat(null,e(t.currentTarget).hasClass(&quot;ui-spinner-up&quot;)?1:-1,t),void 0):void 0},&quot;mouseleave .ui-spinner-button&quot;:&quot;_stop&quot;},_draw:function(){var e=this.uiSpinner=this.element.addClass(&quot;ui-spinner-input&quot;).attr(&quot;autocomplete&quot;,&quot;off&quot;).wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml());this.element.attr(&quot;role&quot;,&quot;spinbutton&quot;),this.buttons=e.find(&quot;.ui-spinner-button&quot;).attr(&quot;tabIndex&quot;,-1).button().removeClass(&quot;ui-corner-all&quot;),this.buttons.height()&gt;Math.ceil(.5*e.height())&amp;&amp;e.height()&gt;0&amp;&amp;e.height(e.height()),this.options.disabled&amp;&amp;this.disable()},_keydown:function(t){var i=this.options,s=e.ui.keyCode;switch(t.keyCode){case s.UP:return this._repeat(null,1,t),!0;case s.DOWN:return this._repeat(null,-1,t),!0;case s.PAGE_UP:return this._repeat(null,i.page,t),!0;case s.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_uiSpinnerHtml:function(){return&quot;&lt;span class='ui-spinner ui-widget ui-widget-content ui-corner-all'&gt;&lt;/span&gt;&quot;},_buttonHtml:function(){return&quot;&lt;a class='ui-spinner-button ui-spinner-up ui-corner-tr'&gt;&lt;span class='ui-icon &quot;+this.options.icons.up+&quot;'&gt;&amp;#9650;&lt;/span&gt;&quot;+&quot;&lt;/a&gt;&quot;+&quot;&lt;a class='ui-spinner-button ui-spinner-down ui-corner-br'&gt;&quot;+&quot;&lt;span class='ui-icon &quot;+this.options.icons.down+&quot;'&gt;&amp;#9660;&lt;/span&gt;&quot;+&quot;&lt;/a&gt;&quot;},_start:function(e){return this.spinning||this._trigger(&quot;start&quot;,e)!==!1?(this.counter||(this.counter=1),this.spinning=!0,!0):!1},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay(function(){this._repeat(40,t,i)},e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&amp;&amp;this._trigger(&quot;spin&quot;,t,{value:i})===!1||(this._value(i),this.counter++)},_increment:function(t){var i=this.options.incremental;return i?e.isFunction(i)?i(t):Math.floor(t*t*t/5e4-t*t/500+17*t/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&amp;&amp;(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=&quot;&quot;+e,i=t.indexOf(&quot;.&quot;);return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,s=this.options;return t=null!==s.min?s.min:0,i=e-t,i=Math.round(i/s.step)*s.step,e=t+i,e=parseFloat(e.toFixed(this._precision())),null!==s.max&amp;&amp;e&gt;s.max?s.max:null!==s.min&amp;&amp;s.min&gt;e?s.min:e},_stop:function(e){this.spinning&amp;&amp;(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger(&quot;stop&quot;,e))},_setOption:function(e,t){if(&quot;culture&quot;===e||&quot;numberFormat&quot;===e){var i=this._parse(this.element.val());return this.options[e]=t,this.element.val(this._format(i)),void 0}(&quot;max&quot;===e||&quot;min&quot;===e||&quot;step&quot;===e)&amp;&amp;&quot;string&quot;==typeof t&amp;&amp;(t=this._parse(t)),&quot;icons&quot;===e&amp;&amp;(this.buttons.first().find(&quot;.ui-icon&quot;).removeClass(this.options.icons.up).addClass(t.up),this.buttons.last().find(&quot;.ui-icon&quot;).removeClass(this.options.icons.down).addClass(t.down)),this._super(e,t),&quot;disabled&quot;===e&amp;&amp;(this.widget().toggleClass(&quot;ui-state-disabled&quot;,!!t),this.element.prop(&quot;disabled&quot;,!!t),this.buttons.button(t?&quot;disable&quot;:&quot;enable&quot;))},_setOptions:h(function(e){this._super(e)}),_parse:function(e){return&quot;string&quot;==typeof e&amp;&amp;&quot;&quot;!==e&amp;&amp;(e=window.Globalize&amp;&amp;this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),&quot;&quot;===e||isNaN(e)?null:e},_format:function(e){return&quot;&quot;===e?&quot;&quot;:window.Globalize&amp;&amp;this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({&quot;aria-valuemin&quot;:this.options.min,&quot;aria-valuemax&quot;:this.options.max,&quot;aria-valuenow&quot;:this._parse(this.element.val())})},isValid:function(){var e=this.value();return null===e?!1:e===this._adjustValue(e)},_value:function(e,t){var i;&quot;&quot;!==e&amp;&amp;(i=this._parse(e),null!==i&amp;&amp;(t||(i=this._adjustValue(i)),e=this._format(i))),this.element.val(e),this._refresh()},_destroy:function(){this.element.removeClass(&quot;ui-spinner-input&quot;).prop(&quot;disabled&quot;,!1).removeAttr(&quot;autocomplete&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;aria-valuemin&quot;).removeAttr(&quot;aria-valuemax&quot;).removeAttr(&quot;aria-valuenow&quot;),this.uiSpinner.replaceWith(this.element)},stepUp:h(function(e){this._stepUp(e)}),_stepUp:function(e){this._start()&amp;&amp;(this._spin((e||1)*this.options.step),this._stop())},stepDown:h(function(e){this._stepDown(e)}),_stepDown:function(e){this._start()&amp;&amp;(this._spin((e||1)*-this.options.step),this._stop())},pageUp:h(function(e){this._stepUp((e||1)*this.options.page)}),pageDown:h(function(e){this._stepDown((e||1)*this.options.page)}),value:function(e){return arguments.length?(h(this._value).call(this,e),void 0):this._parse(this.element.val())},widget:function(){return this.uiSpinner}}),e.widget(&quot;ui.tabs&quot;,{version:&quot;1.11.4&quot;,delay:300,options:{active:null,collapsible:!1,event:&quot;click&quot;,heightStyle:&quot;content&quot;,hide:null,show:null,activate:null,beforeActivate:null,beforeLoad:null,load:null},_isLocal:function(){var e=/#.*$/;return function(t){var i,s;t=t.cloneNode(!1),i=t.href.replace(e,&quot;&quot;),s=location.href.replace(e,&quot;&quot;);try{i=decodeURIComponent(i)}catch(n){}try{s=decodeURIComponent(s)}catch(n){}return t.hash.length&gt;1&amp;&amp;i===s}}(),_create:function(){var t=this,i=this.options;this.running=!1,this.element.addClass(&quot;ui-tabs ui-widget ui-widget-content ui-corner-all&quot;).toggleClass(&quot;ui-tabs-collapsible&quot;,i.collapsible),this._processTabs(),i.active=this._initialActive(),e.isArray(i.disabled)&amp;&amp;(i.disabled=e.unique(i.disabled.concat(e.map(this.tabs.filter(&quot;.ui-state-disabled&quot;),function(e){return t.tabs.index(e)}))).sort()),this.active=this.options.active!==!1&amp;&amp;this.anchors.length?this._findActive(i.active):e(),this._refresh(),this.active.length&amp;&amp;this.load(i.active)},_initialActive:function(){var t=this.options.active,i=this.options.collapsible,s=location.hash.substring(1);return null===t&amp;&amp;(s&amp;&amp;this.tabs.each(function(i,n){return e(n).attr(&quot;aria-controls&quot;)===s?(t=i,!1):void 0}),null===t&amp;&amp;(t=this.tabs.index(this.tabs.filter(&quot;.ui-tabs-active&quot;))),(null===t||-1===t)&amp;&amp;(t=this.tabs.length?0:!1)),t!==!1&amp;&amp;(t=this.tabs.index(this.tabs.eq(t)),-1===t&amp;&amp;(t=i?!1:0)),!i&amp;&amp;t===!1&amp;&amp;this.anchors.length&amp;&amp;(t=0),t},_getCreateEventData:function(){return{tab:this.active,panel:this.active.length?this._getPanelForTab(this.active):e()}},_tabKeydown:function(t){var i=e(this.document[0].activeElement).closest(&quot;li&quot;),s=this.tabs.index(i),n=!0;if(!this._handlePageNav(t)){switch(t.keyCode){case e.ui.keyCode.RIGHT:case e.ui.keyCode.DOWN:s++;break;case e.ui.keyCode.UP:case e.ui.keyCode.LEFT:n=!1,s--;break;case e.ui.keyCode.END:s=this.anchors.length-1;break;case e.ui.keyCode.HOME:s=0;break;case e.ui.keyCode.SPACE:return t.preventDefault(),clearTimeout(this.activating),this._activate(s),void 0;case e.ui.keyCode.ENTER:return t.preventDefault(),clearTimeout(this.activating),this._activate(s===this.options.active?!1:s),void 0;default:return}t.preventDefault(),clearTimeout(this.activating),s=this._focusNextTab(s,n),t.ctrlKey||t.metaKey||(i.attr(&quot;aria-selected&quot;,&quot;false&quot;),this.tabs.eq(s).attr(&quot;aria-selected&quot;,&quot;true&quot;),this.activating=this._delay(function(){this.option(&quot;active&quot;,s)},this.delay))}},_panelKeydown:function(t){this._handlePageNav(t)||t.ctrlKey&amp;&amp;t.keyCode===e.ui.keyCode.UP&amp;&amp;(t.preventDefault(),this.active.focus())},_handlePageNav:function(t){return t.altKey&amp;&amp;t.keyCode===e.ui.keyCode.PAGE_UP?(this._activate(this._focusNextTab(this.options.active-1,!1)),!0):t.altKey&amp;&amp;t.keyCode===e.ui.keyCode.PAGE_DOWN?(this._activate(this._focusNextTab(this.options.active+1,!0)),!0):void 0},_findNextTab:function(t,i){function s(){return t&gt;n&amp;&amp;(t=0),0&gt;t&amp;&amp;(t=n),t}for(var n=this.tabs.length-1;-1!==e.inArray(s(),this.options.disabled);)t=i?t+1:t-1;return t},_focusNextTab:function(e,t){return e=this._findNextTab(e,t),this.tabs.eq(e).focus(),e},_setOption:function(e,t){return&quot;active&quot;===e?(this._activate(t),void 0):&quot;disabled&quot;===e?(this._setupDisabled(t),void 0):(this._super(e,t),&quot;collapsible&quot;===e&amp;&amp;(this.element.toggleClass(&quot;ui-tabs-collapsible&quot;,t),t||this.options.active!==!1||this._activate(0)),&quot;event&quot;===e&amp;&amp;this._setupEvents(t),&quot;heightStyle&quot;===e&amp;&amp;this._setupHeightStyle(t),void 0)},_sanitizeSelector:function(e){return e?e.replace(/[!&quot;$%&amp;'()*+,.\/:;&lt;=&gt;?@\[\]\^`{|}~]/g,&quot;\\$&amp;&quot;):&quot;&quot;},refresh:function(){var t=this.options,i=this.tablist.children(&quot;:has(a[href])&quot;);t.disabled=e.map(i.filter(&quot;.ui-state-disabled&quot;),function(e){return i.index(e)}),this._processTabs(),t.active!==!1&amp;&amp;this.anchors.length?this.active.length&amp;&amp;!e.contains(this.tablist[0],this.active[0])?this.tabs.length===t.disabled.length?(t.active=!1,this.active=e()):this._activate(this._findNextTab(Math.max(0,t.active-1),!1)):t.active=this.tabs.index(this.active):(t.active=!1,this.active=e()),this._refresh()},_refresh:function(){this._setupDisabled(this.options.disabled),this._setupEvents(this.options.event),this._setupHeightStyle(this.options.heightStyle),this.tabs.not(this.active).attr({&quot;aria-selected&quot;:&quot;false&quot;,&quot;aria-expanded&quot;:&quot;false&quot;,tabIndex:-1}),this.panels.not(this._getPanelForTab(this.active)).hide().attr({&quot;aria-hidden&quot;:&quot;true&quot;}),this.active.length?(this.active.addClass(&quot;ui-tabs-active ui-state-active&quot;).attr({&quot;aria-selected&quot;:&quot;true&quot;,&quot;aria-expanded&quot;:&quot;true&quot;,tabIndex:0}),this._getPanelForTab(this.active).show().attr({&quot;aria-hidden&quot;:&quot;false&quot;})):this.tabs.eq(0).attr(&quot;tabIndex&quot;,0)},_processTabs:function(){var t=this,i=this.tabs,s=this.anchors,n=this.panels;
this.tablist=this._getList().addClass(&quot;ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all&quot;).attr(&quot;role&quot;,&quot;tablist&quot;).delegate(&quot;&gt; li&quot;,&quot;mousedown&quot;+this.eventNamespace,function(t){e(this).is(&quot;.ui-state-disabled&quot;)&amp;&amp;t.preventDefault()}).delegate(&quot;.ui-tabs-anchor&quot;,&quot;focus&quot;+this.eventNamespace,function(){e(this).closest(&quot;li&quot;).is(&quot;.ui-state-disabled&quot;)&amp;&amp;this.blur()}),this.tabs=this.tablist.find(&quot;&gt; li:has(a[href])&quot;).addClass(&quot;ui-state-default ui-corner-top&quot;).attr({role:&quot;tab&quot;,tabIndex:-1}),this.anchors=this.tabs.map(function(){return e(&quot;a&quot;,this)[0]}).addClass(&quot;ui-tabs-anchor&quot;).attr({role:&quot;presentation&quot;,tabIndex:-1}),this.panels=e(),this.anchors.each(function(i,s){var n,a,o,r=e(s).uniqueId().attr(&quot;id&quot;),h=e(s).closest(&quot;li&quot;),l=h.attr(&quot;aria-controls&quot;);t._isLocal(s)?(n=s.hash,o=n.substring(1),a=t.element.find(t._sanitizeSelector(n))):(o=h.attr(&quot;aria-controls&quot;)||e({}).uniqueId()[0].id,n=&quot;#&quot;+o,a=t.element.find(n),a.length||(a=t._createPanel(o),a.insertAfter(t.panels[i-1]||t.tablist)),a.attr(&quot;aria-live&quot;,&quot;polite&quot;)),a.length&amp;&amp;(t.panels=t.panels.add(a)),l&amp;&amp;h.data(&quot;ui-tabs-aria-controls&quot;,l),h.attr({&quot;aria-controls&quot;:o,&quot;aria-labelledby&quot;:r}),a.attr(&quot;aria-labelledby&quot;,r)}),this.panels.addClass(&quot;ui-tabs-panel ui-widget-content ui-corner-bottom&quot;).attr(&quot;role&quot;,&quot;tabpanel&quot;),i&amp;&amp;(this._off(i.not(this.tabs)),this._off(s.not(this.anchors)),this._off(n.not(this.panels)))},_getList:function(){return this.tablist||this.element.find(&quot;ol,ul&quot;).eq(0)},_createPanel:function(t){return e(&quot;&lt;div&gt;&quot;).attr(&quot;id&quot;,t).addClass(&quot;ui-tabs-panel ui-widget-content ui-corner-bottom&quot;).data(&quot;ui-tabs-destroy&quot;,!0)},_setupDisabled:function(t){e.isArray(t)&amp;&amp;(t.length?t.length===this.anchors.length&amp;&amp;(t=!0):t=!1);for(var i,s=0;i=this.tabs[s];s++)t===!0||-1!==e.inArray(s,t)?e(i).addClass(&quot;ui-state-disabled&quot;).attr(&quot;aria-disabled&quot;,&quot;true&quot;):e(i).removeClass(&quot;ui-state-disabled&quot;).removeAttr(&quot;aria-disabled&quot;);this.options.disabled=t},_setupEvents:function(t){var i={};t&amp;&amp;e.each(t.split(&quot; &quot;),function(e,t){i[t]=&quot;_eventHandler&quot;}),this._off(this.anchors.add(this.tabs).add(this.panels)),this._on(!0,this.anchors,{click:function(e){e.preventDefault()}}),this._on(this.anchors,i),this._on(this.tabs,{keydown:&quot;_tabKeydown&quot;}),this._on(this.panels,{keydown:&quot;_panelKeydown&quot;}),this._focusable(this.tabs),this._hoverable(this.tabs)},_setupHeightStyle:function(t){var i,s=this.element.parent();&quot;fill&quot;===t?(i=s.height(),i-=this.element.outerHeight()-this.element.height(),this.element.siblings(&quot;:visible&quot;).each(function(){var t=e(this),s=t.css(&quot;position&quot;);&quot;absolute&quot;!==s&amp;&amp;&quot;fixed&quot;!==s&amp;&amp;(i-=t.outerHeight(!0))}),this.element.children().not(this.panels).each(function(){i-=e(this).outerHeight(!0)}),this.panels.each(function(){e(this).height(Math.max(0,i-e(this).innerHeight()+e(this).height()))}).css(&quot;overflow&quot;,&quot;auto&quot;)):&quot;auto&quot;===t&amp;&amp;(i=0,this.panels.each(function(){i=Math.max(i,e(this).height(&quot;&quot;).height())}).height(i))},_eventHandler:function(t){var i=this.options,s=this.active,n=e(t.currentTarget),a=n.closest(&quot;li&quot;),o=a[0]===s[0],r=o&amp;&amp;i.collapsible,h=r?e():this._getPanelForTab(a),l=s.length?this._getPanelForTab(s):e(),u={oldTab:s,oldPanel:l,newTab:r?e():a,newPanel:h};t.preventDefault(),a.hasClass(&quot;ui-state-disabled&quot;)||a.hasClass(&quot;ui-tabs-loading&quot;)||this.running||o&amp;&amp;!i.collapsible||this._trigger(&quot;beforeActivate&quot;,t,u)===!1||(i.active=r?!1:this.tabs.index(a),this.active=o?e():a,this.xhr&amp;&amp;this.xhr.abort(),l.length||h.length||e.error(&quot;jQuery UI Tabs: Mismatching fragment identifier.&quot;),h.length&amp;&amp;this.load(this.tabs.index(a),t),this._toggle(t,u))},_toggle:function(t,i){function s(){a.running=!1,a._trigger(&quot;activate&quot;,t,i)}function n(){i.newTab.closest(&quot;li&quot;).addClass(&quot;ui-tabs-active ui-state-active&quot;),o.length&amp;&amp;a.options.show?a._show(o,a.options.show,s):(o.show(),s())}var a=this,o=i.newPanel,r=i.oldPanel;this.running=!0,r.length&amp;&amp;this.options.hide?this._hide(r,this.options.hide,function(){i.oldTab.closest(&quot;li&quot;).removeClass(&quot;ui-tabs-active ui-state-active&quot;),n()}):(i.oldTab.closest(&quot;li&quot;).removeClass(&quot;ui-tabs-active ui-state-active&quot;),r.hide(),n()),r.attr(&quot;aria-hidden&quot;,&quot;true&quot;),i.oldTab.attr({&quot;aria-selected&quot;:&quot;false&quot;,&quot;aria-expanded&quot;:&quot;false&quot;}),o.length&amp;&amp;r.length?i.oldTab.attr(&quot;tabIndex&quot;,-1):o.length&amp;&amp;this.tabs.filter(function(){return 0===e(this).attr(&quot;tabIndex&quot;)}).attr(&quot;tabIndex&quot;,-1),o.attr(&quot;aria-hidden&quot;,&quot;false&quot;),i.newTab.attr({&quot;aria-selected&quot;:&quot;true&quot;,&quot;aria-expanded&quot;:&quot;true&quot;,tabIndex:0})},_activate:function(t){var i,s=this._findActive(t);s[0]!==this.active[0]&amp;&amp;(s.length||(s=this.active),i=s.find(&quot;.ui-tabs-anchor&quot;)[0],this._eventHandler({target:i,currentTarget:i,preventDefault:e.noop}))},_findActive:function(t){return t===!1?e():this.tabs.eq(t)},_getIndex:function(e){return&quot;string&quot;==typeof e&amp;&amp;(e=this.anchors.index(this.anchors.filter(&quot;[href$='&quot;+e+&quot;']&quot;))),e},_destroy:function(){this.xhr&amp;&amp;this.xhr.abort(),this.element.removeClass(&quot;ui-tabs ui-widget ui-widget-content ui-corner-all ui-tabs-collapsible&quot;),this.tablist.removeClass(&quot;ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all&quot;).removeAttr(&quot;role&quot;),this.anchors.removeClass(&quot;ui-tabs-anchor&quot;).removeAttr(&quot;role&quot;).removeAttr(&quot;tabIndex&quot;).removeUniqueId(),this.tablist.unbind(this.eventNamespace),this.tabs.add(this.panels).each(function(){e.data(this,&quot;ui-tabs-destroy&quot;)?e(this).remove():e(this).removeClass(&quot;ui-state-default ui-state-active ui-state-disabled ui-corner-top ui-corner-bottom ui-widget-content ui-tabs-active ui-tabs-panel&quot;).removeAttr(&quot;tabIndex&quot;).removeAttr(&quot;aria-live&quot;).removeAttr(&quot;aria-busy&quot;).removeAttr(&quot;aria-selected&quot;).removeAttr(&quot;aria-labelledby&quot;).removeAttr(&quot;aria-hidden&quot;).removeAttr(&quot;aria-expanded&quot;).removeAttr(&quot;role&quot;)}),this.tabs.each(function(){var t=e(this),i=t.data(&quot;ui-tabs-aria-controls&quot;);i?t.attr(&quot;aria-controls&quot;,i).removeData(&quot;ui-tabs-aria-controls&quot;):t.removeAttr(&quot;aria-controls&quot;)}),this.panels.show(),&quot;content&quot;!==this.options.heightStyle&amp;&amp;this.panels.css(&quot;height&quot;,&quot;&quot;)},enable:function(t){var i=this.options.disabled;i!==!1&amp;&amp;(void 0===t?i=!1:(t=this._getIndex(t),i=e.isArray(i)?e.map(i,function(e){return e!==t?e:null}):e.map(this.tabs,function(e,i){return i!==t?i:null})),this._setupDisabled(i))},disable:function(t){var i=this.options.disabled;if(i!==!0){if(void 0===t)i=!0;else{if(t=this._getIndex(t),-1!==e.inArray(t,i))return;i=e.isArray(i)?e.merge([t],i).sort():[t]}this._setupDisabled(i)}},load:function(t,i){t=this._getIndex(t);var s=this,n=this.tabs.eq(t),a=n.find(&quot;.ui-tabs-anchor&quot;),o=this._getPanelForTab(n),r={tab:n,panel:o},h=function(e,t){&quot;abort&quot;===t&amp;&amp;s.panels.stop(!1,!0),n.removeClass(&quot;ui-tabs-loading&quot;),o.removeAttr(&quot;aria-busy&quot;),e===s.xhr&amp;&amp;delete s.xhr};this._isLocal(a[0])||(this.xhr=e.ajax(this._ajaxSettings(a,i,r)),this.xhr&amp;&amp;&quot;canceled&quot;!==this.xhr.statusText&amp;&amp;(n.addClass(&quot;ui-tabs-loading&quot;),o.attr(&quot;aria-busy&quot;,&quot;true&quot;),this.xhr.done(function(e,t,n){setTimeout(function(){o.html(e),s._trigger(&quot;load&quot;,i,r),h(n,t)},1)}).fail(function(e,t){setTimeout(function(){h(e,t)},1)})))},_ajaxSettings:function(t,i,s){var n=this;return{url:t.attr(&quot;href&quot;),beforeSend:function(t,a){return n._trigger(&quot;beforeLoad&quot;,i,e.extend({jqXHR:t,ajaxSettings:a},s))}}},_getPanelForTab:function(t){var i=e(t).attr(&quot;aria-controls&quot;);return this.element.find(this._sanitizeSelector(&quot;#&quot;+i))}}),e.widget(&quot;ui.tooltip&quot;,{version:&quot;1.11.4&quot;,options:{content:function(){var t=e(this).attr(&quot;title&quot;)||&quot;&quot;;return e(&quot;&lt;a&gt;&quot;).text(t).html()},hide:!0,items:&quot;[title]:not([disabled])&quot;,position:{my:&quot;left top+15&quot;,at:&quot;left bottom&quot;,collision:&quot;flipfit flip&quot;},show:!0,tooltipClass:null,track:!1,close:null,open:null},_addDescribedBy:function(t,i){var s=(t.attr(&quot;aria-describedby&quot;)||&quot;&quot;).split(/\s+/);s.push(i),t.data(&quot;ui-tooltip-id&quot;,i).attr(&quot;aria-describedby&quot;,e.trim(s.join(&quot; &quot;)))},_removeDescribedBy:function(t){var i=t.data(&quot;ui-tooltip-id&quot;),s=(t.attr(&quot;aria-describedby&quot;)||&quot;&quot;).split(/\s+/),n=e.inArray(i,s);-1!==n&amp;&amp;s.splice(n,1),t.removeData(&quot;ui-tooltip-id&quot;),s=e.trim(s.join(&quot; &quot;)),s?t.attr(&quot;aria-describedby&quot;,s):t.removeAttr(&quot;aria-describedby&quot;)},_create:function(){this._on({mouseover:&quot;open&quot;,focusin:&quot;open&quot;}),this.tooltips={},this.parents={},this.options.disabled&amp;&amp;this._disable(),this.liveRegion=e(&quot;&lt;div&gt;&quot;).attr({role:&quot;log&quot;,&quot;aria-live&quot;:&quot;assertive&quot;,&quot;aria-relevant&quot;:&quot;additions&quot;}).addClass(&quot;ui-helper-hidden-accessible&quot;).appendTo(this.document[0].body)},_setOption:function(t,i){var s=this;return&quot;disabled&quot;===t?(this[i?&quot;_disable&quot;:&quot;_enable&quot;](),this.options[t]=i,void 0):(this._super(t,i),&quot;content&quot;===t&amp;&amp;e.each(this.tooltips,function(e,t){s._updateContent(t.element)}),void 0)},_disable:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event(&quot;blur&quot;);n.target=n.currentTarget=s.element[0],t.close(n,!0)}),this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.is(&quot;[title]&quot;)&amp;&amp;t.data(&quot;ui-tooltip-title&quot;,t.attr(&quot;title&quot;)).removeAttr(&quot;title&quot;)})},_enable:function(){this.element.find(this.options.items).addBack().each(function(){var t=e(this);t.data(&quot;ui-tooltip-title&quot;)&amp;&amp;t.attr(&quot;title&quot;,t.data(&quot;ui-tooltip-title&quot;))})},open:function(t){var i=this,s=e(t?t.target:this.element).closest(this.options.items);s.length&amp;&amp;!s.data(&quot;ui-tooltip-id&quot;)&amp;&amp;(s.attr(&quot;title&quot;)&amp;&amp;s.data(&quot;ui-tooltip-title&quot;,s.attr(&quot;title&quot;)),s.data(&quot;ui-tooltip-open&quot;,!0),t&amp;&amp;&quot;mouseover&quot;===t.type&amp;&amp;s.parents().each(function(){var t,s=e(this);s.data(&quot;ui-tooltip-open&quot;)&amp;&amp;(t=e.Event(&quot;blur&quot;),t.target=t.currentTarget=this,i.close(t,!0)),s.attr(&quot;title&quot;)&amp;&amp;(s.uniqueId(),i.parents[this.id]={element:this,title:s.attr(&quot;title&quot;)},s.attr(&quot;title&quot;,&quot;&quot;))}),this._registerCloseHandlers(t,s),this._updateContent(s,t))},_updateContent:function(e,t){var i,s=this.options.content,n=this,a=t?t.type:null;return&quot;string&quot;==typeof s?this._open(t,e,s):(i=s.call(e[0],function(i){n._delay(function(){e.data(&quot;ui-tooltip-open&quot;)&amp;&amp;(t&amp;&amp;(t.type=a),this._open(t,e,i))})}),i&amp;&amp;this._open(t,e,i),void 0)},_open:function(t,i,s){function n(e){l.of=e,o.is(&quot;:hidden&quot;)||o.position(l)}var a,o,r,h,l=e.extend({},this.options.position);if(s){if(a=this._find(i))return a.tooltip.find(&quot;.ui-tooltip-content&quot;).html(s),void 0;i.is(&quot;[title]&quot;)&amp;&amp;(t&amp;&amp;&quot;mouseover&quot;===t.type?i.attr(&quot;title&quot;,&quot;&quot;):i.removeAttr(&quot;title&quot;)),a=this._tooltip(i),o=a.tooltip,this._addDescribedBy(i,o.attr(&quot;id&quot;)),o.find(&quot;.ui-tooltip-content&quot;).html(s),this.liveRegion.children().hide(),s.clone?(h=s.clone(),h.removeAttr(&quot;id&quot;).find(&quot;[id]&quot;).removeAttr(&quot;id&quot;)):h=s,e(&quot;&lt;div&gt;&quot;).html(h).appendTo(this.liveRegion),this.options.track&amp;&amp;t&amp;&amp;/^mouse/.test(t.type)?(this._on(this.document,{mousemove:n}),n(t)):o.position(e.extend({of:i},this.options.position)),o.hide(),this._show(o,this.options.show),this.options.show&amp;&amp;this.options.show.delay&amp;&amp;(r=this.delayedShow=setInterval(function(){o.is(&quot;:visible&quot;)&amp;&amp;(n(l.of),clearInterval(r))},e.fx.interval)),this._trigger(&quot;open&quot;,t,{tooltip:o})}},_registerCloseHandlers:function(t,i){var s={keyup:function(t){if(t.keyCode===e.ui.keyCode.ESCAPE){var s=e.Event(t);s.currentTarget=i[0],this.close(s,!0)}}};i[0]!==this.element[0]&amp;&amp;(s.remove=function(){this._removeTooltip(this._find(i).tooltip)}),t&amp;&amp;&quot;mouseover&quot;!==t.type||(s.mouseleave=&quot;close&quot;),t&amp;&amp;&quot;focusin&quot;!==t.type||(s.focusout=&quot;close&quot;),this._on(!0,i,s)},close:function(t){var i,s=this,n=e(t?t.currentTarget:this.element),a=this._find(n);return a?(i=a.tooltip,a.closing||(clearInterval(this.delayedShow),n.data(&quot;ui-tooltip-title&quot;)&amp;&amp;!n.attr(&quot;title&quot;)&amp;&amp;n.attr(&quot;title&quot;,n.data(&quot;ui-tooltip-title&quot;)),this._removeDescribedBy(n),a.hiding=!0,i.stop(!0),this._hide(i,this.options.hide,function(){s._removeTooltip(e(this))}),n.removeData(&quot;ui-tooltip-open&quot;),this._off(n,&quot;mouseleave focusout keyup&quot;),n[0]!==this.element[0]&amp;&amp;this._off(n,&quot;remove&quot;),this._off(this.document,&quot;mousemove&quot;),t&amp;&amp;&quot;mouseleave&quot;===t.type&amp;&amp;e.each(this.parents,function(t,i){e(i.element).attr(&quot;title&quot;,i.title),delete s.parents[t]}),a.closing=!0,this._trigger(&quot;close&quot;,t,{tooltip:i}),a.hiding||(a.closing=!1)),void 0):(n.removeData(&quot;ui-tooltip-open&quot;),void 0)},_tooltip:function(t){var i=e(&quot;&lt;div&gt;&quot;).attr(&quot;role&quot;,&quot;tooltip&quot;).addClass(&quot;ui-tooltip ui-widget ui-corner-all ui-widget-content &quot;+(this.options.tooltipClass||&quot;&quot;)),s=i.uniqueId().attr(&quot;id&quot;);return e(&quot;&lt;div&gt;&quot;).addClass(&quot;ui-tooltip-content&quot;).appendTo(i),i.appendTo(this.document[0].body),this.tooltips[s]={element:t,tooltip:i}},_find:function(e){var t=e.data(&quot;ui-tooltip-id&quot;);return t?this.tooltips[t]:null},_removeTooltip:function(e){e.remove(),delete this.tooltips[e.attr(&quot;id&quot;)]},_destroy:function(){var t=this;e.each(this.tooltips,function(i,s){var n=e.Event(&quot;blur&quot;),a=s.element;n.target=n.currentTarget=a[0],t.close(n,!0),e(&quot;#&quot;+i).remove(),a.data(&quot;ui-tooltip-title&quot;)&amp;&amp;(a.attr(&quot;title&quot;)||a.attr(&quot;title&quot;,a.data(&quot;ui-tooltip-title&quot;)),a.removeData(&quot;ui-tooltip-title&quot;))}),this.liveRegion.remove()}})});
&lt;/script&gt;</pre>
</div>
<div title="leftbackdo6.gif" modifier="YourName" created="200905301419" modified="200905301713" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\leftbackdo6.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[leftbackdo6.gif|leftbackdo6.gif]] - {{{type=image/gif, size=64 bytes, encoded=89 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/leftbackdo6.gif|./images/leftbackdo6.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/leftbackdo6.gif|http://www.symbex.net.au/Wiki/images/leftbackdo6.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|leftbackdo6.gif]] or [img[tooltip|leftbackdo6.gif][link]]}}}
[img[tooltip|leftbackdo6.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhbgACAIAAAHKOqgAzZiH5BAAAAAAALAAAAABuAAIAAAIXDIynyesNn4x0
2lqB3rz7D4biSJZmVwAAOw==
---END_DATA---
%/</pre>
</div>
<div title="leftbackdrkgreenqu9.jpg" modifier="YourName" created="200906010517" modified="200909150415" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\leftbackdrkgreenqu9.jpg}}}|
| attached on:|1 June 2009 by YourName|
| embedded:|[[leftbackdrkgreenqu9.jpg|leftbackdrkgreenqu9.jpg]] - {{{type=image/jpeg, size=992 bytes, encoded=1344 bytes}}}|
| local file:|//none//|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/leftbackdrkgreenqu9.jpg|http://www.symbex.net.au/Wiki/images/leftbackdrkgreenqu9.jpg]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|leftbackdrkgreenqu9.jpg]] or [img[tooltip|leftbackdrkgreenqu9.jpg][link]]}}}
[img[tooltip|leftbackdrkgreenqu9.jpg]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/jpeg;base64,
/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAUDBAQEAwUEBAQFBQUGBwwIBwcHBw8L
CwkMEQ8SEhEPERETFhwXExQaFRERGCEYGh0dHx8fExciJCIeJBweHx7/2wBDAQUF
BQcGBw4ICA4eFBEUHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4eHh4e
Hh4eHh4eHh4eHh4eHh7/wAARCAACAG4DASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEA
AAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIh
MUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6
Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZ
mqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx
8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREA
AgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAV
YnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hp
anN0dXZ3eHl6goOEhYaHiImKkpOUlZaXmJmaoqOkpaanqKmqsrO0tba3uLm6wsPE
xcbHyMnK0tPU1dbX2Nna4uPk5ebn6Onq8vP09fb3+Pn6/9oADAMBAAIRAxEAPwCw
mnaem3ZY2q7cbcRKMY24xx28tP8AvhfQUJp2npt2WNqu3G3ESjGNuMcdvLT/AL4X
0FFFfMn5+Cadp6bdljartxtxEoxjbjHHby0/74X0FCadp6bdljartxtxEoxjbjHH
by0/74X0FFFAAmnaem3ZY2q7cbcRKMY24xx28tP++F9BQmnaem3ZY2q7cbcRKMY2
4xx28tP++F9BRRQAJp2npt2WNqu3G3ESjGNuMcdvLT/vhfQUJp2npt2WNqu3G3ES
jGNuMcdvLT/vhfQUUUACadp6bdljartxtxEoxjbjHHby0/74X0FCadp6bdljartx
txEoxjbjHHby0/74X0FFFAAmnaem3ZY2q7cbcRKMY24xx28tP++F9BQmnaem3ZY2
q7cbcRKMY24xx28tP++F9BRRQAJp2npt2WNqu3G3ESjGNuMcdvLT/vhfQU63srO3
YNb2kETKu0FIwpAwoxx2wiD6KPQUUVnV/hy9GJ7H/9k=
---END_DATA---
%/</pre>
</div>
<div title="mainmenugray7ef.gif" modifier="YourName" created="200905260550" modified="200905301712" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\mainmenugray7ef.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[mainmenugray7ef.gif|mainmenugray7ef.gif]] - {{{type=image/gif, size=105 bytes, encoded=142 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/mainmenugray7ef.gif|./images/mainmenugray7ef.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/mainmenugray7ef.gif|http://www.symbex.net.au/Wiki/images/mainmenugray7ef.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|mainmenugray7ef.gif]] or [img[tooltip|mainmenugray7ef.gif][link]]}}}
[img[tooltip|mainmenugray7ef.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhAQBkAPMPALa2trm5ub29vb+/v8TExMbGxsvLy9HR0dfX19vb29zc3OHh
4efn5+vr6+zs7O7u7iH5BAAAAAAALAAAAAABAGQAAAQW8D3X2FIJHVPIEAEgjmRp
nmiqrqwZAQA7
---END_DATA---
%/</pre>
</div>
<div title="minus.gif" modifier="YourName" created="200905301630" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\minus.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[minus.gif|minus.gif]] - {{{type=image/gif, size=837 bytes, encoded=1133 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/minus.gif|./images/minus.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/minus.gif|http://www.symbex.net.au/Wiki/images/minus.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|minus.gif]] or [img[tooltip|minus.gif][link]]}}}
[img[tooltip|minus.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhCQAJAPcAAAAAAICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAJAAkAAAgiAAMIHEjwn8GD/wQiPKhw
YcIA/wBIlPjQYUWHDRcS3BggIAA7
---END_DATA---
%/</pre>
</div>
<div title="navbargray1.gif" modifier="YourName" created="200906161914" modified="200909150413" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\navbargray1.gif}}}|
| attached on:|17 June 2009 by YourName|
| embedded:|[[navbargray1.gif|navbargray1.gif]] - {{{type=image/gif, size=837 bytes, encoded=1133 bytes}}}|
| local file:|//none//|
| remote link:|/%REMOTE_LINK%/[[htttp://www/symbex.net.au/Wiki/images/navbargray1.gif|htttp://www/symbex.net.au/Wiki/images/navbargray1.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbargray1.gif]] or [img[tooltip|navbargray1.gif][link]]}}}
[img[tooltip|navbargray1.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhbgACAPcAAAAAAGNjY///////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////ywAAAAAbgACAAAIKgADABBIcKDBgggPKkzIcKHDhhAfSowY
EYDFixgzatzIsaPHjyBDiswYEAA7
---END_DATA---
%/</pre>
</div>
<div title="navbargray777.gif" modifier="YourName" created="200906161931" modified="200909150413" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\navbargray777.gif}}}|
| attached on:|17 June 2009 by YourName|
| embedded:|[[navbargray777.gif|navbargray777.gif]] - {{{type=image/gif, size=837 bytes, encoded=1133 bytes}}}|
| local file:|//none//|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki//images/navbargray777.gif|http://www.symbex.net.au/Wiki//images/navbargray777.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbargray777.gif]] or [img[tooltip|navbargray777.gif][link]]}}}
[img[tooltip|navbargray777.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhbgACAPcAAAAAAHNzc///////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////ywAAAAAbgACAAAIKgADABBIcKDBgggPKkzIcKHDhhAfSowY
EYDFixgzatzIsaPHjyBDiswYEAA7
---END_DATA---
%/</pre>
</div>
<div title="navbargrayhw1.gif" modifier="YourName" created="200905301720" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\navbargrayhw1.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[navbargrayhw1.gif|navbargrayhw1.gif]] - {{{type=image/gif, size=1012 bytes, encoded=1373 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/navbargrayhw1.gif|./images/navbargrayhw1.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/navbargrayhw1.gif|http://www.symbex.net.au/Wiki/images/navbargrayhw1.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbargrayhw1.gif]] or [img[tooltip|navbargrayhw1.gif][link]]}}}
[img[tooltip|navbargrayhw1.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhCgA8APcAAL29zr3GzsbGzsbG1sbO1s7O1s7W3tbW3tbe3t7e597n5+fn
7+fv7+/v7+/v9+/39/f39/f/////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////ywAAAAACgA8AAAI2QABCBxIkEEDBggTIkzAsKFDAgUIQJwY
MYDFixYBYNxoUUAAAR5BfhQwgABJAgMEoFQpsaVJiRFjxoRYwECBmjhrGthpk+fO
A0CDCkVwAAFRo0UPOFyKIIECpwyfSp1KdYHVq1gXMLC6davWgw3CGgTbwEFYs2XP
PjC7lq0DCHDjyp1Lt67cCHDx5rXLt6/fv4ADCx5MuDBfvXohJFZcd3Hix3YhM947
Fy9ixnglQNC8GS5nzHEzd+4surRnxpozi07dWTNr1qtby3Y9WzFtCa5dq74dAffm
gAAAOw==
---END_DATA---
%/</pre>
</div>
<div title="navbargrayhw1.png" modifier="Shankar" created="200905301411" modified="201109281522" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW Help\ScienceImages\navbargrayhw1.png}}}|
| attached on:|26 May 2009 by YourName|
| embedded:|[[navbargrayhw1.png|navbargrayhw1.png]] - {{{type=image/png, size=303 bytes, encoded=410 bytes}}}|
| local file:|//none//|
| remote link:|//none//|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbargrayhw1.png]] or [img[tooltip|navbargrayhw1.png][link]]}}}
[img[tooltip|navbargrayhw1.png]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/png;base64,
iVBORw0KGgoAAAANSUhEUgAAAAoAAAA8CAIAAADQc7xaAAAABmJLR0QA/wD/AP+g
vaeTAAAA5ElEQVR42u2TS67DIAxF7wHvfz0ddd699KO+fqbugDYlQKBSVOkNmgGK
fLDvxQY2252WPw6ncwfb+e/Ww/tjN/tyvfdwDKGHQx/HuAqPiscVxW1dtsX/am2k
/c2JDa4D4O5AAVKwlyrJpt3TkpcwuUtpUVVfwbvFB9o/3MYMJgZyh3JcLsF7oIhq
XuIDa7T0yZw3OW/nZFvyH1PyTAncJRRe0s3zYxliLu2TNkveTJWj7N7LhPCGNC9r
C7aeT1C4PJWo023SrbRBCs9RUfIUtLJbc+uNnudbTVnT58lOug60TpaCD9FINRTx
kClXAAAAAElFTkSuQmCC
---END_DATA---
%/</pre>
</div>
<div title="navbargreenhw1.gif" modifier="YourName" created="200906010618" modified="200909150415" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\navbargreenhw1.gif}}}|
| attached on:|1 June 2009 by YourName|
| embedded:|[[navbargreenhw1.gif|navbargreenhw1.gif]] - {{{type=image/gif, size=966 bytes, encoded=1308 bytes}}}|
| local file:|//none//|
| remote link:|/%REMOTE_LINK%/[[htttp://www.symbex.net.ai/Wiki/images/navbargreenhw1.gif|htttp://www.symbex.net.ai/Wiki/images/navbargreenhw1.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbargreenhw1.gif]] or [img[tooltip|navbargreenhw1.gif][link]]}}}
[img[tooltip|navbargreenhw1.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhCgA8APcAAK33nLX/pb3/pb3/rcb/rcb/tc7/tdb/tdb/vd7/vd7/xuf/
xu//xu//zv//////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////ywAAAAACgA8AAAIqwABCBxIMEECBQgOJkRooKHDhwMERJwY
IGIAABczYsQYoKPHjyBDigwgsWLJiRMlqkQ5oKXLlgRiypQ5gECBmDdt4tR5s2eB
h0CDAj2AwEBRBAeMGkWKgGnTp1ChGpxKdaoCg1cPal2wdSvXBWAVgE0AtqzZs2jT
ql3Ltq3bt3Djyp1Lt67du3jzzmUAlu8Cv2z5Ci7rt0FZw4T7Kk68ALFhvo//mh0c
mUFAAAA7
---END_DATA---
%/</pre>
</div>
<div title="navbarred.gif" modifier="Shankar Swamy" created="200905301417" modified="200905301710" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\navbarred.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[navbarred.gif|navbarred.gif]] - {{{type=image/gif, size=984 bytes, encoded=1332 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/navbarred.gif|./images/navbarred.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/navbarred.gif|http://www.symbex.net.au/Wiki/images/navbarred.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|navbarred.gif]] or [img[tooltip|navbarred.gif][link]]}}}
[img[tooltip|navbarred.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhCgA8APcAAP+9zv/Gzv/G1v/O1v/W3v/e3v/e5//n5//n7//v7//v9//3
9///////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////ywAAAAACgA8AAAIvQABCBxIMIHBgwgNKFzIcIDDhxADSJwo
EQDFixgxChgQYKOAAAM+QnwIcqTJAQQcpkyJkoDLlS9jynRZgECBmjdtEmDIs4CB
Az8VAh1KtCiCA0cRJEWKIIFSp06bIpzaVEECq1ivKlhwletWqwvCil2wdazZs2gX
MAi7dm3at3Djyp1Lt67du3jhunWrdixfv4DZiv0buK/hw4MNtz28WHDjvYL7MlhM
2bFktZUhZ8Z8ebPnzJQnY24bekFAAAA7
---END_DATA---
%/</pre>
</div>
<div title="openbook.gif" modifier="YourName" created="200905301649" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\openbook.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[openbook.gif|openbook.gif]] - {{{type=image/gif, size=397 bytes, encoded=540 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/openbook.gif|./images/openbook.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/openbook.gif|http://www.symbex.net.au/Wiki/images/openbook.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|openbook.gif]] or [img[tooltip|openbook.gif][link]]}}}
[img[tooltip|openbook.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEAAQANU5AKat0evq6d7d3Zy12tji9pKp16WkuXZ/q7O2xo2MjLi4qoOc
zby8rLS0s8G/u7i2prKxr6WnpJKp2MbU8cTEw7/P772+rFx6tnCLws/b8+bl5cPG
09fh9b/Arru4uK+smfPy6Tlcoqyxr9HQzq2yss/b9LK0p8bT8XCLw4Oczv//+0lq
q8jIyD5Uf2aAtMrO4XRzcy5Sm6WkoZ6z3tnZ2Ts7O0RERMPDw////////wAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAADkALAAAAAAQABAAAAaqwBoqRywajbUU7EgkJAzF
WqGwLN5gCcABmqvNCJ7qNSL4bA63rqSEI8GuAhzugUAUbrXFSS6CxeUmLwEzNjUY
FXI0DjRyOAovNIQ1FxOJECyNDJCSKxlyIzKYchabhSEcOBoUoY0dpTUxBDgCDaxy
LwCDNjctMQMBNDIvOAEAAC8ghDm8vsEsMgChNCrKy70DMjIDLtzc1dYuMS4tvTHm
LTZGNzbsN+7v7kEAOw==
---END_DATA---
%/</pre>
</div>
<div title="palette" modifier="Shankar Swamy" created="201201071736" modified="201201071743" tags="aaTag mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;tagging&gt;&gt;</pre>
</div>
<div title="search" modifier="YourName" created="200612240439" modified="200911132253" tags="mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>&lt;&lt;search&gt;&gt;
&lt;&lt;tiddler HideTiddlerTags&gt;&gt;
&lt;&lt;tiddler HideTiddlerSubtitle&gt;&gt;
&lt;&lt;tiddler HideTiddlerTitle&gt;&gt;</pre>
</div>
<div title="treeview-black-line.gif" modifier="Shankar" created="200905240549" modified="200905301652" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-black-line.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-black-line.gif|treeview-black-line.gif]] - {{{type=image/gif, size=1877 bytes, encoded=2543 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-black-line.gif|./images/treeview-black-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-black-line.gif|http://www.symbex.net.au/Wiki/images/treeview-black-line.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-black-line.gif]] or [img[tooltip|treeview-black-line.gif][link]]}}}
[img[tooltip|treeview-black-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEADwBvcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAQAPAGAAj/AP8JHPgPAMGDCA0iXFiQ
4UKFDglCjChwIkWLETE61MgQgMePHx9SlDhyIEeRJRumPJkwpcqSLA/GJLnS5UyT
NnPW3AlTZ0+eI29W9BmU6EWjGZFuVNqRKcqfUIsCPTo1adWlV5tmfSo1KlWvVsFi
FauVLNevXdOiXRtWbVu2Y93GhVtWbl26Z9/qnbv3bt+8fAP7FQx4sOHCiFtuVWyW
sd3EMp06xjv5b2XClw9nhkyzceTFnz13fry5dGjSpymntrwac2vNrznjBD1adW3W
t13nhr1b9lDas0UHR93bdPHYxofbVo6buW7nvKH7fkncpfXr2LNr3869e/TfwsFX
/xe/nHxz88/Rf6denv159+nhrxcqfzr9+5KR6z/OX3py9fbl1x+A/9VXIH7AEbif
fwsqOKCBDUL4IILhScjghAJeqKGDG1rI4YcehkjheCJmCOKI7aH4norxsTifiSUm
GGOFLgYoY40HwohjhDtieKOOQP4oJI1BEjkkiT12mOSJRSLZZIpPrhhli1O+eCSU
V0qZJZVbWmnkl052aSOYWJKppZlcoullmGqOyeabZcJ5ppxp0rlmnHjOmWede96p
5598AupnoIQOaqibfSIqqKKFMnpojmJC2qakdjpqKaWJYrqopo1y+iiPVV4KaqSj
TlpqpZ6K6qOpq6J6aqavbv8aa6ezftoqrLfKmiutu9qqZKipBlurqr+S2iuxTBpb
LKvLunqssM8OC22zuFKrq7W8Yutrssxy66y2yM74rbfVknutudmiu6245bJ7rrvp
wrvukvKGS++9wEqrb7T8gjutuvbm2y/A/9ZbML7KEryvvwsrPLDBDUP8MMLdSszw
xAJfrLHDG1vM8cceh0zxuCJnDPLI7aL8rsrxsjyvySUnHHPFLgcsc80Hw4xzxDtj
fLPOQP8sNM1BEz00yT13nPTJRSPddMpPrxx1y1O/fDTUV0udNdVbW2301053bTPY
WJOttdlco+112GqPzfbbZcN9ttxp07123HjPnXfde9//rffffAPud+CED264230j
LrjihTN+eM5iQ9625HY7bjnliWO+uOaNc/44z1VfDnrko09eeuWei+6z6aujfnrm
r28ee+ezf9467LfLnjvtu9uudOipB1+76r+T3jvxTBtfPOvLu3688M8PD33zuFOv
u/W8Y+978sxz77z2yM/8vffVk3+9+dmjv7345bN/vvvpw7/+0vKHT//9wEuvf/T8
gz+9+vbLX/8A+L/6FRB/yiPg/vy3QAUO0IANhOADEdg9CTJwggK8oAYduEELcvCD
HgwhBccnwgyCcITtQ+H7VBg/Fs7PhCVMYAwr6MIAyrCGB4QhDiO4QwzeUIdA/KEQ
MmkYRCIOkYQ97GAST1hEJDYxhU9cYRRbOMUXHhGKV5RiFqm4RSsa8YtO7KINaQgS
kAQEADs=
---END_DATA---
%/</pre>
</div>
<div title="treeview-black.gif" modifier="YourName" created="200905240036" modified="200905301650" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-black.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-black.gif|treeview-black.gif]] - {{{type=image/gif, size=1216 bytes, encoded=1649 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-black.gif|./images/treeview-black.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-black.gif|http://www.symbex.net.au/Wiki/images/treeview-black.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-black.gif]] or [img[tooltip|treeview-black.gif][link]]}}}
[img[tooltip|treeview-black.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAABgAIUAAAj/AP8JHEiwoMGDCBMqXMjw
H4CHABRCbEixosWLBCNi3Mixo0WNHkOKFAlypMmTKFOqPAmx5cOVMEkeLBmz5seB
IGna3LkwJ06eQBlGdOmwZdCjGX8K1In0qM+lTaNCNchU6k6XRq1araoVKdeuQb+C
5Sl2rM2yZmOiTRuS6Vq2Hd3CxThR4kuqcy++Rbg3b9+8gAMLBou17mCTcg8jnql4
Md7GMokShbwxMeW4jC9jfqy5cuG/nTmHljl6JOjSolFzPK1aaWuhmV/3jB3aMN+7
BVmb1e0QNW/ZwIMLF/z5N2TLw3O7Nt74ae/keCVnhe6cueLq0FNPzY7zM/fv4MOL
nR+/m7z21tNn4gaOnHv77O+p0zb/nHxx8fGTYw+/H/xQo5PJt511h/X3XX7D3Uff
ggw26GB9CxLYmYS7racehWNhSJmGxz3o4YcK+jcffCMKqBx/RU0UoH4lsnieiyf6
592HNNZoY20Octicfhbm1qOJEeYoZIM6BhbigS0mmKRwCDKZ4ksrKvmilDEiOSWT
M96o5ZZcdunll2AaFBAAOw==
---END_DATA---
%/</pre>
</div>
<div title="treeview-default-line.gif" modifier="Shankar Swamy" created="200905301653" modified="201204102241" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-default-line.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-default-line.gif|treeview-default-line.gif]] - {{{type=image/gif, size=1993 bytes, encoded=2701 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-default-line.gif|./images/treeview-default-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-default-line.gif|http://www.symbex.net.au/Wiki/images/treeview-default-line.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-default-line.gif]] or [img[tooltip|treeview-default-line.gif][link]]}}}
[img[tooltip|treeview-default-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEADwBvcAAAAAAICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAQAPAGAAj/AP8JHEiwoEGBAQ4qXHgw
IcOHCx1CnEhQIkWKCTP+03ixYceLFj8yDClSIcmSBk+irLhyZMuIL03G9DizoMqX
N1vmXLkTZc+SP0UG/Ti0Y1GQNW0mZbkUYVOnT49ifLqRqtSJVyFmfbjVZVSrYL+K
bdoV5tilZWWeTZqWJtmwb9fWbJsSLlq7bPHO1TuTrlK5ffnG9Ms0ruG7gAcLxrlY
Z2Oej31GBjpZaGWil6lq3sy5M9fMSBMzFu2YNGTTklFTVm2ZNWbXRkFPhR36cF7a
s23vxY1Vdm/eWn0HB/6ZuFfdgY2bRa5YuVrmo6GXln6aemrrq7G31v6ae2znbhF7
/68tvvzt8bnN70b/m/1w98XhH1efXP5y+s3tP8cfnf90/9UBeJ2A2RG4nYHdIfid
fuGdpyB5Dka43oPpSVgfhe1h+J6G8XE4n4X5eXgfiP2R+J+JAaI4oIoFsnigiwnC
uKCI+8kI4YQ2VojjjhfmmKGPGwLZoZAf8hgikSMaWaKSJzKZopMrQtmilC9SGaOV
MyJZI5Y39siljl6GeeSXP5IZpJlDolmkmEuy2aSbT8IZpZxT0lmlnVfimaWaSerZ
5Zh+ggnooG0S+qahcSI6p6J1Mnqno3lCumegZVJ6pqVpYrqmpH8W6umhnyYa6qKj
Nlrqo6dGmuqknAq6aqegxv8qqqyk0mqqrajiqqqurL7qKq+wzipsrcPeWmyux+6a
bK/A/rpssMRGa6y0yFKrrLXMPussttBO6221314bbrbcbjtut+CmK6665J5rLrvo
ritvu/C+O2+89N5rb7784uvvvv9W2qrAvhLcrMHaIlyuwu4yXK/D+kLcL8AUSxzw
pQNjXLDGB3OcsMcLg9ywyA+THLHJE1tcMcoXZ5qxyxvD3LHMH9Mcss0j41yyzifz
nDLLK/vc8qYxEz2z0TUjfbPSOTO9s9M9Q/2z0EFLPXSfL1tdNdZFc32010mDvbTY
TZP9tNlRoz211iq3DbTbVMPN9tt0x1333Hbnjffeal//vaWmfW/9d9aBy1343Yfr
nTjfg3fd+NePhx352JOXXfnZl6ed+dqLd7653w3y+bngoQM+uuGnI5664qszXjrh
rXv+uuOzQ1675LdTnrvlu2Peu+a/cx778MGDXhd4xzOYPI3Fk768ls2jHr3q07Ne
vevPi3697Nmbvj3x3cP+/fjh016+7efjnr7u6/Pevu/vAx+/8OT/pbz9zM9vPP7Q
6+88/9rzn/QESD0CWs+A2AOg9xDIPQWKj4Hgc6D5JIg+CqrPguzDoPs0CD8Oys+D
9INg/QqTPxDuj4T9M+H/UBhAFQ7QhQWE4QFlmEAWLpCGDbThA3EYQR1O0IcVBOIF
poWYQSJu0IgdROIHlRhCHo5wIISBonBmyMQTShF5ThShFrPIxSqu8Ir38+ILxRhD
MlIRjCU0Yw3RmEI15pCNLXRjD+F4Qzk+ESphpOMO7bhFPnZRjz8EZBAFOURCFtGQ
R0RkEhW5REY20Y+QdKQV8ZhGSX6Rkm205Bg1WUZOnhGTcfTkGkFZR1G+kZR7NOUc
URlIVg7SlYWE5SFlmUhaLtIpGslIQAAAOw==
---END_DATA---
%/</pre>
</div>
<div title="treeview-default.gif" modifier="Shankar Swamy" created="200905231929" modified="200905301633" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-default.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-default.gif|treeview-default.gif]] - {{{type=image/gif, size=1222 bytes, encoded=1657 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-default.gif|./images/treeview-default.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-default.gif|http://www.symbex.net.au/Wiki/images/treeview-default.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-default.gif]] or [img[tooltip|treeview-default.gif][link]]}}}
[img[tooltip|treeview-default.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAAICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAABgAIUAAAj/AP8JHEiwoMGDCBMqXMjw
H4CHABRCbEixosWLBCNi3Mixo0WNHkOKFAlypMmTKFOqPBmgpUuXK2OKDHCQpsyb
G206HKgTp8+GOkH2/EkUIU2ID//RXFq0KcGgPJ1KfTpQ6NSrQwVmvfrzpVeuYMOK
VTq2rFmnW8+qXTsyLVuSb4uWjBq34USJSetynIvRrd6qfwMLHszV60vCIbf6RcxQ
MeOOjh/ndIiULFPJFCNjtqh5c+aanjkbbhm6tNTFplOvRK26tUnWpvm6Xigbdty7
CXGrls3ZM+/ZwIMLjzua9HC6BW2Hhqr1OHKrzskijchU+WPmZKNjt7658/Di3KOL
ox9Pvrx5ir+jp8dcOXfe1uuP1xYff/j88/iVFhfvXfh2/oA1px1lE1X3XYDZOfff
gAaFJxl4+UUo4YTO1SechcFhSJhuB3EYW4QazhYihSS2BiGDyQHYoIopDjidZQkC
119wM8oImnb7lajjjjz+NSJ8IALnYUbv9aiag0YyhmSSf52o4I1ProgiVS5WZqB/
UB5X42xbuuYkk2CGKeaYZJY5W0AAOw==
---END_DATA---
%/</pre>
</div>
<div title="treeview-famfamfam-line.gif" modifier="YourName" created="200905240041" modified="200905301655" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-famfamfam-line.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-famfamfam-line.gif|treeview-famfamfam-line.gif]] - {{{type=image/gif, size=807 bytes, encoded=1092 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-famfamfam-line.gif|./images/treeview-famfamfam-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-famfamfam-line.gif|http://www.symbex.net.au/Wiki/images/treeview-famfamfam-line.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-famfamfam-line.gif]] or [img[tooltip|treeview-famfamfam-line.gif][link]]}}}
[img[tooltip|treeview-famfamfam-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhAQABAPcAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAABAAEAAAgEAP8FBAA7
---END_DATA---
%/</pre>
</div>
<div title="treeview-famfamfam.gif" modifier="YourName" created="200905240039" modified="200905301654" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-famfamfam.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-famfamfam.gif|treeview-famfamfam.gif]] - {{{type=image/gif, size=1280 bytes, encoded=1734 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-famfamfam.gif|./images/treeview-famfamfam.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-famfamfam.gif|http://www.symbex.net.au/Wiki/images/treeview-famfamfam.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-famfamfam.gif]] or [img[tooltip|treeview-famfamfam.gif][link]]}}}
[img[tooltip|treeview-famfamfam.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAADFrGDlzIUJzIVKEMXOcY71CAL1KANZaCMZaId5rIfdz
APd7GIS1Y4y9Y5S1e++EQvetc5S1jKW9nLXWlLXGrbnSpN6lhOetjOe1lO+1lNbn
vf/Stf///wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAABgAIUAAAj/AP8JHEiwoMGDCBMqXMjw
H4CHABRCbEixosWLBCNi3Mixo0WNHkOKFAlypMmTKFOqXMmypcuXMGPKnCnQQoEC
BCbQ3JmwQgMKGxwQeMCzKEECFCh0cOBAgNGnSDtIpRDgqdEBDhp0aNDUalEJBBxQ
EErUK08JAwIMkGC2rdu3cOPKnUu3Ls2SdlvizVtxosSHfDfuDYxyMOHDiBMrXsy4
sdsMCQwkuOCYYwYFGjhEUJChMsYEGiAwYAAhgeeLBjhI7cDAwGmLCSIwWLAAgenX
FDEkmI3gAGXcFCFL/g28uPHjyJMrl7icoeHKfhNGB/68ucDq1rNr3869u1WbOHVy
3fcJlCx3pEqZOt0edWrV7Vi1cl2vHaxY89zRqmXrvb///wAGOBB2zRG4GETVTYeb
gcoxmJyDyEEo4IQUHgdeTt2RF9RQ5yW1VFfsKeUed/FtBWJ9YY3FYX5prVXhizDG
eJiExtFYnI18KWiQjqfhuCCAPsoo5JBE8iTcZN1dltlmnW0Hmmik3aZdaqu1xl1s
s9UmZXa68eZbkpEhWeSYZJapUpA9AhkhYNKxaeabcMYp55yMHUmcdkpqxtmVoY1W
GndUSmWlk7LRZht3Xdb2JXd20unoo5BGKumkBwUEADs=
---END_DATA---
%/</pre>
</div>
<div title="treeview-gold-line.gif" modifier="Shankar" created="200906050211" modified="201109062005" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\treeview-gold-line.gif}}}|
| attached on:|4 June 2009 by YourName|
| embedded:|[[treeview-gold-line.gif|treeview-gold-line.gif]] - {{{type=image/gif, size=1878 bytes, encoded=2543 bytes}}}|
| local file:|/%LOCAL_LINK%/[[file:///F:/TiddlyWiki/TW jQuery/TreeView/images/treeview-gold-line.gif|file:///F:/TiddlyWiki/TW jQuery/TreeView/images/treeview-gold-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-gold-line.gif|http://www.symbex.net.au/Wiki//images/treeview-gold-line.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-gold-line.gif]] or [img[tooltip|treeview-gold-line.gif][link]]}}}
[img[tooltip|treeview-gold-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEADwBvcAAAAAAPdzc///1v//////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////yH5BAEAAAAALAAAAAAQAPAGAAj+AAEIHAhAAMGDCA0iXFiQ
4UKFDglCjChwIkWLETE61MhQgMePHx9SlDhyIEeRJRumPJkwpcqSLA/GJLnS5UyT
NnPW3AlTZ0+eI29W9BmU6EWjGZFuVNqRKcqfUIsCPTo1adWlV5tmfSo1KlWvVsFi
FauVLNevXdOiXRtWbVu2Y93GhVtWbl26Z9/qnbv3bt+8fAP7FQx4sOHCiFtuVWyW
sd3EMp06xjv5b2XClw9nhkyzceTFnz13fry5dGjSpymntrwac2vNrznjBD1adW3W
t13nhr1b9lDas0UHR93bdPHYxofbVo6buW7nvKH7fkncpfXr2LNr3869e/TfwsH+
Vxe/nHxz88/Rf6denv159+nhrxcqfzr9+5KR6z/OX3py9fbl1x+A/9VXIH7AEbif
fwsqOKCBDUL4IILhScjghAJeqKGDG1rI4YcehkjheCJmCOKI7aH4norxsTifiSUm
GGOFLgYoY40HwohjhDtieKOOQP4oJI1BEjkkiT12mOSJRSLZZIpPrhhli1O+eCSU
V0qZJZVbWmnkl052aSOYWJKppZlcoullmGqOyeabZcJ5ppxp0rlmnHjOmWede96p
5598AupnoIQOaqibfSIqqKKFMnpojmJC2qakdjpqKaWJYrqopo1y+iiPVV4KaqSj
TlpqpZ6K6qOpq6J6aqb+r24aa6ezftoqrLfKmiutu9qqZKipBlurqr+S2iuxTBpb
LKvLunqssM8OC22zuFKrq7W8Yutrssxy66y2yM74rbfVknutudmiu6245bJ7rrvp
wrvukvKGS++9wEqrb7T8gjutuvbm2y/A/9ZbML7KEryvvwsrPLDBDUP8MMLdSszw
xAJfrLHDG1vM8cceh0zxuCJnDPLI7aL8rsrxsjyvySUnHHPFLgcsc80Hw4xzxDtj
fLPOQP8sNM1BEz00yT13nPTJRSPddMpPrxx1y1O/fDTUV0udNdVbW2301053bTPY
WJOttdlco+112GqPzfbbZcN9ttxp07123HjPnXf+3XvfrffffAPud+CED264230j
LrjihTN+eM5iQ9625HY7bjnliWO+uOaNc/44z1VfDnrko09eeuWei+6z6aujfnrm
r28ee+ezf9467LfLnjvtu9uudOipB1+76r+T3jvxTBtfPOvLu3688M8PD33zuFOv
u/W8Y+978sxz77z2yM/8vffVk3+9+dmjv7345bN/vvvpw7/+0vKHT//9wEuvf/T8
gz+9+vbLX/8A+L/6FRB/yiPg/vy3QAUO0IANhOADEdg9CTJwggK8oAYduEELcvCD
HgwhBccnwgyCcITtQ+H7VBg/Fs7PhCVMYAwr6MIAyrCGB4QhDiO4QwzeUIc3QPyh
EGkYRCIOkYQ97GAST1hEJDYxhU9cYRRbOMUXHhGKV5RiFqm4RSsa8YtO7KINaQgS
kAQEAAA7
---END_DATA---
%/</pre>
</div>
<div title="treeview-gold.gif" modifier="YourName" created="200906051227" modified="200909150413" tags="attachment excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\treeview-gold.gif}}}|
| attached on:|5 June 2009 by YourName|
| embedded:|[[treeview-gold.gif|treeview-gold.gif]] - {{{type=image/gif, size=1179 bytes, encoded=1596 bytes}}}|
| local file:|//none//|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-gold.gif|http://www.symbex.net.au/Wiki/images/treeview-gold.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-gold.gif]] or [img[tooltip|treeview-gold.gif][link]]}}}
[img[tooltip|treeview-gold.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAAP//1v//////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////
/////////////////yH5BAEAAAAALAAAAABgAIUAAAj+AAEIHEiwoMGDCBMqXMiw
ocOHECNKnEixosWLGDNq3Mixo8ePIEMKDECyZEmRKCUGOLgypcuGLQHEjPmyJsuB
M23qNLgygICTJmnudJlz5NCjRWUeHSrU6FKdQU0+Xdp06s6qVm1izfpyK9eUXr+K
DCsWJNmyHs+i5ah2rca2buPKnUtXbtSTdTNWhZs34d6+GP8CtthTgOGeUgdHFKx4
IuPGi29CVnmX7+SCli9L1kyY88XMnnGGrgh6dOnQpz2n5rx6tOvXsGNzrdw672PZ
op0qxY05927eon0CTYw7ae26xoETvM2btvLn0KNLn069uvWvxyFnb7xdcffB3+l5
OofOvLjv8GuTk5f5k6RM4rLVP5evvHz8ytfz69/Pv7///wAGKOCABJqF33o8RWdf
bAvCVthh7+FlXoII9lbhcgoeWOCGHHbo4YcgOqgferaNaCJ14823WX0rAtfga4i1
F6F7zbVYI4Uq4lifhiH26OOPQAYppEsBAQA7
---END_DATA---
%/</pre>
</div>
<div title="treeview-gray-line.gif" modifier="Shankar" created="200905240036" modified="200905301657" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-gray-line.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-gray-line.gif|treeview-gray-line.gif]] - {{{type=image/gif, size=1877 bytes, encoded=2543 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-gray-line.gif|./images/treeview-gray-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-default.gif|http://www.symbex.net.au/Wiki/images/treeview-default.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-gray-line.gif]] or [img[tooltip|treeview-gray-line.gif][link]]}}}
[img[tooltip|treeview-gray-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEADwBvcAAAAAAICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAQAPAGAAj/AP8JHPgvAMGDCA0iXFiQ
4UKFDglCjChwIkWLETE61MgwgMePHx9SlDhyIEeRJRumPJkwpcqSLA/GJLnS5UyT
NnPW3AlTZ0+eI29W9BmU6EWjGZFuVNqRKcqfUIsCPTo1adWlV5tmfSo1KlWvVsFi
FauVLNevXdOiXRtWbVu2Y93GhVtWbl26Z9/qnbv3bt+8fAP7FQx4sOHCiFtuVWyW
sd3EMp06xjv5b2XClw9nhkyzceTFnz13fry5dGjSpymntrwac2vNrznjBD1adW3W
t13nhr1b9lDas0UHR93bdPHYxofbVo6buW7nvKH7fkncpfXr2LNr3869e/TfwsFX
/xe/nHxz88/Rf6denv159+nhrxcqfzr9+5KR6z/OX3py9fbl1x+A/9VXIH7AEbif
fwsqOKCBDUL4IILhScjghAJeqKGDG1rI4YcehkjheCJmCOKI7aH4norxsTifiSUm
GGOFLgYoY40HwohjhDtieKOOQP4oJI1BEjkkiT12mOSJRSLZZIpPrhhli1O+eCSU
V0qZJZVbWmnkl052aSOYWJKppZlcoullmGqOyeabZcJ5ppxp0rlmnHjOmWede96p
5598AupnoIQOaqibfSIqqKKFMnpojmJC2qakdjpqKaWJYrqopo1y+iiPVV4KaqSj
TlpqpZ6K6qOpq6J6aqavbv8aa6ezftoqrLfKmiutu9qqZKipBlurqr+S2iuxTBpb
LKvLunqssM8OC22zuFKrq7W8Yutrssxy66y2yM74rbfVknutudmiu6245bJ7rrvp
wrvukvKGS++9wEqrb7T8gjutuvbm2y/A/9ZbML7KEryvvwsrPLDBDUP8MMLdSszw
xAJfrLHDG1vM8cceh0zxuCJnDPLI7aL8rsrxsjyvySUnHHPFLgcsc80Hw4xzxDtj
fLPOQP8sNM1BEz00yT13nPTJRSPddMpPrxx1y1O/fDTUV0udNdVbW2301053bTPY
WJOttdlco+112GqPzfbbZcN9ttxp07123HjPnXfde9//rffffAPud+CED264230j
LrjihTN+eM5iQ9625HY7bjnliWO+uOaNc/44z1VfDnrko09eeuWei+6z6aujfnrm
r28ee+ezf9467LfLnjvtu9uudOipB1+76r+T3jvxTBtfPOvLu3688M8PD33zuFOv
u/W8Y+978sxz77z2yM/8vffVk3+9+dmjv7345bN/vvvpw7/+0vKHT//9wEuvf/T8
gz+9+vbLX/8A+L/6FRB/yiPg/vy3QAUO0IANhOADEdg9CTJwggK8oAYduEELcvCD
HgwhBccnwgyCcITtQ+H7VBg/Fs7PhCVMYAwr6MIAyrCGB4QhDiO4QwzeUIdA/KEQ
MmkYRCIOkYQ97GAST1hEJDYxhU9cYRRbOMUXHhGKV5RiFqm4RSsa8YtO7KINaQgS
kAQEADs=
---END_DATA---
%/</pre>
</div>
<div title="treeview-gray.gif" modifier="Shankar" created="200905231943" modified="201109070349" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-gray.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-gray.gif|treeview-gray.gif]] - {{{type=image/gif, size=1230 bytes, encoded=1665 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-gray.gif|./images/treeview-gray.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-gray.gif|http://www.symbex.net.au/Wiki/images/treeview-gray.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-gray.gif]] or [img[tooltip|treeview-gray.gif][link]]}}}
[img[tooltip|treeview-gray.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAAICAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAABgAIUAAAj/AP8JHEiwoMGDCBMqXMjw
H4CHABRCbEixosWLBCNi3Mixo0WNHkOKFAlypMmTKFOqPBmgpUuXK2OKDHCQpsyb
G206HKgTp8+GOkH2/EkUIU2ID/+9HFq0aFCeTaMafCqQqVSnNa9qXfpSq9eqX8OC
FfvVKlmsZ7emVbv2ZkmobWW+HRu34kSJSafW/RjS7N6Dc/8KHkw4LVeYhUda9ZvY
4uLGM7NC9ngUqdKuky8+zsxxM2eMnj87PsxYNMPSpimiTn2adV/XlGF3XA07MG3X
tlPfTbib4O29gR3rlk28uPHjVUkjl1zwd2qqSpfrFShUenOHlpdah+7cNHfrvpmD
qyfdHbz58+jTqzcZHH1705Z55y2e+3x98/fB518ffT159KFtN1B1531XIHYTaSed
geYxOJ542ynH34QUVmjhThW+h99xvQE2H3Ea6mdhiBeWWKCEDUK4oIrLBbgiUhEp
2CKLyLk443QNomjijjz2mBmJ0gG5nJCTdViQkTdSWB5xS8rWJGxPivbfgTg+WKWA
V76YHWZJhkfldV96meNhPpZp5plopqnmmggFBAA7
---END_DATA---
%/</pre>
</div>
<div title="treeview-red-line.gif" modifier="Shankar" created="200905301604" modified="200905301604" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TW jQuery\TreeView\images\treeview-red-line.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-red-line.gif|treeview-red-line.gif]] - {{{type=image/gif, size=1877 bytes, encoded=2543 bytes}}}|
| local file:|/%LOCAL_LINK%/[[file:///F:/TiddlyWiki/TW jQuery/TreeView/images/treeview-red-line.gif|file:///F:/TiddlyWiki/TW jQuery/TreeView/images/treeview-red-line.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-red-line.gif|http://www.symbex.net.au/Wiki/images/treeview-red-line.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-red-line.gif]] or [img[tooltip|treeview-red-line.gif][link]]}}}
[img[tooltip|treeview-red-line.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhEADwBvcAAAAAAPV2dgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAAQAPAGAAj/AP8JHPgvAMGDCA0iXFiQ
4UKFDglCjChwIkWLETE61MgwgMePHx9SlDhyIEeRJRumPJkwpcqSLA/GJLnS5UyT
NnPW3AlTZ0+eI29W9BmU6EWjGZFuVNqRKcqfUIsCPTo1adWlV5tmfSo1KlWvVsFi
FauVLNevXdOiXRtWbVu2Y93GhVtWbl26Z9/qnbv3bt+8fAP7FQx4sOHCiFtuVWyW
sd3EMp06xjv5b2XClw9nhkyzceTFnz13fry5dGjSpymntrwac2vNrznjBD1adW3W
t13nhr1b9lDas0UHR93bdPHYxofbVo6buW7nvKH7fkncpfXr2LNr3869e/TfwsFX
/xe/nHxz88/Rf6denv159+nhrxcqfzr9+5KR6z/OX3py9fbl1x+A/9VXIH7AEbif
fwsqOKCBDUL4IILhScjghAJeqKGDG1rI4YcehkjheCJmCOKI7aH4norxsTifiSUm
GGOFLgYoY40HwohjhDtieKOOQP4oJI1BEjkkiT12mOSJRSLZZIpPrhhli1O+eCSU
V0qZJZVbWmnkl052aSOYWJKppZlcoullmGqOyeabZcJ5ppxp0rlmnHjOmWede96p
5598AupnoIQOaqibfSIqqKKFMnpojmJC2qakdjpqKaWJYrqopo1y+iiPVV4KaqSj
TlpqpZ6K6qOpq6J6aqavbv8aa6ezftoqrLfKmiutu9qqZKipBlurqr+S2iuxTBpb
LKvLunqssM8OC22zuFKrq7W8Yutrssxy66y2yM74rbfVknutudmiu6245bJ7rrvp
wrvukvKGS++9wEqrb7T8gjutuvbm2y/A/9ZbML7KEryvvwsrPLDBDUP8MMLdSszw
xAJfrLHDG1vM8cceh0zxuCJnDPLI7aL8rsrxsjyvySUnHHPFLgcsc80Hw4xzxDtj
fLPOQP8sNM1BEz00yT13nPTJRSPddMpPrxx1y1O/fDTUV0udNdVbW2301053bTPY
WJOttdlco+112GqPzfbbZcN9ttxp07123HjPnXfde9//rffffAPud+CED264230j
LrjihTN+eM5iQ9625HY7bjnliWO+uOaNc/44z1VfDnrko09eeuWei+6z6aujfnrm
r28ee+ezf9467LfLnjvtu9uudOipB1+76r+T3jvxTBtfPOvLu3688M8PD33zuFOv
u/W8Y+978sxz77z2yM/8vffVk3+9+dmjv7345bN/vvvpw7/+0vKHT//9wEuvf/T8
gz+9+vbLX/8A+L/6FRB/yiPg/vy3QAUO0IANhOADEdg9CTJwggK8oAYduEELcvCD
HgwhBccnwgyCcITtQ+H7VBg/Fs7PhCVMYAwr6MIAyrCGB4QhDiO4QwzeUIdA/KEQ
MmkYRCIOkYQ97GAST1hEJDYxhU9cYRRbOMUXHhGKV5RiFqm4RSsa8YtO7KINaQgS
kAQEADs=
---END_DATA---
%/</pre>
</div>
<div title="treeview-red.gif" modifier="Shankar" created="200905240421" modified="201109070340" tags="attachment mySystem excludeSearch excludeLists excludeMissing System" changecount="1">
<pre>| source file:|{{{F:\TiddlyWiki\TWExperiments\jQuery\images\treeview-red.gif}}}|
| attached on:|31 May 2009 by YourName|
| embedded:|[[treeview-red.gif|treeview-red.gif]] - {{{type=image/gif, size=1230 bytes, encoded=1665 bytes}}}|
| local file:|/%LOCAL_LINK%/[[./images/treeview-red.gif|./images/treeview-red.gif]]|
| remote link:|/%REMOTE_LINK%/[[http://www.symbex.net.au/Wiki/images/treeview-red.gif|http://www.symbex.net.au/Wiki/images/treeview-red.gif]]|
image
&lt;&lt;&lt;
usage: {{{[img[tooltip|treeview-red.gif]] or [img[tooltip|treeview-red.gif][link]]}}}
[img[tooltip|treeview-red.gif]]
&lt;&lt;&lt;

/% DO NOT EDIT BELOW THIS POINT
---BEGIN_DATA---
image/gif;base64,
R0lGODlhYACFAPcAAAAAAPV2dgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAABgAIUAAAj/AP8JHEiwoMGDCBMqXMjw
H4CHABRCbEixosWLBCNi3Mixo0WNHkOKFAlypMmTKFOqPBmgpUuXK2OKDHCQpsyb
G206HKgTp8+GOkH2/EkUIU2ID/+9HFq0aFCeTaMafCqQqVSnNa9qXfpSq9eqX8OC
FfvVKlmsZ7emVbv2ZkmobWW+HRu34kSJSafW/RjS7N6Dc/8KHkw4LVeYhUda9ZvY
4uLGM7NC9ngUqdKuky8+zsxxM2eMnj87PsxYNMPSpimiTn2adV/XlGF3XA07MG3X
tlPfTbib4O29gR3rlk28uPHjVUkjl1zwd2qqSpfrFShUenOHlpdah+7cNHfrvpmD
qyfdHbz58+jTqzcZHH1705Z55y2e+3x98/fB518ffT159KFtN1B1531XIHYTaSed
geYxOJ542ynH34QUVmjhThW+h99xvQE2H3Ea6mdhiBeWWKCEDUK4oIrLBbgiUhEp
2CKLyLk443QNomjijjz2mBmJ0gG5nJCTdViQkTdSWB5xS8rWJGxPivbfgTg+WKWA
V76YHWZJhkfldV96meNhPpZp5plopqnmmggFBAA7
---END_DATA---
%/</pre>
</div>
</div>
<!--POST-STOREAREA-->
<!--POST-BODY-START-->

<!--POST-BODY-END-->
<script id="jsArea" type="text/javascript">
//<![CDATA[

//
// Please note:
//
// * This code is designed to be readable but for compactness it only includes brief comments. You can see fuller comments
//   in the project repository at https://github.com/TiddlyWiki/tiddlywiki
//
// * You should never need to modify this source code directly. TiddlyWiki is carefully designed to allow deep customisation
//   without changing the core code. Please consult the development group at http://groups.google.com/group/TiddlyWikiDev
//
// JSLint directives
/*global jQuery:false, version:false */
/*jslint bitwise:true, browser:true, confusion:true, eqeq:true, evil:true, forin:true, maxerr:100, plusplus:true, regexp:true, sloppy:true, sub:true, undef:true, unparam:true, vars:true, white:true */
//--
//-- Configuration repository
//--

// Miscellaneous options
var config = {
	numRssItems: 20, // Number of items in the RSS feed
	animDuration: 400, // Duration of UI animations in milliseconds
	cascadeFast: 20, // Speed for cascade animations (higher == slower)
	cascadeSlow: 60, // Speed for EasterEgg cascade animations
	cascadeDepth: 5, // Depth of cascade animation
	locale: "en" // W3C language tag
};

// Hashmap of alternative parsers for the wikifier
config.parsers = {};

// Adaptors
config.adaptors = {};
config.defaultAdaptor = null;

// Backstage tasks
config.tasks = {};

// Annotations
config.annotations = {};

// Custom fields to be automatically added to new tiddlers
config.defaultCustomFields = {};

// Messages
config.messages = {
	messageClose: {},
	dates: {},
	tiddlerPopup: {}
};

// Options that can be set in the options panel and/or cookies
config.options = {
	chkRegExpSearch: false,
	chkCaseSensitiveSearch: false,
	chkIncrementalSearch: true,
	chkAnimate: true,
	chkSaveBackups: true,
	chkAutoSave: false,
	chkGenerateAnRssFeed: false,
	chkSaveEmptyTemplate: false,
	chkOpenInNewWindow: true,
	chkToggleLinks: false,
	chkHttpReadOnly: true,
	chkForceMinorUpdate: false,
	chkConfirmDelete: true,
	chkInsertTabs: false,
	chkUsePreForStorage: true, // Whether to use <pre> format for storage
	chkDisplayInstrumentation: false,
	txtBackupFolder: "",
	txtEditorFocus: "text",
	txtMainTab: "tabTimeline",
	txtMoreTab: "moreTabAll",
	txtMaxEditRows: "30",
	txtFileSystemCharSet: "UTF-8",
	txtTheme: ""
	};
config.optionsDesc = {};

config.optionsSource = {};

// Default tiddler templates
var DEFAULT_VIEW_TEMPLATE = 1;
var DEFAULT_EDIT_TEMPLATE = 2;
config.tiddlerTemplates = {
	1: "ViewTemplate",
	2: "EditTemplate"
};

// More messages (rather a legacy layout that should not really be like this)
config.views = {
	wikified: {
		tag: {}
	},
	editor: {
		tagChooser: {}
	}
};

// Backstage tasks
config.backstageTasks = ["save","importTask","tweak","upgrade","plugins"];

// Extensions
config.extensions = {};

// Macros; each has a 'handler' member that is inserted later
config.macros = {
	today: {},
	version: {},
	search: {sizeTextbox: 15},
	tiddler: {},
	tag: {},
	tags: {},
	tagging: {},
	timeline: {},
	allTags: {},
	list: {
		all: {},
		missing: {},
		orphans: {},
		shadowed: {},
		touched: {},
		filter: {}
	},
	closeAll: {},
	permaview: {},
	saveChanges: {},
	slider: {},
	option: {},
	options: {},
	newTiddler: {},
	newJournal: {},
	tabs: {},
	gradient: {},
	message: {},
	view: {defaultView: "text"},
	edit: {},
	tagChooser: {},
	toolbar: {},
	plugins: {},
	refreshDisplay: {},
	importTiddlers: {},
	upgrade: {
		source: "http://tiddlywiki-releases.tiddlyspace.com/upgrade",
		backupExtension: "pre.core.upgrade"
	},
	sync: {},
	annotations: {}
};

// Commands supported by the toolbar macro
config.commands = {
	closeTiddler: {},
	closeOthers: {},
	editTiddler: {},
	saveTiddler: {hideReadOnly: true},
	cancelTiddler: {},
	deleteTiddler: {hideReadOnly: true},
	permalink: {},
	references: {type: "popup"},
	jump: {type: "popup"},
	syncing: {type: "popup"},
	fields: {type: "popup"}
};

// Control of macro parameter evaluation
config.evaluateMacroParameters = "all";

// Basic regular expressions
config.textPrimitives = {
	upperLetter: "[A-Z\u00c0-\u00de\u0150\u0170]",
	lowerLetter: "[a-z0-9_\\-\u00df-\u00ff\u0151\u0171]",
	anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]",
	anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff\u0150\u0170\u0151\u0171]"
};
if(!((new RegExp("[\u0150\u0170]","g")).test("\u0150"))) {
	config.textPrimitives = {
		upperLetter: "[A-Z\u00c0-\u00de]",
		lowerLetter: "[a-z0-9_\\-\u00df-\u00ff]",
		anyLetter:   "[A-Za-z0-9_\\-\u00c0-\u00de\u00df-\u00ff]",
		anyLetterStrict: "[A-Za-z0-9\u00c0-\u00de\u00df-\u00ff]"
	};
}
config.textPrimitives.sliceSeparator = "::";
config.textPrimitives.sectionSeparator = "##";
config.textPrimitives.urlPattern = "(?:file|http|https|mailto|ftp|irc|news|data):[^\\s'\"]+(?:/|\\b)";
config.textPrimitives.unWikiLink = "~";
config.textPrimitives.wikiLink = "(?:(?:" + config.textPrimitives.upperLetter + "+" +
	config.textPrimitives.lowerLetter + "+" +
	config.textPrimitives.upperLetter +
	config.textPrimitives.anyLetter + "*)|(?:" +
	config.textPrimitives.upperLetter + "{2,}" +
	config.textPrimitives.lowerLetter + "+))";

config.textPrimitives.cssLookahead = "(?:(" + config.textPrimitives.anyLetter + "+)\\(([^\\)\\|\\n]+)(?:\\):))|(?:(" + config.textPrimitives.anyLetter + "+):([^;\\|\\n]+);)";
config.textPrimitives.cssLookaheadRegExp = new RegExp(config.textPrimitives.cssLookahead,"mg");

config.textPrimitives.brackettedLink = "\\[\\[([^\\]]+)\\]\\]";
config.textPrimitives.titledBrackettedLink = "\\[\\[([^\\[\\]\\|]+)\\|([^\\[\\]\\|]+)\\]\\]";
config.textPrimitives.tiddlerForcedLinkRegExp = new RegExp("(?:" + config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");
config.textPrimitives.tiddlerAnyLinkRegExp = new RegExp("("+ config.textPrimitives.wikiLink + ")|(?:" +
	config.textPrimitives.titledBrackettedLink + ")|(?:" +
	config.textPrimitives.brackettedLink + ")|(?:" +
	config.textPrimitives.urlPattern + ")","mg");

config.glyphs = {
	currBrowser: null,
	browsers: [],
	codes: {}
};

//--
//-- Shadow tiddlers
//--

config.shadowTiddlers = {
	StyleSheet: "",
	MarkupPreHead: "",
	MarkupPostHead: "",
	MarkupPreBody: "",
	MarkupPostBody: "",
	TabTimeline: '<<timeline>>',
	TabAll: '<<list all>>',
	TabTags: '<<allTags excludeLists>>',
	TabMoreMissing: '<<list missing>>',
	TabMoreOrphans: '<<list orphans>>',
	TabMoreShadowed: '<<list shadowed>>',
	AdvancedOptions: '<<options>>',
	PluginManager: '<<plugins>>',
	SystemSettings: '',
	ToolbarCommands: '|~ViewToolbar|closeTiddler closeOthers +editTiddler > fields syncing permalink references jump|\n|~EditToolbar|+saveTiddler -cancelTiddler deleteTiddler|',
	WindowTitle: '<<tiddler SiteTitle>> - <<tiddler SiteSubtitle>>'
};

// Browser detection... In a very few places, there's nothing else for it but to know what browser we're using.
config.userAgent = navigator.userAgent.toLowerCase();
config.browser = {
	isIE: config.userAgent.indexOf("msie") != -1 && config.userAgent.indexOf("opera") == -1,
	isGecko: navigator.product == "Gecko" && config.userAgent.indexOf("WebKit") == -1,
	ieVersion: /MSIE (\d{1,2}.\d)/i.exec(config.userAgent), // config.browser.ieVersion[1], if it exists, will be the IE version string, eg "6.0"
	isSafari: config.userAgent.indexOf("applewebkit") != -1,
	isBadSafari: !((new RegExp("[\u0150\u0170]","g")).test("\u0150")),
	firefoxDate: /gecko\/(\d{8})/i.exec(config.userAgent), // config.browser.firefoxDate[1], if it exists, will be Firefox release date as "YYYYMMDD"
	isOpera: config.userAgent.indexOf("opera") != -1,
	isChrome: config.userAgent.indexOf('chrome') > -1,
	isLinux: config.userAgent.indexOf("linux") != -1,
	isUnix: config.userAgent.indexOf("x11") != -1,
	isMac: config.userAgent.indexOf("mac") != -1,
	isWindows: config.userAgent.indexOf("win") != -1
};

merge(config.glyphs,{
	browsers: [
		function() {return config.browser.isIE;},
		function() {return true;}
		],
	codes: {
		downTriangle: ["\u25BC","\u25BE"],
		downArrow: ["\u2193","\u2193"],
		bentArrowLeft: ["\u2190","\u21A9"],
		bentArrowRight: ["\u2192","\u21AA"]
	}
});

//--
//-- Translateable strings
//--

// Strings in "double quotes" should be translated; strings in 'single quotes' should be left alone

merge(config.options,{
	txtUserName: "YourName"});

merge(config.tasks,{
	save: {text: "save", tooltip: "Save your changes to this TiddlyWiki"},
	importTask: {text: "import", tooltip: "Import tiddlers and plugins from other TiddlyWiki files and servers", content: '<<importTiddlers>>'},
	tweak: {text: "tweak", tooltip: "Tweak the appearance and behaviour of TiddlyWiki", content: '<<options>>'},
	upgrade: {text: "upgrade", tooltip: "Upgrade TiddlyWiki core code", content: '<<upgrade>>'},
	plugins: {text: "plugins", tooltip: "Manage installed plugins", content: '<<plugins>>'}
});

// Options that can be set in the options panel and/or cookies
merge(config.optionsDesc,{
	txtUserName: "Username for signing your edits",
	chkRegExpSearch: "Enable regular expressions for searches",
	chkCaseSensitiveSearch: "Case-sensitive searching",
	chkIncrementalSearch: "Incremental key-by-key searching",
	chkAnimate: "Enable animations",
	chkSaveBackups: "Keep backup file when saving changes",
	chkAutoSave: "Automatically save changes",
	chkGenerateAnRssFeed: "Generate an RSS feed when saving changes",
	chkSaveEmptyTemplate: "Generate an empty template when saving changes",
	chkOpenInNewWindow: "Open external links in a new window",
	chkToggleLinks: "Clicking on links to open tiddlers causes them to close",
	chkHttpReadOnly: "Hide editing features when viewed over HTTP",
	chkForceMinorUpdate: "Don't update modifier username and date when editing tiddlers",
	chkConfirmDelete: "Require confirmation before deleting tiddlers",
	chkInsertTabs: "Use the tab key to insert tab characters instead of moving between fields",
	txtBackupFolder: "Name of folder to use for backups",
	txtMaxEditRows: "Maximum number of rows in edit boxes",
	txtTheme: "Name of the theme to use",
	txtFileSystemCharSet: "Default character set for saving changes (Firefox/Mozilla only)"});

merge(config.messages,{
	customConfigError: "Problems were encountered loading plugins. See PluginManager for details",
	pluginError: "Error: %0",
	pluginDisabled: "Not executed because disabled via 'systemConfigDisable' tag",
	pluginForced: "Executed because forced via 'systemConfigForce' tag",
	pluginVersionError: "Not executed because this plugin needs a newer version of TiddlyWiki",
	nothingSelected: "Nothing is selected. You must select one or more items first",
	savedSnapshotError: "It appears that this TiddlyWiki has been incorrectly saved. Please see http://www.tiddlywiki.com/#Download for details",
	subtitleUnknown: "(unknown)",
	undefinedTiddlerToolTip: "The tiddler '%0' doesn't yet exist",
	shadowedTiddlerToolTip: "The tiddler '%0' doesn't yet exist, but has a pre-defined shadow value",
	tiddlerLinkTooltip: "%0 - %1, %2",
	externalLinkTooltip: "External link to %0",
	noTags: "There are no tagged tiddlers",
	notFileUrlError: "You need to save this TiddlyWiki to a file before you can save changes",
	cantSaveError: "It's not possible to save changes. Possible reasons include:\n- your browser doesn't support saving (Firefox, Internet Explorer, Safari and Opera all work if properly configured)\n- the pathname to your TiddlyWiki file contains illegal characters\n- the TiddlyWiki HTML file has been moved or renamed",
	invalidFileError: "The original file '%0' does not appear to be a valid TiddlyWiki",
	backupSaved: "Backup saved",
	backupFailed: "Failed to save backup file",
	rssSaved: "RSS feed saved",
	rssFailed: "Failed to save RSS feed file",
	emptySaved: "Empty template saved",
	emptyFailed: "Failed to save empty template file",
	mainSaved: "Main TiddlyWiki file saved",
	mainDownload: "Downloading/saving main TiddlyWiki file",
	mainDownloadManual: "RIGHT CLICK HERE to download/save main TiddlyWiki file",
	mainFailed: "Failed to save main TiddlyWiki file. Your changes have not been saved",
	macroError: "Error in macro <<%0>>",
	macroErrorDetails: "Error while executing macro <<%0>>:\n%1",
	missingMacro: "No such macro",
	overwriteWarning: "A tiddler named '%0' already exists. Choose OK to overwrite it",
	unsavedChangesWarning: "WARNING! There are unsaved changes in TiddlyWiki\n\nChoose OK to save\nChoose CANCEL to discard",
	confirmExit: "--------------------------------\n\nThere are unsaved changes in TiddlyWiki. If you continue you will lose those changes\n\n--------------------------------",
	saveInstructions: "SaveChanges",
	unsupportedTWFormat: "Unsupported TiddlyWiki format '%0'",
	tiddlerSaveError: "Error when saving tiddler '%0'",
	tiddlerLoadError: "Error when loading tiddler '%0'",
	wrongSaveFormat: "Cannot save with storage format '%0'. Using standard format for save.",
	invalidFieldName: "Invalid field name %0",
	fieldCannotBeChanged: "Field '%0' cannot be changed",
	loadingMissingTiddler: "Attempting to retrieve the tiddler '%0' from the '%1' server at:\n\n'%2' in the workspace '%3'",
	upgradeDone: "The upgrade to version %0 is now complete\n\nClick 'OK' to reload the newly upgraded TiddlyWiki",
	invalidCookie: "Invalid cookie '%0'"});

merge(config.messages.messageClose,{
	text: "close",
	tooltip: "close this message area"});

config.messages.backstage = {
	open: {text: "backstage", tooltip: "Open the backstage area to perform authoring and editing tasks"},
	close: {text: "close", tooltip: "Close the backstage area"},
	prompt: "backstage: ",
	decal: {
		edit: {text: "edit", tooltip: "Edit the tiddler '%0'"}
	}
};

config.messages.listView = {
	tiddlerTooltip: "Click for the full text of this tiddler",
	previewUnavailable: "(preview not available)"
};

config.messages.dates.months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November","December"];
config.messages.dates.days = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
config.messages.dates.shortMonths = ["Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
config.messages.dates.shortDays = ["Sun", "Mon", "Tue", "Wed", "Thu", "Fri", "Sat"];
// suffixes for dates, eg "1st","2nd","3rd"..."30th","31st"
config.messages.dates.daySuffixes = ["st","nd","rd","th","th","th","th","th","th","th",
		"th","th","th","th","th","th","th","th","th","th",
		"st","nd","rd","th","th","th","th","th","th","th",
		"st"];
config.messages.dates.am = "am";
config.messages.dates.pm = "pm";

merge(config.messages.tiddlerPopup,{
	});

merge(config.views.wikified.tag,{
	labelNoTags: "no tags",
	labelTags: "tags: ",
	openTag: "Open tag '%0'",
	tooltip: "Show tiddlers tagged with '%0'",
	openAllText: "Open all",
	openAllTooltip: "Open all of these tiddlers",
	popupNone: "No other tiddlers tagged with '%0'"});

merge(config.views.wikified,{
	defaultText: "The tiddler '%0' doesn't yet exist. Double-click to create it",
	defaultModifier: "(missing)",
	shadowModifier: "(built-in shadow tiddler)",
	dateFormat: "DD MMM YYYY",
	createdPrompt: "created"});

merge(config.views.editor,{
	tagPrompt: "Type tags separated with spaces, [[use double square brackets]] if necessary, or add existing",
	defaultText: "Type the text for '%0'"});

merge(config.views.editor.tagChooser,{
	text: "tags",
	tooltip: "Choose existing tags to add to this tiddler",
	popupNone: "There are no tags defined",
	tagTooltip: "Add the tag '%0'"});

merge(config.messages,{
	sizeTemplates:
		[
		{unit: 1024*1024*1024, template: "%0\u00a0GB"},
		{unit: 1024*1024, template: "%0\u00a0MB"},
		{unit: 1024, template: "%0\u00a0KB"},
		{unit: 1, template: "%0\u00a0B"}
		]});

merge(config.macros.search,{
	label: "search",
	prompt: "Search this TiddlyWiki",
	placeholder: "",
	accessKey: "F",
	successMsg: "%0 tiddlers found matching %1",
	failureMsg: "No tiddlers found matching %0"});

merge(config.macros.tagging,{
	label: "tagging: ",
	labelNotTag: "not tagging",
	tooltip: "List of tiddlers tagged with '%0'"});

merge(config.macros.timeline,{
	dateFormat: "DD MMM YYYY"});

merge(config.macros.allTags,{
	tooltip: "Show tiddlers tagged with '%0'",
	noTags: "There are no tagged tiddlers"});

config.macros.list.all.prompt = "All tiddlers in alphabetical order";
config.macros.list.missing.prompt = "Tiddlers that have links to them but are not defined";
config.macros.list.orphans.prompt = "Tiddlers that are not linked to from any other tiddlers";
config.macros.list.shadowed.prompt = "Tiddlers shadowed with default contents";
config.macros.list.touched.prompt = "Tiddlers that have been modified locally";

merge(config.macros.closeAll,{
	label: "close all",
	prompt: "Close all displayed tiddlers (except any that are being edited)"});

merge(config.macros.permaview,{
	label: "permaview",
	prompt: "Link to an URL that retrieves all the currently displayed tiddlers"});

merge(config.macros.saveChanges,{
	label: "save changes",
	prompt: "Save all tiddlers to create a new TiddlyWiki",
	accessKey: "S"});

merge(config.macros.newTiddler,{
	label: "new tiddler",
	prompt: "Create a new tiddler",
	title: "New Tiddler",
	accessKey: "N"});

merge(config.macros.newJournal,{
	label: "new journal",
	prompt: "Create a new tiddler from the current date and time",
	accessKey: "J"});

merge(config.macros.options,{
	wizardTitle: "Tweak advanced options",
	step1Title: "These options are saved in cookies in your browser",
	step1Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='false' name='chkUnknown'>Show unknown options</input>",
	unknownDescription: "//(unknown)//",
	listViewTemplate: {
		columns: [
			{name: 'Option', field: 'option', title: "Option", type: 'String'},
			{name: 'Description', field: 'description', title: "Description", type: 'WikiText'},
			{name: 'Name', field: 'name', title: "Name", type: 'String'}
			],
		rowClasses: [
			{className: 'lowlight', field: 'lowlight'}
			]}
	});

merge(config.macros.plugins,{
	wizardTitle: "Manage plugins",
	step1Title: "Currently loaded plugins",
	step1Html: "<input type='hidden' name='markList'></input>", // DO NOT TRANSLATE
	skippedText: "(This plugin has not been executed because it was added since startup)",
	noPluginText: "There are no plugins installed",
	confirmDeleteText: "Are you sure you want to delete these plugins:\n\n%0",
	removeLabel: "remove systemConfig tag",
	removePrompt: "Remove systemConfig tag",
	deleteLabel: "delete",
	deletePrompt: "Delete these tiddlers forever",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Forced', field: 'forced', title: "Forced", tag: 'systemConfigForce', type: 'TagCheckbox'},
			{name: 'Disabled', field: 'disabled', title: "Disabled", tag: 'systemConfigDisable', type: 'TagCheckbox'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]},
	listViewTemplateReadOnly: {
		columns: [
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Description', field: 'Description', title: "Description", type: 'String'},
			{name: 'Version', field: 'Version', title: "Version", type: 'String'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Executed', field: 'executed', title: "Loaded", type: 'Boolean', trueText: "Yes", falseText: "No"},
			{name: 'Startup Time', field: 'startupTime', title: "Startup Time", type: 'String'},
			{name: 'Error', field: 'error', title: "Status", type: 'Boolean', trueText: "Error", falseText: "OK"},
			{name: 'Log', field: 'log', title: "Log", type: 'StringList'}
			],
		rowClasses: [
			{className: 'error', field: 'error'},
			{className: 'warning', field: 'warning'}
			]}
	});

merge(config.macros.toolbar,{
	moreLabel: "more",
	morePrompt: "Show additional commands",
	lessLabel: "less",
	lessPrompt: "Hide additional commands",
	separator: "|"
	});

merge(config.macros.refreshDisplay,{
	label: "refresh",
	prompt: "Redraw the entire TiddlyWiki display"
	});

merge(config.macros.importTiddlers,{
	readOnlyWarning: "You cannot import into a read-only TiddlyWiki file. Try opening it from a file:// URL",
	wizardTitle: "Import tiddlers from another file or server",
	step1Title: "Step 1: Locate the server or TiddlyWiki file",
	step1Html: "Specify the type of the server: <select name='selTypes'><option value=''>Choose...</option></select><br>Enter the URL or pathname here: <input type='text' size=50 name='txtPath'><br>...or browse for a file: <input type='file' size=50 name='txtBrowse'><br><hr>...or select a pre-defined feed: <select name='selFeeds'><option value=''>Choose...</option></select>",
	openLabel: "open",
	openPrompt: "Open the connection to this file or server",
	statusOpenHost: "Opening the host",
	statusGetWorkspaceList: "Getting the list of available workspaces",
	step2Title: "Step 2: Choose the workspace",
	step2Html: "Enter a workspace name: <input type='text' size=50 name='txtWorkspace'><br>...or select a workspace: <select name='selWorkspace'><option value=''>Choose...</option></select>",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel this import",
	statusOpenWorkspace: "Opening the workspace",
	statusGetTiddlerList: "Getting the list of available tiddlers",
	errorGettingTiddlerList: "Error getting list of tiddlers, click Cancel to try again",
	errorGettingTiddlerListHttp404: "Error retrieving tiddlers from url, please ensure the url exists. Click Cancel to try again.",
	errorGettingTiddlerListHttp: "Error retrieving tiddlers from url, please ensure this url exists and is <a href='http://enable-cors.org/'>CORS</a> enabled",
	errorGettingTiddlerListFile: "Error retrieving tiddlers from local file, please make sure the file is in the same directory as your TiddlyWiki. Click Cancel to try again.",
	step3Title: "Step 3: Choose the tiddlers to import",
	step3Html: "<input type='hidden' name='markList'></input><br><input type='checkbox' checked='true' name='chkSync'>Keep these tiddlers linked to this server so that you can synchronise subsequent changes</input><br><input type='checkbox' name='chkSave'>Save the details of this server in a 'systemServer' tiddler called:</input> <input type='text' size=25 name='txtSaveTiddler'>",
	importLabel: "import",
	importPrompt: "Import these tiddlers",
	confirmOverwriteText: "Are you sure you want to overwrite these tiddlers:\n\n%0",
	step4Title: "Step 4: Importing %0 tiddler(s)",
	step4Html: "<input type='hidden' name='markReport'></input>", // DO NOT TRANSLATE
	doneLabel: "done",
	donePrompt: "Close this wizard",
	statusDoingImport: "Importing tiddlers",
	statusDoneImport: "All tiddlers imported",
	systemServerNamePattern: "%2 on %1",
	systemServerNamePatternNoWorkspace: "%1",
	confirmOverwriteSaveTiddler: "The tiddler '%0' already exists. Click 'OK' to overwrite it with the details of this server, or 'Cancel' to leave it unchanged",
	serverSaveTemplate: "|''Type:''|%0|\n|''URL:''|%1|\n|''Workspace:''|%2|\n\nThis tiddler was automatically created to record the details of this server",
	serverSaveModifier: "(System)",
	listViewTemplate: {
		columns: [
			{name: 'Selected', field: 'Selected', rowName: 'title', type: 'Selector'},
			{name: 'Tiddler', field: 'tiddler', title: "Tiddler", type: 'Tiddler'},
			{name: 'Size', field: 'size', tiddlerLink: 'size', title: "Size", type: 'Size'},
			{name: 'Tags', field: 'tags', title: "Tags", type: 'Tags'}
			],
		rowClasses: [
			]}
	});

merge(config.macros.upgrade,{
	wizardTitle: "Upgrade TiddlyWiki core code",
	step1Title: "Update or repair this TiddlyWiki to the latest release",
	step1Html: "You are about to upgrade to the latest release of the TiddlyWiki core code (from <a href='%0' class='externalLink' target='_blank'>%1</a>). Your content will be preserved across the upgrade.<br><br>Note that core upgrades have been known to interfere with older plugins. If you run into problems with the upgraded file, see <a href='http://www.tiddlywiki.org/wiki/CoreUpgrades' class='externalLink' target='_blank'>http://www.tiddlywiki.org/wiki/CoreUpgrades</a>",
	errorCantUpgrade: "Unable to upgrade this TiddlyWiki. You can only perform upgrades on TiddlyWiki files stored locally",
	errorNotSaved: "You must save changes before you can perform an upgrade",
	step2Title: "Confirm the upgrade details",
	step2Html_downgrade: "You are about to downgrade to TiddlyWiki version %0 from %1.<br><br>Downgrading to an earlier version of the core code is not recommended",
	step2Html_restore: "This TiddlyWiki appears to be already using the latest version of the core code (%0).<br><br>You can continue to upgrade anyway to ensure that the core code hasn't been corrupted or damaged",
	step2Html_upgrade: "You are about to upgrade to TiddlyWiki version %0 from %1",
	upgradeLabel: "upgrade",
	upgradePrompt: "Prepare for the upgrade process",
	statusPreparingBackup: "Preparing backup",
	statusSavingBackup: "Saving backup file",
	errorSavingBackup: "There was a problem saving the backup file",
	statusLoadingCore: "Loading core code",
	errorLoadingCore: "Error loading the core code",
	errorCoreFormat: "Error with the new core code",
	statusSavingCore: "Saving the new core code",
	statusReloadingCore: "Reloading the new core code",
	startLabel: "start",
	startPrompt: "Start the upgrade process",
	cancelLabel: "cancel",
	cancelPrompt: "Cancel the upgrade process",
	step3Title: "Upgrade cancelled",
	step3Html: "You have cancelled the upgrade process"
	});

merge(config.macros.annotations,{
	});

merge(config.commands.closeTiddler,{
	text: "close",
	tooltip: "Close this tiddler"});

merge(config.commands.closeOthers,{
	text: "close others",
	tooltip: "Close all other tiddlers"});

merge(config.commands.editTiddler,{
	text: "edit",
	tooltip: "Edit this tiddler",
	readOnlyText: "view",
	readOnlyTooltip: "View the source of this tiddler"});

merge(config.commands.saveTiddler,{
	text: "done",
	tooltip: "Save changes to this tiddler"});

merge(config.commands.cancelTiddler,{
	text: "cancel",
	tooltip: "Undo changes to this tiddler",
	warning: "Are you sure you want to abandon your changes to '%0'?",
	readOnlyText: "done",
	readOnlyTooltip: "View this tiddler normally"});

merge(config.commands.deleteTiddler,{
	text: "delete",
	tooltip: "Delete this tiddler",
	warning: "Are you sure you want to delete '%0'?"});

merge(config.commands.permalink,{
	text: "permalink",
	tooltip: "Permalink for this tiddler"});

merge(config.commands.references,{
	text: "references",
	tooltip: "Show tiddlers that link to this one",
	popupNone: "No references"});

merge(config.commands.jump,{
	text: "jump",
	tooltip: "Jump to another open tiddler"});

merge(config.commands.fields,{
	text: "fields",
	tooltip: "Show the extended fields of this tiddler",
	emptyText: "There are no extended fields for this tiddler",
	listViewTemplate: {
		columns: [
			{name: 'Field', field: 'field', title: "Field", type: 'String'},
			{name: 'Value', field: 'value', title: "Value", type: 'String'}
			],
		rowClasses: [
			],
		buttons: [
			]}});

merge(config.shadowTiddlers,{
	DefaultTiddlers: "[[GettingStarted]]",
	MainMenu: "[[GettingStarted]]",
	SiteTitle: "My TiddlyWiki",
	SiteSubtitle: "a reusable non-linear personal web notebook",
	SiteUrl: "",
	SideBarOptions: '<<search>><<closeAll>><<permaview>><<newTiddler>><<newJournal "DD MMM YYYY" "journal">><<saveChanges>><<slider chkSliderOptionsPanel OptionsPanel "options \u00bb" "Change TiddlyWiki advanced options">>',
	SideBarTabs: '<<tabs txtMainTab "Timeline" "Timeline" TabTimeline "All" "All tiddlers" TabAll "Tags" "All tags" TabTags "More" "More lists" TabMore>>',
	TabMore: '<<tabs txtMoreTab "Missing" "Missing tiddlers" TabMoreMissing "Orphans" "Orphaned tiddlers" TabMoreOrphans "Shadowed" "Shadowed tiddlers" TabMoreShadowed>>'
	});

merge(config.annotations,{
	AdvancedOptions: "This shadow tiddler provides access to several advanced options",
	ColorPalette: "These values in this shadow tiddler determine the colour scheme of the ~TiddlyWiki user interface",
	DefaultTiddlers: "The tiddlers listed in this shadow tiddler will be automatically displayed when ~TiddlyWiki starts up",
	EditTemplate: "The HTML template in this shadow tiddler determines how tiddlers look while they are being edited",
	GettingStarted: "This shadow tiddler provides basic usage instructions",
	ImportTiddlers: "This shadow tiddler provides access to importing tiddlers",
	MainMenu: "This shadow tiddler is used as the contents of the main menu in the left-hand column of the screen",
	MarkupPreHead: "This tiddler is inserted at the top of the <head> section of the TiddlyWiki HTML file",
	MarkupPostHead: "This tiddler is inserted at the bottom of the <head> section of the TiddlyWiki HTML file",
	MarkupPreBody: "This tiddler is inserted at the top of the <body> section of the TiddlyWiki HTML file",
	MarkupPostBody: "This tiddler is inserted at the end of the <body> section of the TiddlyWiki HTML file immediately after the script block",
	OptionsPanel: "This shadow tiddler is used as the contents of the options panel slider in the right-hand sidebar",
	PageTemplate: "The HTML template in this shadow tiddler determines the overall ~TiddlyWiki layout",
	PluginManager: "This shadow tiddler provides access to the plugin manager",
	SideBarOptions: "This shadow tiddler is used as the contents of the option panel in the right-hand sidebar",
	SideBarTabs: "This shadow tiddler is used as the contents of the tabs panel in the right-hand sidebar",
	SiteSubtitle: "This shadow tiddler is used as the second part of the page title",
	SiteTitle: "This shadow tiddler is used as the first part of the page title",
	SiteUrl: "This shadow tiddler should be set to the full target URL for publication",
	StyleSheetColors: "This shadow tiddler contains CSS definitions related to the color of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheet: "This tiddler can contain custom CSS definitions",
	StyleSheetLayout: "This shadow tiddler contains CSS definitions related to the layout of page elements. ''DO NOT EDIT THIS TIDDLER'', instead make your changes in the StyleSheet shadow tiddler",
	StyleSheetLocale: "This shadow tiddler contains CSS definitions related to the translation locale",
	StyleSheetPrint: "This shadow tiddler contains CSS definitions for printing",
	SystemSettings: "This tiddler is used to store configuration options for this TiddlyWiki document",
	TabAll: "This shadow tiddler contains the contents of the 'All' tab in the right-hand sidebar",
	TabMore: "This shadow tiddler contains the contents of the 'More' tab in the right-hand sidebar",
	TabMoreMissing: "This shadow tiddler contains the contents of the 'Missing' tab in the right-hand sidebar",
	TabMoreOrphans: "This shadow tiddler contains the contents of the 'Orphans' tab in the right-hand sidebar",
	TabMoreShadowed: "This shadow tiddler contains the contents of the 'Shadowed' tab in the right-hand sidebar",
	TabTags: "This shadow tiddler contains the contents of the 'Tags' tab in the right-hand sidebar",
	TabTimeline: "This shadow tiddler contains the contents of the 'Timeline' tab in the right-hand sidebar",
	ToolbarCommands: "This shadow tiddler determines which commands are shown in tiddler toolbars",
	ViewTemplate: "The HTML template in this shadow tiddler determines how tiddlers look"
	});
//--
//-- Main
//--

var params = null; // Command line parameters
var store = null; // TiddlyWiki storage
var story = null; // Main story
var formatter = null; // Default formatters for the wikifier
var anim = typeof Animator == "function" ? new Animator() : null; // Animation engine
var readOnly = false; // Whether we're in readonly mode
var highlightHack = null; // Embarrassing hack department...
var hadConfirmExit = false; // Don't warn more than once
var safeMode = false; // Disable all plugins and cookies
var showBackstage; // Whether to include the backstage area
var installedPlugins = []; // Information filled in when plugins are executed
var startingUp = false; // Whether we're in the process of starting up
var pluginInfo,tiddler; // Used to pass information to plugins in loadPlugins()

// Whether this file can be saved back to the same location [Preemption]
window.allowSave = window.allowSave || function(l)
{
	return true;
}

// Whether this file is being viewed locally
window.isLocal = function()
{
	return (document.location.protocol == "file:");
}

// Whether to use the JavaSaver applet
var useJavaSaver = window.isLocal() && (config.browser.isSafari || config.browser.isOpera);

// Allow preemption code a chance to tweak config and useJavaSaver [Preemption]
if (window.tweakConfig) window.tweakConfig();

if(!window || !window.console) {
	console = {tiddlywiki:true,log:function(message) {displayMessage(message);}};
}

// Starting up
function main()
{
	window.originalHTML=recreateOriginal();

	var t10,t9,t8,t7,t6,t5,t4,t3,t2,t1,t0 = new Date();
	startingUp = true;
	var doc = jQuery(document);
	jQuery.noConflict();
	window.onbeforeunload = function(e) {if(window.confirmExit) return confirmExit();};
	params = getParameters();
	if(params)
		params = params.parseParams("open",null,false);
	store = new TiddlyWiki({config:config});
	invokeParamifier(params,"oninit");
	story = new Story("tiddlerDisplay","tiddler");
	addEvent(document,"click",Popup.onDocumentClick);
	saveTest();
	var s;
	for(s=0; s<config.notifyTiddlers.length; s++)
		store.addNotification(config.notifyTiddlers[s].name,config.notifyTiddlers[s].notify);
	t1 = new Date();
	loadShadowTiddlers();
	doc.trigger("loadShadows");
	t2 = new Date();
	store.loadFromDiv("storeArea","store",true);
	doc.trigger("loadTiddlers");
	loadOptions();
	t3 = new Date();
	invokeParamifier(params,"onload");
	t4 = new Date();
	readOnly = window.isLocal() ? false : config.options.chkHttpReadOnly;
	var pluginProblem = loadPlugins("systemConfig");
	doc.trigger("loadPlugins");
	t5 = new Date();
	formatter = new Formatter(config.formatters);
	invokeParamifier(params,"onconfig");
	story.switchTheme(config.options.txtTheme);
	showBackstage = showBackstage !== undefined ? showBackstage : !readOnly;
	t6 = new Date();
	var m;
	for(m in config.macros) {
		if(config.macros[m].init)
			config.macros[m].init();
	}
	t7 = new Date();
	store.notifyAll();
	t8 = new Date();
	restart();
	refreshDisplay();
	t9 = new Date();
	if(pluginProblem) {
		story.displayTiddler(null,"PluginManager");
		displayMessage(config.messages.customConfigError);
	}
	if(showBackstage)
		backstage.init();
	t10 = new Date();
	if(config.options.chkDisplayInstrumentation) {
		displayMessage("LoadShadows " + (t2-t1) + " ms");
		displayMessage("LoadFromDiv " + (t3-t2) + " ms");
		displayMessage("LoadPlugins " + (t5-t4) + " ms");
		displayMessage("Macro init " + (t7-t6) + " ms");
		displayMessage("Notify " + (t8-t7) + " ms");
		displayMessage("Restart " + (t9-t8) + " ms");
		displayMessage("Total: " + (t10-t0) + " ms");
	}
	startingUp = false;
	doc.trigger("startup");
}

// Called on unload. All functions called conditionally since they themselves may have been unloaded.
function unload()
{
	if(window.checkUnsavedChanges)
		checkUnsavedChanges();
	if(window.scrubNodes)
		scrubNodes(document.body);
}

// Restarting
function restart()
{
	invokeParamifier(params,"onstart");
	if(story.isEmpty()) {
		story.displayDefaultTiddlers();
	}
	window.scrollTo(0,0);
}

function saveTest()
{
	var s = document.getElementById("saveTest");
	if(s.hasChildNodes())
		alert(config.messages.savedSnapshotError);
	s.appendChild(document.createTextNode("savetest"));
}

function loadShadowTiddlers()
{
	var shadows = new TiddlyWiki();
	shadows.loadFromDiv("shadowArea","shadows",true);
	shadows.forEachTiddler(function(title,tiddler){config.shadowTiddlers[title] = tiddler.text;});
}

function loadPlugins(tag)
{
	if(safeMode)
		return false;
	var tiddlers = store.getTaggedTiddlers(tag);
	tiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : 1);});
	var toLoad = [];
	var nLoaded = 0;
	var map = {};
	var nPlugins = tiddlers.length;
	installedPlugins = [];
	var i;
	for(i=0; i<nPlugins; i++) {
		var p = getPluginInfo(tiddlers[i]);
		installedPlugins[i] = p;
		var n = p.Name || p.title;
		if(n)
			map[n] = p;
		n = p.Source;
		if(n)
			map[n] = p;
	}
	var visit = function(p) {
		if(!p || p.done)
			return;
		p.done = 1;
		var reqs = p.Requires;
		if(reqs) {
			reqs = reqs.readBracketedList();
			var i;
			for(i=0; i<reqs.length; i++)
				visit(map[reqs[i]]);
		}
		toLoad.push(p);
	};
	for(i=0; i<nPlugins; i++)
		visit(installedPlugins[i]);
	for(i=0; i<toLoad.length; i++) {
		p = toLoad[i];
		pluginInfo = p;
		tiddler = p.tiddler;
		if(isPluginExecutable(p)) {
			if(isPluginEnabled(p)) {
				p.executed = true;
				var startTime = new Date();
				try {
					if(tiddler.text)
						window.eval(tiddler.text);
					nLoaded++;
				} catch(ex) {
					p.log.push(config.messages.pluginError.format([exceptionText(ex)]));
					p.error = true;
					if(!console.tiddlywiki) {
						console.log("error evaluating " + tiddler.title, ex);
					}
				}
				pluginInfo.startupTime = String((new Date()) - startTime) + "ms";
			} else {
				nPlugins--;
			}
		} else {
			p.warning = true;
		}
	}
	return nLoaded != nPlugins;
}

function getPluginInfo(tiddler)
{
	var p = store.getTiddlerSlices(tiddler.title,["Name","Description","Version","Requires","CoreVersion","Date","Source","Author","License","Browsers"]);
	p.tiddler = tiddler;
	p.title = tiddler.title;
	p.log = [];
	return p;
}

// Check that a particular plugin is valid for execution
function isPluginExecutable(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigForce")) {
		plugin.log.push(config.messages.pluginForced);
		return true;
	}
	if(plugin["CoreVersion"]) {
		var coreVersion = plugin["CoreVersion"].split(".");
		var w = parseInt(coreVersion[0],10) - version.major;
		if(w == 0 && coreVersion[1])
			w = parseInt(coreVersion[1],10) - version.minor;
		if(w == 0 && coreVersion[2])
			w = parseInt(coreVersion[2],10) - version.revision;
		if(w > 0) {
			plugin.log.push(config.messages.pluginVersionError);
			return false;
		}
	}
	return true;
}

function isPluginEnabled(plugin)
{
	if(plugin.tiddler.isTagged("systemConfigDisable")) {
		plugin.log.push(config.messages.pluginDisabled);
		return false;
	}
	return true;
}

//--
//-- Paramifiers
//--

function getParameters()
{
	var p = null;
	if(window.location.hash) {
		p = decodeURIComponent(window.location.hash.substr(1));
		if(config.browser.firefoxDate != null && config.browser.firefoxDate[1] < "20051111")
			p = convertUTF8ToUnicode(p);
	}
	return p;
}

function invokeParamifier(params,handler)
{
	if(!params || params.length == undefined || params.length <= 1)
		return;
	var i;
	for(i=1; i<params.length; i++) {
		var p = config.paramifiers[params[i].name];
		if(p && p[handler] instanceof Function)
			p[handler](params[i].value);
		else {
			var h = config.optionHandlers[params[i].name.substr(0,3)];
			if(h && h.set instanceof Function)
				h.set(params[i].name,params[i].value);
		}
	}
}

config.paramifiers = {};

config.paramifiers.start = {
	oninit: function(v) {
		safeMode = v.toLowerCase() == "safe";
	}
};

config.paramifiers.open = {
	onstart: function(v) {
		if(!readOnly || store.tiddlerExists(v) || store.isShadowTiddler(v))
			story.displayTiddler("bottom",v,null,false,null);
	}
};

config.paramifiers.story = {
	onstart: function(v) {
		var list = store.getTiddlerText(v,"").parseParams("open",null,false);
		invokeParamifier(list,"onstart");
	}
};

config.paramifiers.search = {
	onstart: function(v) {
		story.search(v,false,false);
	}
};

config.paramifiers.searchRegExp = {
	onstart: function(v) {
		story.prototype.search(v,false,true);
	}
};

config.paramifiers.tag = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers("[tag["+v+"]]"),null,false,null);
	}
};

config.paramifiers.newTiddler = {
	onstart: function(v) {
		var args = v.parseParams("anon", null, null)[0];
		var title = args.title ? args.title[0] : v;
		var customFields = args.fields ? args.fields[0] : null;
		if(!readOnly) {
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,customFields);
			story.focusTiddler(title,"text");
			var i,tags = args.tag || [];
			for(i=0;i<tags.length;i++) {
				story.setTiddlerTag(title,tags[i],+1);
			}
		}
	}
};

config.paramifiers.newJournal = {
	onstart: function(v) {
		if(!readOnly) {
			var now = new Date();
			var title = now.formatString(v.trim());
			story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE);
			story.focusTiddler(title,"text");
		}
	}
};

config.paramifiers.readOnly = {
	onconfig: function(v) {
		var p = v.toLowerCase();
		readOnly = p == "yes" ? true : (p == "no" ? false : readOnly);
	}
};

config.paramifiers.theme = {
	onconfig: function(v) {
		story.switchTheme(v);
	}
};

config.paramifiers.upgrade = {
	onstart: function(v) {
		upgradeFrom(v);
	}
};

config.paramifiers.recent= {
	onstart: function(v) {
		var titles=[];
		var i,tiddlers=store.getTiddlers("modified","excludeLists").reverse();
		for(i=0; i<v && i<tiddlers.length; i++)
			titles.push(tiddlers[i].title);
		story.displayTiddlers(null,titles);
	}
};

config.paramifiers.filter = {
	onstart: function(v) {
		story.displayTiddlers(null,store.filterTiddlers(v),null,false);
	}
};

//--
//-- Formatter helpers
//--

function Formatter(formatters)
{
	var n;
	this.formatters = [];
	var pattern = [];
	for(n=0; n<formatters.length; n++) {
		pattern.push("(" + formatters[n].match + ")");
		this.formatters.push(formatters[n]);
	}
	this.formatterRegExp = new RegExp(pattern.join("|"),"mg");
}

config.formatterHelpers = {

	createElementAndWikify: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,this.element),this.termRegExp);
	},

	inlineCssHelper: function(w)
	{
		var styles = [];
		config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var s,v;
			if(lookaheadMatch[1]) {
				s = lookaheadMatch[1].unDash();
				v = lookaheadMatch[2];
			} else {
				s = lookaheadMatch[3].unDash();
				v = lookaheadMatch[4];
			}
			if(s=="bgcolor")
				s = "backgroundColor";
			if(s=="float")
				s = "cssFloat";
			styles.push({style: s, value: v});
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
			config.textPrimitives.cssLookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = config.textPrimitives.cssLookaheadRegExp.exec(w.source);
		}
		return styles;
	},

	applyCssHelper: function(e,styles)
	{
		var t;
		for(t=0; t< styles.length; t++) {
			try {
				e.style[styles[t].style] = styles[t].value;
			} catch (ex) {
			}
		}
	},

	enclosedTextHelper: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var text = lookaheadMatch[1];
			if(config.browser.isIE && (config.browser.ieVersion[1] < 10))
				text = text.replace(/\n/g,"\r");
			createTiddlyElement(w.output,this.element,null,null,text);
			w.nextMatch = lookaheadMatch.index + lookaheadMatch[0].length;
		}
	},

	isExternalLink: function(link)
	{
		if(store.tiddlerExists(link) || store.isShadowTiddler(link)) {
			return false;
		}
		var urlRegExp = new RegExp(config.textPrimitives.urlPattern,"mg");
		if(urlRegExp.exec(link)) {
			return true;
		}
		if(link.indexOf(".")!=-1 || link.indexOf("\\")!=-1 || link.indexOf("/")!=-1 || link.indexOf("#")!=-1) {
			return true;
		}
		return false;
	}

};

//--
//-- Standard formatters
//--

config.formatters = [
{
	name: "table",
	match: "^\\|(?:[^\\n]*)\\|(?:[fhck]?)$",
	lookaheadRegExp: /^\|([^\n]*)\|([fhck]?)$/mg,
	rowTermRegExp: /(\|(?:[fhck]?)$\n?)/mg,
	cellRegExp: /(?:\|([^\n\|]*)\|)|(\|[fhck]?$\n?)/mg,
	cellTermRegExp: /((?:\x20*)\|)/mg,
	rowTypes: {"c":"caption", "h":"thead", "":"tbody", "f":"tfoot"},
	handler: function(w)
	{
		var table = createTiddlyElement(w.output,"table",null,"twtable");
		var prevColumns = [];
		var currRowType = null;
		var rowContainer;
		var rowCount = 0;
		var onmouseover = function() {jQuery(this).addClass("hoverRow");};
		var onmouseout = function() {jQuery(this).removeClass("hoverRow");};
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			var nextRowType = lookaheadMatch[2];
			if(nextRowType == "k") {
				table.className = lookaheadMatch[1];
				w.nextMatch += lookaheadMatch[0].length+1;
			} else {
				if(nextRowType != currRowType) {
					rowContainer = createTiddlyElement(table,this.rowTypes[nextRowType]);
					currRowType = nextRowType;
				}
				if(currRowType == "c") {
					// Caption
					w.nextMatch++;
					if(rowContainer != table.firstChild)
						table.insertBefore(rowContainer,table.firstChild);
					rowContainer.setAttribute("align",rowCount == 0?"top":"bottom");
					w.subWikifyTerm(rowContainer,this.rowTermRegExp);
				} else {
					var theRow = createTiddlyElement(rowContainer,"tr",null,rowCount%2?"oddRow":"evenRow");
					theRow.onmouseover = onmouseover;
					theRow.onmouseout = onmouseout;
					this.rowHandler(w,theRow,prevColumns);
					rowCount++;
				}
			}
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	},
	rowHandler: function(w,e,prevColumns)
	{
		var col = 0;
		var colSpanCount = 1;
		var prevCell = null;
		this.cellRegExp.lastIndex = w.nextMatch;
		var cellMatch = this.cellRegExp.exec(w.source);
		while(cellMatch && cellMatch.index == w.nextMatch) {
			if(cellMatch[1] == "~") {
				// Rowspan
				var last = prevColumns[col];
				if(last) {
					last.rowSpanCount++;
					last.element.setAttribute("rowspan",last.rowSpanCount);
					last.element.setAttribute("rowSpan",last.rowSpanCount); // Needed for IE
					last.element.valign = "center";
					if(colSpanCount > 1) {
						last.element.setAttribute("colspan",colSpanCount);
						last.element.setAttribute("colSpan",colSpanCount); // Needed for IE
						colSpanCount = 1;
					}
				}
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[1] == ">") {
				// Colspan
				colSpanCount++;
				w.nextMatch = this.cellRegExp.lastIndex-1;
			} else if(cellMatch[2]) {
				// End of row
				if(prevCell && colSpanCount > 1) {
					prevCell.setAttribute("colspan",colSpanCount);
					prevCell.setAttribute("colSpan",colSpanCount); // Needed for IE
				}
				w.nextMatch = this.cellRegExp.lastIndex;
				break;
			} else {
				// Cell
				w.nextMatch++;
				var styles = config.formatterHelpers.inlineCssHelper(w);
				var spaceLeft = false;
				var chr = w.source.substr(w.nextMatch,1);
				while(chr == " ") {
					spaceLeft = true;
					w.nextMatch++;
					chr = w.source.substr(w.nextMatch,1);
				}
				var cell;
				if(chr == "!") {
					cell = createTiddlyElement(e,"th");
					w.nextMatch++;
				} else {
					cell = createTiddlyElement(e,"td");
				}
				prevCell = cell;
				prevColumns[col] = {rowSpanCount:1,element:cell};
				if(colSpanCount > 1) {
					cell.setAttribute("colspan",colSpanCount);
					cell.setAttribute("colSpan",colSpanCount); // Needed for IE
					colSpanCount = 1;
				}
				config.formatterHelpers.applyCssHelper(cell,styles);
				w.subWikifyTerm(cell,this.cellTermRegExp);
				if(w.matchText.substr(w.matchText.length-2,1) == " ") // spaceRight
					cell.align = spaceLeft ? "center" : "left";
				else if(spaceLeft)
					cell.align = "right";
				w.nextMatch--;
			}
			col++;
			this.cellRegExp.lastIndex = w.nextMatch;
			cellMatch = this.cellRegExp.exec(w.source);
		}
	}
},

{
	name: "heading",
	match: "^!{1,6}",
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		w.subWikifyTerm(createTiddlyElement(w.output,"h" + w.matchLength),this.termRegExp);
	}
},

{
	name: "list",
	match: "^(?:[\\*#;:]+)",
	lookaheadRegExp: /^(?:(?:(\*)|(#)|(;)|(:))+)/mg,
	termRegExp: /(\n)/mg,
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0, currType = null;
		var listLevel, listType, itemType, baseType;
		w.nextMatch = w.matchStart;
		this.lookaheadRegExp.lastIndex = w.nextMatch;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		while(lookaheadMatch && lookaheadMatch.index == w.nextMatch) {
			if(lookaheadMatch[1]) {
				listType = "ul";
				itemType = "li";
			} else if(lookaheadMatch[2]) {
				listType = "ol";
				itemType = "li";
			} else if(lookaheadMatch[3]) {
				listType = "dl";
				itemType = "dt";
			} else if(lookaheadMatch[4]) {
				listType = "dl";
				itemType = "dd";
			}
			if(!baseType)
				baseType = listType;
			listLevel = lookaheadMatch[0].length;
			w.nextMatch += lookaheadMatch[0].length;
			var t;
			if(listLevel > currLevel) {
				for(t=currLevel; t<listLevel; t++) {
					var target = (currLevel == 0) ? stack[stack.length-1] : stack[stack.length-1].lastChild;
					stack.push(createTiddlyElement(target,listType));
				}
			} else if(listType!=baseType && listLevel==1) {
				w.nextMatch -= lookaheadMatch[0].length;
				return;
			} else if(listLevel < currLevel) {
				for(t=currLevel; t>listLevel; t--)
					stack.pop();
			} else if(listLevel == currLevel && listType != currType) {
				stack.pop();
				stack.push(createTiddlyElement(stack[stack.length-1].lastChild,listType));
			}
			currLevel = listLevel;
			currType = listType;
			var e = createTiddlyElement(stack[stack.length-1],itemType);
			w.subWikifyTerm(e,this.termRegExp);
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		}
	}
},

{
	name: "quoteByBlock",
	match: "^<<<\\n",
	termRegExp: /(^<<<(\n|$))/mg,
	element: "blockquote",
	handler: config.formatterHelpers.createElementAndWikify
},

{
	name: "quoteByLine",
	match: "^>+",
	lookaheadRegExp: /^>+/mg,
	termRegExp: /(\n)/mg,
	element: "blockquote",
	handler: function(w)
	{
		var stack = [w.output];
		var currLevel = 0;
		var newLevel = w.matchLength;
		var t,matched;
		do {
			if(newLevel > currLevel) {
				for(t=currLevel; t<newLevel; t++)
					stack.push(createTiddlyElement(stack[stack.length-1],this.element));
			} else if(newLevel < currLevel) {
				for(t=currLevel; t>newLevel; t--)
					stack.pop();
			}
			currLevel = newLevel;
			w.subWikifyTerm(stack[stack.length-1],this.termRegExp);
			createTiddlyElement(stack[stack.length-1],"br");
			this.lookaheadRegExp.lastIndex = w.nextMatch;
			var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
			matched = lookaheadMatch && lookaheadMatch.index == w.nextMatch;
			if(matched) {
				newLevel = lookaheadMatch[0].length;
				w.nextMatch += lookaheadMatch[0].length;
			}
		} while(matched);
	}
},

{
	name: "rule",
	match: "^----+$\\n?|<hr ?/?>\\n?",
	handler: function(w)
	{
		createTiddlyElement(w.output,"hr");
	}
},

{
	name: "monospacedByLine",
	match: "^(?:/\\*\\{\\{\\{\\*/|\\{\\{\\{|//\\{\\{\\{|<!--\\{\\{\\{-->)\\n",
	element: "pre",
	handler: function(w)
	{
		switch(w.matchText) {
		case "/*{{{*/\n": // CSS
			this.lookaheadRegExp = /\/\*\{\{\{\*\/\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\*\}\}\}\*\/$\n?)/mg;
			break;
		case "{{{\n": // monospaced block
			this.lookaheadRegExp = /^\{\{\{\n((?:^[^\n]*\n)+?)(^\f*\}\}\}$\n?)/mg;
			break;
		case "//{{{\n": // plugin
			this.lookaheadRegExp = /^\/\/\{\{\{\n\n*((?:^[^\n]*\n)+?)(\n*^\f*\/\/\}\}\}$\n?)/mg;
			break;
		case "<!--{{{-->\n": //template
			this.lookaheadRegExp = /<!--\{\{\{-->\n*((?:^[^\n]*\n)+?)(\n*^\f*<!--\}\}\}-->$\n?)/mg;
			break;
		default:
			break;
		}
		config.formatterHelpers.enclosedTextHelper.call(this,w);
	}
},

{
	name: "wikifyComment",
	match: "^(?:/\\*\\*\\*|<!---)\\n",
	handler: function(w)
	{
		var termRegExp = (w.matchText == "/***\n") ? (/(^\*\*\*\/\n)/mg) : (/(^--->\n)/mg);
		w.subWikifyTerm(w.output,termRegExp);
	}
},

{
	name: "macro",
	match: "<<",
	lookaheadRegExp: /<<([^>\s]+)(?:\s*)((?:[^>]|(?:>(?!>)))*)>>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart && lookaheadMatch[1]) {
			w.nextMatch = this.lookaheadRegExp.lastIndex;
			invokeMacro(w.output,lookaheadMatch[1],lookaheadMatch[2],w,w.tiddler);
		}
	}
},

{
	name: "prettyLink",
	match: "\\[\\[",
	lookaheadRegExp: /\[\[(.*?)(?:\|(~)?(.*?))?\]\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e;
			var text = lookaheadMatch[1];
			if(lookaheadMatch[3]) {
				// Pretty bracketted link
				var link = lookaheadMatch[3];
				e = (!lookaheadMatch[2] && config.formatterHelpers.isExternalLink(link)) ?
						createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
			} else {
				// Simple bracketted link
				e = createTiddlyLink(w.output,text,false,null,w.isStatic,w.tiddler);
			}
			createTiddlyText(e,text);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "wikiLink",
	match: config.textPrimitives.unWikiLink+"?"+config.textPrimitives.wikiLink,
	handler: function(w)
	{
		if(w.matchText.substr(0,1) == config.textPrimitives.unWikiLink) {
			w.outputText(w.output,w.matchStart+1,w.nextMatch);
			return;
		}
		if(w.matchStart > 0) {
			var preRegExp = new RegExp(config.textPrimitives.anyLetterStrict,"mg");
			preRegExp.lastIndex = w.matchStart-1;
			var preMatch = preRegExp.exec(w.source);
			if(preMatch.index == w.matchStart-1) {
				w.outputText(w.output,w.matchStart,w.nextMatch);
				return;
			}
		}
		if(w.autoLinkWikiWords || store.isShadowTiddler(w.matchText)) {
			var link = createTiddlyLink(w.output,w.matchText,false,null,w.isStatic,w.tiddler);
			w.outputText(link,w.matchStart,w.nextMatch);
		} else {
			w.outputText(w.output,w.matchStart,w.nextMatch);
		}
	}
},

{
	name: "urlLink",
	match: config.textPrimitives.urlPattern,
	handler: function(w)
	{
		w.outputText(createExternalLink(w.output,w.matchText),w.matchStart,w.nextMatch);
	}
},

{
	name: "image",
	match: "\\[[<>]?[Ii][Mm][Gg]\\[",
	lookaheadRegExp: /\[([<]?)(>?)[Ii][Mm][Gg]\[(?:([^\|\]]+)\|)?([^\[\]\|]+)\](?:\[([^\]]*)\])?\]/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			var e = w.output;
			if(lookaheadMatch[5]) {
				var link = lookaheadMatch[5];
				e = config.formatterHelpers.isExternalLink(link) ? createExternalLink(w.output,link) : createTiddlyLink(w.output,link,false,null,w.isStatic,w.tiddler);
				jQuery(e).addClass("imageLink");
			}
			var img = createTiddlyElement(e,"img");
			if(lookaheadMatch[1])
				img.align = "left";
			else if(lookaheadMatch[2])
				img.align = "right";
			if(lookaheadMatch[3]) {
				img.title = lookaheadMatch[3];
				img.setAttribute("alt",lookaheadMatch[3]);
			}
			img.src = lookaheadMatch[4];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "html",
	match: "<[Hh][Tt][Mm][Ll]>",
	lookaheadRegExp: /<[Hh][Tt][Mm][Ll]>((?:.|\n)*?)<\/[Hh][Tt][Mm][Ll]>/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span").innerHTML = lookaheadMatch[1];
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "commentByBlock",
	match: "/%",
	lookaheadRegExp: /\/%((?:.|\n)*?)%\//mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart)
			w.nextMatch = this.lookaheadRegExp.lastIndex;
	}
},

{
	name: "characterFormat",
	match: "''|//|__|\\^\\^|~~|--(?!\\s|$)|\\{\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "''":
			w.subWikifyTerm(w.output.appendChild(document.createElement("strong")),/('')/mg);
			break;
		case "//":
			w.subWikifyTerm(createTiddlyElement(w.output,"em"),/(\/\/)/mg);
			break;
		case "__":
			w.subWikifyTerm(createTiddlyElement(w.output,"u"),/(__)/mg);
			break;
		case "^^":
			w.subWikifyTerm(createTiddlyElement(w.output,"sup"),/(\^\^)/mg);
			break;
		case "~~":
			w.subWikifyTerm(createTiddlyElement(w.output,"sub"),/(~~)/mg);
			break;
		case "--":
			w.subWikifyTerm(createTiddlyElement(w.output,"strike"),/(--)/mg);
			break;
		case "{{{":
			var lookaheadRegExp = /\{\{\{((?:.|\n)*?)\}\}\}/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
				createTiddlyElement(w.output,"code",null,null,lookaheadMatch[1]);
				w.nextMatch = lookaheadRegExp.lastIndex;
			}
			break;
		}
	}
},

{
	name: "customFormat",
	match: "@@|\\{\\{",
	handler: function(w)
	{
		switch(w.matchText) {
		case "@@":
			var e = createTiddlyElement(w.output,"span");
			var styles = config.formatterHelpers.inlineCssHelper(w);
			if(styles.length == 0)
				e.className = "marked";
			else
				config.formatterHelpers.applyCssHelper(e,styles);
			w.subWikifyTerm(e,/(@@)/mg);
			break;
		case "{{":
			var lookaheadRegExp = /\{\{[\s]*([\w]+[\s\w]*)[\s]*\{(\n?)/mg;
			lookaheadRegExp.lastIndex = w.matchStart;
			var lookaheadMatch = lookaheadRegExp.exec(w.source);
			if(lookaheadMatch) {
				w.nextMatch = lookaheadRegExp.lastIndex;
				e = createTiddlyElement(w.output,lookaheadMatch[2] == "\n" ? "div" : "span",null,lookaheadMatch[1]);
				w.subWikifyTerm(e,/(\}\}\})/mg);
			}
			break;
		}
	}
},

{
	name: "mdash",
	match: "--",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = "&mdash;";
	}
},

{
	name: "lineBreak",
	match: "\\n|<br ?/?>",
	handler: function(w)
	{
		createTiddlyElement(w.output,"br");
	}
},

{
	name: "rawText",
	match: "\"{3}|<nowiki>",
	lookaheadRegExp: /(?:\"{3}|<nowiki>)((?:.|\n)*?)(?:\"{3}|<\/nowiki>)/mg,
	handler: function(w)
	{
		this.lookaheadRegExp.lastIndex = w.matchStart;
		var lookaheadMatch = this.lookaheadRegExp.exec(w.source);
		if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
			createTiddlyElement(w.output,"span",null,null,lookaheadMatch[1]);
			w.nextMatch = this.lookaheadRegExp.lastIndex;
		}
	}
},

{
	name: "htmlEntitiesEncoding",
	match: "(?:(?:&#?[a-zA-Z0-9]{2,8};|.)(?:&#?(?:x0*(?:3[0-6][0-9a-fA-F]|1D[c-fC-F][0-9a-fA-F]|20[d-fD-F][0-9a-fA-F]|FE2[0-9a-fA-F])|0*(?:76[89]|7[7-9][0-9]|8[0-7][0-9]|761[6-9]|76[2-7][0-9]|84[0-3][0-9]|844[0-7]|6505[6-9]|6506[0-9]|6507[0-1]));)+|&#?[a-zA-Z0-9]{2,8};)",
	handler: function(w)
	{
		createTiddlyElement(w.output,"span").innerHTML = w.matchText;
	}
}

];

//--
//-- Wikifier
//--

function getParser(tiddler,format)
{
	if(tiddler) {
		if(!format)
			format = tiddler.fields["wikiformat"];
		var i;
		if(format) {
			for(i in config.parsers) {
				if(format == config.parsers[i].format)
					return config.parsers[i];
			}
		} else {
			for(i in config.parsers) {
				if(tiddler.isTagged(config.parsers[i].formatTag))
					return config.parsers[i];
			}
		}
	}
	return formatter;
}

function Wikifier(source,formatter,highlightRegExp,tiddler)
{
	this.source = source;
	this.output = null;
	this.formatter = formatter;
	this.nextMatch = 0;
	this.autoLinkWikiWords = tiddler && tiddler.autoLinkWikiWords() == false ? false : true;
	this.highlightRegExp = highlightRegExp;
	this.highlightMatch = null;
	this.isStatic = false;
	if(highlightRegExp) {
		highlightRegExp.lastIndex = 0;
		this.highlightMatch = highlightRegExp.exec(source);
	}
	this.tiddler = tiddler;
}

Wikifier.prototype.wikifyPlain = function()
{
	var e = createTiddlyElement(document.body,"div");
	e.style.display = "none";
	this.subWikify(e);
	var text = jQuery(e).text();
	jQuery(e).remove();
	return text;
};

Wikifier.prototype.subWikify = function(output,terminator)
{
	try {
		if(terminator)
			this.subWikifyTerm(output,new RegExp("(" + terminator + ")","mg"));
		else
			this.subWikifyUnterm(output);
	} catch(ex) {
		showException(ex);
	}
};

Wikifier.prototype.subWikifyUnterm = function(output)
{
	var oldOutput = this.output;
	this.output = output;
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	while(formatterMatch) {
		// Output any text before the match
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		// Set the match parameters for the handler
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		formatterMatch = this.formatter.formatterRegExp.exec(this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.subWikifyTerm = function(output,terminatorRegExp)
{
	var oldOutput = this.output;
	this.output = output;
	terminatorRegExp.lastIndex = this.nextMatch;
	var terminatorMatch = terminatorRegExp.exec(this.source);
	this.formatter.formatterRegExp.lastIndex = this.nextMatch;
	var formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	while(terminatorMatch || formatterMatch) {
		if(terminatorMatch && (!formatterMatch || terminatorMatch.index <= formatterMatch.index)) {
			if(terminatorMatch.index > this.nextMatch)
				this.outputText(this.output,this.nextMatch,terminatorMatch.index);
			this.matchText = terminatorMatch[1];
			this.matchLength = terminatorMatch[1].length;
			this.matchStart = terminatorMatch.index;
			this.nextMatch = this.matchStart + this.matchLength;
			this.output = oldOutput;
			return;
		}
		if(formatterMatch.index > this.nextMatch)
			this.outputText(this.output,this.nextMatch,formatterMatch.index);
		this.matchStart = formatterMatch.index;
		this.matchLength = formatterMatch[0].length;
		this.matchText = formatterMatch[0];
		this.nextMatch = this.formatter.formatterRegExp.lastIndex;
		var t;
		for(t=1; t<formatterMatch.length; t++) {
			if(formatterMatch[t]) {
				this.formatter.formatters[t-1].handler(this);
				this.formatter.formatterRegExp.lastIndex = this.nextMatch;
				break;
			}
		}
		terminatorRegExp.lastIndex = this.nextMatch;
		terminatorMatch = terminatorRegExp.exec(this.source);
		formatterMatch = this.formatter.formatterRegExp.exec(terminatorMatch ? this.source.substr(0,terminatorMatch.index) : this.source);
	}
	if(this.nextMatch < this.source.length) {
		this.outputText(this.output,this.nextMatch,this.source.length);
		this.nextMatch = this.source.length;
	}
	this.output = oldOutput;
};

Wikifier.prototype.outputText = function(place,startPos,endPos)
{
	while(this.highlightMatch && (this.highlightRegExp.lastIndex > startPos) && (this.highlightMatch.index < endPos) && (startPos < endPos)) {
		if(this.highlightMatch.index > startPos) {
			createTiddlyText(place,this.source.substring(startPos,this.highlightMatch.index));
			startPos = this.highlightMatch.index;
		}
		var highlightEnd = Math.min(this.highlightRegExp.lastIndex,endPos);
		createTiddlyElement(place,"span",null,"highlight",this.source.substring(startPos,highlightEnd));
		startPos = highlightEnd;
		if(startPos >= this.highlightRegExp.lastIndex)
			this.highlightMatch = this.highlightRegExp.exec(this.source);
	}
	if(startPos < endPos) {
		createTiddlyText(place,this.source.substring(startPos,endPos));
	}
};

function wikify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,getParser(tiddler),highlightRegExp,tiddler);
		var t0 = new Date();
		wikifier.subWikify(output);
		if(tiddler && config.options.chkDisplayInstrumentation)
			displayMessage("wikify:" +tiddler.title+ " in " + (new Date()-t0) + " ms");
	}
}

function wikifyStatic(source,highlightRegExp,tiddler,format)
{
	var e = createTiddlyElement(document.body,"pre");
	e.style.display = "none";
	var html = "";
	if(source && source != "") {
		if(!tiddler)
			tiddler = new Tiddler("temp");
		var wikifier = new Wikifier(source,getParser(tiddler,format),highlightRegExp,tiddler);
		wikifier.isStatic = true;
		wikifier.subWikify(e);
		html = e.innerHTML;
		jQuery(e).remove();
	}
	return html;
}

function wikifyPlainText(text,limit,tiddler)
{
	if(limit > 0)
		text = text.substr(0,limit);
	var wikifier = new Wikifier(text,formatter,null,tiddler);
	return wikifier.wikifyPlain();
}

function highlightify(source,output,highlightRegExp,tiddler)
{
	if(source) {
		var wikifier = new Wikifier(source,formatter,highlightRegExp,tiddler);
		wikifier.outputText(output,0,source.length);
	}
}

//--
//-- Macro definitions
//--

function invokeMacro(place,macro,params,wikifier,tiddler)
{
	try {
		var m = config.macros[macro];
		if(m && m.handler) {
			var tiddlerElem = story.findContainingTiddler(place);
			window.tiddler = tiddlerElem ? store.getTiddler(tiddlerElem.getAttribute("tiddler")) : null;
			window.place = place;
			var allowEval = true;
			if(config.evaluateMacroParameters=="system") {
				if(!tiddler || tiddler.tags.indexOf("systemAllowEval") == -1) {
					allowEval = false;
				}
			}
			m.handler(place,macro,m.noPreParse?null:params.readMacroParams(!allowEval),wikifier,params,tiddler);
		} else {
			createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,config.messages.missingMacro]));
		}
	} catch(ex) {
		createTiddlyError(place,config.messages.macroError.format([macro]),config.messages.macroErrorDetails.format([macro,ex.toString()]));
	}
}

config.macros.version.handler = function(place)
{
	jQuery("<span/>").text(formatVersion()).appendTo(place);
};

config.macros.today.handler = function(place,macroName,params)
{
	var now = new Date();
	var text = params[0] ? now.formatString(params[0].trim()) : now.toLocaleString();
	jQuery("<span/>").text(text).appendTo(place);
};

config.macros.list.template = "<<view title link>>";
config.macros.list.handler = function(place,macroName,params,wikifier,paramString)
{
	var list = document.createElement("ul");
	jQuery(list).attr({ refresh: "macro", macroName: macroName }).data("params", paramString);
	place.appendChild(list);
	this.refresh(list);
};

config.macros.list.refresh = function(list) {
	var paramString = jQuery(list).data("params");
	var params = paramString.readMacroParams();
	var args = paramString.parseParams("anon", null, null)[0];
	var type = args.anon ? args.anon[0] : "all";
	jQuery(list).empty().addClass("list list-" + type);
	var template = args.template ? store.getTiddlerText(args.template[0]) : false;
	if(!template) {
		template = config.macros.list.template;
	}
	if(this[type].prompt)
		createTiddlyElement(list,"li",null,"listTitle",this[type].prompt);
	var results;
	if(this[type].handler)
		results = this[type].handler(params);
	var t;
	for(t = 0; t < results.length; t++) {
		var li = document.createElement("li");
		list.appendChild(li);
		var tiddler = results[t];
		if(typeof(tiddler) == 'string') { // deal with missing etc..
				tiddler = store.getTiddler(tiddler) || new Tiddler(tiddler);
		}
		wikify(template, li, null, tiddler);
	}
	if(results.length === 0 && args.emptyMessage) {
		jQuery(list).addClass("emptyList");
		jQuery("<li />").text(args.emptyMessage[0]).appendTo(list);
	}
};

config.macros.list.all.handler = function(params)
{
	return store.reverseLookup("tags","excludeLists",false,"title");
};

config.macros.list.missing.handler = function(params)
{
	return store.getMissingLinks();
};

config.macros.list.orphans.handler = function(params)
{
	return store.getOrphans();
};

config.macros.list.shadowed.handler = function(params)
{
	return store.getShadowed();
};

config.macros.list.touched.handler = function(params)
{
	return store.getTouched();
};

config.macros.list.filter.handler = function(params)
{
	var filter = params[1];
	var results = [];
	if(filter) {
		var tiddlers = store.filterTiddlers(filter);
		var t;
		for(t=0; t<tiddlers.length; t++)
			results.push(tiddlers[t].title);
	}
	return results;
};

config.macros.allTags.handler = function(place,macroName,params)
{
	var tags = store.getTags(params[0]);
	var ul = createTiddlyElement(place,"ul");
	if(tags.length == 0)
		createTiddlyElement(ul,"li",null,"listTitle",this.noTags);
	var t;
	for(t=0; t<tags.length; t++) {
		var title = tags[t][0];
		var info = getTiddlyLinkInfo(title);
		var li = createTiddlyElement(ul,"li");
		var btn = createTiddlyButton(li,title + " (" + tags[t][1] + ")",this.tooltip.format([title]),onClickTag,info.classes);
		btn.setAttribute("tag",title);
		btn.setAttribute("refresh","link");
		btn.setAttribute("tiddlyLink",title);
		if(params[1]) {
			btn.setAttribute("sortby",params[1]);
		}
	}
};

var macro = config.macros.timeline;
merge(macro, {
	handler: function(place,macroName,params, wikifier, paramString, tiddler) {
		var container = jQuery("<div />").attr("params", paramString).
			attr("macroName", macroName).appendTo(place)[0];
		macro.refresh(container);
	},
	refresh: function(container) {
		jQuery(container).attr("refresh", "macro").empty();
		var paramString = jQuery(container).attr("params");
		var args = paramString.parseParams("anon", null, null)[0];
		var params = args.anon || [];

		var field = params[0] || "modified";
		var prefix = field.charAt(0);
		var no_prefix_field = prefix === "-" || prefix === "+" ? field.substr(1, field.length) : field;
		var dateFormat = params[2] || this.dateFormat;
		var groupTemplate = macro.groupTemplate.format(no_prefix_field, dateFormat);
		groupTemplate = args.groupTemplate ? store.getTiddlerText(args.groupTemplate[0]) || groupTemplate :
			groupTemplate;

		var itemTemplate = macro.itemTemplate;
		itemTemplate = args.template ? store.getTiddlerText(args.template[0]) || itemTemplate :
			itemTemplate;

		var tiddlers = args.filter ? store.sortTiddlers(store.filterTiddlers(args.filter[0]), field) :
			store.reverseLookup("tags", "excludeLists", false, field);
		var lastGroup = "", ul;
		var last = params[1] ? tiddlers.length-Math.min(tiddlers.length,parseInt(params[1],10)) : 0;
		var t;
		for(t=tiddlers.length-1; t>=last; t--) {
			var tiddler = tiddlers[t];
			var theGroup = wikifyPlainText(groupTemplate,0,tiddler);
			if(typeof(ul) == "undefined" || theGroup != lastGroup) {
				ul = document.createElement("ul");
				jQuery(ul).addClass("timeline");
				container.appendChild(ul);
				createTiddlyElement(ul,"li",null,"listTitle",theGroup);
				lastGroup = theGroup;
			}
			var item = createTiddlyElement(ul,"li",null,"listLink");
			wikify(itemTemplate,item,null,tiddler);
		}
	},
	groupTemplate: "<<view %0 date '%1'>>", 
	itemTemplate: "<<view title link>>"
});

config.macros.tiddler.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var allowEval = true;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.length > 0 && config.evaluateMacroParameters == "system") {
		// included tiddler and "system" evaluation required, so check tiddler tagged appropriately
		var title = stack[stack.length-1];
		var pos = title.indexOf(config.textPrimitives.sectionSeparator);
		if(pos != -1) {
			title = title.substr(0,pos); // get the base tiddler title
		}
		var t = store.getTiddler(title);
		if(!t || t.tags.indexOf("systemAllowEval") == -1) {
			allowEval = false;
		}
	}
	params = paramString.parseParams("name",null,allowEval,false,true);
	var names = params[0]["name"];
	var tiddlerName = names[0];
	var className = names[1] || null;
	var args = params[0]["with"];
	var wrapper = createTiddlyElement(place,"span",null,className,null,{
		refresh: "content", tiddler: tiddlerName
	});
	if(args!==undefined)
		wrapper.setAttribute("args","[["+args.join("]] [[")+"]]");
	this.transclude(wrapper,tiddlerName,args);
};

config.macros.tiddler.transclude = function(wrapper,tiddlerName,args)
{
	var text = store.getTiddlerText(tiddlerName);
	if(!text)
		return;
	var stack = config.macros.tiddler.tiddlerStack;
	if(stack.indexOf(tiddlerName) !== -1)
		return;
	stack.push(tiddlerName);
	try {
		if(typeof args == "string")
			args = args.readBracketedList();
		var n = args ? Math.min(args.length,9) : 0;
		var i;
		for(i=0; i<n; i++) {
			var placeholderRE = new RegExp("\\$" + (i + 1),"mg");
			text = text.replace(placeholderRE,args[i]);
		}
		config.macros.tiddler.renderText(wrapper,text,tiddlerName);
	} finally {
		stack.pop();
	}
};

config.macros.tiddler.renderText = function(place,text,tiddlerName)
{
	wikify(text,place,null,store.getTiddler(tiddlerName));
};

config.macros.tiddler.tiddlerStack = [];

config.macros.tag.handler = function(place,macroName,params)
{
	var btn = createTagButton(place,params[0],null,params[1],params[2]);
	if(params[3]) {
		btn.setAttribute('sortby',params[3]);
	}
};

config.macros.tags.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title && store.tiddlerExists(title))
		tiddler = store.getTiddler(title);
	var sep = getParam(params,"sep"," ");
	var lingo = config.views.wikified.tag;
	var label = null;
	var t;
	for(t=0; t<tiddler.tags.length; t++) {
		var tag = store.getTiddler(tiddler.tags[t]);
		if(!tag || !tag.tags.contains("excludeLists")) {
			if(!label)
				label = createTiddlyElement(ul,"li",null,"listTitle",lingo.labelTags.format([tiddler.title]));
			createTagButton(createTiddlyElement(ul,"li"),tiddler.tags[t],tiddler.title);
			if(t<tiddler.tags.length-1)
				createTiddlyText(ul,sep);
		}
	}
	if(!label)
		createTiddlyElement(ul,"li",null,"listTitle",lingo.labelNoTags.format([tiddler.title]));
};

config.macros.tagging.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,true,false,false);
	var ul = createTiddlyElement(place,"ul");
	var title = getParam(params,"anon","");
	if(title == "" && tiddler instanceof Tiddler)
		title = tiddler.title;
	var sep = getParam(params,"sep"," ");
	ul.setAttribute("title",this.tooltip.format([title]));
	var sortby = getParam(params,"sortBy",false);
	var tagged = store.getTaggedTiddlers(title,sortby);
	var prompt = tagged.length == 0 ? this.labelNotTag : this.label;
	createTiddlyElement(ul,"li",null,"listTitle",prompt.format([title,tagged.length]));
	var t;
	for(t=0; t<tagged.length; t++) {
		createTiddlyLink(createTiddlyElement(ul,"li"),tagged[t].title,true);
		if(t<tagged.length-1)
			createTiddlyText(ul,sep);
	}
};

config.macros.closeAll.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.closeAll.onClick = function(e)
{
	story.closeAllTiddlers();
	return false;
};

config.macros.permaview.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.permaview.onClick = function(e)
{
	story.permaView();
	return false;
};

config.macros.saveChanges.handler = function(place,macroName,params)
{
	if(!readOnly)
		createTiddlyButton(place,params[0] || this.label,params[1] || this.prompt,this.onClick,null,null,this.accessKey);
};

config.macros.saveChanges.onClick = function(e)
{
	saveChanges();
	return false;
};

config.macros.slider.onClickSlider = function(ev)
{
	var n = this.nextSibling;
	var cookie = n.getAttribute("cookie");
	var isOpen = n.style.display != "none";
	if(config.options.chkAnimate && anim && typeof Slider == "function")
		anim.startAnimating(new Slider(n,!isOpen,null,"none"));
	else
		n.style.display = isOpen ? "none" : "block";
	config.options[cookie] = !isOpen;
	saveOption(cookie);
	return false;
};

config.macros.slider.createSlider = function(place,cookie,title,tooltip)
{
	var c = cookie || "";
	createTiddlyButton(place,title,tooltip,this.onClickSlider);
	var panel = createTiddlyElement(null,"div",null,"sliderPanel");
	panel.setAttribute("cookie",c);
	panel.style.display = config.options[c] ? "block" : "none";
	place.appendChild(panel);
	return panel;
};

config.macros.slider.handler = function(place,macroName,params)
{
	var panel = this.createSlider(place,params[0],params[2],params[3]);
	var text = store.getTiddlerText(params[1]);
	panel.setAttribute("refresh","content");
	panel.setAttribute("tiddler",params[1]);
	if(text)
		wikify(text,panel,null,store.getTiddler(params[1]));
};

// <<gradient [[tiddler name]] vert|horiz rgb rgb rgb rgb... >>
config.macros.gradient.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var panel = wikifier ? createTiddlyElement(place,"div",null,"gradient") : place;
	panel.style.position = "relative";
	panel.style.overflow = "hidden";
	panel.style.zIndex = "0";
	if(wikifier) {
		var styles = config.formatterHelpers.inlineCssHelper(wikifier);
		config.formatterHelpers.applyCssHelper(panel,styles);
	}
	params = paramString.parseParams("color");
	var locolors = [], hicolors = [];
	var t;
	for(t=2; t<params.length; t++) {
		var c = params[t].value;
		if(params[t].name == "snap") {
			hicolors[hicolors.length-1] = c;
		} else {
			locolors.push(c);
			hicolors.push(c);
		}
	}
	drawGradient(panel,params[1].value != "vert",locolors,hicolors);
	if(wikifier)
		wikifier.subWikify(panel,">>");
	if(document.all) {
		panel.style.height = "100%";
		panel.style.width = "100%";
	}
};

config.macros.message.handler = function(place,macroName,params)
{
	if(params[0]) {
		var names = params[0].split(".");
		var lookupMessage = function(root,nameIndex) {
				if(root[names[nameIndex]]) {
					if(nameIndex < names.length-1)
						return (lookupMessage(root[names[nameIndex]],nameIndex+1));
					else
						return root[names[nameIndex]];
				} else
					return null;
			};
		var m = lookupMessage(config,0);
		if(m == null)
			m = lookupMessage(window,0);
		createTiddlyText(place,m.toString().format(params.splice(1)));
	}
};


config.macros.view.depth = 0;
config.macros.view.values = [];
config.macros.view.views = {
	text: function(value,place,params,wikifier,paramString,tiddler) {
		highlightify(value,place,highlightHack,tiddler);
	},
	link: function(value,place,params,wikifier,paramString,tiddler) {
		createTiddlyLink(place,value,true);
	},
	wikified: function(value,place,params,wikifier,paramString,tiddler) {
		if(config.macros.view.depth>50)
			return;
		if(config.macros.view.depth>0) {
			if (value==config.macros.view.values[config.macros.view.depth-1]) {
				return;
			}
		}
		config.macros.view.values[config.macros.view.depth] = value;
		config.macros.view.depth++;
		if(params[2])
			value=params[2].unescapeLineBreaks().format([value]);
		wikify(value,place,highlightHack,tiddler);
		config.macros.view.depth--;
		config.macros.view.values[config.macros.view.depth] = null;
	},
	date: function(value,place,params,wikifier,paramString,tiddler) {
		value = Date.convertFromYYYYMMDDHHMM(value);
		createTiddlyText(place,value.formatString(params[2] || config.views.wikified.dateFormat));
	}
};

config.macros.view.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if((tiddler instanceof Tiddler) && params[0]) {
		var value = store.getValue(tiddler,params[0]);
		if(value) {
			var type = params[1] || config.macros.view.defaultView;
			var handler = config.macros.view.views[type];
			if(handler)
				handler(value,place,params,wikifier,paramString,tiddler);
		}
	}
};

config.macros.edit.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var field = params[0];
	var rows = params[1] || 0;
	var defVal = params[2] || '';
	if((tiddler instanceof Tiddler) && field) {
		story.setDirty(tiddler.title,true);
		var e,v;
		if(field != "text" && !rows) {
			e = createTiddlyElement(null,"input",null,null,null,{
				type: "text", edit: field, size: "40", autocomplete: "off"
			});
			e.value = store.getValue(tiddler,field) || defVal;
			place.appendChild(e);
		} else {
			var wrapper1 = createTiddlyElement(null,"fieldset",null,"fieldsetFix");
			var wrapper2 = createTiddlyElement(wrapper1,"div");
			e = createTiddlyElement(wrapper2,"textarea");
			e.value = v = store.getValue(tiddler,field) || defVal;
			rows = rows || 10;
			var lines = v.match(/\n/mg);
			var maxLines = Math.max(parseInt(config.options.txtMaxEditRows,10),5);
			if(lines != null && lines.length > rows)
				rows = lines.length + 5;
			rows = Math.min(rows,maxLines);
			e.setAttribute("rows",rows);
			e.setAttribute("edit",field);
			place.appendChild(wrapper1);
		}
		if(tiddler.isReadOnly()) {
			e.setAttribute("readOnly","readOnly");
			jQuery(e).addClass("readOnly");
		}
		return e;
	}
};

config.macros.tagChooser.onClick = function(ev)
{
	var e = ev || window.event;
	var lingo = config.views.editor.tagChooser;
	var popup = Popup.create(this);
	var tags = store.getTags(this.getAttribute("tags"));
	if(tags.length == 0)
		jQuery("<li/>").text(lingo.popupNone).appendTo(popup);
	var t;
	for(t=0; t<tags.length; t++) {
		var tag = createTiddlyButton(createTiddlyElement(popup,"li"),tags[t][0],lingo.tagTooltip.format([tags[t][0]]),config.macros.tagChooser.onTagClick);
		tag.setAttribute("tag",tags[t][0]);
		tag.setAttribute("tiddler",this.getAttribute("tiddler"));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
};

config.macros.tagChooser.onTagClick = function(ev)
{
	var e = ev || window.event;
	if(e.metaKey || e.ctrlKey) stopEvent(e); //# keep popup open on CTRL-click
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(!readOnly)
		story.setTiddlerTag(title,tag,0);
	return false;
};

config.macros.tagChooser.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(tiddler instanceof Tiddler) {
		var lingo = config.views.editor.tagChooser;
		var btn = createTiddlyButton(place,lingo.text,lingo.tooltip,this.onClick);
		btn.setAttribute("tiddler",tiddler.title);
		btn.setAttribute("tags",params[0]);
	}
};

config.macros.refreshDisplay.handler = function(place)
{
	createTiddlyButton(place,this.label,this.prompt,this.onClick);
};

config.macros.refreshDisplay.onClick = function(e)
{
	refreshAll();
	return false;
};

config.macros.annotations.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var title = tiddler ? tiddler.title : null;
	var a = title ? config.annotations[title] : null;
	if(!tiddler || !title || !a)
		return;
	var text = a.format([title]);
	wikify(text,createTiddlyElement(place,"div",null,"annotation"),null,tiddler);
};
//--
//-- NewTiddler and NewJournal macros
//--

config.macros.newTiddler.createNewTiddlerButton = function(place,title,params,label,prompt,accessKey,newFocus,isJournal)
{
	var tags = [];
	var t;
	for(t=1; t<params.length; t++) {
		if((params[t].name == "anon" && t != 1) || (params[t].name == "tag"))
			tags.push(params[t].value);
	}
	label = getParam(params,"label",label);
	prompt = getParam(params,"prompt",prompt);
	accessKey = getParam(params,"accessKey",accessKey);
	newFocus = getParam(params,"focus",newFocus);
	var customFields = getParam(params,"fields","");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	var btn = createTiddlyButton(place,label,prompt,this.onClickNewTiddler,null,null,accessKey);
	btn.setAttribute("newTitle",title);
	btn.setAttribute("isJournal",isJournal ? "true" : "false");
	if(tags.length > 0)
		btn.setAttribute("params",tags.join("|"));
	btn.setAttribute("newFocus",newFocus);
	btn.setAttribute("newTemplate",getParam(params,"template",DEFAULT_EDIT_TEMPLATE));
	if(customFields !== "")
		btn.setAttribute("customFields",customFields);
	var text = getParam(params,"text");
	if(text !== undefined)
		btn.setAttribute("newText",text);
	return btn;
};

config.macros.newTiddler.onClickNewTiddler = function()
{
	var title = this.getAttribute("newTitle");
	if(this.getAttribute("isJournal") == "true") {
		title = new Date().formatString(title.trim());
	}
	var params = this.getAttribute("params");
	var tags = params ? params.split("|") : [];
	var focus = this.getAttribute("newFocus");
	var template = this.getAttribute("newTemplate");
	var customFields = this.getAttribute("customFields");
	if(!customFields && !store.isShadowTiddler(title))
		customFields = String.encodeHashMap(config.defaultCustomFields);
	story.displayTiddler(null,title,template,false,null,null);
	var tiddlerElem = story.getTiddler(title);
	if(customFields)
		story.addCustomFields(tiddlerElem,customFields);
	var text = this.getAttribute("newText");
	if(typeof text == "string" && story.getTiddlerField(title,"text"))
		story.getTiddlerField(title,"text").value = text.format([title]);
	var t;
	for(t=0;t<tags.length;t++)
		story.setTiddlerTag(title,tags[t],+1);
	story.focusTiddler(title,focus);
	return false;
};

config.macros.newTiddler.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : this.title;
		title = getParam(params,"title",title);
		this.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"title",false);
	}
};

config.macros.newJournal.handler = function(place,macroName,params,wikifier,paramString)
{
	if(!readOnly) {
		params = paramString.parseParams("anon",null,true,false,false);
		var title = params[1] && params[1].name == "anon" ? params[1].value : config.macros.timeline.dateFormat;
		title = getParam(params,"title",title);
		config.macros.newTiddler.createNewTiddlerButton(place,title,params,this.label,this.prompt,this.accessKey,"text",true);
	}
};

//--
//-- Search macro
//--

config.macros.search.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	params = paramString.parseParams("anon",null,false,false,false);
	createTiddlyButton(place,this.label,this.prompt,this.onClick,"searchButton");
	var txt = createTiddlyElement(null,"input",null,"txtOptionInput searchField");
	txt.value = getParam(params,"anon","");
	if(config.browser.isSafari) {
		txt.setAttribute("type","search");
		txt.setAttribute("results","5");
	} else {
		txt.setAttribute("type","text");
	}
	place.appendChild(txt);
	txt.onkeyup = this.onKeyPress;
	txt.onfocus = this.onFocus;
	txt.setAttribute("size",this.sizeTextbox);
	txt.setAttribute("accessKey",getParam(params,"accesskey",this.accessKey));
	txt.setAttribute("autocomplete","off");
	txt.setAttribute("lastSearchText","");
	txt.setAttribute("placeholder",getParam(params,"placeholder",this.placeholder));
};

// Global because there's only ever one outstanding incremental search timer
config.macros.search.timeout = null;

config.macros.search.doSearch = function(txt)
{
	if(txt.value.length > 0) {
		story.search(txt.value,config.options.chkCaseSensitiveSearch,config.options.chkRegExpSearch);
		txt.setAttribute("lastSearchText",txt.value);
	}
};

config.macros.search.onClick = function(e)
{
	config.macros.search.doSearch(this.nextSibling);
	return false;
};

config.macros.search.onKeyPress = function(ev)
{
	var me = config.macros.search;
	var e = ev || window.event;
	switch(e.keyCode) {
		case 9: // Tab
			return;
		case 13: // Ctrl-Enter
		case 10: // Ctrl-Enter on IE PC
			me.doSearch(this);
			break;
		case 27: // Escape
			this.value = "";
			clearMessage();
			break;
	}
	if(config.options.chkIncrementalSearch) {
		if(this.value.length > 2) {
			if(this.value != this.getAttribute("lastSearchText")) {
				if(me.timeout) {
					clearTimeout(me.timeout);
				}
				var txt = this;
				me.timeout = setTimeout(function() {me.doSearch(txt);},500);
			}
		} else {
			if(me.timeout) {
				clearTimeout(me.timeout);
			}
		}
	}
};

config.macros.search.onFocus = function(e)
{
	this.select();
};

//--
//-- Tabs macro
//--

config.macros.tabs.handler = function(place,macroName,params)
{
	var cookie = params[0];
	var numTabs = (params.length-1)/3;
	var wrapper = createTiddlyElement(null,"div",null,"tabsetWrapper " + cookie);
	var tabset = createTiddlyElement(wrapper,"div",null,"tabset");
	tabset.setAttribute("cookie",cookie);
	var validTab = false;
	var t;
	for(t=0; t<numTabs; t++) {
		var label = params[t*3+1];
		var prompt = params[t*3+2];
		var content = params[t*3+3];
		var tab = createTiddlyButton(tabset,label,prompt,this.onClickTab,"tab tabUnselected");
		createTiddlyElement(tab,"span",null,null," ",{style:"font-size:0pt;line-height:0px"});
		tab.setAttribute("tab",label);
		tab.setAttribute("content",content);
		tab.title = prompt;
		if(config.options[cookie] == label)
			validTab = true;
	}
	if(!validTab)
		config.options[cookie] = params[1];
	place.appendChild(wrapper);
	this.switchTab(tabset,config.options[cookie]);
};

config.macros.tabs.onClickTab = function(e)
{
	config.macros.tabs.switchTab(this.parentNode,this.getAttribute("tab"));
	return false;
};

config.macros.tabs.switchTab = function(tabset,tab)
{
	var cookie = tabset.getAttribute("cookie");
	var theTab = null;
	var nodes = tabset.childNodes;
	var t;
	for(t=0; t<nodes.length; t++) {
		if(nodes[t].getAttribute && nodes[t].getAttribute("tab") == tab) {
			theTab = nodes[t];
			theTab.className = "tab tabSelected";
		} else {
			nodes[t].className = "tab tabUnselected";
		}
	}
	if(theTab) {
		if(tabset.nextSibling && tabset.nextSibling.className == "tabContents")
			jQuery(tabset.nextSibling).remove();
		var tabContent = createTiddlyElement(null,"div",null,"tabContents");
		tabset.parentNode.insertBefore(tabContent,tabset.nextSibling);
		var contentTitle = theTab.getAttribute("content");
		wikify(store.getTiddlerText(contentTitle),tabContent,null,store.getTiddler(contentTitle));
		if(cookie) {
			config.options[cookie] = tab;
			saveOption(cookie);
		}
	}
};

//--
//-- Tiddler toolbar
//--

// Create a toolbar command button
config.macros.toolbar.createCommand = function(place,commandName,tiddler,className)
{
	if(typeof commandName != "string") {
		var c = null;
		var t;
		for(t in config.commands) {
			if(config.commands[t] == commandName)
				c = t;
		}
		commandName = c;
	}
	if((tiddler instanceof Tiddler) && (typeof commandName == "string")) {
		var command = config.commands[commandName];
		if(command.isEnabled ? command.isEnabled(tiddler) : this.isCommandEnabled(command,tiddler)) {
			var text = command.getText ? command.getText(tiddler) : this.getCommandText(command,tiddler);
			var tooltip = command.getTooltip ? command.getTooltip(tiddler) : this.getCommandTooltip(command,tiddler);
			var cmd = command.type == "popup" ? this.onClickPopup : this.onClickCommand;
			var btn = createTiddlyButton(null,text,tooltip,cmd);
			btn.setAttribute("commandName",commandName);
			btn.setAttribute("tiddler",tiddler.title);
			jQuery(btn).addClass("command_" + commandName);
			if(className)
				jQuery(btn).addClass(className);
			place.appendChild(btn);
		}
	}
};

config.macros.toolbar.isCommandEnabled = function(command,tiddler)
{
	var title = tiddler.title;
	var ro = tiddler.isReadOnly();
	var shadow = store.isShadowTiddler(title) && !store.tiddlerExists(title);
	return (!ro || (ro && !command.hideReadOnly)) && !(shadow && command.hideShadow);
};

config.macros.toolbar.getCommandText = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyText) || command.text;
};

config.macros.toolbar.getCommandTooltip = function(command,tiddler)
{
	return (tiddler.isReadOnly() && command.readOnlyTooltip) || command.tooltip;
};

config.macros.toolbar.onClickCommand = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var command = config.commands[this.getAttribute("commandName")];
	return command.handler(e,this,this.getAttribute("tiddler"));
};

config.macros.toolbar.onClickPopup = function(ev)
{
	var e = ev || window.event;
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	var popup = Popup.create(this);
	var command = config.commands[this.getAttribute("commandName")];
	var title = this.getAttribute("tiddler");
	popup.setAttribute("tiddler",title);
	command.handlePopup(popup,title);
	Popup.show();
	return false;
};

// Invoke the first command encountered from a given place that is tagged with a specified class
config.macros.toolbar.invokeCommand = function(place,className,event)
{
	var children = place.getElementsByTagName("a");
	var t;
	for(t=0; t<children.length; t++) {
		var c = children[t];
		if(jQuery(c).hasClass(className) && c.getAttribute && c.getAttribute("commandName")) {
			if(c.onclick instanceof Function)
				c.onclick.call(c,event);
			break;
		}
	}
};

config.macros.toolbar.onClickMore = function(ev)
{
	var e = this.nextSibling;
	e.style.display = "inline";
	this.style.display = "none";
	return false;
};

config.macros.toolbar.onClickLess = function(ev)
{
	var e = this.parentNode;
	var m = e.previousSibling;
	e.style.display = "none";
	m.style.display = "inline";
	return false;
};

config.macros.toolbar.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	var t;
	for(t=0; t<params.length; t++) {
		var btn;
		var c = params[t];
		switch(c) {
		case "!":
			createTiddlyText(place,this.separator);
			break;
		case "*":
			createTiddlyElement(place,"br");
			break;
		case "<":
			btn = createTiddlyButton(place,this.lessLabel,this.lessPrompt,config.macros.toolbar.onClickLess);
			jQuery(btn).addClass("lessCommand");
			break;
		case ">":
			btn = createTiddlyButton(place,this.moreLabel,this.morePrompt,config.macros.toolbar.onClickMore);
			jQuery(btn).addClass("moreCommand");
			var e = createTiddlyElement(place,"span",null,"moreCommand");
			e.style.display = "none";
			place = e;
			break;
		default:
			var className = "";
			switch(c.substr(0,1)) {
			case "+":
				className = "defaultCommand";
				c = c.substr(1);
				break;
			case "-":
				className = "cancelCommand";
				c = c.substr(1);
				break;
			}
			if(config.commands[c]) {
				this.createCommand(place,c,tiddler,className);
			} else {
				this.customCommand(place,c,wikifier,tiddler);
			}
			break;
		}
	}
};

// Overrideable function to extend toolbar handler
config.macros.toolbar.customCommand = function(place,command,wikifier,tiddler)
{
};

//--
//-- Menu and toolbar commands
//--

config.commands.closeTiddler.handler = function(event,src,title)
{
	if(story.isDirty(title) && !readOnly) {
		if(!confirm(config.commands.cancelTiddler.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.closeTiddler(title,true);
	return false;
};

config.commands.closeOthers.handler = function(event,src,title)
{
	story.closeAllTiddlers(title);
	return false;
};

config.commands.editTiddler.handler = function(event,src,title)
{
	clearMessage();
	var tiddlerElem = story.getTiddler(title);
	var fields = tiddlerElem.getAttribute("tiddlyFields");
	story.displayTiddler(null,title,DEFAULT_EDIT_TEMPLATE,false,null,fields);
	var e = story.getTiddlerField(title,config.options.txtEditorFocus||"text");
	if(e) {
		setCaretPosition(e,0);
	}
	return false;
};

config.commands.saveTiddler.handler = function(event,src,title)
{
	var newTitle = story.saveTiddler(title,event.shiftKey);
	if(newTitle)
		story.displayTiddler(null,newTitle);
	return false;
};

config.commands.cancelTiddler.handler = function(event,src,title)
{
	if(story.hasChanges(title) && !readOnly) {
		if(!confirm(this.warning.format([title])))
			return false;
	}
	story.setDirty(title,false);
	story.displayTiddler(null,title);
	return false;
};

config.commands.deleteTiddler.handler = function(event,src,title)
{
	var deleteIt = true;
	if(config.options.chkConfirmDelete)
		deleteIt = confirm(this.warning.format([title]));
	if(deleteIt) {
		store.removeTiddler(title);
		story.closeTiddler(title,true);
		autoSaveChanges();
	}
	return false;
};

config.commands.permalink.handler = function(event,src,title)
{
	var t = encodeURIComponent(String.encodeTiddlyLink(title));
	if(window.location.hash != t)
		window.location.hash = t;
	return false;
};

config.commands.references.handlePopup = function(popup,title)
{
	var references = store.getReferringTiddlers(title);
	var c = false;
	var r;
	for(r=0; r<references.length; r++) {
		if(references[r].title != title && !references[r].isTagged("excludeLists")) {
			createTiddlyLink(createTiddlyElement(popup,"li"),references[r].title,true);
			c = true;
		}
	}
	if(!c)
		createTiddlyElement(popup,"li",null,"disabled",this.popupNone);
};

config.commands.jump.handlePopup = function(popup,title)
{
	story.forEachTiddler(function(title,element) {
		createTiddlyLink(createTiddlyElement(popup,"li"),title,true,null,false,null,true);
		});
};

config.commands.fields.handlePopup = function(popup,title)
{
	var tiddler = store.fetchTiddler(title);
	if(!tiddler)
		return;
	var items = [];
	store.forEachField(tiddler,function(tiddler,fieldName,value){items.push({field:fieldName,value:value});},true);
	items.sort(function(a,b) {return a.field < b.field ? -1 : (a.field == b.field ? 0 : +1);});
	if(items.length > 0)
		ListView.create(popup,items,this.listViewTemplate);
	else
		createTiddlyElement(popup,"div",null,null,this.emptyText);
};

//--
//-- Tiddler() object
//--

function Tiddler(title)
{
	this.title = title;
	this.text = "";
	this.creator = null;
	this.modifier = null;
	this.created = new Date();
	this.modified = this.created;
	this.links = [];
	this.linksUpdated = false;
	this.tags = [];
	this.fields = {};
	return this;
}

Tiddler.prototype.getLinks = function()
{
	if(this.linksUpdated==false)
		this.changed();
	return this.links;
};

// Returns the fields that are inherited in string field:"value" field2:"value2" format
Tiddler.prototype.getInheritedFields = function()
{
	var f = {};
	var i;
	for(i in this.fields) {
		if(i=="server.host" || i=="server.workspace" || i=="wikiformat"|| i=="server.type") {
			f[i] = this.fields[i];
		}
	}
	return String.encodeHashMap(f);
};

// Increment the changeCount of a tiddler
Tiddler.prototype.incChangeCount = function()
{
	var c = this.fields['changecount'];
	c = c ? parseInt(c,10) : 0;
	this.fields['changecount'] = String(c+1);
};

// Clear the changeCount of a tiddler
Tiddler.prototype.clearChangeCount = function()
{
	if(this.fields['changecount']) {
		delete this.fields['changecount'];
	}
};

Tiddler.prototype.doNotSave = function()
{
	return this.fields['doNotSave'];
};

// Returns true if the tiddler has been updated since the tiddler was created or downloaded
Tiddler.prototype.isTouched = function()
{
	var changecount = this.fields.changecount || 0;
	return changecount > 0;
};

// Change the text and other attributes of a tiddler
Tiddler.prototype.set = function(title,text,modifier,modified,tags,created,fields,creator)
{
	this.assign(title,text,modifier,modified,tags,created,fields,creator);
	this.changed();
	return this;
};

// Change the text and other attributes of a tiddler without triggered a tiddler.changed() call
Tiddler.prototype.assign = function(title,text,modifier,modified,tags,created,fields,creator)
{
	if(title != undefined)
		this.title = title;
	if(text != undefined)
		this.text = text;
	if(modifier != undefined)
		this.modifier = modifier;
	if(modified != undefined)
		this.modified = modified;
	if(creator != undefined)
		this.creator = creator;
	if(created != undefined)
		this.created = created;
	if(fields != undefined)
		this.fields = fields;
	if(tags != undefined)
		this.tags = (typeof tags == "string") ? tags.readBracketedList() : tags;
	else if(this.tags == undefined)
		this.tags = [];
	return this;
};

// Get the tags for a tiddler as a string (space delimited, using [[brackets]] for tags containing spaces)
Tiddler.prototype.getTags = function()
{
	return String.encodeTiddlyLinkList(this.tags);
};

// Test if a tiddler carries a tag
Tiddler.prototype.isTagged = function(tag)
{
	return this.tags.indexOf(tag) != -1;
};

// Static method to convert "\n" to newlines, "\s" to "\"
Tiddler.unescapeLineBreaks = function(text)
{
	return text ? text.unescapeLineBreaks() : "";
};

// Convert newlines to "\n", "\" to "\s"
Tiddler.prototype.escapeLineBreaks = function()
{
	return this.text.escapeLineBreaks();
};

// Updates the secondary information (like links[] array) after a change to a tiddler
Tiddler.prototype.changed = function()
{
	this.links = [];
	var text = this.text;
	// remove 'quoted' text before scanning tiddler source
	text = text.replace(/\/%((?:.|\n)*?)%\//g,"").
		replace(/\{{3}((?:.|\n)*?)\}{3}/g,"").
		replace(/"""((?:.|\n)*?)"""/g,"").
		replace(/<nowiki\>((?:.|\n)*?)<\/nowiki\>/g,"").
		replace(/<html\>((?:.|\n)*?)<\/html\>/g,"").
		replace(/<script((?:.|\n)*?)<\/script\>/g,"");
	var t = this.autoLinkWikiWords() ? 0 : 1;
	var tiddlerLinkRegExp = t==0 ? config.textPrimitives.tiddlerAnyLinkRegExp : config.textPrimitives.tiddlerForcedLinkRegExp;
	tiddlerLinkRegExp.lastIndex = 0;
	var formatMatch = tiddlerLinkRegExp.exec(text);
	while(formatMatch) {
		var lastIndex = tiddlerLinkRegExp.lastIndex;
		if(t==0 && formatMatch[1] && formatMatch[1] != this.title) {
			// wikiWordLink
			if(formatMatch.index > 0) {
				var preRegExp = new RegExp(config.textPrimitives.unWikiLink+"|"+config.textPrimitives.anyLetter,"mg");
				preRegExp.lastIndex = formatMatch.index-1;
				var preMatch = preRegExp.exec(text);
				if(preMatch.index != formatMatch.index-1)
					this.links.pushUnique(formatMatch[1]);
			} else {
				this.links.pushUnique(formatMatch[1]);
			}
		}
		else if(formatMatch[2-t] && !config.formatterHelpers.isExternalLink(formatMatch[3-t])) // titledBrackettedLink
			this.links.pushUnique(formatMatch[3-t]);
		else if(formatMatch[4-t] && formatMatch[4-t] != this.title) // brackettedLink
			this.links.pushUnique(formatMatch[4-t]);
		tiddlerLinkRegExp.lastIndex = lastIndex;
		formatMatch = tiddlerLinkRegExp.exec(text);
	}
	this.linksUpdated = true;
};

Tiddler.prototype.getSubtitle = function()
{
	var modifier = this.modifier;
	if(!modifier)
		modifier = config.messages.subtitleUnknown || "";
	var modified = this.modified;
	if(modified)
		modified = modified.toLocaleString();
	else
		modified = config.messages.subtitleUnknown || "";
	var f = config.messages.tiddlerLinkTooltip || "%0 - %1, %2";
	return f.format([this.title,modifier,modified]);
};

Tiddler.prototype.isReadOnly = function()
{
	return readOnly;
};

Tiddler.prototype.autoLinkWikiWords = function()
{
	return !(this.isTagged("systemConfig") || this.isTagged("excludeMissing"));
};

Tiddler.prototype.getServerType = function()
{
	var serverType = null;
	if(this.fields['server.type'])
		serverType = this.fields['server.type'];
	if(!serverType)
		serverType = this.fields['wikiformat'];
	if(serverType && !config.adaptors[serverType])
		serverType = null;
	return serverType;
};

Tiddler.prototype.getAdaptor = function()
{
	var serverType = this.getServerType();
	return serverType ? new config.adaptors[serverType]() : null;
};

//--
//-- TiddlyWiki instance contains TiddlerS
//--

function TiddlyWiki(params)
{
	var tiddlers = {}; // Hashmap by name of tiddlers
	if(params && params.config) {
		this.config = config;
	}
	this.tiddlersUpdated = false;
	this.namedNotifications = []; // Array of {name:,notify:} of notification functions
	this.notificationLevel = 0;
	this.slices = {}; // map tiddlerName->(map sliceName->sliceValue). Lazy.
	this.clear = function() {
		tiddlers = {};
		this.setDirty(false);
	};
	this.fetchTiddler = function(title) {
		var t = tiddlers[title];
		return t instanceof Tiddler ? t : null;
	};
	this.deleteTiddler = function(title) {
		delete this.slices[title];
		delete tiddlers[title];
	};
	this.addTiddler = function(tiddler) {
		delete this.slices[tiddler.title];
		tiddlers[tiddler.title] = tiddler;
	};
	this.forEachTiddler = function(callback) {
		var t;
		for(t in tiddlers) {
			var tiddler = tiddlers[t];
			if(tiddler instanceof Tiddler)
				callback.call(this,t,tiddler);
		}
	};
}

TiddlyWiki.prototype.setDirty = function(dirty)
{
	this.dirty = dirty;
};

TiddlyWiki.prototype.isDirty = function()
{
	return this.dirty;
};

TiddlyWiki.prototype.tiddlerExists = function(title)
{
	var t = this.fetchTiddler(title);
	return t != undefined;
};

TiddlyWiki.prototype.isShadowTiddler = function(title)
{
	return config.shadowTiddlers[title] === undefined ? false : true;
};

TiddlyWiki.prototype.isAvailable = function(title) {
	if (!title)
		return false;
	var s = title ? title.indexOf(config.textPrimitives.sectionSeparator) : -1;
	if(s!=-1)
		title = title.substr(0,s);
	return this.tiddlerExists(title) || this.isShadowTiddler(title);
};

TiddlyWiki.prototype.createTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler) {
		tiddler = new Tiddler(title);
		this.addTiddler(tiddler);
		this.setDirty(true);
	}
	return tiddler;
};

TiddlyWiki.prototype.getTiddler = function(title)
{
	var t = this.fetchTiddler(title);
	if(t != undefined)
		return t;
	else
		return null;
};

TiddlyWiki.prototype.getShadowTiddlerText = function(title)
{
	if(typeof config.shadowTiddlers[title] == "string")
		return config.shadowTiddlers[title];
	else
		return "";
};

// Retrieve tiddler contents
TiddlyWiki.prototype.getTiddlerText = function(title,defaultText)
{
	if(!title)
		return defaultText;
	var pos = title.indexOf(config.textPrimitives.sectionSeparator);
	var section = null;
	if(pos != -1) {
		section = title.substr(pos + config.textPrimitives.sectionSeparator.length);
		title = title.substr(0,pos);
	}
	pos = title.indexOf(config.textPrimitives.sliceSeparator);
	if(pos != -1) {
		var slice = this.getTiddlerSlice(title.substr(0,pos),title.substr(pos + config.textPrimitives.sliceSeparator.length));
		if(slice)
			return slice;
	}
	var tiddler = this.fetchTiddler(title);
	var text = tiddler ? tiddler.text : null;
	if(!tiddler && this.isShadowTiddler(title)) {
		text = this.getShadowTiddlerText(title);
	}
	if(text) {
		if(!section)
			return text;
		var re = new RegExp("(^!{1,6}[ \t]*" + section.escapeRegExp() + "[ \t]*\n)","mg");
		re.lastIndex = 0;
		var match = re.exec(text);
		if(match) {
			var t = text.substr(match.index+match[1].length);
			var re2 = /^!/mg;
			re2.lastIndex = 0;
			match = re2.exec(t); //# search for the next heading
			if(match)
				t = t.substr(0,match.index-1);//# don't include final \n
			return t;
		}
		return defaultText;
	}
	if(defaultText != undefined)
		return defaultText;
	return null;
};

TiddlyWiki.prototype.getRecursiveTiddlerText = function(title,defaultText,depth)
{
	var bracketRegExp = new RegExp("(?:\\[\\[([^\\]]+)\\]\\])","mg");
	var text = this.getTiddlerText(title,null);
	if(text == null)
		return defaultText;
	var textOut = [];
	var match,lastPos = 0;
	do {
		match = bracketRegExp.exec(text);
		if(match) {
			textOut.push(text.substr(lastPos,match.index-lastPos));
			if(match[1]) {
				if(depth <= 0)
					textOut.push(match[1]);
				else
					textOut.push(this.getRecursiveTiddlerText(match[1],"",depth-1));
			}
			lastPos = match.index + match[0].length;
		} else {
			textOut.push(text.substr(lastPos));
		}
	} while(match);
	return textOut.join("");
};

//TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]+)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\n]+)[\t\x20]*\|$)/gm;
TiddlyWiki.prototype.slicesRE = /(?:^([\'\/]{0,2})~?([\.\w]+)\:\1[\t\x20]*([^\n]*)[\t\x20]*$)|(?:^\|([\'\/]{0,2})~?([\.\w]+)\:?\4\|[\t\x20]*([^\|\n]*)[\t\x20]*\|$)/gm;
// @internal
TiddlyWiki.prototype.calcAllSlices = function(title)
{
	var slices = {};
	var text = this.getTiddlerText(title,"");
	this.slicesRE.lastIndex = 0;
	var m = this.slicesRE.exec(text);
	while(m) {
		if(m[2])
			slices[m[2]] = m[3];
		else
			slices[m[5]] = m[6];
		m = this.slicesRE.exec(text);
	}
	return slices;
};

// Returns the slice of text of the given name
TiddlyWiki.prototype.getTiddlerSlice = function(title,sliceName)
{
	var slices = this.slices[title];
	if(!slices) {
		slices = this.calcAllSlices(title);
		this.slices[title] = slices;
	}
	return slices[sliceName];
};

// Build an hashmap of the specified named slices of a tiddler
TiddlyWiki.prototype.getTiddlerSlices = function(title,sliceNames)
{
	var t,r = {};
	for(t=0; t<sliceNames.length; t++) {
		var slice = this.getTiddlerSlice(title,sliceNames[t]);
		if(slice)
			r[sliceNames[t]] = slice;
	}
	return r;
};

TiddlyWiki.prototype.suspendNotifications = function()
{
	this.notificationLevel--;
};

TiddlyWiki.prototype.resumeNotifications = function()
{
	this.notificationLevel++;
};

// Invoke the notification handlers for a particular tiddler
TiddlyWiki.prototype.notify = function(title,doBlanket)
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if((n.name == null && doBlanket) || (n.name == title))
				n.notify(title);
		}
	}
};

// Invoke the notification handlers for all tiddlers
TiddlyWiki.prototype.notifyAll = function()
{
	if(!this.notificationLevel) {
	    var t;
		for(t=0; t<this.namedNotifications.length; t++) {
			var n = this.namedNotifications[t];
			if(n.name)
				n.notify(n.name);
		}
	}
};

// Add a notification handler to a tiddler
TiddlyWiki.prototype.addNotification = function(title,fn)
{
	var i;
	for(i=0; i<this.namedNotifications.length; i++) {
		if((this.namedNotifications[i].name == title) && (this.namedNotifications[i].notify == fn))
			return this;
	}
	this.namedNotifications.push({name: title, notify: fn});
	return this;
};

TiddlyWiki.prototype.removeTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		this.deleteTiddler(title);
		this.notify(title,true);
		this.setDirty(true);
	}
};

// Reset the sync status of a freshly synced tiddler
TiddlyWiki.prototype.resetTiddler = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		tiddler.clearChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.setTiddlerTag = function(title,status,tag)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler) {
		var t = tiddler.tags.indexOf(tag);
		if(t != -1)
			tiddler.tags.splice(t,1);
		if(status)
			tiddler.tags.push(tag);
		tiddler.changed();
		tiddler.incChangeCount();
		this.notify(title,true);
		this.setDirty(true);
	}
};

TiddlyWiki.prototype.addTiddlerFields = function(title,fields)
{
	var tiddler = this.fetchTiddler(title);
	if(!tiddler)
		return;
	merge(tiddler.fields,fields);
	tiddler.changed();
	tiddler.incChangeCount();
	this.notify(title,true);
	this.setDirty(true);
};

// Store tiddler in TiddlyWiki instance
TiddlyWiki.prototype.saveTiddler = function(title,newTitle,newBody,modifier,modified,tags,fields,clearChangeCount,created,creator)
{
	var tiddler;
	if(title instanceof Tiddler) {
		tiddler = title;
		tiddler.fields = merge(merge({},tiddler.fields),config.defaultCustomFields,true);
		title = tiddler.title;
		newTitle = title;
	} else {
		tiddler = this.fetchTiddler(title);
		if(tiddler) {
			created = created || tiddler.created; // Preserve created date
			creator = creator || tiddler.creator;
			this.deleteTiddler(title);
		} else {
			created = created || modified;
			tiddler = new Tiddler();
		}
		fields = merge(merge({},fields),config.defaultCustomFields,true);
		tiddler.set(newTitle,newBody,modifier,modified,tags,created,fields,creator);
	}
	this.addTiddler(tiddler);
	if(clearChangeCount)
		tiddler.clearChangeCount();
	else
		tiddler.incChangeCount();
	if(title != newTitle)
		this.notify(title,true);
	this.notify(newTitle,true);
	this.setDirty(true);
	return tiddler;
};

TiddlyWiki.prototype.incChangeCount = function(title)
{
	var tiddler = this.fetchTiddler(title);
	if(tiddler)
		tiddler.incChangeCount();
};

TiddlyWiki.prototype.getLoader = function()
{
	if(!this.loader)
		this.loader = new TW21Loader();
	return this.loader;
};

TiddlyWiki.prototype.getSaver = function()
{
	if(!this.saver)
		this.saver = new TW21Saver();
	return this.saver;
};

// Return all tiddlers formatted as an HTML string
TiddlyWiki.prototype.allTiddlersAsHtml = function()
{
	return this.getSaver().externalize(store);
};

// Load contents of a TiddlyWiki from an HTML DIV
TiddlyWiki.prototype.loadFromDiv = function(src,idPrefix,noUpdate)
{
	this.idPrefix = idPrefix;
	var storeElem = (typeof src == "string") ? document.getElementById(src) : src;
	if(!storeElem)
		return;
	var tiddlers = this.getLoader().loadTiddlers(this,storeElem.childNodes);
	this.setDirty(false);
	if(!noUpdate) {
		var i;
		for(i = 0;i<tiddlers.length; i++)
			tiddlers[i].changed();
	}
	jQuery(document).trigger("loadTiddlers");
};

// Load contents of a TiddlyWiki from a string
// Returns null if there's an error
TiddlyWiki.prototype.importTiddlyWiki = function(text)
{
	var posDiv = locateStoreArea(text);
	if(!posDiv)
		return null;
	var content = "<" + "html><" + "body>" + text.substring(posDiv[0],posDiv[1] + endSaveArea.length) + "<" + "/body><" + "/html>";
	// Create the iframe
	var iframe = document.createElement("iframe");
	iframe.style.display = "none";
	document.body.appendChild(iframe);
	var doc = iframe.document;
	if(iframe.contentDocument)
		doc = iframe.contentDocument; // For NS6
	else if(iframe.contentWindow)
		doc = iframe.contentWindow.document; // For IE5.5 and IE6
	// Put the content in the iframe
	doc.open();
	doc.writeln(content);
	doc.close();
	// Load the content into a TiddlyWiki() object
	var storeArea = doc.getElementById("storeArea");
	this.loadFromDiv(storeArea,"store");
	// Get rid of the iframe
	iframe.parentNode.removeChild(iframe);
	return this;
};

TiddlyWiki.prototype.updateTiddlers = function()
{
	this.tiddlersUpdated = true;
	this.forEachTiddler(function(title,tiddler) {
		tiddler.changed();
	});
};

// Return an array of tiddlers matching a search regular expression
TiddlyWiki.prototype.search = function(searchRegExp,sortField,excludeTag,match)
{
	var candidates = this.reverseLookup("tags",excludeTag,!!match);
	var t,results = [];
	for(t=0; t<candidates.length; t++) {
		if((candidates[t].title.search(searchRegExp) != -1) || (candidates[t].text.search(searchRegExp) != -1))
			results.push(candidates[t]);
	}
	if(!sortField)
		sortField = "title";
	results.sort(function(a,b) {return a[sortField] < b[sortField] ? -1 : (a[sortField] == b[sortField] ? 0 : +1);});
	return results;
};

// Returns a list of all tags in use
//   excludeTag - if present, excludes tags that are themselves tagged with excludeTag
// Returns an array of arrays where [tag][0] is the name of the tag and [tag][1] is the number of occurances
TiddlyWiki.prototype.getTags = function(excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
	    var g,c;
		for(g=0; g<tiddler.tags.length; g++) {
			var tag = tiddler.tags[g];
			var n = true;
			for(c=0; c<results.length; c++) {
				if(results[c][0] == tag) {
					n = false;
					results[c][1]++;
				}
			}
			if(n && excludeTag) {
				var t = this.fetchTiddler(tag);
				if(t && t.isTagged(excludeTag))
					n = false;
			}
			if(n)
				results.push([tag,1]);
		}
	});
	results.sort(function(a,b) {return a[0].toLowerCase() < b[0].toLowerCase() ? -1 : (a[0].toLowerCase() == b[0].toLowerCase() ? 0 : +1);});
	return results;
};

// Return an array of the tiddlers that are tagged with a given tag
TiddlyWiki.prototype.getTaggedTiddlers = function(tag,sortField)
{
	return this.reverseLookup("tags",tag,true,sortField);
};

TiddlyWiki.prototype.getValueTiddlers = function(field,value,sortField)
{
	return this.reverseLookup(field,value,true,sortField);
};

// Return an array of the tiddlers that link to a given tiddler
TiddlyWiki.prototype.getReferringTiddlers = function(title,unusedParameter,sortField)
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	return this.reverseLookup("links",title,true,sortField);
};

// Return an array of the tiddlers that do or do not have a specified entry in the specified storage array (ie, "links" or "tags")
// lookupMatch == true to match tiddlers, false to exclude tiddlers
TiddlyWiki.prototype.reverseLookup = function(lookupField,lookupValue,lookupMatch,sortField)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		var f = !lookupMatch;
		var values;
		if(["links", "tags"].contains(lookupField)) {
			values = tiddler[lookupField];
		} else {
			var accessor = TiddlyWiki.standardFieldAccess[lookupField];
			if(accessor) {
				values = [ accessor.get(tiddler) ];
			} else {
				values = tiddler.fields[lookupField] ? [tiddler.fields[lookupField]] : [];
			}
		}
		var lookup;
		for(lookup=0; lookup<values.length; lookup++) {
			if(values[lookup] == lookupValue)
				f = lookupMatch;
		}
		if(f)
			results.push(tiddler);
	});
	if(!sortField)
		sortField = "title";
	return this.sortTiddlers(results,sortField);
};

// Return the tiddlers as a sorted array
TiddlyWiki.prototype.getTiddlers = function(field,excludeTag)
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(excludeTag == undefined || !tiddler.isTagged(excludeTag))
			results.push(tiddler);
	});
	if(field)
		results.sort(function(a,b) {return a[field] < b[field] ? -1 : (a[field] == b[field] ? 0 : +1);});
	return results;
};

// Return array of names of tiddlers that are referred to but not defined
TiddlyWiki.prototype.getMissingLinks = function()
{
	if(!this.tiddlersUpdated)
		this.updateTiddlers();
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(tiddler.isTagged("excludeMissing") || tiddler.isTagged("systemConfig"))
			return;
		var n;
		for(n=0; n<tiddler.links.length;n++) {
			var link = tiddler.links[n];
			if(this.getTiddlerText(link,null) == null && !this.isShadowTiddler(link) && !config.macros[link])
				results.pushUnique(link);
		}
	});
	results.sort();
	return results;
};

// Return an array of names of tiddlers that are defined but not referred to
TiddlyWiki.prototype.getOrphans = function()
{
	var results = [];
	this.forEachTiddler(function (title,tiddler) {
		if(this.getReferringTiddlers(title).length == 0 && !tiddler.isTagged("excludeLists"))
			results.push(title);
	});
	results.sort();
	return results;
};

// Return an array of names of all the shadow tiddlers
TiddlyWiki.prototype.getShadowed = function()
{
	var t,results = [];
	for(t in config.shadowTiddlers) {
		if(this.isShadowTiddler(t))
			results.push(t);
	}
	results.sort();
	return results;
};

// Return an array of tiddlers that have been touched since they were downloaded or created
TiddlyWiki.prototype.getTouched = function()
{
	var results = [];
	this.forEachTiddler(function(title,tiddler) {
		if(tiddler.isTouched())
			results.push(tiddler);
		});
	results.sort();
	return results;
};

// Resolves a Tiddler reference or tiddler title into a Tiddler object, or null if it doesn't exist
TiddlyWiki.prototype.resolveTiddler = function(tiddler)
{
	var t = (typeof tiddler == "string") ? this.getTiddler(tiddler) : tiddler;
	return t instanceof Tiddler ? t : null;
};

// Sort a list of tiddlers
TiddlyWiki.prototype.sortTiddlers = function(tiddlers,field)
{
	var asc = +1;
	switch(field.substr(0,1)) {
	case "-":
		asc = -1;
		field = field.substr(1);
		break;
	case "+":
		field = field.substr(1);
		break;
	}
	if(TiddlyWiki.standardFieldAccess[field]) {
		if(field=="title") {
			tiddlers.sort(function(a,b) {return a[field].toLowerCase() < b[field].toLowerCase() ? -asc : (a[field].toLowerCase() == b[field].toLowerCase() ? 0 : asc);});
		} else {
			tiddlers.sort(function(a,b) {return a[field] < b[field] ? -asc : (a[field] == b[field] ? 0 : asc);});
		}
	} else {
		tiddlers.sort(function(a,b) {return a.fields[field] < b.fields[field] ? -asc : (a.fields[field] == b.fields[field] ? 0 : +asc);});
	}
	return tiddlers;
};

//--
//-- Filter a list of tiddlers
//--

config.filters = {
	tiddler: function(results,match) {
		var title = match[1]||match[4];
		var tiddler = this.fetchTiddler(title);
		if(tiddler) {
			results.pushUnique(tiddler);
		} else if(this.isShadowTiddler(title)) {
			tiddler = new Tiddler();
			tiddler.set(title,this.getTiddlerText(title));
			results.pushUnique(tiddler);
		} else {
			results.pushUnique(new Tiddler(title));
		}
		return results;
	},
	tag: function(results,match) {
		var m,matched = this.getTaggedTiddlers(match[3]);
		for(m=0; m<matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	},
	sort: function(results,match) {
		return this.sortTiddlers(results,match[3]);
	},
	limit: function(results,match) {
		return results.slice(0,parseInt(match[3],10));
	},
	field: function(results,match) {
		var m,matched = this.getValueTiddlers(match[2],match[3]);
		for (m = 0; m < matched.length; m++) {
			results.pushUnique(matched[m]);
		}
		return results;
	}
};

// Filter a list of tiddlers
TiddlyWiki.prototype.filterTiddlers = function(filter)
{
	var re = /([^\s\[\]]+)|(?:\[([ \w\.\-]+)\[([^\]]+)\]\])|(?:\[\[([^\]]+)\]\])/mg;

	var results = [];
	if(filter) {
		var match = re.exec(filter);
		while(match) {
			var handler = (match[1]||match[4])?'tiddler':config.filters[match[2]]?match[2]:'field';
			results = config.filters[handler].call(this,results,match);
			match = re.exec(filter);
		}
	}
	return results;
};
// Returns true if path is a valid field name (path),
// i.e. a sequence of identifiers, separated by "."
TiddlyWiki.isValidFieldName = function(name)
{
	var match = /[a-zA-Z_]\w*(\.[a-zA-Z_]\w*)*/.exec(name);
	return match && (match[0] == name);
};

// Throws an exception when name is not a valid field name.
TiddlyWiki.checkFieldName = function(name)
{
	if(!TiddlyWiki.isValidFieldName(name))
		throw config.messages.invalidFieldName.format([name]);
};

function StringFieldAccess(n,readOnly)
{
	this.set = readOnly ?
			function(t,v) {if(v != t[n]) throw config.messages.fieldCannotBeChanged.format([n]);} :
			function(t,v) {if(v != t[n]) {t[n] = v; return true;}};
	this.get = function(t) {return t[n];};
}

function DateFieldAccess(n)
{
	this.set = function(t,v) {
		var d = v instanceof Date ? v : Date.convertFromYYYYMMDDHHMM(v);
		if(d != t[n]) {
			t[n] = d; return true;
		}
	};
	this.get = function(t) {return t[n].convertToYYYYMMDDHHMM();};
}

function LinksFieldAccess(n)
{
	this.set = function(t,v) {
		var s = (typeof v == "string") ? v.readBracketedList() : v;
		if(s.toString() != t[n].toString()) {
			t[n] = s; return true;
		}
	};
	this.get = function(t) {return String.encodeTiddlyLinkList(t[n]);};
}

TiddlyWiki.standardFieldAccess = {
	// The set functions return true when setting the data has changed the value.
	"title":    new StringFieldAccess("title",true),
	// Handle the "tiddler" field name as the title
	"tiddler":  new StringFieldAccess("title",true),
	"text":     new StringFieldAccess("text"),
	"modifier": new StringFieldAccess("modifier"),
	"modified": new DateFieldAccess("modified"),
	"creator":  new StringFieldAccess("creator"),
	"created":  new DateFieldAccess("created"),
	"tags":     new LinksFieldAccess("tags")
};

TiddlyWiki.isStandardField = function(name)
{
	return TiddlyWiki.standardFieldAccess[name] != undefined;
};

// Sets the value of the given field of the tiddler to the value.
// Setting an ExtendedField's value to null or undefined removes the field.
// Setting a namespace to undefined removes all fields of that namespace.
// The fieldName is case-insensitive.
// All values will be converted to a string value.
TiddlyWiki.prototype.setValue = function(tiddler,fieldName,value)
{
	TiddlyWiki.checkFieldName(fieldName);
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return;
	fieldName = fieldName.toLowerCase();
	var isRemove = (value === undefined) || (value === null);
	var accessor = TiddlyWiki.standardFieldAccess[fieldName];
	if(accessor) {
		if(isRemove)
			// don't remove StandardFields
			return;
		var h = TiddlyWiki.standardFieldAccess[fieldName];
		if(!h.set(t,value))
			return;
	} else {
		var oldValue = t.fields[fieldName];
		if(isRemove) {
			if(oldValue !== undefined) {
				// deletes a single field
				delete t.fields[fieldName];
			} else {
				// no concrete value is defined for the fieldName
				// so we guess this is a namespace path.
				// delete all fields in a namespace
				var re = new RegExp("^"+fieldName+"\\.");
				var dirty = false;
				var n;
				for(n in t.fields) {
					if(n.match(re)) {
						delete t.fields[n];
						dirty = true;
					}
				}
				if(!dirty)
					return;
			}
		} else {
			// the "normal" set case. value is defined (not null/undefined)
			// For convenience provide a nicer conversion Date->String
			value = value instanceof Date ? value.convertToYYYYMMDDHHMMSSMMM() : String(value);
			if(oldValue == value)
				return;
			t.fields[fieldName] = value;
		}
	}
	// When we are here the tiddler/store really was changed.
	this.notify(t.title,true);
	if(!fieldName.match(/^temp\./))
		this.setDirty(true);
};

// Returns the value of the given field of the tiddler.
// The fieldName is case-insensitive.
// Will only return String values (or undefined).
TiddlyWiki.prototype.getValue = function(tiddler,fieldName)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	if(fieldName.indexOf(config.textPrimitives.sectionSeparator) === 0 || fieldName.indexOf(config.textPrimitives.sliceSeparator) === 0) {
		var sliceType = fieldName.substr(0, 2);
		var sliceName = fieldName.substring(2);
		return store.getTiddlerText("%0%1%2".format(t.title,sliceType,sliceName));
	} else {
		fieldName = fieldName.toLowerCase();
		var accessor = TiddlyWiki.standardFieldAccess[fieldName];
		if(accessor) {
			return accessor.get(t);
		}
	}
	return t.fields[fieldName];
};

// Calls the callback function for every field in the tiddler.
// When callback function returns a non-false value the iteration stops
// and that value is returned.
// The order of the fields is not defined.
// @param callback a function(tiddler,fieldName,value).
TiddlyWiki.prototype.forEachField = function(tiddler,callback,onlyExtendedFields)
{
	var t = this.resolveTiddler(tiddler);
	if(!t)
		return undefined;
	var n,result;
	for(n in t.fields) {
		result = callback(t,n,t.fields[n]);
		if(result)
			return result;
		}
	if(onlyExtendedFields)
		return undefined;
	for(n in TiddlyWiki.standardFieldAccess) {
		if(n != "tiddler") {
			// even though the "title" field can also be referenced through the name "tiddler"
			// we only visit this field once.
			result = callback(t,n,TiddlyWiki.standardFieldAccess[n].get(t));
			if(result)
				return result;
		}
	}
	return undefined;
};

//--
//-- Story functions
//--

function Story(containerId,idPrefix)
{
	this.container = containerId;
	this.idPrefix = idPrefix;
	this.highlightRegExp = null;
	this.tiddlerId = function(title) {
		title = title.replace(/_/g, "__").replace(/ /g, "_");
		var id = this.idPrefix + title;
		return id==this.container ? this.idPrefix + "_" + title : id;
	};
	this.containerId = function() {
		return this.container;
	};
}

Story.prototype.getTiddler = function(title)
{
	return document.getElementById(this.tiddlerId(title));
};

Story.prototype.getContainer = function()
{
	return document.getElementById(this.containerId());
};

Story.prototype.forEachTiddler = function(fn)
{
	var place = this.getContainer();
	if(!place)
		return;
	var e = place.firstChild;
	while(e) {
		var n = e.nextSibling;
		var title = e.getAttribute("tiddler");
		if(title) {
			fn.call(this,title,e);
		}
		e = n;
	}
};

Story.prototype.displayDefaultTiddlers = function()
{
	this.displayTiddlers(null,store.filterTiddlers(store.getTiddlerText("DefaultTiddlers")));
};

Story.prototype.displayTiddlers = function(srcElement,titles,template,animate,unused,customFields,toggle)
{
	var t;
	for(t = titles.length-1;t>=0;t--)
		this.displayTiddler(srcElement,titles[t],template,animate,unused,customFields);
};

Story.prototype.displayTiddler = function(srcElement,tiddler,template,animate,unused,customFields,toggle,animationSrc)
{
	var title = (tiddler instanceof Tiddler) ? tiddler.title : tiddler;
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(toggle) {
			if(tiddlerElem.getAttribute("dirty") != "true")
				this.closeTiddler(title,true);
		} else {
			this.refreshTiddler(title,template,false,customFields);
		}
	} else {
		var place = this.getContainer();
		var before = this.positionTiddler(srcElement);
		tiddlerElem = this.createTiddler(place,before,title,template,customFields);
	}
	if(animationSrc && typeof animationSrc !== "string") {
		srcElement = animationSrc;
	}
	if(srcElement && typeof srcElement !== "string") {
		if(config.options.chkAnimate && (animate == undefined || animate == true) && anim && typeof Zoomer == "function" && typeof Scroller == "function")
			anim.startAnimating(new Zoomer(title,srcElement,tiddlerElem),new Scroller(tiddlerElem));
		else
			window.scrollTo(0,ensureVisible(tiddlerElem));
	}
	return tiddlerElem;
};

Story.prototype.positionTiddler = function(srcElement)
{
	var place = this.getContainer();
	var before = null;
	if(typeof srcElement == "string") {
		switch(srcElement) {
		case "top":
			before = place.firstChild;
			break;
		case "bottom":
			before = null;
			break;
		}
	} else {
		var after = this.findContainingTiddler(srcElement);
		if(after == null) {
			before = place.firstChild;
		} else if(after.nextSibling) {
			before = after.nextSibling;
			if(before.nodeType != 1)
				before = null;
		}
	}
	return before;
};

Story.prototype.createTiddler = function(place,before,title,template,customFields)
{
	var tiddlerElem = createTiddlyElement(null,"div",this.tiddlerId(title),"tiddler");
	tiddlerElem.setAttribute("refresh","tiddler");
	if(customFields)
		tiddlerElem.setAttribute("tiddlyFields",customFields);
	place.insertBefore(tiddlerElem,before);
	var defaultText = null;
	if(!store.tiddlerExists(title) && !store.isShadowTiddler(title))
		defaultText = this.loadMissingTiddler(title,customFields);
	this.refreshTiddler(title,template,false,customFields,defaultText);
	return tiddlerElem;
};

Story.prototype.loadMissingTiddler = function(title,fields,callback)
{
	var getTiddlerCallback = function(context)
	{
		if(context.status) {
			var t = context.tiddler;
			if(!t.created)
				t.created = new Date();
			if(!t.modified)
				t.modified = t.created;
			var dirty = store.isDirty();
			context.tiddler = store.saveTiddler(t.title,t.title,t.text,t.modifier,t.modified,t.tags,t.fields,true,t.created,t.creator);
			if(!window.allowSave())
				store.setDirty(dirty);
			autoSaveChanges();
		} else {
			story.refreshTiddler(context.title,null,true);
		}
		context.adaptor.close();
		if(callback) {
			callback(context);
		}
	};
	var tiddler = new Tiddler(title);
	tiddler.fields = typeof fields == "string" ? fields.decodeHashMap() : fields||{};
	var context = {serverType:tiddler.getServerType()};
	if(!context.serverType)
		return "";
	context.host = tiddler.fields['server.host'];
	context.workspace = tiddler.fields['server.workspace'];
	var adaptor = new config.adaptors[context.serverType]();
	adaptor.getTiddler(title,context,null,getTiddlerCallback);
	return config.messages.loadingMissingTiddler.format([title,context.serverType,context.host,context.workspace]);
};

Story.prototype.chooseTemplateForTiddler = function(title,template)
{
	if(!template)
		template = DEFAULT_VIEW_TEMPLATE;
	if(template == DEFAULT_VIEW_TEMPLATE || template == DEFAULT_EDIT_TEMPLATE)
		template = config.tiddlerTemplates[template];
	return template;
};

Story.prototype.getTemplateForTiddler = function(title,template,tiddler)
{
	return store.getRecursiveTiddlerText(template,null,10);
};

Story.prototype.refreshTiddler = function(title,template,force,customFields,defaultText)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		if(tiddlerElem.getAttribute("dirty") == "true" && !force)
			return tiddlerElem;
		template = this.chooseTemplateForTiddler(title,template);
		var currTemplate = tiddlerElem.getAttribute("template");
		if((template != currTemplate) || force) {
			var tiddler = store.getTiddler(title);
			if(!tiddler) {
				tiddler = new Tiddler();
				if(store.isShadowTiddler(title)) {
					var tags = [];
					tiddler.set(title,store.getTiddlerText(title),config.views.wikified.shadowModifier,version.date,tags,version.date);
				} else {
					var text = template=="EditTemplate" ?
								config.views.editor.defaultText.format([title]) :
								config.views.wikified.defaultText.format([title]);
					text = defaultText || text;
					var fields = customFields ? customFields.decodeHashMap() : null;
					tiddler.set(title,text,config.views.wikified.defaultModifier,version.date,[],version.date,fields);
				}
			}
			tiddlerElem.setAttribute("tags",tiddler.tags.join(" "));
			tiddlerElem.setAttribute("tiddler",title);
			tiddlerElem.setAttribute("template",template);
			tiddlerElem.onmouseover = this.onTiddlerMouseOver;
			tiddlerElem.onmouseout = this.onTiddlerMouseOut;
			tiddlerElem.ondblclick = this.onTiddlerDblClick;
			tiddlerElem[window.event?"onkeydown":"onkeypress"] = this.onTiddlerKeyPress;
			tiddlerElem.innerHTML = this.getTemplateForTiddler(title,template,tiddler);
			applyHtmlMacros(tiddlerElem,tiddler);
			if(store.getTaggedTiddlers(title).length > 0)
				jQuery(tiddlerElem).addClass("isTag");
			else
				jQuery(tiddlerElem).removeClass("isTag");
			if(store.tiddlerExists(title)) {
				jQuery(tiddlerElem).removeClass("shadow");
				jQuery(tiddlerElem).removeClass("missing");
			} else {
				jQuery(tiddlerElem).addClass(store.isShadowTiddler(title) ? "shadow" : "missing");
			}
			if(customFields)
				this.addCustomFields(tiddlerElem,customFields);
		}
	}
	return tiddlerElem;
};

Story.prototype.addCustomFields = function(place,customFields)
{
	var fields = customFields.decodeHashMap();
	var w = createTiddlyElement(place,"div",null,"customFields");
	w.style.display = "none";
	var t;
	for(t in fields) {
		var e = document.createElement("input");
		e.setAttribute("type","text");
		e.setAttribute("value",fields[t]);
		w.appendChild(e);
		e.setAttribute("edit",t);
	}
};

Story.prototype.refreshAllTiddlers = function(force)
{
	var e = this.getContainer().firstChild;
	while(e) {
		var template = e.getAttribute("template");
		if(template && e.getAttribute("dirty") != "true") {
			this.refreshTiddler(e.getAttribute("tiddler"),force ? null : template,true);
		}
		e = e.nextSibling;
	}
};

Story.prototype.onTiddlerMouseOver = function(e)
{
	jQuery(this).addClass("selected");
};

Story.prototype.onTiddlerMouseOut = function(e)
{
	jQuery(this).removeClass("selected");
};

Story.prototype.onTiddlerDblClick = function(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	if(target && target.nodeName.toLowerCase() != "input" && target.nodeName.toLowerCase() != "textarea") {
		if(document.selection && document.selection.empty)
			document.selection.empty();
		config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
		e.cancelBubble = true;
		if(e.stopPropagation) e.stopPropagation();
		return true;
	}
	return false;
};

Story.prototype.onTiddlerKeyPress = function(ev)
{
	var e = ev || window.event;
	clearMessage();
	var consume = false;
	var title = this.getAttribute("tiddler");
	var target = resolveTarget(e);
	switch(e.keyCode) {
	case 9: // Tab
		var ed = story.getTiddlerField(title,"text");
		if(target.tagName.toLowerCase() == "input" && ed.value==config.views.editor.defaultText.format([title])) {
			// moving from input field and editor still contains default text, so select it
			ed.focus();
			ed.select();
			consume = true;
		}
		if(config.options.chkInsertTabs && target.tagName.toLowerCase() == "textarea") {
			replaceSelection(target,String.fromCharCode(9));
			consume = true;
		}
		if(config.isOpera) {
			target.onblur = function() {
				this.focus();
				this.onblur = null;
			};
		}
		break;
	case 13: // Ctrl-Enter
	case 10: // Ctrl-Enter on IE PC
	case 77: // Ctrl-Enter is "M" on some platforms
		if(e.ctrlKey) {
			blurElement(this);
			config.macros.toolbar.invokeCommand(this,"defaultCommand",e);
			consume = true;
		}
		break;
	case 27: // Escape
		blurElement(this);
		config.macros.toolbar.invokeCommand(this,"cancelCommand",e);
		consume = true;
		break;
	}
	e.cancelBubble = consume;
	if(consume) {
		if(e.stopPropagation) e.stopPropagation(); // Stop Propagation
		e.returnValue = true; // Cancel The Event in IE
		if(e.preventDefault ) e.preventDefault(); // Cancel The Event in Moz
	}
	return !consume;
};

Story.prototype.getTiddlerField = function(title,field)
{
	var tiddlerElem = this.getTiddler(title);
	var e = null;
	if(tiddlerElem) {
		var t,children = tiddlerElem.getElementsByTagName("*");
		for(t=0; t<children.length; t++) {
			var c = children[t];
			if(c.tagName.toLowerCase() == "input" || c.tagName.toLowerCase() == "textarea") {
				if(!e)
					e = c;
				if(c.getAttribute("edit") == field)
					e = c;
			}
		}
	}
	return e;
};

Story.prototype.focusTiddler = function(title,field)
{
	var e = this.getTiddlerField(title,field);
	if(e) {
		e.focus();
		e.select();
	}
};

Story.prototype.blurTiddler = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem && tiddlerElem.focus && tiddlerElem.blur) {
		tiddlerElem.focus();
		tiddlerElem.blur();
	}
};

Story.prototype.setTiddlerField = function(title,tag,mode,field)
{
	var c = this.getTiddlerField(title,field);
	var tags = c.value.readBracketedList();
	tags.setItem(tag,mode);
	c.value = String.encodeTiddlyLinkList(tags);
};

Story.prototype.setTiddlerTag = function(title,tag,mode)
{
	this.setTiddlerField(title,tag,mode,"tags");
};

Story.prototype.closeTiddler = function(title,animate,unused)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		clearMessage();
		this.scrubTiddler(tiddlerElem);
		if(config.options.chkAnimate && animate && anim && typeof Slider == "function")
			anim.startAnimating(new Slider(tiddlerElem,false,null,"all"));
		else {
			jQuery(tiddlerElem).remove();
		}
	}
};

Story.prototype.scrubTiddler = function(tiddlerElem)
{
	tiddlerElem.id = null;
};

Story.prototype.setDirty = function(title,dirty)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		tiddlerElem.setAttribute("dirty",dirty ? "true" : "false");
};

Story.prototype.isDirty = function(title)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem)
		return tiddlerElem.getAttribute("dirty") == "true";
	return null;
};

Story.prototype.areAnyDirty = function()
{
	var r = false;
	this.forEachTiddler(function(title,element) {
		if(this.isDirty(title))
			r = true;
	});
	return r;
};

Story.prototype.closeAllTiddlers = function(exclude)
{
	clearMessage();
	this.forEachTiddler(function(title,element) {
		if((title != exclude) && element.getAttribute("dirty") != "true")
			this.closeTiddler(title);
	});
	window.scrollTo(0,ensureVisible(this.container));
};

Story.prototype.isEmpty = function()
{
	var place = this.getContainer();
	return place && place.firstChild == null;
};

Story.prototype.search = function(text,useCaseSensitive,useRegExp)
{
	this.closeAllTiddlers();
	highlightHack = new RegExp(useRegExp ? text : text.escapeRegExp(),useCaseSensitive ? "mg" : "img");
	var matches = store.search(highlightHack,"title","excludeSearch");
	this.displayTiddlers(null,matches);
	highlightHack = null;
	var q = useRegExp ? "/" : "'";
	if(matches.length > 0)
		displayMessage(config.macros.search.successMsg.format([matches.length.toString(),q + text + q]));
	else
		displayMessage(config.macros.search.failureMsg.format([q + text + q]));
};

Story.prototype.findContainingTiddler = function(e)
{
	while(e && !jQuery(e).hasClass("tiddler")) {
		e = jQuery(e).hasClass("popup") && Popup.stack[0] ? Popup.stack[0].root : e.parentNode;
	}
	return e;
};

Story.prototype.gatherSaveFields = function(e,fields)
{
	if(e && e.getAttribute) {
		var f = e.getAttribute("edit");
		if(f)
			fields[f] = e.value.replace(/\r/mg,"");
		if(e.hasChildNodes()) {
			var t,c = e.childNodes;
			for(t=0; t<c.length; t++)
				this.gatherSaveFields(c[t],fields);
		}
	}
};

Story.prototype.hasChanges = function(title)
{
	var e = this.getTiddler(title);
	if(e) {
		var fields = {};
		this.gatherSaveFields(e,fields);
		if(store.fetchTiddler(title)) {
		    var n;
			for(n in fields) {
				if(store.getValue(title,n) != fields[n]) //# tiddler changed
					return true;
			}
		} else {
			if(store.isShadowTiddler(title) && store.getShadowTiddlerText(title) == fields.text) { //# not checking for title or tags
				return false;
			} else { //# changed shadow or new tiddler
				return true;
			}
		}
	}
	return false;
};

Story.prototype.saveTiddler = function(title,minorUpdate)
{
	var tiddlerElem = this.getTiddler(title);
	if(tiddlerElem) {
		var fields = {};
		this.gatherSaveFields(tiddlerElem,fields);
		var newTitle = fields.title || title;
		if(!store.tiddlerExists(newTitle)) {
			newTitle = newTitle.trim();
			var creator = config.options.txtUserName;
		}
		if(store.tiddlerExists(newTitle) && newTitle != title) {
			if(!confirm(config.messages.overwriteWarning.format([newTitle.toString()])))
				return null;
				title = newTitle;
		}
		if(newTitle != title)
			this.closeTiddler(newTitle,false);
		tiddlerElem.id = this.tiddlerId(newTitle);
		tiddlerElem.setAttribute("tiddler",newTitle);
		tiddlerElem.setAttribute("template",DEFAULT_VIEW_TEMPLATE);
		tiddlerElem.setAttribute("dirty","false");
		if(config.options.chkForceMinorUpdate)
			minorUpdate = !minorUpdate;
		if(!store.tiddlerExists(newTitle))
			minorUpdate = false;
		var newDate = new Date();
		if(store.tiddlerExists(title)) {
			var t = store.fetchTiddler(title);
			var extendedFields = t.fields;
			creator = t.creator;
		} else {
			extendedFields = merge({},config.defaultCustomFields);
		}
		var n;
		for(n in fields) {
			if(!TiddlyWiki.isStandardField(n))
				extendedFields[n] = fields[n];
		}
		var tiddler = store.saveTiddler(title,newTitle,fields.text,minorUpdate ? undefined : config.options.txtUserName,minorUpdate ? undefined : newDate,fields.tags,extendedFields,null,null,creator);
		autoSaveChanges(null,[tiddler]);
		return newTitle;
	}
	return null;
};

Story.prototype.permaView = function()
{
	var links = [];
	this.forEachTiddler(function(title,element) {
		links.push(String.encodeTiddlyLink(title));
	});
	var t = encodeURIComponent(links.join(" "));
	if(t == "")
		t = "#";
	if(window.location.hash != t)
		window.location.hash = t;
};

Story.prototype.switchTheme = function(theme)
{
	if(safeMode)
		return;

	var getSlice = function(theme,slice) {
		var r;
		if(readOnly)
			r = store.getTiddlerSlice(theme,slice+"ReadOnly") || store.getTiddlerSlice(theme,"Web"+slice);
		r = r || store.getTiddlerSlice(theme,slice);
		if(r && r.indexOf(config.textPrimitives.sectionSeparator)==0)
			r = theme + r;
		return store.isAvailable(r) ? r : slice;
	};

	var replaceNotification = function(i,name,theme,slice) {
		var newName = getSlice(theme,slice);
		if(name!=newName && store.namedNotifications[i].name==name) {
			store.namedNotifications[i].name = newName;
			return newName;
		}
		return name;
	};

	var pt = config.refresherData.pageTemplate;
	var vi = DEFAULT_VIEW_TEMPLATE;
	var vt = config.tiddlerTemplates[vi];
	var ei = DEFAULT_EDIT_TEMPLATE;
	var et = config.tiddlerTemplates[ei];

	var i;
	for(i=0; i<config.notifyTiddlers.length; i++) {
		var name = config.notifyTiddlers[i].name;
		switch(name) {
		case "PageTemplate":
			config.refresherData.pageTemplate = replaceNotification(i,config.refresherData.pageTemplate,theme,name);
			break;
		case "StyleSheet":
			removeStyleSheet(config.refresherData.styleSheet);
			config.refresherData.styleSheet = replaceNotification(i,config.refresherData.styleSheet,theme,name);
			break;
		case "ColorPalette":
			config.refresherData.colorPalette = replaceNotification(i,config.refresherData.colorPalette,theme,name);
			break;
		default:
			break;
		}
	}
	config.tiddlerTemplates[vi] = getSlice(theme,"ViewTemplate");
	config.tiddlerTemplates[ei] = getSlice(theme,"EditTemplate");
	if(!startingUp) {
		if(config.refresherData.pageTemplate!=pt || config.tiddlerTemplates[vi]!=vt || config.tiddlerTemplates[ei]!=et) {
			refreshAll();
			this.refreshAllTiddlers(true);
		} else {
			setStylesheet(store.getRecursiveTiddlerText(config.refresherData.styleSheet,"",10),config.refreshers.styleSheet);
		}
		config.options.txtTheme = theme;
		saveOption("txtTheme");
	}
};

//--
//-- Backstage
//--
// Backstage tasks
config.tasks.save.action = saveChanges;

var backstage = {
	area: null,
	toolbar: null,
	button: null,
	showButton: null,
	hideButton: null,
	cloak: null,
	panel: null,
	panelBody: null,
	panelFooter: null,
	currTabName: null,
	currTabElem: null,
	content: null,

	init: function() {
		var cmb = config.messages.backstage;
		this.area = document.getElementById("backstageArea");
		this.toolbar = jQuery("#backstageToolbar").empty()[0];
		this.button = jQuery("#backstageButton").empty()[0];
		this.button.style.display = "block";
		var t = cmb.open.text + " " + glyph("bentArrowLeft");
		this.showButton = createTiddlyButton(this.button,t,cmb.open.tooltip,
						function(e) {backstage.show(); return false;},null,"backstageShow");
		t = glyph("bentArrowRight") + " " + cmb.close.text;
		this.hideButton = createTiddlyButton(this.button,t,cmb.close.tooltip,
						function(e) {backstage.hide(); return false;},null,"backstageHide");
		this.cloak = document.getElementById("backstageCloak");
		this.panel = document.getElementById("backstagePanel");
		this.panelFooter = createTiddlyElement(this.panel,"div",null,"backstagePanelFooter");
		this.panelBody = createTiddlyElement(this.panel,"div",null,"backstagePanelBody");
		this.cloak.onmousedown = function(e) {backstage.switchTab(null);};
		createTiddlyText(this.toolbar,cmb.prompt);
		for(t=0; t<config.backstageTasks.length; t++) {
			var taskName = config.backstageTasks[t];
			var task = config.tasks[taskName];
			var handler = task.action ? this.onClickCommand : this.onClickTab;
			var text = task.text + (task.action ? "" : glyph("downTriangle"));
			var btn = createTiddlyButton(this.toolbar,text,task.tooltip,handler,"backstageTab");
			jQuery(btn).addClass(task.action ? "backstageAction" : "backstageTask");
			btn.setAttribute("task", taskName);
			}
		this.content = document.getElementById("contentWrapper");
		if(config.options.chkBackstage)
			this.show();
		else
			this.hide();
	},

	isVisible: function() {
		return this.area ? this.area.style.display == "block" : false;
	},

	show: function() {
		this.area.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.toolbar.style.left = findWindowWidth() + "px";
			var p = [{style: "left", start: findWindowWidth(), end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p));
		} else {
			backstage.area.style.left = "0px";
		}
		jQuery(this.showButton).hide();
		jQuery(this.hideButton).show();
		config.options.chkBackstage = true;
		saveOption("chkBackstage");
		jQuery(this.content).addClass("backstageVisible");
	},

	hide: function() {
		if(this.currTabElem) {
			this.switchTab(null);
		} else {
			backstage.toolbar.style.left = "0px";
			if(anim && config.options.chkAnimate) {
				var p = [{style: "left", start: 0, end: findWindowWidth(), template: "%0px"}];
				var c = function(element,properties) {backstage.area.style.display = "none";};
				anim.startAnimating(new Morpher(backstage.toolbar,config.animDuration,p,c));
			} else {
				this.area.style.display = "none";
			}
			this.showButton.style.display = "block";
			this.hideButton.style.display = "none";
			config.options.chkBackstage = false;
			saveOption("chkBackstage");
			jQuery(this.content).removeClass("backstageVisible");
		}
	},

	onClickCommand: function(e) {
		var task = config.tasks[this.getAttribute("task")];
		if(task.action) {
			backstage.switchTab(null);
			task.action();
		}
		return false;
	},

	onClickTab: function(e) {
		backstage.switchTab(this.getAttribute("task"));
		return false;
	},

	// Switch to a given tab, or none if null is passed
	switchTab: function(tabName) {
		var tabElem = null;
		var e = this.toolbar.firstChild;
		while(e) {
			if(e.getAttribute && e.getAttribute("task") == tabName)
				tabElem = e;
			e = e.nextSibling;
		}
		if(tabName == backstage.currTabName) {
			backstage.hidePanel();
			return;
		}
		if(backstage.currTabElem) {
			jQuery(this.currTabElem).removeClass("backstageSelTab");
		}
		if(tabElem && tabName) {
			backstage.preparePanel();
			jQuery(tabElem).addClass("backstageSelTab");
			var task = config.tasks[tabName];
			wikify(task.content,backstage.panelBody,null,null);
			backstage.showPanel();
		} else if(backstage.currTabElem) {
			backstage.hidePanel();
		}
		backstage.currTabName = tabName;
		backstage.currTabElem = tabElem;
	},

	isPanelVisible: function() {
		return backstage.panel ? backstage.panel.style.display == "block" : false;
	},

	preparePanel: function() {
		backstage.cloak.style.height = findDocHeight() + "px";
		backstage.cloak.style.display = "block";
		jQuery(backstage.panelBody).empty();
		return backstage.panelBody;
	},

	showPanel: function() {
		backstage.panel.style.display = "block";
		if(anim && config.options.chkAnimate) {
			backstage.panel.style.top = (-backstage.panel.offsetHeight) + "px";
			var p = [{style: "top", start: -backstage.panel.offsetHeight, end: 0, template: "%0px"}];
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p),new Scroller(backstage.panel,false));
		} else {
			backstage.panel.style.top = "0px";
		}
		return backstage.panelBody;
	},

	hidePanel: function() {
		if(backstage.currTabElem)
			jQuery(backstage.currTabElem).removeClass("backstageSelTab");
		backstage.currTabElem = null;
		backstage.currTabName = null;
		if(anim && config.options.chkAnimate) {
			var p = [
				{style: "top", start: 0, end: -(backstage.panel.offsetHeight), template: "%0px"},
				{style: "display", atEnd: "none"}
			];
			var c = function(element,properties) {backstage.cloak.style.display = "none";};
			anim.startAnimating(new Morpher(backstage.panel,config.animDuration,p,c));
		} else {
			jQuery([backstage.panel,backstage.cloak]).hide();
		}
	}
};

config.macros.backstage = {};

config.macros.backstage.handler = function(place,macroName,params)
{
	var backstageTask = config.tasks[params[0]];
	if(backstageTask)
		createTiddlyButton(place,backstageTask.text,backstageTask.tooltip,function(e) {backstage.switchTab(params[0]); return false;});
};

//--
//-- ImportTiddlers macro
//--

config.macros.importTiddlers.handler = function(place,macroName,params,wikifier,paramString,tiddler)
{
	if(readOnly) {
		createTiddlyElement(place,"div",null,"marked",this.readOnlyWarning);
		return;
	}
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	this.restart(w);
};

config.macros.importTiddlers.onCancel = function(e)
{
	var wizard = new Wizard(this);
	wizard.clear();
	config.macros.importTiddlers.restart(wizard);
	return false;
};

config.macros.importTiddlers.onClose = function(e)
{
	backstage.hidePanel();
	return false;
};

config.macros.importTiddlers.restart = function(wizard)
{
	var me = config.macros.importTiddlers;
	wizard.addStep(this.step1Title,this.step1Html);
	var t,s = wizard.getElement("selTypes");
	for(t in config.adaptors) {
		var e = createTiddlyElement(s,"option",null,null,config.adaptors[t].serverLabel || t);
		e.value = t;
	}
	if(config.defaultAdaptor)
		s.value = config.defaultAdaptor;
	s = wizard.getElement("selFeeds");
	var feeds = this.getFeeds();
	for(t in feeds) {
		e = createTiddlyElement(s,"option",null,null,t);
		e.value = t;
	}
	wizard.setValue("feeds",feeds);
	s.onchange = me.onFeedChange;
	var fileInput = wizard.getElement("txtBrowse");
	fileInput.onchange = me.onBrowseChange;
	fileInput.onkeyup = me.onBrowseChange;
	wizard.setButtons([{caption: this.openLabel, tooltip: this.openPrompt, onClick: me.onOpen}]);
	wizard.formElem.action = "javascript:;";
	wizard.formElem.onsubmit = function() {
		if(!this.txtPath || this.txtPath.value.length) //# check for manually entered path in first step
			this.lastChild.firstChild.onclick();
	};
};

config.macros.importTiddlers.getFeeds = function()
{
	var feeds = {};
	var t,tagged = store.getTaggedTiddlers("systemServer","title");
	for(t=0; t<tagged.length; t++) {
		var title = tagged[t].title;
		var serverType = store.getTiddlerSlice(title,"Type");
		if(!serverType)
			serverType = "file";
		feeds[title] = {title: title,
						url: store.getTiddlerSlice(title,"URL"),
						workspace: store.getTiddlerSlice(title,"Workspace"),
						workspaceList: store.getTiddlerSlice(title,"WorkspaceList"),
						tiddlerFilter: store.getTiddlerSlice(title,"TiddlerFilter"),
						serverType: serverType,
						description: store.getTiddlerSlice(title,"Description")};
	}
	return feeds;
};

config.macros.importTiddlers.onFeedChange = function(e)
{
	var wizard = new Wizard(this);
	var selTypes = wizard.getElement("selTypes");
	var fileInput = wizard.getElement("txtPath");
	var feeds = wizard.getValue("feeds");
	var f = feeds[this.value];
	if(f) {
		selTypes.value = f.serverType;
		fileInput.value = f.url;
		wizard.setValue("feedName",f.serverType);
		wizard.setValue("feedHost",f.url);
		wizard.setValue("feedWorkspace",f.workspace);
		wizard.setValue("feedWorkspaceList",f.workspaceList);
		wizard.setValue("feedTiddlerFilter",f.tiddlerFilter);
	}
	return false;
};

config.macros.importTiddlers.onBrowseChange = function(e)
{
	var wizard = new Wizard(this);
	var file = this.value;
	file = file.replace(/^C:\\fakepath\\/i,''); // remove fakepath (chrome/opera/safari)
	if(this.files && this.files[0]) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalFileRead");
			file = this.files[0].fileName; // REQUIRES PRIVILEGES.. NULL otherwise
		} catch (ex) {
			// non-priv fallback: combine filename with path to current document
			var path=getLocalPath(document.location.href);
			var slashpos=path.lastIndexOf('/'); if (slashpos==-1) slashpos=path.lastIndexOf('\\'); 
			if (slashpos!=-1) path=path.substr(0,slashpos+1); // remove filename, leave trailing 	slash
			file=path+file;
		}
	}
	var fileInput = wizard.getElement("txtPath");
	fileInput.value = config.macros.importTiddlers.getURLFromLocalPath(file);
	var serverType = wizard.getElement("selTypes");
	serverType.value = "file";
	return true;
};

config.macros.importTiddlers.getURLFromLocalPath = function(v)
{
	if(!v || !v.length)
		return v;
	v = v.replace(/\\/g,"/"); // use "/" for cross-platform consistency
	var u;
	var t = v.split(":");
	var p = t[1] || t[0]; // remove drive letter (if any)
	if(t[1] && (t[0] == "http" || t[0] == "https" || t[0] == "file")) {
		u = v;
	} else if(p.substr(0,1)=="/") {
		u = document.location.protocol + "//" + document.location.hostname + (t[1] ? "/" : "") + v;
	} else {
		var c = document.location.href.replace(/\\/g,"/");
		var pos = c.lastIndexOf("/");
		if(pos!=-1)
			c = c.substr(0,pos); // remove filename
		u = c + "/" + p;
	}
	return u;
};

config.macros.importTiddlers.onOpen = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var fileInput = wizard.getElement("txtPath");
	var url = fileInput.value;
	var serverType = wizard.getElement("selTypes").value || config.defaultAdaptor;
	var adaptor = new config.adaptors[serverType]();
	wizard.setValue("adaptor",adaptor);
	wizard.setValue("serverType",serverType);
	wizard.setValue("host",url);
	adaptor.openHost(url,null,wizard,me.onOpenHost);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenHost);
	return false;
};

config.macros.importTiddlers.onOpenHost = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	var adaptor = wizard.getValue("adaptor");
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenHost: " + context.statusText);
	adaptor.getWorkspaceList(context,wizard,me.onGetWorkspaceList);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetWorkspaceList);
};

config.macros.importTiddlers.onGetWorkspaceList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onGetWorkspaceList: " + context.statusText);
	wizard.setValue("context",context);
	var workspace = wizard.getValue("feedWorkspace");
	if(!workspace && context.workspaces.length==1)
		workspace = context.workspaces[0].title;
	if(workspace) {
		context.adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
		wizard.setValue("workspace",workspace);
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
		return;
	}
	wizard.addStep(me.step2Title,me.step2Html);
	var t,s = wizard.getElement("selWorkspace");
	s.onchange = me.onWorkspaceChange;
	for(t=0; t<context.workspaces.length; t++) {
		var e = createTiddlyElement(s,"option",null,null,context.workspaces[t].title);
		e.value = context.workspaces[t].title;
	}
	var workspaceList = wizard.getValue("feedWorkspaceList");
	if(workspaceList) {
		var n,list = workspaceList.parseParams("workspace",null,false,true);
		for(n=1; n<list.length; n++) {
			if(context.workspaces.findByField("title",list[n].value) == null) {
				e = createTiddlyElement(s,"option",null,null,list[n].value);
				e.value = list[n].value;
			}
		}
	}
	if(workspace) {
		t = wizard.getElement("txtWorkspace");
		t.value = workspace;
	}
	wizard.setButtons([{caption: me.openLabel, tooltip: me.openPrompt, onClick: me.onChooseWorkspace}]);
};

config.macros.importTiddlers.onWorkspaceChange = function(e)
{
	var wizard = new Wizard(this);
	var t = wizard.getElement("txtWorkspace");
	t.value = this.value;
	this.selectedIndex = 0;
	return false;
};

config.macros.importTiddlers.onChooseWorkspace = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	var adaptor = wizard.getValue("adaptor");
	var workspace = wizard.getElement("txtWorkspace").value;
	wizard.setValue("workspace",workspace);
	var context = wizard.getValue("context");
	adaptor.openWorkspace(workspace,context,wizard,me.onOpenWorkspace);
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusOpenWorkspace);
	return false;
};

config.macros.importTiddlers.onOpenWorkspace = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true)
		displayMessage("Error in importTiddlers.onOpenWorkspace: " + context.statusText);
	var adaptor = wizard.getValue("adaptor");
	var browse=wizard.getElement("txtBrowse");
	if (browse.files) context.file=browse.files[0]; // for HTML5 FileReader
	adaptor.getTiddlerList(context,wizard,me.onGetTiddlerList,wizard.getValue("feedTiddlerFilter"));
	wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],me.statusGetTiddlerList);
};

config.macros.importTiddlers.onGetTiddlerList = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(context.status !== true) {
		var error = context.statusText||me.errorGettingTiddlerList;
		if(context.host.indexOf("file://") === 0) {
			error = me.errorGettingTiddlerListFile;
		} else {
			error = context.xhr && context.xhr.status == 404 ? me.errorGettingTiddlerListHttp404 :
				me.errorGettingTiddlerListHttp;
		}
		wizard.setButtons([{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}],"");
		jQuery("span.status", wizard.footerEl).html(error); // so error message can be html
		return;
	}
	// Extract data for the listview
	var listedTiddlers = [];
	if(context.tiddlers) {
		var n;
		for(n=0; n<context.tiddlers.length; n++) {
			var tiddler = context.tiddlers[n];
			listedTiddlers.push({
				title: tiddler.title,
				modified: tiddler.modified,
				modifier: tiddler.modifier,
				text: tiddler.text ? wikifyPlainText(tiddler.text,100) : "",
				tags: tiddler.tags,
				size: tiddler.text ? tiddler.text.length : 0,
				tiddler: tiddler
			});
		}
	}
	listedTiddlers.sort(function(a,b) {return a.title < b.title ? -1 : (a.title == b.title ? 0 : +1);});
	// Display the listview
	wizard.addStep(me.step3Title,me.step3Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	var listView = ListView.create(listWrapper,listedTiddlers,me.listViewTemplate);
	wizard.setValue("listView",listView);
	wizard.setValue("context",context);
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler");
	txtSaveTiddler.value = me.generateSystemServerName(wizard);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel},
			{caption: me.importLabel, tooltip: me.importPrompt, onClick: me.doImport}
		]);
};

config.macros.importTiddlers.generateSystemServerName = function(wizard)
{
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var pattern = config.macros.importTiddlers[workspace ? "systemServerNamePattern" : "systemServerNamePatternNoWorkspace"];
	return pattern.format([serverType,host,workspace]);
};

config.macros.importTiddlers.saveServerTiddler = function(wizard)
{
	var me = config.macros.importTiddlers;
	var txtSaveTiddler = wizard.getElement("txtSaveTiddler").value;
	if(store.tiddlerExists(txtSaveTiddler)) {
		if(!confirm(me.confirmOverwriteSaveTiddler.format([txtSaveTiddler])))
			return;
		store.suspendNotifications();
		store.removeTiddler(txtSaveTiddler);
		store.resumeNotifications();
	}
	var serverType = wizard.getValue("serverType");
	var host = wizard.getValue("host");
	var workspace = wizard.getValue("workspace");
	var text = me.serverSaveTemplate.format([serverType,host,workspace]);
	store.saveTiddler(txtSaveTiddler,txtSaveTiddler,text,me.serverSaveModifier,new Date(),["systemServer"]);
};

config.macros.importTiddlers.doImport = function(e)
{
	var me = config.macros.importTiddlers;
	var wizard = new Wizard(this);
	if(wizard.getElement("chkSave").checked)
		me.saveServerTiddler(wizard);
	var chkSync = wizard.getElement("chkSync").checked;
	wizard.setValue("sync",chkSync);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	var adaptor = wizard.getValue("adaptor");
	var overwrite = [];
	var t;
	for(t=0; t<rowNames.length; t++) {
		if(store.tiddlerExists(rowNames[t]))
			overwrite.push(rowNames[t]);
	}
	if(overwrite.length > 0) {
		if(!confirm(me.confirmOverwriteText.format([overwrite.join(", ")])))
			return false;
	}
	wizard.addStep(me.step4Title.format([rowNames.length]),me.step4Html);
	for(t=0; t<rowNames.length; t++) {
		var link = document.createElement("div");
		createTiddlyLink(link,rowNames[t],true);
		var place = wizard.getElement("markReport");
		place.parentNode.insertBefore(link,place);
	}
	wizard.setValue("remainingImports",rowNames.length);
	wizard.setButtons([
			{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}
		],me.statusDoingImport);
	var wizardContext = wizard.getValue("context");
	var tiddlers = wizardContext ? wizardContext.tiddlers : [];
	for(t=0; t<rowNames.length; t++) {
		var context = {
			allowSynchronous:true,
			tiddler:tiddlers[tiddlers.findByField("title",rowNames[t])]
		};
		adaptor.getTiddler(rowNames[t],context,wizard,me.onGetTiddler);
	}
	return false;
};

config.macros.importTiddlers.onGetTiddler = function(context,wizard)
{
	var me = config.macros.importTiddlers;
	if(!context.status)
		displayMessage("Error in importTiddlers.onGetTiddler: " + context.statusText);
	var tiddler = context.tiddler;
	store.suspendNotifications();
	store.saveTiddler(tiddler.title, tiddler.title, tiddler.text, tiddler.modifier, tiddler.modified, tiddler.tags, tiddler.fields, true, tiddler.created);
	if(!wizard.getValue("sync")) {
		store.setValue(tiddler.title,'server',null);
	}
	store.resumeNotifications();
	if(!context.isSynchronous)
		store.notify(tiddler.title,true);
	var remainingImports = wizard.getValue("remainingImports")-1;
	wizard.setValue("remainingImports",remainingImports);
	if(remainingImports == 0) {
		if(context.isSynchronous) {
			store.notifyAll();
			refreshDisplay();
		}
		wizard.setButtons([
				{caption: me.doneLabel, tooltip: me.donePrompt, onClick: me.onClose}
			],me.statusDoneImport);
		autoSaveChanges();
	}
};

//--
//-- Upgrade macro
//--

config.macros.upgrade.handler = function(place)
{
	var w = new Wizard();
	w.createWizard(place,this.wizardTitle);
	w.addStep(this.step1Title,this.step1Html.format([this.source,this.source]));
	w.setButtons([{caption: this.upgradeLabel, tooltip: this.upgradePrompt, onClick: this.onClickUpgrade}]);
};

config.macros.upgrade.onClickUpgrade = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	if(!window.allowSave()) {
		alert(me.errorCantUpgrade);
		return false;
	}
	if(story.areAnyDirty() || store.isDirty()) {
		alert(me.errorNotSaved);
		return false;
	}
	var localPath = getLocalPath(document.location.toString());
	var backupPath = getBackupPath(localPath,me.backupExtension);
	w.setValue("backupPath",backupPath);
	w.setButtons([],me.statusPreparingBackup);
	var original = loadOriginal(localPath);
	w.setButtons([],me.statusSavingBackup);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(!backup) {
		w.setButtons([],me.errorSavingBackup);
		alert(me.errorSavingBackup);
		return false;
	}
	w.setButtons([],me.statusLoadingCore);
	var options = {
		type:"GET",
		url:me.source,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			me.onLoadCore(true,w,jqXHR.responseText,me.source,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			me.onLoadCore(false,w,null,me.source,jqXHR);
		}
	};
	ajaxReq(options);
	return false;
};

config.macros.upgrade.onLoadCore = function(status,params,responseText,url,xhr)
{
	var me = config.macros.upgrade;
	var w = params;
	var errMsg;
	if(!status)
		errMsg = me.errorLoadingCore;
	var newVer = me.extractVersion(responseText);
	if(!newVer)
		errMsg = me.errorCoreFormat;
	if(errMsg) {
		w.setButtons([],errMsg);
		alert(errMsg);
		return;
	}
	var onStartUpgrade = function(e) {
		w.setButtons([],me.statusSavingCore);
		var localPath = getLocalPath(document.location.toString());
		saveFile(localPath,responseText);
		w.setButtons([],me.statusReloadingCore);
		var backupPath = w.getValue("backupPath");
		var newLoc = document.location.toString() + "?time=" + new Date().convertToYYYYMMDDHHMM() + "#upgrade:[[" + encodeURI(backupPath) + "]]";
		window.setTimeout(function () {window.location = newLoc;},10);
	};
	var step2 = [me.step2Html_downgrade,me.step2Html_restore,me.step2Html_upgrade][compareVersions(version,newVer) + 1];
	w.addStep(me.step2Title,step2.format([formatVersion(newVer),formatVersion(version)]));
	w.setButtons([{caption: me.startLabel, tooltip: me.startPrompt, onClick: onStartUpgrade},{caption: me.cancelLabel, tooltip: me.cancelPrompt, onClick: me.onCancel}]);
};

config.macros.upgrade.onCancel = function(e)
{
	var me = config.macros.upgrade;
	var w = new Wizard(this);
	w.addStep(me.step3Title,me.step3Html);
	w.setButtons([]);
	return false;
};

config.macros.upgrade.extractVersion = function(upgradeFile)
{
	var re = /^var version = \{title: "([^"]+)", major: (\d+), minor: (\d+), revision: (\d+)(, beta: (\d+)){0,1}, date: new Date\("([^"]+)"\)/mg;
	var m = re.exec(upgradeFile);
	return m ? {title: m[1], major: m[2], minor: m[3], revision: m[4], beta: m[6], date: new Date(m[7])} : null;
};

function upgradeFrom(path)
{
	var importStore = new TiddlyWiki();
	var tw = loadFile(path);
	if(window.netscape !== undefined)
		tw = convertUTF8ToUnicode(tw);
	importStore.importTiddlyWiki(tw);
	importStore.forEachTiddler(function(title,tiddler) {
		if(!store.getTiddler(title)) {
			store.addTiddler(tiddler);
		}
	});
	refreshDisplay();
	saveChanges(); //# To create appropriate Markup* sections
	alert(config.messages.upgradeDone.format([formatVersion()]));
	window.location = window.location.toString().substr(0,window.location.toString().lastIndexOf("?"));
}

//--
//-- Manager UI for groups of tiddlers
//--

config.macros.plugins.handler = function(place,macroName,params,wikifier,paramString)
{
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement("markList");
	var listWrapper = document.createElement("div");
	markList.parentNode.insertBefore(listWrapper,markList);
	listWrapper.setAttribute("refresh","macro");
	listWrapper.setAttribute("macroName","plugins");
	listWrapper.setAttribute("params",paramString);
	this.refresh(listWrapper,paramString);
};

config.macros.plugins.refresh = function(listWrapper,params)
{
	var me = config.macros.plugins;
	var wizard = new Wizard(listWrapper);
	var selectedRows = [];
	ListView.forEachSelector(listWrapper,function(e,rowName) {
			if(e.checked)
				selectedRows.push(e.getAttribute("rowName"));
		});
	jQuery(listWrapper).empty();
	params = params.parseParams("anon");
	var plugins = installedPlugins.slice(0);
	var t,tiddler,p;
	var configTiddlers = store.getTaggedTiddlers("systemConfig");
	for(t=0; t<configTiddlers.length; t++) {
		tiddler = configTiddlers[t];
		if(plugins.findByField("title",tiddler.title) == null) {
			p = getPluginInfo(tiddler);
			p.executed = false;
			p.log.splice(0,0,this.skippedText);
			plugins.push(p);
		}
	}
	for(t=0; t<plugins.length; t++) {
		p = plugins[t];
		p.size = p.tiddler.text ? p.tiddler.text.length : 0;
		p.forced = p.tiddler.isTagged("systemConfigForce");
		p.disabled = p.tiddler.isTagged("systemConfigDisable");
		p.Selected = selectedRows.indexOf(plugins[t].title) != -1;
	}
	if(plugins.length == 0) {
		createTiddlyElement(listWrapper,"em",null,null,this.noPluginText);
		wizard.setButtons([]);
	} else {
		var template = readOnly ? this.listViewTemplateReadOnly : this.listViewTemplate;
		var listView = ListView.create(listWrapper,plugins,template,this.onSelectCommand);
		wizard.setValue("listView",listView);
		if(!readOnly) {
			wizard.setButtons([
				{caption: me.removeLabel, tooltip: me.removePrompt, onClick: me.doRemoveTag},
				{caption: me.deleteLabel, tooltip: me.deletePrompt, onClick: me.doDelete}
			]);
		}
	}
};

config.macros.plugins.doRemoveTag = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		var t;
		for(t=0; t<rowNames.length; t++) {
			store.setTiddlerTag(rowNames[t],false,"systemConfig");
		}
		autoSaveChanges();
	}
};

config.macros.plugins.doDelete = function(e)
{
	var wizard = new Wizard(this);
	var listView = wizard.getValue("listView");
	var rowNames = ListView.getSelectedRows(listView);
	if(rowNames.length == 0) {
		alert(config.messages.nothingSelected);
	} else {
		if(confirm(config.macros.plugins.confirmDeleteText.format([rowNames.join(", ")]))) {
			var t;
			for(t=0; t<rowNames.length; t++) {
				store.removeTiddler(rowNames[t]);
				story.closeTiddler(rowNames[t],true);
			}
		}
		autoSaveChanges();
	}
};

//--
//-- Message area
//--

function getMessageDiv()
{
	var msgArea = document.getElementById("messageArea");
	if(!msgArea)
		return null;
	if(!msgArea.hasChildNodes())
		createTiddlyButton(createTiddlyElement(msgArea,"div",null,"messageToolbar"),
			config.messages.messageClose.text,
			config.messages.messageClose.tooltip,
			clearMessage);
	msgArea.style.display = "block";
	return createTiddlyElement(msgArea,"div");
}

function displayMessage(text,linkText)
{
	var e = getMessageDiv();
	if(!e) {
		alert(text);
		return;
	}
	if(linkText) {
		var link = createTiddlyElement(e,"a",null,null,text);
		link.href = linkText;
		link.target = "_blank";
	} else {
		e.appendChild(document.createTextNode(text));
	}
}

function clearMessage()
{
	var msgArea = document.getElementById("messageArea");
	if(msgArea) {
		jQuery(msgArea).empty();
		msgArea.style.display = "none";
	}
	return false;
}

//--
//-- Refresh mechanism
//--

config.notifyTiddlers = [
	{name: "SystemSettings", notify: onSystemSettingsChange},
	{name: "StyleSheetLayout", notify: refreshStyles},
	{name: "StyleSheetColors", notify: refreshStyles},
	{name: "StyleSheet", notify: refreshStyles},
	{name: "StyleSheetPrint", notify: refreshStyles},
	{name: "PageTemplate", notify: refreshPageTemplate},
	{name: "SiteTitle", notify: refreshPageTitle},
	{name: "SiteSubtitle", notify: refreshPageTitle},
	{name: "WindowTitle", notify: refreshPageTitle},
	{name: "ColorPalette", notify: refreshColorPalette},
	{name: null, notify: refreshDisplay}
];

config.refreshers = {
	link: function(e,changeList)
		{
		var title = e.getAttribute("tiddlyLink");
		refreshTiddlyLink(e,title);
		return true;
		},

	tiddler: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var template = e.getAttribute("template");
		if(changeList && (changeList.indexOf && changeList.indexOf(title) != -1) && !story.isDirty(title))
			story.refreshTiddler(title,template,true);
		else
			refreshElements(e,changeList);
		return true;
		},

	content: function(e,changeList)
		{
		var title = e.getAttribute("tiddler");
		var force = e.getAttribute("force");
		var args = e.getAttribute("args");
		if(force != null || changeList == null || (changeList.indexOf && changeList.indexOf(title) != -1)) {
			jQuery(e).empty();
			config.macros.tiddler.transclude(e,title,args);
			return true;
		} else
			return false;
		},

	macro: function(e,changeList)
		{
		var macro = e.getAttribute("macroName");
		var params = e.getAttribute("params");
		if(macro)
			macro = config.macros[macro];
		if(macro && macro.refresh)
			macro.refresh(e,params);
		return true;
		}
};

config.refresherData = {
	styleSheet: "StyleSheet",
	defaultStyleSheet: "StyleSheet",
	pageTemplate: "PageTemplate",
	defaultPageTemplate: "PageTemplate",
	colorPalette: "ColorPalette",
	defaultColorPalette: "ColorPalette"
};

function refreshElements(root,changeList)
{
	var c,nodes = root.childNodes;
	for(c=0; c<nodes.length; c++) {
		var e = nodes[c], type = null;
		if(e.getAttribute && (e.tagName ? e.tagName != "IFRAME" : true))
			type = e.getAttribute("refresh");
		var refresher = config.refreshers[type];
		var refreshed = false;
		if(refresher != undefined)
			refreshed = refresher(e,changeList);
		if(e.hasChildNodes() && !refreshed)
			refreshElements(e,changeList);
	}
}

function applyHtmlMacros(root,tiddler)
{
	var e = root.firstChild;
	while(e) {
		var nextChild = e.nextSibling;
		if(e.getAttribute) {
			var macro = e.getAttribute("macro");
			if(macro) {
				e.removeAttribute("macro");
				var params = "";
				var p = macro.indexOf(" ");
				if(p != -1) {
					params = macro.substr(p+1);
					macro = macro.substr(0,p);
				}
				invokeMacro(e,macro,params,null,tiddler);
			}
		}
		if(e.hasChildNodes())
			applyHtmlMacros(e,tiddler);
		e = nextChild;
	}
}

function refreshPageTemplate(title)
{
	var stash = jQuery("<div/>").appendTo("body").hide()[0];
	var display = story.getContainer();
	var nodes,t;
	if(display) {
		nodes = display.childNodes;
		for(t=nodes.length-1; t>=0; t--)
			stash.appendChild(nodes[t]);
	}
	var wrapper = document.getElementById("contentWrapper");

	if(!title || !store.isAvailable(title))
		title = config.refresherData.pageTemplate;
	if(!store.isAvailable(title))
		title = config.refresherData.defaultPageTemplate; //# this one is always avaialable
	wrapper.innerHTML = store.getRecursiveTiddlerText(title,null,10);
	applyHtmlMacros(wrapper);
	refreshElements(wrapper);
	display = story.getContainer();
	jQuery(display).empty();
	if(!display)
		display = createTiddlyElement(wrapper,"div",story.containerId());
	nodes = stash.childNodes;
	for(t=nodes.length-1; t>=0; t--)
		display.appendChild(nodes[t]);
	jQuery(stash).remove();
}

function refreshDisplay(hint)
{
	if(typeof hint == "string")
		hint = [hint];
	var e = document.getElementById("contentWrapper");
	refreshElements(e,hint);
	if(backstage.isPanelVisible()) {
		e = document.getElementById("backstage");
		refreshElements(e,hint);
	}
}

function refreshPageTitle()
{
	document.title = getPageTitle();
}

function getPageTitle()
{
	return wikifyPlainText(store.getTiddlerText("WindowTitle",""),null,tiddler);
}

function refreshStyles(title,doc)
{
	setStylesheet(title == null ? "" : store.getRecursiveTiddlerText(title,"",10),title,doc || document);
}

function refreshColorPalette(title)
{
	if(!startingUp)
		refreshAll();
}

function refreshAll()
{
	refreshPageTemplate();
	refreshDisplay();
	refreshStyles("StyleSheetLayout");
	refreshStyles("StyleSheetColors");
	refreshStyles(config.refresherData.styleSheet);
	refreshStyles("StyleSheetPrint");
}

//--
//-- Option handling
//--

config.optionHandlers = {
	'txt': {
		get: function(name) {return encodeCookie(config.options[name].toString());},
		set: function(name,value) {config.options[name] = decodeCookie(value);}
	},
	'chk': {
		get: function(name) {return config.options[name] ? 'true' : 'false';},
		set: function(name,value) {config.options[name] = value == 'true';}
	}
};

function setOption(name,value)
{
	var optType = name.substr(0,3);
	if(config.optionHandlers[optType] && config.optionHandlers[optType].set)
		config.optionHandlers[optType].set(name,value);
}

// Gets the value of an option as a string. Most code should just read from config.options.* directly
function getOption(name)
{
	var optType = name.substr(0,3);
	return config.optionHandlers[optType] && config.optionHandlers[optType].get ? config.optionHandlers[optType].get(name) : null;
}

function loadOptions()
{
	if(safeMode)
		return;
	loadCookies();
	loadSystemSettings();
}
// @Deprecated; retained for backwards compatibility
var loadOptionsCookie = loadOptions;

function getCookies()
{
	var cookieList = document.cookie.split(';');
	var i,cookies = {};
	for(i=0; i<cookieList.length; i++) {
		var p = cookieList[i].indexOf('=');
		if(p != -1) {
			var name = cookieList[i].substr(0,p).trim();
			var value = cookieList[i].substr(p+1).trim();
			cookies[name] = value;
		}
	}
	return cookies;
}

function loadCookies()
{
	var i,cookies = getCookies();
	if(cookies['TiddlyWiki']) {
		cookies = cookies['TiddlyWiki'].decodeHashMap();
	}
	for(i in cookies) {
		if(config.optionsSource[i] != 'setting') {
			setOption(i,cookies[i]);
		}
	}
}

function loadSystemSettings()
{
	var key,settings = store.calcAllSlices('SystemSettings');
	config.optionsSource = {};
	for(key in settings) {
		setOption(key,settings[key]);
		config.optionsSource[key] = 'setting';
	}
}

function onSystemSettingsChange()
{
	if(!startingUp) {
		loadSystemSettings();
	}
}

function saveOption(name)
{
	if(safeMode)
		return;
	if(name.match(/[()\s]/g, '_')) {
		alert(config.messages.invalidCookie.format([name]));
		return;
	}
	saveCookie(name);
	if(config.optionsSource[name] == 'setting') {
		saveSystemSetting(name,true);
	}
}
// @Deprecated; retained for backwards compatibility
var saveOptionCookie = saveOption;

function removeCookie(name)
{
	document.cookie = name + '=; expires=Thu, 01-Jan-1970 00:00:01 UTC; path=/;';
}

function saveCookie(name)
{
	var key,cookies = {};
	for(key in config.options) {
		var value = getOption(key);
		value = value == null ? 'false' : value;
		cookies[key] = value;
	}
	document.cookie = 'TiddlyWiki=' + String.encodeHashMap(cookies) + '; expires=Fri, 1 Jan 2038 12:00:00 UTC; path=/';
	cookies = getCookies();
	var c;
	for(c in cookies) {
		var optType = c.substr(0,3);
		if(config.optionHandlers[optType])
			removeCookie(c);
	}
}

var systemSettingSave;
function commitSystemSettings(storeWasDirty)
{
	if(systemSettingSave) {
		window.clearTimeout(systemSettingSave);
	}
	systemSettingSave = window.setTimeout(function() {
		var tiddler = store.getTiddler('SystemSettings');
		autoSaveChanges(null,[tiddler]);
	}, 1000);
}

function saveSystemSetting(name,saveFile)
{
	var title = 'SystemSettings';
	var slice = store.getTiddlerSlice(title,name);
	if(readOnly || slice === getOption(name)) {
		return; //# don't save if read-only or the option hasn't changed
	}
	var slices = store.calcAllSlices(title);
	var key;
	for(key in config.optionsSource) {
		var value = getOption(key) || '';
		if(slices[key] !== value) {
			slices[key] = value;
		}
	}
	var text = [];
	for(key in slices) {
		text.push('%0: %1'.format([key,slices[key]]));
	}
	text = text.sort().join('\n');
	var storeWasDirty = store.isDirty();
	var tiddler = store.getTiddler(title);
	if(tiddler) {
		tiddler.text = text;
		tiddler = store.saveTiddler(tiddler);
	} else {
		tiddler = store.saveTiddler(title,title,text,'System',new Date(),['excludeLists'],config.defaultCustomFields);
	}
	if(saveFile) {
		commitSystemSettings(storeWasDirty);
	}
}

function encodeCookie(s)
{
	return escape(convertUnicodeToHtmlEntities(s));
}

function decodeCookie(s)
{
	s = unescape(s);
	var re = /&#[0-9]{1,5};/g;
	return s.replace(re,function($0) {return String.fromCharCode(eval($0.replace(/[&#;]/g,'')));});
}

config.macros.option.genericCreate = function(place,type,opt,className,desc)
{
	var typeInfo = config.macros.option.types[type];
	var c = document.createElement(typeInfo.elementType);
	if(typeInfo.typeValue)
		c.setAttribute('type',typeInfo.typeValue);
	c[typeInfo.eventName] = typeInfo.onChange;
	c.setAttribute('option',opt);
	c.className = className || typeInfo.className;
	if(config.optionsDesc[opt])
		c.setAttribute('title',config.optionsDesc[opt]);
	place.appendChild(c);
	if(desc != 'no')
		createTiddlyText(place,config.optionsDesc[opt] || opt);
	c[typeInfo.valueField] = config.options[opt];
	return c;
};

config.macros.option.genericOnChange = function(e)
{
	var opt = this.getAttribute('option');
	if(opt) {
		var optType = opt.substr(0,3);
		var handler = config.macros.option.types[optType];
		if(handler.elementType && handler.valueField)
			config.macros.option.propagateOption(opt,handler.valueField,this[handler.valueField],handler.elementType,this);
	}
	return true;
};

config.macros.option.types = {
	'txt': {
		elementType: 'input',
		valueField: 'value',
		eventName: 'onchange',
		className: 'txtOptionInput',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	},
	'chk': {
		elementType: 'input',
		valueField: 'checked',
		eventName: 'onclick',
		className: 'chkOptionInput',
		typeValue: 'checkbox',
		create: config.macros.option.genericCreate,
		onChange: config.macros.option.genericOnChange
	}
};

config.macros.option.propagateOption = function(opt,valueField,value,elementType,elem)
{
	config.options[opt] = value;
	saveOption(opt);
	var t,nodes = document.getElementsByTagName(elementType);
	for(t=0; t<nodes.length; t++) {
		var optNode = nodes[t].getAttribute('option');
		if(opt == optNode && nodes[t]!=elem)
			nodes[t][valueField] = value;
	}
};

config.macros.option.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var opt = (params[1] && params[1].name == 'anon') ? params[1].value : getParam(params,'name',null);
	var className = (params[2] && params[2].name == 'anon') ? params[2].value : getParam(params,'class',null);
	var desc = getParam(params,'desc','no');
	var type = opt.substr(0,3);
	var h = config.macros.option.types[type];
	if(h && h.create)
		h.create(place,type,opt,className,desc);
};

config.macros.options.handler = function(place,macroName,params,wikifier,paramString)
{
	params = paramString.parseParams('anon',null,true,false,false);
	var showUnknown = getParam(params,'showUnknown','no');
	var wizard = new Wizard();
	wizard.createWizard(place,this.wizardTitle);
	wizard.addStep(this.step1Title,this.step1Html);
	var markList = wizard.getElement('markList');
	var chkUnknown = wizard.getElement('chkUnknown');
	chkUnknown.checked = showUnknown == 'yes';
	chkUnknown.onchange = this.onChangeUnknown;
	var listWrapper = document.createElement('div');
	markList.parentNode.insertBefore(listWrapper,markList);
	wizard.setValue('listWrapper',listWrapper);
	this.refreshOptions(listWrapper,showUnknown == 'yes');
};

config.macros.options.refreshOptions = function(listWrapper,showUnknown)
{
	var n,opts = [];
	for(n in config.options) {
		var opt = {};
		opt.option = '';
		opt.name = n;
		opt.lowlight = !config.optionsDesc[n];
		opt.description = opt.lowlight ? this.unknownDescription : config.optionsDesc[n];
		if(!opt.lowlight || showUnknown)
			opts.push(opt);
	}
	opts.sort(function(a,b) {return a.name.substr(3) < b.name.substr(3) ? -1 : (a.name.substr(3) == b.name.substr(3) ? 0 : +1);});
	ListView.create(listWrapper,opts,this.listViewTemplate);
	for(n=0; n<opts.length; n++) {
		var type = opts[n].name.substr(0,3);
		var h = config.macros.option.types[type];
		if(h && h.create) {
			h.create(opts[n].colElements['option'],type,opts[n].name,null,'no');
		}
	}
};

config.macros.options.onChangeUnknown = function(e)
{
	var wizard = new Wizard(this);
	var listWrapper = wizard.getValue('listWrapper');
	jQuery(listWrapper).empty();
	config.macros.options.refreshOptions(listWrapper,this.checked);
	return false;
};

//--
//-- Saving
//--

var saveUsingSafari = false;

var startSaveArea = '<div id="' + 'storeArea">'; // Split up into two so that indexOf() of this source doesn't find it
var startSaveAreaRE = /<((div)|(DIV)) ((id)|(ID))=["']?storeArea['"]?>/; // Used for IE6
var endSaveArea = '</d' + 'iv>';
var endSaveAreaCaps = '</D' + 'IV>';

// If there are unsaved changes, force the user to confirm before exitting
function confirmExit()
{
	hadConfirmExit = true;
	if((store && store.isDirty && store.isDirty()) || (story && story.areAnyDirty && story.areAnyDirty()))
		return config.messages.confirmExit;
}

// Give the user a chance to save changes before exitting
function checkUnsavedChanges()
{
	if(store && store.isDirty && store.isDirty() && window.hadConfirmExit === false) {
		if(confirm(config.messages.unsavedChangesWarning))
			saveChanges();
	}
}

function updateLanguageAttribute(s)
{
	if(config.locale) {
		var mRE = /(<html(?:.*?)?)(?: xml:lang\="([a-z]+)")?(?: lang\="([a-z]+)")?>/;
		var m = mRE.exec(s);
		if(m) {
			var t = m[1];
			if(m[2])
				t += ' xml:lang="' + config.locale + '"';
			if(m[3])
				t += ' lang="' + config.locale + '"';
			t += ">";
			s = s.substr(0,m.index) + t + s.substr(m.index+m[0].length);
		}
	}
	return s;
}

function updateMarkupBlock(s,blockName,tiddlerName)
{
	return s.replaceChunk(
			"<!--%0-START-->".format([blockName]),
			"<!--%0-END-->".format([blockName]),
			"\n" + convertUnicodeToFileFormat(store.getRecursiveTiddlerText(tiddlerName,"")) + "\n");
}

function updateOriginal(original,posDiv,localPath)
{
	if(!posDiv)
		posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(config.messages.invalidFileError.format([localPath]));
		return null;
	}
	var revised = original.substr(0,posDiv[0] + startSaveArea.length) + "\n" +
				convertUnicodeToFileFormat(store.allTiddlersAsHtml()) + "\n" +
				original.substr(posDiv[1]);
	var newSiteTitle = convertUnicodeToFileFormat(getPageTitle()).htmlEncode();
	revised = revised.replaceChunk("<title"+">","</title"+">"," " + newSiteTitle + " ");
	revised = updateLanguageAttribute(revised);
	revised = updateMarkupBlock(revised,"PRE-HEAD","MarkupPreHead");
	revised = updateMarkupBlock(revised,"POST-HEAD","MarkupPostHead");
	revised = updateMarkupBlock(revised,"PRE-BODY","MarkupPreBody");
	revised = updateMarkupBlock(revised,"POST-SCRIPT","MarkupPostBody");
	return revised;
}

function locateStoreArea(original)
{
	// Locate the storeArea divs
	if(!original)
		return null;
	var posOpeningDiv = original.search(startSaveAreaRE);
	var limitClosingDiv = original.indexOf("<"+"!--POST-STOREAREA--"+">");
	if(limitClosingDiv == -1)
		limitClosingDiv = original.indexOf("<"+"!--POST-BODY-START--"+">");
	var start = limitClosingDiv == -1 ? original.length : limitClosingDiv;
	var posClosingDiv = original.lastIndexOf(endSaveArea,start);
	if(posClosingDiv == -1)
		posClosingDiv = original.lastIndexOf(endSaveAreaCaps,start);
	return (posOpeningDiv != -1 && posClosingDiv != -1) ? [posOpeningDiv,posClosingDiv] : null;
}

function autoSaveChanges(onlyIfDirty,tiddlers)
{
	if(config.options.chkAutoSave)
		saveChanges(onlyIfDirty,tiddlers);
}

function loadOriginal(localPath)
{
	var content=loadFile(localPath);
	if (!content) content=window.originalHTML||recreateOriginal();
	return content;
}

function recreateOriginal()
{
	// construct doctype
	var content = "<!DOCTYPE ";
	var t=document.doctype;
	if (!t) 
		content+="html"
	else {
		content+=t.name;
		if      (t.publicId)		content+=' PUBLIC "'+t.publicId+'"';
		else if (t.systemId)		content+=' SYSTEM "'+t.systemId+'"';
	}
	content+=' "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"';
	content+='>\n';

	// append current document content
	content+=document.documentElement.outerHTML;

	content=content.replace(/<div id="saveTest">savetest<\/div>/,'<div id="saveTest"></div>');
	content=content.replace(/script><applet [^\>]*><\/applet>/g,'script>');
	content=content.replace(/><head>/,'>\n<head>');
	content=content.replace(/\n\n<\/body><\/html>$/,'</body>\n</html>\n');
	content=content.replace(/(<(meta) [^\>]*[^\/])>/g,'$1 />');
	content=content.replace(/<noscript>[^\<]*<\/noscript>/,
		function(m){return m.replace(/&lt;/g,'<').replace(/&gt;/g,'>');});
	content=content.replace(/<div id="copyright">[^\<]*<\/div>/,
		function(m){return m.replace(/\xA9/g,'&copy;');});

	return content;
}

// Save this tiddlywiki with the pending changes
function saveChanges(onlyIfDirty,tiddlers)
{
	if(onlyIfDirty && !store.isDirty())
		return;
	clearMessage();
	var t0 = new Date();
	var msg = config.messages;
	var originalPath = document.location.toString();
	if(!window.allowSave()) {
		alert(msg.notFileUrlError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var localPath = getLocalPath(originalPath);
	var original = loadOriginal(localPath);
	if(original == null) {
		alert(msg.cantSaveError);
		if(store.tiddlerExists(msg.saveInstructions))
			story.displayTiddler(null,msg.saveInstructions);
		return;
	}
	var posDiv = locateStoreArea(original);
	if(!posDiv) {
		alert(msg.invalidFileError.format([localPath]));
		return;
	}
	var co=config.options; //# abbreviation
	config.saveByDownload=false;
	config.saveByManualDownload=false;
	saveMain(localPath,original,posDiv);
	if (!config.saveByDownload && !config.saveByManualDownload) {
		if(co.chkSaveBackups)
			saveBackup(localPath,original);
		if(co.chkSaveEmptyTemplate)
			saveEmpty(localPath,original,posDiv);
		if(co.chkGenerateAnRssFeed && saveRss instanceof Function)
			saveRss(localPath);
	}
	if(co.chkDisplayInstrumentation)
		displayMessage("saveChanges " + (new Date()-t0) + " ms");
}


function saveMain(localPath,original,posDiv)
{
	var save;
	try {
		var revised = updateOriginal(original,posDiv,localPath);
		save = saveFile(localPath,revised);
	} catch (ex) {
		showException(ex);
	}
	if(save) {
		if (!config.saveByManualDownload) {
			if (config.saveByDownload) { //# set by HTML5DownloadSaveFile()
				var link = getDataURI(revised);
				var msg  = config.messages.mainDownload;
			} else {
				var link = "file://" + localPath;
				var msg  = config.messages.mainSaved;
			}
			displayMessage(msg,link);
		}
		store.setDirty(false);
	} else {
		alert(config.messages.mainFailed);
	}
}

function saveBackup(localPath,original)
{
	var backupPath = getBackupPath(localPath);
	var backup = copyFile(backupPath,localPath);
	if(!backup)
		backup = saveFile(backupPath,original);
	if(backup)
		displayMessage(config.messages.backupSaved,"file://" + backupPath);
	else
		alert(config.messages.backupFailed);
}

function saveEmpty(localPath,original,posDiv)
{
	var emptyPath,p;
	if((p = localPath.lastIndexOf("/")) != -1)
		emptyPath = localPath.substr(0,p) + "/";
	else if((p = localPath.lastIndexOf("\\")) != -1)
		emptyPath = localPath.substr(0,p) + "\\";
	else
		emptyPath = localPath + ".";
	emptyPath += "empty.html";
	var empty = original.substr(0,posDiv[0] + startSaveArea.length) + original.substr(posDiv[1]);
	var emptySave = saveFile(emptyPath,empty);
	if(emptySave)
		displayMessage(config.messages.emptySaved,"file://" + emptyPath);
	else
		alert(config.messages.emptyFailed);
}

// Translate URL to local path [Preemption]
window.getLocalPath = window.getLocalPath || function(origPath)
{
	var originalPath = convertUriToUTF8(origPath,config.options.txtFileSystemCharSet);
	// Remove any location or query part of the URL
	var argPos = originalPath.indexOf("?");
	if(argPos != -1)
		originalPath = originalPath.substr(0,argPos);
	var hashPos = originalPath.indexOf("#");
	if(hashPos != -1)
		originalPath = originalPath.substr(0,hashPos);
	// Convert file://localhost/ to file:///
	if(originalPath.indexOf("file://localhost/") == 0)
		originalPath = "file://" + originalPath.substr(16);
	// Convert to a native file format
	var localPath;
	if(originalPath.charAt(9) == ":") // pc local file
		localPath = unescape(originalPath.substr(8)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file://///") == 0) // FireFox pc network file
		localPath = "\\\\" + unescape(originalPath.substr(10)).replace(new RegExp("/","g"),"\\");
	else if(originalPath.indexOf("file:///") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(7));
	else if(originalPath.indexOf("file:/") == 0) // mac/unix local file
		localPath = unescape(originalPath.substr(5));
	else // pc network file
		localPath = "\\\\" + unescape(originalPath.substr(7)).replace(new RegExp("/","g"),"\\");
	return localPath;
}

function getBackupPath(localPath,title,extension)
{
	var slash = "\\";
	var dirPathPos = localPath.lastIndexOf("\\");
	if(dirPathPos == -1) {
		dirPathPos = localPath.lastIndexOf("/");
		slash = "/";
	}
	var backupFolder = config.options.txtBackupFolder;
	if(!backupFolder || backupFolder == "")
		backupFolder = ".";
	var backupPath = localPath.substr(0,dirPathPos) + slash + backupFolder + localPath.substr(dirPathPos);
	backupPath = backupPath.substr(0,backupPath.lastIndexOf(".")) + ".";
	if(title)
		backupPath += title.replace(/[\\\/\*\?\":<> ]/g,"_") + ".";
	backupPath += (new Date()).convertToYYYYMMDDHHMMSSMMM() + "." + (extension || "html");
	return backupPath;
}

//--
//-- RSS Saving
//--

function saveRss(localPath)
{
	var rssPath = localPath.substr(0,localPath.lastIndexOf(".")) + ".xml";
	if(saveFile(rssPath,convertUnicodeToFileFormat(generateRss())))
		displayMessage(config.messages.rssSaved,"file://" + rssPath);
	else
		alert(config.messages.rssFailed);
}

tiddlerToRssItem = function(tiddler,uri)
{
	var s = "<title" + ">" + tiddler.title.htmlEncode() + "</title" + ">\n";
	s += "<description>" + wikifyStatic(tiddler.text,null,tiddler).htmlEncode() + "</description>\n";
	var i;
	for(i=0; i<tiddler.tags.length; i++)
		s += "<category>" + tiddler.tags[i] + "</category>\n";
	s += "<link>" + uri + "#" + encodeURIComponent(String.encodeTiddlyLink(tiddler.title)) + "</link>\n";
	s +="<pubDate>" + tiddler.modified.toGMTString() + "</pubDate>\n";
	return s;
};

function generateRss()
{
	var s = [];
	var d = new Date();
	var u = store.getTiddlerText("SiteUrl");
	// Assemble the header
	s.push("<" + "?xml version=\"1.0\"?" + ">");
	s.push("<rss version=\"2.0\">");
	s.push("<channel>");
	s.push("<title" + ">" + wikifyPlainText(store.getTiddlerText("SiteTitle",""),null,tiddler).htmlEncode() + "</title" + ">");
	if(u)
		s.push("<link>" + u.htmlEncode() + "</link>");
	s.push("<description>" + wikifyPlainText(store.getTiddlerText("SiteSubtitle",""),null,tiddler).htmlEncode() + "</description>");
	s.push("<language>" + config.locale + "</language>");
	s.push("<copyright>Copyright " + d.getFullYear() + " " + config.options.txtUserName.htmlEncode() + "</copyright>");
	s.push("<pubDate>" + d.toGMTString() + "</pubDate>");
	s.push("<lastBuildDate>" + d.toGMTString() + "</lastBuildDate>");
	s.push("<docs>http://blogs.law.harvard.edu/tech/rss</docs>");
	s.push("<generator>TiddlyWiki " + formatVersion() + "</generator>");
	// The body
	var tiddlers = store.getTiddlers("modified","excludeLists");
	var i,n = config.numRssItems > tiddlers.length ? 0 : tiddlers.length-config.numRssItems;
	for(i=tiddlers.length-1; i>=n; i--) {
		s.push("<item>\n" + tiddlerToRssItem(tiddlers[i],u) + "\n</item>");
	}
	// And footer
	s.push("</channel>");
	s.push("</rss>");
	// Save it all
	return s.join("\n");
}

//--
//-- Filesystem code
//--

// Copy a file in filesystem [Preemption]
window.copyFile = window.copyFile || function(dest,source)
{
	return config.browser.isIE ? ieCopyFile(dest,source) : false;
}


// Save a file in filesystem [Preemption]
window.saveFile = window.saveFile || function(fileUrl,content)
{
	var r = mozillaSaveFile(fileUrl,content);
	if(!r)
		r = ieSaveFile(fileUrl,content);
	if(!r)
		r = javaSaveFile(fileUrl,content);
	if(!r)
		r = HTML5DownloadSaveFile(fileUrl,content);
	if(!r)
		r = manualSaveFile(fileUrl,content);
	return r;
}

// Load a file from filesystem [Preemption]
window.loadFile = window.loadFile || function(fileUrl)
{
	var r = mozillaLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = ieLoadFile(fileUrl);
	if((r == null) || (r == false))
		r = javaLoadFile(fileUrl);
	return r;
}

function ieCreatePath(path)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}

	var pos = path.lastIndexOf("\\");
	if(pos==-1)
		pos = path.lastIndexOf("/");
	if(pos!=-1)
		path = path.substring(0,pos+1);

	var scan = [path];
	var parent = fso.GetParentFolderName(path);
	while(parent && !fso.FolderExists(parent)) {
		scan.push(parent);
		parent = fso.GetParentFolderName(parent);
	}

	for(i=scan.length-1;i>=0;i--) {
		if(!fso.FolderExists(scan[i])) {
			fso.CreateFolder(scan[i]);
		}
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function ieSaveFile(filePath,content)
{
	ieCreatePath(filePath);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
	} catch(ex) {
		return null;
	}
	var file = fso.OpenTextFile(filePath,2,-1,0);
	file.Write(content);
	file.Close();
	return true;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function ieLoadFile(filePath)
{
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		var file = fso.OpenTextFile(filePath,1);
		var content = file.ReadAll();
		file.Close();
	} catch(ex) {
		return null;
	}
	return content;
}

function ieCopyFile(dest,source)
{
	ieCreatePath(dest);
	try {
		var fso = new ActiveXObject("Scripting.FileSystemObject");
		fso.GetFile(source).Copy(dest);
	} catch(ex) {
		return false;
	}
	return true;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function mozillaSaveFile(filePath,content)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				file.create(0,0x01B4);// 0x01B4 = 0664
			var out = Components.classes["@mozilla.org/network/file-output-stream;1"].createInstance(Components.interfaces.nsIFileOutputStream);
			out.init(file,0x22,0x04,null);
			out.write(content,content.length);
			out.flush();
			out.close();
			return true;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, or a string of the content if successful
function mozillaLoadFile(filePath)
{
	if(window.Components) {
		try {
			netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
			var file = Components.classes["@mozilla.org/file/local;1"].createInstance(Components.interfaces.nsILocalFile);
			file.initWithPath(filePath);
			if(!file.exists())
				return null;
			var inputStream = Components.classes["@mozilla.org/network/file-input-stream;1"].createInstance(Components.interfaces.nsIFileInputStream);
			inputStream.init(file,0x01,0x04,null);
			var sInputStream = Components.classes["@mozilla.org/scriptableinputstream;1"].createInstance(Components.interfaces.nsIScriptableInputStream);
			sInputStream.init(inputStream);
			var contents = sInputStream.read(sInputStream.available());
			sInputStream.close();
			inputStream.close();
			return contents;
		} catch(ex) {
			return false;
		}
	}
	return null;
}

function javaUrlToFilename(url)
{
	var f = "//localhost";
	if(url.indexOf(f) == 0)
		return url.substring(f.length);
	var i = url.indexOf(":");
	return i > 0 ? url.substring(i-1) : url;
}

/*
 *
 * in between when the applet has been started
 * and the user has given permission to run the applet
 * we get an applet object, but it doesn't have the methods
 * we expect yet.
 *
 */
var LOG_TIDDLYSAVER = true;
function logTiddlySaverException(msg, ex) {
	var applet = document.applets['TiddlySaver'];
	console.log(msg + ": " + ex);
	if (LOG_TIDDLYSAVER && applet) {
		try {
			console.log(msg + ": " + applet.getLastErrorMsg());
			console.log(msg + ": " + applet.getLastErrorStackTrace());
		} catch (ex) {}
	}
}

function javaDebugInformation () {
	var applet = document.applets['TiddlySaver'];
	var what = [
		["Java Version", applet.getJavaVersion],
		["Last Exception", applet.getLastErrorMessage],
		["Last Exception Stack Trace", applet.getLastErrorStackTrace],
		["System Properties", applet.getSystemProperties] ];

	function formatItem (description, method) {
		try {
			 result = String(method.call(applet));
		} catch (ex) {
			 result = String(ex)
		}
		return description + ": " + result
	}

	return jQuery.map(what, function (item) { return formatItem.apply(this, item) })
			.join('\n\n')
}

function javaSaveFile(filePath,content)
{
	var applet = document.applets['TiddlySaver'];
	try {
		if (applet && filePath) 
			return applet.saveFile(javaUrlToFilename(filePath), "UTF-8", content);
	} catch(ex) {
		logTiddlySaverException("javaSaveFile", ex);
	}
	// is this next block working anywhere ? -- grmble
	try {
		var s = new java.io.PrintStream(new java.io.FileOutputStream(javaUrlToFilename(filePath)));
		s.print(content);
		s.close();
	} catch(ex2) {
		return null;
	}
	return true;
}

function javaLoadFile(filePath)
{
	var applet = document.applets['TiddlySaver'];
	try {
		if (applet && filePath) {
			var ret = applet.loadFile(javaUrlToFilename(filePath),"UTF-8");
			if(!ret)
				return null;
			return String(ret);
		}
	} catch(ex) {
		logTiddlySaverException("javaLoadFile", ex);
	}
	// is this next block working anywhere ? -- grmble
	var content = [];
	try {
		var r = new java.io.BufferedReader(new java.io.FileReader(javaUrlToFilename(filePath)));
		var line;
		while((line = r.readLine()) != null)
			content.push(String(line));
		r.close();
	} catch(ex2) {
		return null;
	}
	return content.join("\n");
}

function HTML5DownloadSaveFile(filePath,content)
{
	if(document.createElement("a").download !== undefined) {
		config.saveByDownload=true;
		var slashpos=filePath.lastIndexOf("/");
		if (slashpos==-1) slashpos=filePath.lastIndexOf("\\"); 
		var filename=filePath.substr(slashpos+1);
		var uri = getDataURI(content);
		var link = document.createElement("a");
		link.setAttribute("target","_blank");
		link.setAttribute("href",uri);
		link.setAttribute("download",filename);
		document.body.appendChild(link); link.click(); document.body.removeChild(link);
		return true;
	}
	return null;
}

// Returns null if it can't do it, false if there's an error, true if it saved OK
function manualSaveFile(filePath,content)
{
	// FALLBACK for showing a link to data: URI
	config.saveByManualDownload=true;
	var slashpos=filePath.lastIndexOf("/");
	if (slashpos==-1) slashpos=filePath.lastIndexOf("\\"); 
	var filename=filePath.substr(slashpos+1);
	var uri = getDataURI(content);
	displayMessage(config.messages.mainDownloadManual,uri);
	return true;
}

// construct data URI (using base64 encoding to preserve multi-byte encodings)
function getDataURI(data) {
	if (config.browser.isIE)
		return "data:text/html,"+encodeURIComponent(data);
	else
		return "data:text/html;base64,"+encodeBase64(data);
}

function encodeBase64(data) {
	if (!data) return "";
	var keyStr = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";
	var out = "";
	var chr1,chr2,chr3="";
	var enc1,enc2,enc3,enc4="";
	for (var count=0,i=0; i<data.length; ) {
		chr1=data.charCodeAt(i++);
		chr2=data.charCodeAt(i++);
		chr3=data.charCodeAt(i++);
		enc1=chr1 >> 2;
		enc2=((chr1 & 3) << 4) | (chr2 >> 4);
		enc3=((chr2 & 15) << 2) | (chr3 >> 6);
		enc4=chr3 & 63;
		if (isNaN(chr2)) enc3=enc4=64;
		else if (isNaN(chr3)) enc4=64;
		out+=keyStr.charAt(enc1)+keyStr.charAt(enc2)+keyStr.charAt(enc3)+keyStr.charAt(enc4);
		chr1=chr2=chr3=enc1=enc2=enc3=enc4="";
	}
	return out;
}//--
//-- Filesystem utilities
//--

function convertUTF8ToUnicode(u)
{
	return config.browser.isOpera || !window.netscape ? manualConvertUTF8ToUnicode(u) : mozConvertUTF8ToUnicode(u);
}


function manualConvertUTF8ToUnicode(utf)
{
	var uni = utf;
	var src = 0;
	var dst = 0;
	var b1, b2, b3;
	var c;
	while(src < utf.length) {
		b1 = utf.charCodeAt(src++);
		if(b1 < 0x80) {
			dst++;
		} else if(b1 < 0xE0) {
			b2 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0x1F) << 6) | (b2 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		} else {
			b2 = utf.charCodeAt(src++);
			b3 = utf.charCodeAt(src++);
			c = String.fromCharCode(((b1 & 0xF) << 12) | ((b2 & 0x3F) << 6) | (b3 & 0x3F));
			uni = uni.substring(0,dst++).concat(c,utf.substr(src));
		}
	}
	return uni;
}

function mozConvertUTF8ToUnicode(u)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUTF8ToUnicode(u);
	} // fallback
	var s = converter.ConvertToUnicode(u);
	var fin = converter.Finish();
	return fin.length > 0 ? s+fin : s;
}

function convertUnicodeToFileFormat(s)
{
	return config.browser.isOpera || !window.netscape ? (config.browser.isIE ? convertUnicodeToHtmlEntities(s) : s) : mozConvertUnicodeToUTF8(s);
}

function convertUnicodeToHtmlEntities(s)
{
	var re = /[^\u0000-\u007F]/g;
	return s.replace(re,function($0) {return "&#" + $0.charCodeAt(0).toString() + ";";});
}

function convertUnicodeToUTF8(s)
{
// return convertUnicodeToFileFormat to allow plugin migration
	return convertUnicodeToFileFormat(s);
}

function manualConvertUnicodeToUTF8(s)
{
	return unescape(encodeURIComponent(s));
}

function mozConvertUnicodeToUTF8(s)
{
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/scriptableunicodeconverter"].createInstance(Components.interfaces.nsIScriptableUnicodeConverter);
		converter.charset = "UTF-8";
	} catch(ex) {
		return manualConvertUnicodeToUTF8(s);
	} // fallback
	var u = converter.ConvertFromUnicode(s);
	var fin = converter.Finish();
	return fin.length > 0 ? u + fin : u;
}

function convertUriToUTF8(uri,charSet)
{
	if(window.netscape == undefined || charSet == undefined || charSet == "")
		return uri;
	try {
		netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect");
		var converter = Components.classes["@mozilla.org/intl/utf8converterservice;1"].getService(Components.interfaces.nsIUTF8ConverterService);
	} catch(ex) {
		return uri;
	}
	return converter.convertURISpecToUTF8(uri,charSet);
}
//--
//-- Server adaptor base class
//--

function AdaptorBase()
{
	this.host = null;
	this.store = null;
	return this;
}

AdaptorBase.prototype.close = function()
{
	return true;
};

AdaptorBase.prototype.fullHostName = function(host)
{
	if(!host)
		return '';
	host = host.trim();
	if(!host.match(/:\/\//))
		host = 'http://' + host;
	if(host.substr(host.length-1) == '/')
		host = host.substr(0,host.length-1);
	return host;
};

AdaptorBase.minHostName = function(host)
{
	return host;
};

AdaptorBase.prototype.setContext = function(context,userParams,callback)
{
	if(!context) context = {};
	context.userParams = userParams;
	if(callback) context.callback = callback;
	context.adaptor = this;
	if(!context.host)
		context.host = this.host;
	context.host = this.fullHostName(context.host);
	if(!context.workspace)
		context.workspace = this.workspace;
	return context;
};

// Open the specified host
AdaptorBase.prototype.openHost = function(host,context,userParams,callback)
{
	this.host = host;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {context.callback(context,userParams);},10);
	return true;
};

// Open the specified workspace
AdaptorBase.prototype.openWorkspace = function(workspace,context,userParams,callback)
{
	this.workspace = workspace;
	context = this.setContext(context,userParams,callback);
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

//--
//-- Server adaptor for talking to static TiddlyWiki files
//--

function FileAdaptor()
{
}

FileAdaptor.prototype = new AdaptorBase();

FileAdaptor.serverType = 'file';
FileAdaptor.serverLabel = 'TiddlyWiki';

FileAdaptor.loadTiddlyWikiSuccess = function(context,jqXHR)
{
	context.status = true;
	context.adaptor.store = new TiddlyWiki();
	if(!context.adaptor.store.importTiddlyWiki(jqXHR.responseText)) {
		context.statusText = config.messages.invalidFileError.format([context.host]);
		context.status = false;
	}
	context.complete(context,context.userParams);
};

FileAdaptor.loadTiddlyWikiError = function(context,jqXHR)
{
	context.status = false;
	context.statusText = jqXHR.message;
	context.complete(context,context.userParams);
};

// Get the list of workspaces on a given server
FileAdaptor.prototype.getWorkspaceList = function(context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.workspaces = [{title:"(default)"}];
	context.status = true;
	if(callback)
		window.setTimeout(function() {callback(context,userParams);},10);
	return true;
};

// Gets the list of tiddlers within a given workspace
FileAdaptor.prototype.getTiddlerList = function(context,userParams,callback,filter)
{
	context = this.setContext(context,userParams,callback);
	if(!context.filter)
		context.filter = filter;
	context.complete = FileAdaptor.getTiddlerListComplete;
	if(this.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		file:context.file, // for HTML5 FileReader
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			context.xhr = jqXHR;
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerListComplete = function(context,userParams)
{
	if(context.status) {
		if(context.filter) {
			context.tiddlers = context.adaptor.store.filterTiddlers(context.filter);
		} else {
			context.tiddlers = [];
			context.adaptor.store.forEachTiddler(function(title,tiddler) {context.tiddlers.push(tiddler);});
		}
		var i;
		for(i=0; i<context.tiddlers.length; i++) {
			context.tiddlers[i].fields['server.type'] = FileAdaptor.serverType;
			context.tiddlers[i].fields['server.host'] = AdaptorBase.minHostName(context.host);
			context.tiddlers[i].fields['server.page.revision'] = context.tiddlers[i].modified.convertToYYYYMMDDHHMM();
		}
		context.status = true;
	}
	if(context.callback) {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.generateTiddlerInfo = function(tiddler)
{
	var info = {};
	info.uri = tiddler.fields['server.host'] + "#" + tiddler.title;
	return info;
};

// Retrieve a tiddler from a given workspace on a given server
FileAdaptor.prototype.getTiddler = function(title,context,userParams,callback)
{
	context = this.setContext(context,userParams,callback);
	context.title = title;
	context.complete = FileAdaptor.getTiddlerComplete;
	if(context.adaptor.store) {
		return context.complete(context,context.userParams);
	}
	var options = {
		type:"GET",
		url:context.host,
		processData:false,
		success:function(data,textStatus,jqXHR) {
			FileAdaptor.loadTiddlyWikiSuccess(context,jqXHR);
		},
		error:function(jqXHR,textStatus,errorThrown) {
			FileAdaptor.loadTiddlyWikiError(context,jqXHR);
		}
	};
	return ajaxReq(options);
};

FileAdaptor.getTiddlerComplete = function(context,userParams)
{
	var t = context.adaptor.store.fetchTiddler(context.title);
	if(t) {
		t.fields['server.type'] = FileAdaptor.serverType;
		t.fields['server.host'] = AdaptorBase.minHostName(context.host);
		t.fields['server.page.revision'] = t.modified.convertToYYYYMMDDHHMM();
		context.tiddler = t;
		context.status = true;
	} else { //# tiddler does not exist in document
		context.status = false;
	}
	if(context.allowSynchronous) {
		context.isSynchronous = true;
		context.callback(context,userParams);
	} else {
		window.setTimeout(function() {context.callback(context,userParams);},10);
	}
	return true;
};

FileAdaptor.prototype.close = function()
{
	this.store = null;
};

config.adaptors[FileAdaptor.serverType] = FileAdaptor;

config.defaultAdaptor = FileAdaptor.serverType;

//--
//-- HTTP request code
//--

function ajaxReq(args)
{
	if (args.file || args.url.startsWith("file"))  // LOCAL FILE
		return localAjax(args);
	return jQuery.ajax(args);
}

function localAjax(args)
{
	var success=function(data)
		{ args.success(data,"success",{ responseText:data }); }
	var failure=function(who)
		{ args.error({ message:who+": cannot read local file" },"error",0); }

	if (args.file) try { // HTML5 FileReader (Chrome, FF20+, Safari, etc.)
		var reader=new FileReader();
		reader.onload=function(e)  { success(e.target.result); }
		reader.onerror=function(e) { failure("FileReader"); }
		reader.readAsText(args.file);
		return true;
	} catch (ex) { ; }

	try { // local file I/O (IE, FF with TiddlyFox, Chrome/Safari with TiddlySaver, etc.)
		var data=loadFile(getLocalPath(args.url));
		if (data) success(data);
		else failure("loadFile");
		return true;
	} catch (ex) { ; }

	return true;
}

function httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache)
{
	var httpSuccess = function(xhr) {
		try {
			// IE error sometimes returns 1223 when it should be 204 so treat it as success, see #1450
			return (!xhr.status && location.protocol === "file:") ||
				(xhr.status >= 200 && xhr.status < 300) ||
				xhr.status === 304 || xhr.status === 1223;
		} catch(e) {}
		return false;
	};

	var options = {
		type:type,
		url:url,
		processData:false,
		data:data,
		cache:!!allowCache,
		beforeSend: function(xhr) {
			var i;
			for(i in headers)
				xhr.setRequestHeader(i,headers[i]);
		}
	};

	if(callback) {
		options.complete = function(xhr,textStatus) {
			if(httpSuccess(xhr))
				callback(true,params,xhr.responseText,url,xhr);
			else
				callback(false,params,null,url,xhr);
		};
	}
	if(contentType)
		options.contentType = contentType;
	if(username)
		options.username = username;
	if(password)
		options.password = password;
	try {
		if(window.Components && window.netscape && window.netscape.security && document.location.protocol.indexOf("http") == -1)
			window.netscape.security.PrivilegeManager.enablePrivilege("UniversalBrowserRead");
	} catch (ex) {
	}
	return jQuery.ajax(options);
}
//--
//-- TiddlyWiki-specific utility functions
//--

// Returns TiddlyWiki version string
function formatVersion(v)
{
	v = v || version;
	return v.major + "." + v.minor + "." + v.revision +
		(v.alpha ? " (alpha " + v.alpha + ")" : "") +
		(v.beta ? " (beta " + v.beta + ")" : "");
}

function compareVersions(v1,v2)
{
	var x1,x2,i,a = ["major","minor","revision"];
	for(i = 0; i<a.length; i++) {
		x1 = v1[a[i]] || 0;
		x2 = v2[a[i]] || 0;
		if(x1<x2)
			return 1;
		if(x1>x2)
			return -1;
	}
	x1 = v1.beta || 9999;
	x2 = v2.beta || 9999;
	if(x1<x2)
		return 1;
	return x1 > x2 ? -1 : 0;
}

function merge(dst,src,preserveExisting)
{
	var i;
	for(i in src) {
		if(!preserveExisting || dst[i] === undefined)
			dst[i] = src[i];
	}
	return dst;
}

// Resolve the target object of an event
function resolveTarget(e)
{
	var obj;
	if(e.target)
		obj = e.target;
	else if(e.srcElement)
		obj = e.srcElement;
	if(obj.nodeType == 3) // defeat Safari bug
		obj = obj.parentNode;
	return obj;
}

// Returns a string containing the description of an exception, optionally prepended by a message
function exceptionText(e,message)
{
	var s = e.description || e.toString();
	return message ? "%0:\n%1".format([message,s]) : s;
}

// Displays an alert of an exception description with optional message
function showException(e,message)
{
	alert(exceptionText(e,message));
}

function alertAndThrow(m)
{
	alert(m);
	throw(m);
}

function glyph(name)
{
	var g = config.glyphs;
	var b = g.currBrowser;
	if(b == null) {
		b = 0;
		while(b < g.browsers.length-1 && !g.browsers[b]())
			b++;
		g.currBrowser = b;
	}
	if(!g.codes[name])
		return "";
	return g.codes[name][b];
}

function createTiddlyText(parent,text)
{
	return parent.appendChild(document.createTextNode(text));
}

function createTiddlyCheckbox(parent,caption,checked,onChange)
{
	var cb = document.createElement("input");
	cb.setAttribute("type","checkbox");
	cb.onclick = onChange;
	parent.appendChild(cb);
	cb.checked = checked;
	cb.className = "chkOptionInput";
	if(caption)
		wikify(caption,parent);
	return cb;
}

function createTiddlyElement(parent,element,id,className,text,attribs)
{
	var n,e = document.createElement(element);
	if(className != null)
		e.className = className;
	if(id != null)
		e.setAttribute("id",id);
	if(text != null)
		e.appendChild(document.createTextNode(text));
	if(attribs) {
		for(n in attribs) {
			e.setAttribute(n,attribs[n]);
		}
	}
	if(parent != null)
		parent.appendChild(e);
	return e;
}

function createTiddlyButton(parent,text,tooltip,action,className,id,accessKey,attribs)
{
	var i,btn = document.createElement("a");
	btn.setAttribute("href","javascript:;");
	if(action) {
		btn.onclick = action;
	}
	if(tooltip)
		btn.setAttribute("title",tooltip);
	if(text)
		btn.appendChild(document.createTextNode(text));
	btn.className = className || "button";
	if(id)
		btn.id = id;
	if(attribs) {
		for(i in attribs) {
			btn.setAttribute(i,attribs[i]);
		}
	}
	if(parent)
		parent.appendChild(btn);
	if(accessKey)
		btn.setAttribute("accessKey",accessKey);
	return btn;
}

function createExternalLink(place,url,label)
{
	var link = document.createElement("a");
	link.className = "externalLink";
	link.href = url;
	var f = config.messages.externalLinkTooltip;
	link.title = f ? f.format([url]) : url;
	if(config.options.chkOpenInNewWindow)
		link.target = "_blank";
	place.appendChild(link);
	if(label)
		createTiddlyText(link, label);
	return link;
}

function getTiddlyLinkInfo(title,currClasses)
{
	var classes = currClasses ? currClasses.split(" ") : [];
	classes.pushUnique("tiddlyLink");
	var tiddler = store.fetchTiddler(title);
	var subTitle;
	if(tiddler) {
		subTitle = tiddler.getSubtitle();
		classes.pushUnique("tiddlyLinkExisting");
		classes.remove("tiddlyLinkNonExisting");
		classes.remove("shadow");
	} else {
	    var f;
		classes.remove("tiddlyLinkExisting");
		classes.pushUnique("tiddlyLinkNonExisting");
		if(store.isShadowTiddler(title)) {
			f = config.messages.shadowedTiddlerToolTip;
			classes.pushUnique("shadow");
		} else {
			f = config.messages.undefinedTiddlerToolTip;
			classes.remove("shadow");
		}
		subTitle = f ? f.format([title]) : "";
	}
	if(typeof config.annotations[title]=="string")
		subTitle = config.annotations[title];
	return {classes: classes.join(" "),subTitle: subTitle};
}

// Event handler for clicking on a tiddly link
function onClickTiddlerLink(ev)
{
	var e = ev || window.event;
	var target = resolveTarget(e);
	var link = target;
	var title = null;
	var fields = null;
	var noToggle = null;
	do {
		title = link.getAttribute("tiddlyLink");
		fields = link.getAttribute("tiddlyFields");
		noToggle = link.getAttribute("noToggle");
		link = link.parentNode;
	} while(title == null && link != null);
	if(!store.isShadowTiddler(title)) {
		var f = fields ? fields.decodeHashMap() : {};
		fields = String.encodeHashMap(merge(f,config.defaultCustomFields,true));
	}
	if(title) {
		var toggling = e.metaKey || e.ctrlKey;
		if(config.options.chkToggleLinks)
			toggling = !toggling;
		if(noToggle)
			toggling = false;
		if(store.getTiddler(title))
			fields = null;
		story.displayTiddler(target,title,null,true,null,fields,toggling);
	}
	clearMessage();
	return false;
}

function createTiddlyLink(place,title,includeText,className,isStatic,linkedFromTiddler,noToggle)
{
	var title = jQuery.trim(title);
	var text = includeText ? title : null;
	var i = getTiddlyLinkInfo(title,className);
	var btn = isStatic ? createExternalLink(place,store.getTiddlerText("SiteUrl",null) + "#" + title) : createTiddlyButton(place,text,i.subTitle,onClickTiddlerLink,i.classes);
	if(isStatic)
		btn.className += ' ' + className;
	btn.setAttribute("refresh","link");
	btn.setAttribute("tiddlyLink",title);
	if(noToggle)
		btn.setAttribute("noToggle","true");
	if(linkedFromTiddler) {
		var fields = linkedFromTiddler.getInheritedFields();
		if(fields)
			btn.setAttribute("tiddlyFields",fields);
	}
	return btn;
}

function refreshTiddlyLink(e,title)
{
	var i = getTiddlyLinkInfo(title,e.className);
	e.className = i.classes;
	e.title = i.subTitle;
}

function createTiddlyDropDown(place,onchange,options,defaultValue)
{
	var sel = createTiddlyElement(place,"select");
	sel.onchange = onchange;
	var t;
	for(t=0; t<options.length; t++) {
		var e = createTiddlyElement(sel,"option",null,null,options[t].caption);
		e.value = options[t].name;
		if(options[t].name == defaultValue)
			e.selected = true;
	}
	return sel;
}

//--
//-- TiddlyWiki-specific popup utility functions
//--

// Event handler for 'open all' on a tiddler popup
function onClickTagOpenAll(ev)
{
	var tiddlers = store.getTaggedTiddlers(this.getAttribute("tag"));
	var sortby = this.getAttribute("sortby");
	if(sortby&&sortby.length) {
		store.sortTiddlers(tiddlers,sortby);
	}
	story.displayTiddlers(this,tiddlers);
	return false;
}

// Event handler for clicking on a tiddler tag
function onClickTag(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	jQuery(popup).addClass("taggedTiddlerList");
	var tag = this.getAttribute("tag");
	var title = this.getAttribute("tiddler");
	if(popup && tag) {
		var tagged = tag.indexOf("[")==-1 ? store.getTaggedTiddlers(tag) : store.filterTiddlers(tag);
		var sortby = this.getAttribute("sortby");
		if(sortby&&sortby.length) {
			store.sortTiddlers(tagged,sortby);
		}
		var titles = [];
		var r;
		for(r=0;r<tagged.length;r++) {
			if(tagged[r].title != title)
				titles.push(tagged[r].title);
		}
		var lingo = config.views.wikified.tag;
		if(titles.length > 0) {
			var openAll = createTiddlyButton(createTiddlyElement(popup,"li"),lingo.openAllText.format([tag]),lingo.openAllTooltip,onClickTagOpenAll);
			openAll.setAttribute("tag",tag);
			openAll.setAttribute("sortby",sortby);
			createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
			for(r=0; r<titles.length; r++) {
				createTiddlyLink(createTiddlyElement(popup,"li"),titles[r],true);
			}
		} else {
			createTiddlyElement(popup,"li",null,"disabled",lingo.popupNone.format([tag]));
		}
		createTiddlyElement(createTiddlyElement(popup,"li",null,"listBreak"),"div");
		var h = createTiddlyLink(createTiddlyElement(popup,"li"),tag,false);
		createTiddlyText(h,lingo.openTag.format([tag]));
	}
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

// Create a button for a tag with a popup listing all the tiddlers that it tags
function createTagButton(place,tag,excludeTiddler,title,tooltip)
{
	var btn = createTiddlyButton(place,title||tag,(tooltip||config.views.wikified.tag.tooltip).format([tag]),onClickTag);
	btn.setAttribute("tag",tag);
	if(excludeTiddler)
		btn.setAttribute("tiddler",excludeTiddler);
	return btn;
}

function onClickTiddlyPopup(ev)
{
	var e = ev || window.event;
	var tiddler = this.tiddler;
	if(tiddler.text) {
		var popup = Popup.create(this,"div","popupTiddler");
		wikify(tiddler.text,popup,null,tiddler);
		Popup.show();
	}
	if(e) e.cancelBubble = true;
	if(e && e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyPopup(place,caption,tooltip,tiddler)
{
	if(tiddler.text) {
		createTiddlyLink(place,caption,true);
		var btn = createTiddlyButton(place,glyph("downArrow"),tooltip,onClickTiddlyPopup,"tiddlerPopupButton");
		btn.tiddler = tiddler;
	} else {
		createTiddlyText(place,caption);
	}
}

function onClickError(ev)
{
	var e = ev || window.event;
	var popup = Popup.create(this);
	var lines = this.getAttribute("errorText").split("\n");
	var t;
	for(t=0; t<lines.length; t++)
		createTiddlyElement(popup,"li",null,null,lines[t]);
	Popup.show();
	e.cancelBubble = true;
	if(e.stopPropagation) e.stopPropagation();
	return false;
}

function createTiddlyError(place,title,text)
{
	var btn = createTiddlyButton(place,title,null,onClickError,"errorButton");
	if(text) btn.setAttribute("errorText",text);
}
//-
//- Animation engine
//-

function Animator()
{
	this.running = 0; // Incremented at start of each animation, decremented afterwards. If zero, the interval timer is disabled
	this.timerID = 0; // ID of the timer used for animating
	this.animations = []; // List of animations in progress
	return this;
}

// Start animation engine
Animator.prototype.startAnimating = function() //# Variable number of arguments
{
	var t;
	for(t=0; t<arguments.length; t++)
		this.animations.push(arguments[t]);
	if(this.running == 0) {
		var me = this;
		this.timerID = window.setInterval(function() {me.doAnimate(me);},10);
	}
	this.running += arguments.length;
};

// Perform an animation engine tick, calling each of the known animation modules
Animator.prototype.doAnimate = function(me)
{
	var a = 0;
	while(a < me.animations.length) {
		var animation = me.animations[a];
		if(animation.tick()) {
			a++;
		} else {
			me.animations.splice(a,1);
			if(--me.running == 0)
				window.clearInterval(me.timerID);
		}
	}
};

Animator.slowInSlowOut = function(progress)
{
	return(1-((Math.cos(progress * Math.PI)+1)/2));
};

//--
//-- Morpher animation
//--

// Animate a set of properties of an element
function Morpher(element,duration,properties,callback)
{
	this.element = element;
	this.duration = duration;
	this.properties = properties;
	this.startTime = new Date();
	this.endTime = Number(this.startTime) + duration;
	this.callback = callback;
	this.tick();
	return this;
}

Morpher.prototype.assignStyle = function(element,style,value)
{
	switch(style) {
	case "-tw-vertScroll":
		window.scrollTo(findScrollX(),value);
		break;
	case "-tw-horizScroll":
		window.scrollTo(value,findScrollY());
		break;
	default:
		element.style[style] = value;
		break;
	}
};

Morpher.prototype.stop = function()
{
	var t;
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.atEnd !== undefined) {
			this.assignStyle(this.element,p.style,p.atEnd);
		}
	}
	if(this.callback)
		this.callback(this.element,this.properties);
};

Morpher.prototype.tick = function()
{
	var currTime = Number(new Date());
	var t,progress = Animator.slowInSlowOut(Math.min(1,(currTime-this.startTime)/this.duration));
	for(t=0; t<this.properties.length; t++) {
		var p = this.properties[t];
		if(p.start !== undefined && p.end !== undefined) {
			var template = p.template || "%0";
			switch(p.format) {
			case undefined:
			case "style":
				var v = p.start + (p.end-p.start) * progress;
				this.assignStyle(this.element,p.style,template.format([v]));
				break;
			case "color":
				break;
			}
		}
	}
	if(currTime >= this.endTime) {
		this.stop();
		return false;
	}
	return true;
};

//--
//-- Zoomer animation
//--

function Zoomer(text,startElement,targetElement,unused)
{
	var e = createTiddlyElement(document.body,"div",null,"zoomer");
	createTiddlyElement(e,"div",null,null,text);
	var winWidth = findWindowWidth();
	var winHeight = findWindowHeight();
	var p = [
		{style: 'left', start: findPosX(startElement), end: findPosX(targetElement), template: '%0px'},
		{style: 'top', start: findPosY(startElement), end: findPosY(targetElement), template: '%0px'},
		{style: 'width', start: Math.min(startElement.scrollWidth,winWidth), end: Math.min(targetElement.scrollWidth,winWidth), template: '%0px', atEnd: 'auto'},
		{style: 'height', start: Math.min(startElement.scrollHeight,winHeight), end: Math.min(targetElement.scrollHeight,winHeight), template: '%0px', atEnd: 'auto'},
		{style: 'fontSize', start: 8, end: 24, template: '%0pt'}
	];
	var c = function(element,properties) {jQuery(element).remove();};
	return new Morpher(e,config.animDuration,p,c);
}

//--
//-- Scroller animation
//--

function Scroller(targetElement)
{
	var p = [{style: '-tw-vertScroll', start: findScrollY(), end: ensureVisible(targetElement)}];
	return new Morpher(targetElement,config.animDuration,p);
}

//--
//-- Slider animation
//--

// deleteMode - "none", "all" [delete target element and it's children], [only] "children" [but not the target element]
function Slider(element,opening,unused,deleteMode)
{
	element.style.overflow = 'hidden';
	if(opening)
		element.style.height = '0px'; // Resolves a Firefox flashing bug
	element.style.display = 'block';
	var height = element.scrollHeight;
	var p = [];
	var c = null;
	if(opening) {
		p.push({style: 'height', start: 0, end: height, template: '%0px', atEnd: 'auto'});
		p.push({style: 'opacity', start: 0, end: 1, template: '%0'});
		p.push({style: 'filter', start: 0, end: 100, template: 'alpha(opacity:%0)'});
	} else {
		p.push({style: 'height', start: height, end: 0, template: '%0px'});
		p.push({style: 'display', atEnd: 'none'});
		p.push({style: 'opacity', start: 1, end: 0, template: '%0'});
		p.push({style: 'filter', start: 100, end: 0, template: 'alpha(opacity:%0)'});
		switch(deleteMode) {
		case "all":
			c = function(element,properties) {jQuery(element).remove();};
			break;
		case "children":
			c = function(element,properties) {jQuery(element).empty();};
			break;
		}
	}
	return new Morpher(element,config.animDuration,p,c);
}

//--
//-- Popup menu
//--

var Popup = {
	stack: [] // Array of objects with members root: and popup:
	};

Popup.create = function(root,elem,className)
{
	var stackPosition = this.find(root,"popup");
	Popup.remove(stackPosition+1);
	var popup = createTiddlyElement(document.body,elem || "ol","popup",className || "popup");
	popup.stackPosition = stackPosition;
	Popup.stack.push({root: root, popup: popup});
	return popup;
};

Popup.onDocumentClick = function(ev)
{
	var e = ev || window.event;
	if(e.eventPhase == undefined)
		Popup.remove();
	else if(e.eventPhase == Event.BUBBLING_PHASE || e.eventPhase == Event.AT_TARGET)
		Popup.remove();
	return true;
};

Popup.show = function(valign,halign,offset)
{
	var curr = Popup.stack[Popup.stack.length-1];
	this.place(curr.root,curr.popup,valign,halign,offset);
	jQuery(curr.root).addClass("highlight");
	if(config.options.chkAnimate && anim && typeof Scroller == "function")
		anim.startAnimating(new Scroller(curr.popup));
	else
		window.scrollTo(0,ensureVisible(curr.popup));
};

Popup.place = function(root,popup,valign,halign,offset)
{
	if(!offset)
		offset = {x:0,y:0};
	if(popup.stackPosition >= 0 && !valign && !halign) {
		offset.x = offset.x + root.offsetWidth;
	} else {
		offset.x = (halign == "right") ? offset.x + root.offsetWidth : offset.x;
		offset.y = (valign == "top") ? offset.y : offset.y + root.offsetHeight;
	}
	var rootLeft = findPosX(root);
	var rootTop = findPosY(root);
	var popupLeft = rootLeft + offset.x;
	var popupTop = rootTop + offset.y;
	var winWidth = findWindowWidth();
	if(popup.offsetWidth > winWidth*0.75)
		popup.style.width = winWidth*0.75 + "px";
	var popupWidth = popup.offsetWidth;
	var scrollWidth = winWidth - document.body.offsetWidth;
	if(popupLeft + popupWidth > winWidth - scrollWidth - 1) {
		if(halign == "right")
			popupLeft = popupLeft - root.offsetWidth - popupWidth;
		else
			popupLeft = winWidth - popupWidth - scrollWidth - 1;
	}
	popup.style.left = popupLeft + "px";
	popup.style.top = popupTop + "px";
	popup.style.display = "block";
};

Popup.find = function(e)
{
	var t,pos = -1;
	for(t=this.stack.length-1; t>=0; t--) {
		if(isDescendant(e,this.stack[t].popup))
			pos = t;
	}
	return pos;
};

Popup.remove = function(pos)
{
	if(!pos) pos = 0;
	if(Popup.stack.length > pos) {
		Popup.removeFrom(pos);
	}
};

Popup.removeFrom = function(from)
{
	var t;
	for(t=Popup.stack.length-1; t>=from; t--) {
		var p = Popup.stack[t];
		jQuery(p.root).removeClass("highlight");
		jQuery(p.popup).remove();
	}
	Popup.stack = Popup.stack.slice(0,from);
};

//--
//-- Wizard support
//--

function Wizard(elem)
{
	if(elem) {
		this.formElem = findRelated(elem,"wizard","className");
		this.bodyElem = findRelated(this.formElem.firstChild,"wizardBody","className","nextSibling");
		this.footElem = findRelated(this.formElem.firstChild,"wizardFooter","className","nextSibling");
	} else {
		this.formElem = null;
		this.bodyElem = null;
		this.footElem = null;
	}
}

Wizard.prototype.setValue = function(name,value)
{
	jQuery(this.formElem).data(name, value);
};

Wizard.prototype.getValue = function(name)
{
	return this.formElem ? jQuery(this.formElem).data(name) : null;
};

Wizard.prototype.createWizard = function(place,title)
{
	this.formElem = createTiddlyElement(place,"form",null,"wizard");
	createTiddlyElement(this.formElem,"h1",null,null,title);
	this.bodyElem = createTiddlyElement(this.formElem,"div",null,"wizardBody");
	this.footElem = createTiddlyElement(this.formElem,"div",null,"wizardFooter");
	return this.formElem;
};

Wizard.prototype.clear = function()
{
	jQuery(this.bodyElem).empty();
};

Wizard.prototype.setButtons = function(buttonInfo,status)
{
	jQuery(this.footElem).empty();
	var t;
	for(t=0; t<buttonInfo.length; t++) {
		createTiddlyButton(this.footElem,buttonInfo[t].caption,buttonInfo[t].tooltip,buttonInfo[t].onClick);
		insertSpacer(this.footElem);
		}
	if(typeof status == "string") {
		createTiddlyElement(this.footElem,"span",null,"status",status);
	}
};

Wizard.prototype.addStep = function(stepTitle,html)
{
	jQuery(this.bodyElem).empty();
	var w = createTiddlyElement(this.bodyElem,"div");
	createTiddlyElement(w,"h2",null,null,stepTitle);
	var step = createTiddlyElement(w,"div",null,"wizardStep");
	step.innerHTML = html;
	applyHtmlMacros(step,tiddler);
};

Wizard.prototype.getElement = function(name)
{
	return this.formElem.elements[name];
};

//--
//-- ListView gadget
//--

var ListView = {};

// Create a listview
ListView.create = function(place,listObject,listTemplate,callback,className)
{
	var table = createTiddlyElement(place,"table",null,className || "listView twtable");
	var thead = createTiddlyElement(table,"thead");
	var t,r = createTiddlyElement(thead,"tr");
	for(t=0; t<listTemplate.columns.length; t++) {
		var columnTemplate = listTemplate.columns[t];
		var c = createTiddlyElement(r,"th");
		var colType = ListView.columnTypes[columnTemplate.type];
		if(colType && colType.createHeader) {
			colType.createHeader(c,columnTemplate,t);
			if(columnTemplate.className)
				jQuery(c).addClass(columnTemplate.className);
		}
	}
	var rc,tbody = createTiddlyElement(table,"tbody");
	for(rc=0; rc<listObject.length; rc++) {
		var rowObject = listObject[rc];
		r = createTiddlyElement(tbody,"tr");
		for(c=0; c<listTemplate.rowClasses.length; c++) {
			if(rowObject[listTemplate.rowClasses[c].field])
				jQuery(r).addClass(listTemplate.rowClasses[c].className);
		}
		rowObject.rowElement = r;
		rowObject.colElements = {};
		var cc;
		for(cc=0; cc<listTemplate.columns.length; cc++) {
			c = createTiddlyElement(r,"td");
			columnTemplate = listTemplate.columns[cc];
			var field = columnTemplate.field;
			colType = ListView.columnTypes[columnTemplate.type];
			if(colType && colType.createItem) {
				colType.createItem(c,rowObject,field,columnTemplate,cc,rc);
				if(columnTemplate.className)
					jQuery(c).addClass(columnTemplate.className);
			}
			rowObject.colElements[field] = c;
		}
	}
	if(callback && listTemplate.actions)
		createTiddlyDropDown(place,ListView.getCommandHandler(callback),listTemplate.actions);
	if(callback && listTemplate.buttons) {
		for(t=0; t<listTemplate.buttons.length; t++) {
			var a = listTemplate.buttons[t];
			if(a && a.name != "")
				createTiddlyButton(place,a.caption,null,ListView.getCommandHandler(callback,a.name,a.allowEmptySelection));
		}
	}
	return table;
};

ListView.getCommandHandler = function(callback,name,allowEmptySelection)
{
	return function(e) {
		var view = findRelated(this,"TABLE",null,"previousSibling");
		var tiddlers = [];
		ListView.forEachSelector(view,function(e,rowName) {
					if(e.checked)
						tiddlers.push(rowName);
					});
		if(tiddlers.length == 0 && !allowEmptySelection) {
			alert(config.messages.nothingSelected);
		} else {
			if(this.nodeName.toLowerCase() == "select") {
				callback(view,this.value,tiddlers);
				this.selectedIndex = 0;
			} else {
				callback(view,name,tiddlers);
			}
		}
	};
};

// Invoke a callback for each selector checkbox in the listview
ListView.forEachSelector = function(view,callback)
{
	var checkboxes = view.getElementsByTagName("input");
	var t,hadOne = false;
	for(t=0; t<checkboxes.length; t++) {
		var cb = checkboxes[t];
		if(cb.getAttribute("type") == "checkbox") {
			var rn = cb.getAttribute("rowName");
			if(rn) {
				callback(cb,rn);
				hadOne = true;
			}
		}
	}
	return hadOne;
};

ListView.getSelectedRows = function(view)
{
	var rowNames = [];
	ListView.forEachSelector(view,function(e,rowName) {
				if(e.checked)
					rowNames.push(rowName);
				});
	return rowNames;
};

ListView.columnTypes = {};

ListView.columnTypes.String = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyText(place,columnTemplate.title);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v);
		}
};

ListView.columnTypes.WikiText = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				wikify(v,place,null,null);
		}
};

ListView.columnTypes.Tiddler = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined && v.title)
				createTiddlyPopup(place,v.title,config.messages.listView.tiddlerTooltip,v);
		}
};

ListView.columnTypes.Size = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var msg = config.messages.sizeTemplates;
			var v = listObject[field];
			if(v != undefined) {
				var t = 0;
				while(t<msg.length-1 && v<msg[t].unit)
					t++;
				createTiddlyText(place,msg[t].template.format([Math.round(v/msg[t].unit)]));
			}
		}
};

ListView.columnTypes.Link = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			var c = columnTemplate.text;
			if(v != undefined)
				createExternalLink(place,v,c || v);
		}
};

ListView.columnTypes.Date = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined)
				createTiddlyText(place,v.formatString(columnTemplate.dateFormat));
		}
};

ListView.columnTypes.StringList = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var t;
				for(t=0; t<v.length; t++) {
					createTiddlyText(place,v[t]);
					createTiddlyElement(place,"br");
				}
			}
		}
};

ListView.columnTypes.Selector = {
	createHeader: function(place,columnTemplate,col)
		{
			createTiddlyCheckbox(place,null,false,this.onHeaderChange);
		},
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],null);
			e.setAttribute("rowName",listObject[columnTemplate.rowName]);
		},
	onHeaderChange: function(e)
		{
			var state = this.checked;
			var view = findRelated(this,"TABLE");
			if(!view)
				return;
			ListView.forEachSelector(view,function(e,rowName) {
								e.checked = state;
							});
		}
};

ListView.columnTypes.Tags = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var tags = listObject[field];
			createTiddlyText(place,String.encodeTiddlyLinkList(tags));
		}
};

ListView.columnTypes.Boolean = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			if(listObject[field] == true)
				createTiddlyText(place,columnTemplate.trueText);
			if(listObject[field] == false)
				createTiddlyText(place,columnTemplate.falseText);
		}
};

ListView.columnTypes.TagCheckbox = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var e = createTiddlyCheckbox(place,null,listObject[field],this.onChange);
			e.setAttribute("tiddler",listObject.title);
			e.setAttribute("tag",columnTemplate.tag);
		},
	onChange : function(e)
		{
			var tag = this.getAttribute("tag");
			var tiddler = this.getAttribute("tiddler");
			store.setTiddlerTag(tiddler,this.checked,tag);
		}
};

ListView.columnTypes.TiddlerLink = {
	createHeader: ListView.columnTypes.String.createHeader,
	createItem: function(place,listObject,field,columnTemplate,col,row)
		{
			var v = listObject[field];
			if(v != undefined) {
				var link = createTiddlyLink(place,listObject[columnTemplate.tiddlerLink],false,null);
				createTiddlyText(link,listObject[field]);
			}
		}
};

//--
//-- Augmented methods for the JavaScript Array() object
//--

// Add indexOf function if browser does not support it
if(!Array.indexOf) {
Array.prototype.indexOf = function(item,from)
{
	if(!from)
		from = 0;
	var i;
	for(i=from; i<this.length; i++) {
		if(this[i] === item)
			return i;
	}
	return -1;
};}

// Find an entry in a given field of the members of an array
Array.prototype.findByField = function(field,value)
{
	var t;
	for(t=0; t<this.length; t++) {
		if(this[t][field] === value)
			return t;
	}
	return null;
};

// Return whether an entry exists in an array
Array.prototype.contains = function(item)
{
	return this.indexOf(item) != -1;
};

// Adds, removes or toggles a particular value within an array
//  value - value to add
//  mode - +1 to add value, -1 to remove value, 0 to toggle it
Array.prototype.setItem = function(value,mode)
{
	var p = this.indexOf(value);
	if(mode == 0)
		mode = (p == -1) ? +1 : -1;
	if(mode == +1) {
		if(p == -1)
			this.push(value);
	} else if(mode == -1) {
		if(p != -1)
			this.splice(p,1);
	}
};

// Return whether one of a list of values exists in an array
Array.prototype.containsAny = function(items)
{
	var i;
	for(i=0; i<items.length; i++) {
		if(this.indexOf(items[i]) != -1)
			return true;
	}
	return false;
};

// Return whether all of a list of values exists in an array
Array.prototype.containsAll = function(items)
{
	var i;
	for(i = 0; i<items.length; i++) {
		if(this.indexOf(items[i]) == -1)
			return false;
	}
	return true;
};

// Push a new value into an array only if it is not already present in the array. If the optional unique parameter is false, it reverts to a normal push
Array.prototype.pushUnique = function(item,unique)
{
	if(unique === false) {
		this.push(item);
	} else {
		if(this.indexOf(item) == -1)
			this.push(item);
	}
};

Array.prototype.remove = function(item)
{
	var p = this.indexOf(item);
	if(p != -1)
		this.splice(p,1);
};

if(!Array.prototype.map) {
Array.prototype.map = function(fn,thisObj)
{
	var scope = thisObj || window;
	var i,j,a = [];
	for(i=0, j=this.length; i < j; ++i) {
		a.push(fn.call(scope,this[i],i,this));
	}
	return a;
};}

//--
//-- Augmented methods for the JavaScript String() object
//--

// Get characters from the right end of a string
String.prototype.right = function(n)
{
	return n < this.length ? this.slice(this.length-n) : this;
};

// Trim whitespace from both ends of a string
String.prototype.trim = function()
{
	return this.replace(/^\s*|\s*$/g,"");
};

// Convert a string from a CSS style property name to a JavaScript style name ("background-color" -> "backgroundColor")
String.prototype.unDash = function()
{
	var t,s = this.split("-");
	if(s.length > 1) {
		for(t=1; t<s.length; t++)
			s[t] = s[t].substr(0,1).toUpperCase() + s[t].substr(1);
	}
	return s.join("");
};

// Substitute substrings from an array into a format string that includes '%1'-type specifiers
String.prototype.format = function(s)
{
	var substrings = s && s.constructor == Array ? s : arguments;
	var subRegExp = /(?:%(\d+))/mg;
	var currPos = 0;
	var match,r = [];
	do {
		match = subRegExp.exec(this);
		if(match && match[1]) {
			if(match.index > currPos)
				r.push(this.substring(currPos,match.index));
			r.push(substrings[parseInt(match[1],10)]);
			currPos = subRegExp.lastIndex;
		}
	} while(match);
	if(currPos < this.length)
		r.push(this.substring(currPos,this.length));
	return r.join("");
};

// Escape any special RegExp characters with that character preceded by a backslash
String.prototype.escapeRegExp = function()
{
	var s = "\\^$*+?()=!|,{}[].";
	var t,c = this;
	for(t=0; t<s.length; t++)
		c = c.replace(new RegExp("\\" + s.substr(t,1),"g"),"\\" + s.substr(t,1));
	return c;
};

// Convert "\" to "\s", newlines to "\n" (and remove carriage returns)
String.prototype.escapeLineBreaks = function()
{
	return this.replace(/\\/mg,"\\s").replace(/\n/mg,"\\n").replace(/\r/mg,"");
};

// Convert "\n" to newlines, "\b" to " ", "\s" to "\" (and remove carriage returns)
String.prototype.unescapeLineBreaks = function()
{
	return this.replace(/\\n/mg,"\n").replace(/\\b/mg," ").replace(/\\s/mg,"\\").replace(/\r/mg,"");
};

// Convert & to "&amp;", < to "&lt;", > to "&gt;" and " to "&quot;"
String.prototype.htmlEncode = function()
{
	return this.replace(/&/mg,"&amp;").replace(/</mg,"&lt;").replace(/>/mg,"&gt;").replace(/\"/mg,"&quot;");
};

// Convert "&amp;" to &, "&lt;" to <, "&gt;" to > and "&quot;" to "
String.prototype.htmlDecode = function()
{
	return this.replace(/&lt;/mg,"<").replace(/&gt;/mg,">").replace(/&quot;/mg,"\"").replace(/&amp;/mg,"&");
};

// Parse a space-separated string of name:value parameters
// The result is an array of objects:
//   result[0] = object with a member for each parameter name, value of that member being an array of values
//   result[1..n] = one object for each parameter, with 'name' and 'value' members
String.prototype.parseParams = function(defaultName,defaultValue,allowEval,noNames,cascadeDefaults)
{
	var parseToken = function(match,p) {
		var n;
		if(match[p]) // Double quoted
			n = match[p];
		else if(match[p+1]) // Single quoted
			n = match[p+1];
		else if(match[p+2]) // Double-square-bracket quoted
			n = match[p+2];
		else if(match[p+3]) // Double-brace quoted
			try {
				n = match[p+3];
				if(allowEval && config.evaluateMacroParameters != "none") {
					if(config.evaluateMacroParameters == "restricted") {
						if(window.restrictedEval) {
							n = window.restrictedEval(n);
						}
					} else {
						n = window.eval(n);
					}
				}
			} catch(ex) {
				throw "Unable to evaluate {{" + match[p+3] + "}}: " + exceptionText(ex);
			}
		else if(match[p+4]) // Unquoted
			n = match[p+4];
		else if(match[p+5]) // empty quote
			n = "";
		return n;
	};
	var r = [{}];
	var dblQuote = "(?:\"((?:(?:\\\\\")|[^\"])+)\")";
	var sngQuote = "(?:'((?:(?:\\\\\')|[^'])+)')";
	var dblSquare = "(?:\\[\\[((?:\\s|\\S)*?)\\]\\])";
	var dblBrace = "(?:\\{\\{((?:\\s|\\S)*?)\\}\\})";
	var unQuoted = noNames ? "([^\"'\\s]\\S*)" : "([^\"':\\s][^\\s:]*)";
	var emptyQuote = "((?:\"\")|(?:''))";
	var skipSpace = "(?:\\s*)";
	var token = "(?:" + dblQuote + "|" + sngQuote + "|" + dblSquare + "|" + dblBrace + "|" + unQuoted + "|" + emptyQuote + ")";
	var re = noNames ? new RegExp(token,"mg") : new RegExp(skipSpace + token + skipSpace + "(?:(\\:)" + skipSpace + token + ")?","mg");
	var match;
	do {
		match = re.exec(this);
		if(match) {
			var n = parseToken(match,1);
			if(noNames) {
				r.push({name:"",value:n});
			} else {
				var v = parseToken(match,8);
				if(v == null && defaultName) {
					v = n;
					n = defaultName;
				} else if(v == null && defaultValue) {
					v = defaultValue;
				}
				r.push({name:n,value:v});
				if(cascadeDefaults) {
					defaultName = n;
					defaultValue = v;
				}
			}
		}
	} while(match);
	// Summarise parameters into first element
	var t;
	for(t=1; t<r.length; t++) {
		if(r[0][r[t].name])
			r[0][r[t].name].push(r[t].value);
		else
			r[0][r[t].name] = [r[t].value];
	}
	return r;
};

// Process a string list of macro parameters into an array. Parameters can be quoted with "", '',
// [[]], {{ }} or left unquoted (and therefore space-separated). Double-braces {{}} results in
// an *evaluated* parameter: e.g. {{config.options.txtUserName}} results in the current user's name.
String.prototype.readMacroParams = function(notAllowEval)
{
	var p = this.parseParams("list",null,!notAllowEval,true);
	var t,n = [];
	for(t=1; t<p.length; t++)
		n.push(p[t].value);
	return n;
};

// Process a string list of unique tiddler names into an array. Tiddler names that have spaces in them must be [[bracketed]]
String.prototype.readBracketedList = function(unique)
{
	var p = this.parseParams("list",null,false,true);
	var t,n = [];
	for(t=1; t<p.length; t++) {
		if(p[t].value)
			n.pushUnique(p[t].value,unique);
	}
	return n;
};

// Returns array with start and end index of chunk between given start and end marker, or undefined.
String.prototype.getChunkRange = function(start,end)
{
	var s = this.indexOf(start);
	if(s != -1) {
		s += start.length;
		var e = this.indexOf(end,s);
		if(e != -1)
			return [s,e];
	}
};

// Replace a chunk of a string given start and end markers
String.prototype.replaceChunk = function(start,end,sub)
{
	var r = this.getChunkRange(start,end);
	return r ? this.substring(0,r[0]) + sub + this.substring(r[1]) : this;
};

// Returns a chunk of a string between start and end markers, or undefined
String.prototype.getChunk = function(start,end)
{
	var r = this.getChunkRange(start,end);
	if(r)
		return this.substring(r[0],r[1]);
};


// Static method to bracket a string with double square brackets if it contains a space
String.encodeTiddlyLink = function(title)
{
	return title.indexOf(" ") == -1 ? title : "[[" + title + "]]";
};

// Static method to encodeTiddlyLink for every item in an array and join them with spaces
String.encodeTiddlyLinkList = function(list)
{
	if(list) {
		var t,results = [];
		for(t=0; t<list.length; t++)
			results.push(String.encodeTiddlyLink(list[t]));
		return results.join(" ");
	} else {
		return "";
	}
};

// Convert a string as a sequence of name:"value" pairs into a hashmap
String.prototype.decodeHashMap = function()
{
	var fields = this.parseParams("anon","",false);
	var t,r = {};
	for(t=1; t<fields.length; t++)
		r[fields[t].name] = fields[t].value;
	return r;
};

// Static method to encode a hashmap into a name:"value"... string
String.encodeHashMap = function(hashmap)
{
	var t,r = [];
	for(t in hashmap)
		r.push(t + ':"' + hashmap[t] + '"');
	return r.join(" ");
};

// Static method to left-pad a string with 0s to a certain width
String.zeroPad = function(n,d)
{
	var s = n.toString();
	if(s.length < d)
		s = "000000000000000000000000000".substr(0,d-s.length) + s;
	return s;
};

String.prototype.startsWith = function(prefix)
{
	return !prefix || this.substring(0,prefix.length) == prefix;
};

// Returns the first value of the given named parameter.
function getParam(params,name,defaultValue)
{
	if(!params)
		return defaultValue;
	var p = params[0][name];
	return p ? p[0] : defaultValue;
}

// Returns the first value of the given boolean named parameter.
function getFlag(params,name,defaultValue)
{
	return !!getParam(params,name,defaultValue);
}

//--
//-- Augmented methods for the JavaScript Date() object
//--

// Substitute date components into a string
Date.prototype.formatString = function(template)
{
	var t = template.replace(/0hh12/g,String.zeroPad(this.getHours12(),2));
	t = t.replace(/hh12/g,this.getHours12());
	t = t.replace(/0hh/g,String.zeroPad(this.getHours(),2));
	t = t.replace(/hh/g,this.getHours());
	t = t.replace(/mmm/g,config.messages.dates.shortMonths[this.getMonth()]);
	t = t.replace(/0mm/g,String.zeroPad(this.getMinutes(),2));
	t = t.replace(/mm/g,this.getMinutes());
	t = t.replace(/0ss/g,String.zeroPad(this.getSeconds(),2));
	t = t.replace(/ss/g,this.getSeconds());
	t = t.replace(/[ap]m/g,this.getAmPm().toLowerCase());
	t = t.replace(/[AP]M/g,this.getAmPm().toUpperCase());
	t = t.replace(/wYYYY/g,this.getYearForWeekNo());
	t = t.replace(/wYY/g,String.zeroPad(this.getYearForWeekNo()-2000,2));
	t = t.replace(/YYYY/g,this.getFullYear());
	t = t.replace(/YY/g,String.zeroPad(this.getFullYear()-2000,2));
	t = t.replace(/MMM/g,config.messages.dates.months[this.getMonth()]);
	t = t.replace(/0MM/g,String.zeroPad(this.getMonth()+1,2));
	t = t.replace(/MM/g,this.getMonth()+1);
	t = t.replace(/0WW/g,String.zeroPad(this.getWeek(),2));
	t = t.replace(/WW/g,this.getWeek());
	t = t.replace(/DDD/g,config.messages.dates.days[this.getDay()]);
	t = t.replace(/ddd/g,config.messages.dates.shortDays[this.getDay()]);
	t = t.replace(/0DD/g,String.zeroPad(this.getDate(),2));
	t = t.replace(/DDth/g,this.getDate()+this.daySuffix());
	t = t.replace(/DD/g,this.getDate());
	var tz = this.getTimezoneOffset();
	var atz = Math.abs(tz);
	t = t.replace(/TZD/g,(tz < 0 ? '+' : '-') + String.zeroPad(Math.floor(atz / 60),2) + ':' + String.zeroPad(atz % 60,2));
	t = t.replace(/\\/g,"");
	return t;
};

Date.prototype.getWeek = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week to calculate weekNo
	var n = Math.floor((dt.getTime()-new Date(dt.getFullYear(),0,1)+3600000)/86400000);
	return Math.floor(n/7)+1;
};

Date.prototype.getYearForWeekNo = function()
{
	var dt = new Date(this.getTime());
	var d = dt.getDay();
	if(d==0) d=7;// JavaScript Sun=0, ISO Sun=7
	dt.setTime(dt.getTime()+(4-d)*86400000);// shift day to Thurs of same week
	return dt.getFullYear();
};

Date.prototype.getHours12 = function()
{
	var h = this.getHours();
	return h > 12 ? h-12 : ( h > 0 ? h : 12 );
};

Date.prototype.getAmPm = function()
{
	return this.getHours() >= 12 ? config.messages.dates.pm : config.messages.dates.am;
};

Date.prototype.daySuffix = function()
{
	return config.messages.dates.daySuffixes[this.getDate()-1];
};

// Convert a date to local YYYYMMDDHHMM string format
Date.prototype.convertToLocalYYYYMMDDHHMM = function()
{
	return this.getFullYear() + String.zeroPad(this.getMonth()+1,2) + String.zeroPad(this.getDate(),2) + String.zeroPad(this.getHours(),2) + String.zeroPad(this.getMinutes(),2);
};

// Convert a date to UTC YYYYMMDDHHMM string format
Date.prototype.convertToYYYYMMDDHHMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2);
};

// Convert a date to UTC YYYYMMDD.HHMMSSMMM string format
Date.prototype.convertToYYYYMMDDHHMMSSMMM = function()
{
	return this.getUTCFullYear() + String.zeroPad(this.getUTCMonth()+1,2) + String.zeroPad(this.getUTCDate(),2) + "." + String.zeroPad(this.getUTCHours(),2) + String.zeroPad(this.getUTCMinutes(),2) + String.zeroPad(this.getUTCSeconds(),2) + String.zeroPad(this.getUTCMilliseconds(),3) +"0";
};

// Static method to create a date from a UTC YYYYMMDDHHMM format string
Date.convertFromYYYYMMDDHHMM = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,12));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSS format string
Date.convertFromYYYYMMDDHHMMSS = function(d)
{
	d = d?d.replace(/[^0-9]/g, ""):"";
	return Date.convertFromYYYYMMDDHHMMSSMMM(d.substr(0,14));
};

// Static method to create a date from a UTC YYYYMMDDHHMMSSMMM format string
Date.convertFromYYYYMMDDHHMMSSMMM = function(d)
{
	d = d ? d.replace(/[^0-9]/g, "") : "";
	return new Date(Date.UTC(parseInt(d.substr(0,4),10),
			parseInt(d.substr(4,2),10)-1,
			parseInt(d.substr(6,2),10),
			parseInt(d.substr(8,2)||"00",10),
			parseInt(d.substr(10,2)||"00",10),
			parseInt(d.substr(12,2)||"00",10),
			parseInt(d.substr(14,3)||"000",10)));
};

//--
//-- RGB colour object
//--

// Construct an RGB colour object from a '#rrggbb', '#rgb' or 'rgb(n,n,n)' string or from separate r,g,b values
function RGB(r,g,b)
{
	this.r = 0;
	this.g = 0;
	this.b = 0;
	if(typeof r == "string") {
		if(r.substr(0,1) == "#") {
			if(r.length == 7) {
				this.r = parseInt(r.substr(1,2),16)/255;
				this.g = parseInt(r.substr(3,2),16)/255;
				this.b = parseInt(r.substr(5,2),16)/255;
			} else {
				this.r = parseInt(r.substr(1,1),16)/15;
				this.g = parseInt(r.substr(2,1),16)/15;
				this.b = parseInt(r.substr(3,1),16)/15;
			}
		} else {
			var rgbPattern = /rgb\s*\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)/;
			var c = r.match(rgbPattern);
			if(c) {
				this.r = parseInt(c[1],10)/255;
				this.g = parseInt(c[2],10)/255;
				this.b = parseInt(c[3],10)/255;
			}
		}
	} else {
		this.r = r;
		this.g = g;
		this.b = b;
	}
	return this;
}

// Mixes this colour with another in a specified proportion
// c = other colour to mix
// f = 0..1 where 0 is this colour and 1 is the new colour
// Returns an RGB object
RGB.prototype.mix = function(c,f)
{
	return new RGB(this.r + (c.r-this.r) * f,this.g + (c.g-this.g) * f,this.b + (c.b-this.b) * f);
};

// Return an rgb colour as a #rrggbb format hex string
RGB.prototype.toString = function()
{
	var clamp = function(x,min,max) {
		return x < min ? min : (x > max ? max : x);
	};
	return "#" +
			("0" + Math.floor(clamp(this.r,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.g,0,1) * 255).toString(16)).right(2) +
			("0" + Math.floor(clamp(this.b,0,1) * 255).toString(16)).right(2);
};

//--
//-- DOM utilities - many derived from www.quirksmode.org
//--

function drawGradient(place,horiz,locolors,hicolors)
{
	if(!hicolors)
		hicolors = locolors;
	var t;
	for(t=0; t<= 100; t+=2) {
		var bar = document.createElement("div");
		place.appendChild(bar);
		bar.style.position = "absolute";
		bar.style.left = horiz ? t + "%" : 0;
		bar.style.top = horiz ? 0 : t + "%";
		bar.style.width = horiz ? (101-t) + "%" : "100%";
		bar.style.height = horiz ? "100%" : (101-t) + "%";
		bar.style.zIndex = -1;
		var p = t/100*(locolors.length-1);
		var hc = hicolors[Math.floor(p)];
		if(typeof hc == "string")
			hc = new RGB(hc);
		var lc = locolors[Math.ceil(p)];
		if(typeof lc == "string")
			lc = new RGB(lc);
		bar.style.backgroundColor = hc.mix(lc,p-Math.floor(p)).toString();
	}
}

function addEvent(obj,type,fn)
{
	if(obj.attachEvent) {
		obj["e"+type+fn] = fn;
		obj[type+fn] = function(){obj["e"+type+fn](window.event);};
		obj.attachEvent("on"+type,obj[type+fn]);
	} else {
		obj.addEventListener(type,fn,false);
	}
}

function removeEvent(obj,type,fn)
{
	if(obj.detachEvent) {
		obj.detachEvent("on"+type,obj[type+fn]);
		obj[type+fn] = null;
	} else {
		obj.removeEventListener(type,fn,false);
	}
}

// Find the closest relative with a given property value (property defaults to tagName, relative defaults to parentNode)
function findRelated(e,value,name,relative)
{
	name = name || "tagName";
	relative = relative || "parentNode";
	if(name == "className") {
		while(e && !jQuery(e).hasClass(value)) {
			e = e[relative];
		}
	} else {
		while(e && e[name] != value) {
			e = e[relative];
		}
	}
	return e;
}

// Get the scroll position for window.scrollTo necessary to scroll a given element into view
function ensureVisible(e)
{
	var posTop = findPosY(e);
	var posBot = posTop + e.offsetHeight;
	var winTop = findScrollY();
	var winHeight = findWindowHeight();
	var winBot = winTop + winHeight;
	if(posTop < winTop) {
		return posTop;
	} else if(posBot > winBot) {
		if(e.offsetHeight < winHeight)
			return posTop - (winHeight - e.offsetHeight);
		else
			return posTop;
	} else {
		return winTop;
	}
}

// Get the current width of the display window
function findWindowWidth()
{
	return window.innerWidth || document.documentElement.clientWidth;
}

// Get the current height of the display window
function findWindowHeight()
{
	return window.innerHeight || document.documentElement.clientHeight;
}

// Get the current height of the document
function findDocHeight() {
    var D = document;
    return Math.max(
        Math.max(D.body.scrollHeight, D.documentElement.scrollHeight),
        Math.max(D.body.offsetHeight, D.documentElement.offsetHeight),
        Math.max(D.body.clientHeight, D.documentElement.clientHeight)
    );
}

// Get the current horizontal page scroll position
function findScrollX()
{
	return window.scrollX || document.documentElement.scrollLeft;
}

// Get the current vertical page scroll position
function findScrollY()
{
	return window.scrollY || document.documentElement.scrollTop;
}

function findPosX(obj)
{
	var curleft = 0;
	while(obj.offsetParent) {
		curleft += obj.offsetLeft;
		obj = obj.offsetParent;
	}
	return curleft;
}

function findPosY(obj)
{
	var curtop = 0;
	while(obj.offsetParent) {
		curtop += obj.offsetTop;
		obj = obj.offsetParent;
	}
	return curtop;
}

// Blur a particular element
function blurElement(e)
{
	if(e && e.focus && e.blur) {
		e.focus();
		e.blur();
	}
}

// Create a non-breaking space
function insertSpacer(place)
{
	var e = document.createTextNode(String.fromCharCode(160));
	if(place)
		place.appendChild(e);
	return e;
}

// Replace the current selection of a textarea or text input and scroll it into view
function replaceSelection(e,text)
{
	if(e.setSelectionRange) {
		var oldpos = e.selectionStart;
		var isRange = e.selectionEnd > e.selectionStart;
		e.value = e.value.substr(0,e.selectionStart) + text + e.value.substr(e.selectionEnd);
		e.setSelectionRange(isRange ? oldpos : oldpos + text.length,oldpos + text.length);
		var linecount = e.value.split("\n").length;
		var thisline = e.value.substr(0,e.selectionStart).split("\n").length-1;
		e.scrollTop = Math.floor((thisline - e.rows / 2) * e.scrollHeight / linecount);
	} else if(document.selection) {
		var range = document.selection.createRange();
		if(range.parentElement() == e) {
			var isCollapsed = range.text == "";
			range.text = text;
			if(!isCollapsed) {
				range.moveStart("character", -text.length);
				range.select();
			}
		}
	}
}

// Set the caret position in a text area
function setCaretPosition(e,pos)
{
	if(e.selectionStart || e.selectionStart == '0') {
		e.selectionStart = pos;
		e.selectionEnd = pos;
		e.focus();
	} else if(document.selection) {
		// IE support
		e.focus ();
		var sel = document.selection.createRange();
		sel.moveStart('character', -e.value.length);
		sel.moveStart('character',pos);
		sel.moveEnd('character',0);
		sel.select();
	}
}

// Returns the text of the given (text) node, possibly merging subsequent text nodes
function getNodeText(e)
{
	var t = "";
	while(e && e.nodeName == "#text") {
		t += e.nodeValue;
		e = e.nextSibling;
	}
	return t;
}

// Returns true if the element e has a given ancestor element
function isDescendant(e,ancestor)
{
	while(e) {
		if(e === ancestor)
			return true;
		e = e.parentNode;
	}
	return false;
}


// deprecate the following...

// Prevent an event from bubbling
function stopEvent(e)
{
	var ev = e || window.event;
	ev.cancelBubble = true;
	if(ev.stopPropagation) ev.stopPropagation();
	return false;
}

// Remove any event handlers or non-primitve custom attributes
function scrubNode(e)
{
	if(!config.browser.isIE)
		return;
	var att = e.attributes;
	if(att) {
		var t;
		for(t=0; t<att.length; t++) {
			var n = att[t].name;
			if(n !== "style" && (typeof e[n] === "function" || (typeof e[n] === "object" && e[n] != null))) {
				try {
					e[n] = null;
				} catch(ex) {
				}
			}
		}
	}
	var c = e.firstChild;
	while(c) {
		scrubNode(c);
		c = c.nextSibling;
	}
}

function setStylesheet(s,id,doc)
{
	jQuery.twStylesheet(s,{id:id,doc:doc});
}

function removeStyleSheet(id)
{
	jQuery.twStylesheet.remove({id:id});
}

//--
//-- LoaderBase and SaverBase
//--

function LoaderBase() {}

LoaderBase.prototype.loadTiddler = function(store,node,tiddlers)
{
	var title = this.getTitle(store,node);
	if(safeMode && store.isShadowTiddler(title))
		return;
	if(title) {
		var tiddler = store.createTiddler(title);
		this.internalizeTiddler(store,tiddler,title,node);
		tiddlers.push(tiddler);
	}
};

LoaderBase.prototype.loadTiddlers = function(store,nodes)
{
	var t,tiddlers = [];
	for(t = 0; t < nodes.length; t++) {
		try {
			this.loadTiddler(store,nodes[t],tiddlers);
		} catch(ex) {
			showException(ex,config.messages.tiddlerLoadError.format([this.getTitle(store,nodes[t])]));
		}
	}
	return tiddlers;
};

function SaverBase() {}

SaverBase.prototype.externalize = function(store)
{
	var results = [];
	var t,tiddlers = store.getTiddlers("title");
	for(t = 0; t < tiddlers.length; t++) {
		if(!tiddlers[t].doNotSave())
			results.push(this.externalizeTiddler(store, tiddlers[t]));
	}
	return results.join("\n");
};

//--
//-- TW21Loader (inherits from LoaderBase)
//--

function TW21Loader() {}

TW21Loader.prototype = new LoaderBase();

TW21Loader.prototype.getTitle = function(store,node)
{
	var title = null;
	if(node.getAttribute) {
		title = node.getAttribute("title");
		if(!title)
			title = node.getAttribute("tiddler");
	}
	if(!title && node.id) {
		var lenPrefix = store.idPrefix.length;
		if(node.id.substr(0,lenPrefix) == store.idPrefix)
			title = node.id.substr(lenPrefix);
	}
	return title;
};

TW21Loader.prototype.internalizeTiddler = function(store,tiddler,title,node)
{
	var e = node.firstChild;
	var text = null;
	if(node.getAttribute("tiddler")) {
		text = getNodeText(e).unescapeLineBreaks();
	} else {
		while(e.nodeName!="PRE" && e.nodeName!="pre") {
			e = e.nextSibling;
		}
		text = e.innerHTML.replace(/\r/mg,"").htmlDecode();
	}
	var creator = node.getAttribute("creator");
	var modifier = node.getAttribute("modifier");
	var c = node.getAttribute("created");
	var m = node.getAttribute("modified");
	var created = c ? Date.convertFromYYYYMMDDHHMMSS(c) : version.date;
	var modified = m ? Date.convertFromYYYYMMDDHHMMSS(m) : created;
	var tags = node.getAttribute("tags");
	var fields = {};
	var i,attrs = node.attributes;
	for(i = attrs.length-1; i >= 0; i--) {
		var name = attrs[i].name;
		if(attrs[i].specified && !TiddlyWiki.isStandardField(name)) {
			fields[name] = attrs[i].value.unescapeLineBreaks();
		}
	}
	tiddler.assign(title,text,modifier,modified,tags,created,fields,creator);
	return tiddler;
};

//--
//-- TW21Saver (inherits from SaverBase)
//--

function TW21Saver() {}

TW21Saver.prototype = new SaverBase();

TW21Saver.prototype.externalizeTiddler = function(store,tiddler)
{
	try {
		var extendedAttributes = "";
		var usePre = config.options.chkUsePreForStorage;
		store.forEachField(tiddler,
			function(tiddler,fieldName,value) {
				// don't store stuff from the temp namespace
				if(typeof value != "string")
					value = "";
				if(!fieldName.match(/^temp\./))
					extendedAttributes += ' %0="%1"'.format([fieldName,value.escapeLineBreaks().htmlEncode()]);
			},true);
		var created = tiddler.created;
		var modified = tiddler.modified;
		var attributes = tiddler.creator ? ' creator="' + tiddler.creator.htmlEncode() + '"' : "";
		attributes += tiddler.modifier ? ' modifier="' + tiddler.modifier.htmlEncode() + '"' : "";
		attributes += (usePre && created == version.date) ? "" :' created="' + created.convertToYYYYMMDDHHMM() + '"';
		attributes += (usePre && modified == created) ? "" : ' modified="' + modified.convertToYYYYMMDDHHMM() +'"';
		var tags = tiddler.getTags();
		if(!usePre || tags)
			attributes += ' tags="' + tags.htmlEncode() + '"';
		return ('<div %0="%1"%2%3>%4</'+'div>').format([
				usePre ? "title" : "tiddler",
				tiddler.title.htmlEncode(),
				attributes,
				extendedAttributes,
				usePre ? "\n<pre>" + tiddler.text.htmlEncode() + "</pre>\n" : tiddler.text.escapeLineBreaks().htmlEncode()
			]);
	} catch (ex) {
		throw exceptionText(ex,config.messages.tiddlerSaveError.format([tiddler.title]));
	}
};



//]]>
</script>

<script id="jsdeprecatedArea" type="text/javascript">
//<![CDATA[
//--
//-- Deprecated Crypto functions and associated conversion routines.
//-- Use the jQuery.encoding functions directly instead.
//--

// Crypto 'namespace'
function Crypto() {}

// Convert a string to an array of big-endian 32-bit words
Crypto.strToBe32s = function(str)
{
	return jQuery.encoding.strToBe32s(str);
};

// Convert an array of big-endian 32-bit words to a string
Crypto.be32sToStr = function(be)
{
	return jQuery.encoding.be32sToStr(be);
};

// Convert an array of big-endian 32-bit words to a hex string
Crypto.be32sToHex = function(be)
{
	return jQuery.encoding.be32sToHex(be);
};

// Return, in hex, the SHA-1 hash of a string
Crypto.hexSha1Str = function(str)
{
	return jQuery.encoding.digests.hexSha1Str(str);
};

// Return the SHA-1 hash of a string
Crypto.sha1Str = function(str)
{
	return jQuery.encoding.digests.sha1Str(str);
};

// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
Crypto.sha1 = function(x,blen)
{
	return jQuery.encoding.digests.sha1(x,blen);
};

//--
//-- Deprecated code
//--

// @Deprecated: Use createElementAndWikify and this.termRegExp instead
config.formatterHelpers.charFormatHelper = function(w)
{
	w.subWikify(createTiddlyElement(w.output,this.element),this.terminator);
};

// @Deprecated: Use enclosedTextHelper and this.lookaheadRegExp instead
config.formatterHelpers.monospacedByLineHelper = function(w)
{
	var lookaheadRegExp = new RegExp(this.lookahead,"mg");
	lookaheadRegExp.lastIndex = w.matchStart;
	var lookaheadMatch = lookaheadRegExp.exec(w.source);
	if(lookaheadMatch && lookaheadMatch.index == w.matchStart) {
		var text = lookaheadMatch[1];
		if(config.browser.isIE)
			text = text.replace(/\n/g,"\r");
		createTiddlyElement(w.output,"pre",null,null,text);
		w.nextMatch = lookaheadRegExp.lastIndex;
	}
};

// @Deprecated: Use <br> or <br /> instead of <<br>>
config.macros.br = {};
config.macros.br.handler = function(place)
{
	createTiddlyElement(place,"br");
};

// Find an entry in an array. Returns the array index or null
// @Deprecated: Use indexOf instead
Array.prototype.find = function(item)
{
	var i = this.indexOf(item);
	return i == -1 ? null : i;
};

// Load a tiddler from an HTML DIV. The caller should make sure to later call Tiddler.changed()
// @Deprecated: Use store.getLoader().internalizeTiddler instead
Tiddler.prototype.loadFromDiv = function(divRef,title)
{
	return store.getLoader().internalizeTiddler(store,this,title,divRef);
};

// Format the text for storage in an HTML DIV
// @Deprecated Use store.getSaver().externalizeTiddler instead.
Tiddler.prototype.saveToDiv = function()
{
	return store.getSaver().externalizeTiddler(store,this);
};

// @Deprecated: Use store.allTiddlersAsHtml() instead
function allTiddlersAsHtml()
{
	return store.allTiddlersAsHtml();
}

// @Deprecated: Use refreshPageTemplate instead
function applyPageTemplate(title)
{
	refreshPageTemplate(title);
}

// @Deprecated: Use story.displayTiddlers instead
function displayTiddlers(srcElement,titles,template,unused1,unused2,animate,unused3)
{
	story.displayTiddlers(srcElement,titles,template,animate);
}

// @Deprecated: Use story.displayTiddler instead
function displayTiddler(srcElement,title,template,unused1,unused2,animate,unused3)
{
	story.displayTiddler(srcElement,title,template,animate);
}

// @Deprecated: Use functions on right hand side directly instead
var createTiddlerPopup = Popup.create;
var scrollToTiddlerPopup = Popup.show;
var hideTiddlerPopup = Popup.remove;

// @Deprecated: Use right hand side directly instead
var regexpBackSlashEn = new RegExp("\\\\n","mg");
var regexpBackSlash = new RegExp("\\\\","mg");
var regexpBackSlashEss = new RegExp("\\\\s","mg");
var regexpNewLine = new RegExp("\n","mg");
var regexpCarriageReturn = new RegExp("\r","mg");

//--
//-- Deprecated FileAdaptor functions
//--

FileAdaptor.loadTiddlyWikiCallback = function(status,context,responseText,url,xhr)
{
	context.status = status;
	if(!status) {
		context.statusText = "Error reading file";
	} else {
		context.adaptor.store = new TiddlyWiki();
		if(!context.adaptor.store.importTiddlyWiki(responseText)) {
			context.statusText = config.messages.invalidFileError.format([url]);
			context.status = false;
		}
	}
	context.complete(context,context.userParams);
};

//--
//-- Deprecated HTTP request code
//-- Use the jQuery ajax functions directly instead
//--

function loadRemoteFile(url,callback,params)
{
	return httpReq("GET",url,callback,params);
}

function doHttp(type,url,data,contentType,username,password,callback,params,headers,allowCache)
{
	return httpReq(type,url,callback,params,headers,data,contentType,username,password,allowCache);
}

//--
//-- Deprecated String functions
//--

// @Deprecated: no direct replacement, since not used in core code
String.prototype.toJSONString = function()
{
	// Convert a string to it's JSON representation by encoding control characters, double quotes and backslash. See json.org
	var m = {
		'\b': '\\b',
		'\f': '\\f',
		'\n': '\\n',
		'\r': '\\r',
		'\t': '\\t',
		'"' : '\\"',
		'\\': '\\\\'
		};
	var replaceFn = function(a,b) {
		var c = m[b];
		if(c)
			return c;
		c = b.charCodeAt();
		return '\\u00' + Math.floor(c / 16).toString(16) + (c % 16).toString(16);
		};
	if(/["\\\x00-\x1f]/.test(this))
		return '"' + this.replace(/([\x00-\x1f\\"])/g,replaceFn) + '"';
	return '"' + this + '"';
};

//--
//-- Deprecated Tiddler code
//--

// @Deprecated: Use tiddlerToRssItem(tiddler,uri) instead
Tiddler.prototype.toRssItem = function(uri)
{
	return tiddlerToRssItem(this,uri);
};

// @Deprecated: Use "<item>\n" + tiddlerToRssItem(tiddler,uri)  + "\n</item>" instead
Tiddler.prototype.saveToRss = function(uri)
{
	return "<item>\n" + tiddlerToRssItem(this,uri) + "\n</item>";
};

// @Deprecated: Use jQuery.encoding.digests.hexSha1Str instead
Tiddler.prototype.generateFingerprint = function()
{
	return "0x" + Crypto.hexSha1Str(this.text);
};

//--
//-- Deprecated Number functions
//--

// @Deprecated: no direct replacement, since not used in core code
// Clamp a number to a range
Number.prototype.clamp = function(min,max)
{
	var c = this;
	if(c < min)
		c = min;
	if(c > max)
		c = max;
	return Number(c);
};

//--
//-- Deprecated utility functions
//-- Use the jQuery functions directly instead
//--

// Remove all children of a node
function removeChildren(e)
{
	jQuery(e).empty();
}

// Remove a node and all it's children
function removeNode(e)
{
	jQuery(e).remove();
}

// Return the content of an element as plain text with no formatting
function getPlainText(e)
{
	return jQuery(e).text();
}

function addClass(e,className)
{
	jQuery(e).addClass(className);
}

function removeClass(e,className)
{
	jQuery(e).removeClass(className);
}

function hasClass(e,className)
{
	return jQuery(e).hasClass(className);
}

//--
//-- Deprecated Wikifier code
//--

function wikifyPlain(title,theStore,limit)
{
	if(!theStore)
		theStore = store;
	if(theStore.tiddlerExists(title) || theStore.isShadowTiddler(title)) {
		return wikifyPlainText(theStore.getTiddlerText(title),limit,tiddler);
	} else {
		return "";
	}
}


//]]>
</script>
<script id="jslibArea" type="text/javascript">
//<![CDATA[
/*! jQuery v1.8.3 jquery.com | jquery.org/license */
(function(e,t){function _(e){var t=M[e]={};return v.each(e.split(y),function(e,n){t[n]=!0}),t}function H(e,n,r){if(r===t&&e.nodeType===1){var i="data-"+n.replace(P,"-$1").toLowerCase();r=e.getAttribute(i);if(typeof r=="string"){try{r=r==="true"?!0:r==="false"?!1:r==="null"?null:+r+""===r?+r:D.test(r)?v.parseJSON(r):r}catch(s){}v.data(e,n,r)}else r=t}return r}function B(e){var t;for(t in e){if(t==="data"&&v.isEmptyObject(e[t]))continue;if(t!=="toJSON")return!1}return!0}function et(){return!1}function tt(){return!0}function ut(e){return!e||!e.parentNode||e.parentNode.nodeType===11}function at(e,t){do e=e[t];while(e&&e.nodeType!==1);return e}function ft(e,t,n){t=t||0;if(v.isFunction(t))return v.grep(e,function(e,r){var i=!!t.call(e,r,e);return i===n});if(t.nodeType)return v.grep(e,function(e,r){return e===t===n});if(typeof t=="string"){var r=v.grep(e,function(e){return e.nodeType===1});if(it.test(t))return v.filter(t,r,!n);t=v.filter(t,r)}return v.grep(e,function(e,r){return v.inArray(e,t)>=0===n})}function lt(e){var t=ct.split("|"),n=e.createDocumentFragment();if(n.createElement)while(t.length)n.createElement(t.pop());return n}function Lt(e,t){return e.getElementsByTagName(t)[0]||e.appendChild(e.ownerDocument.createElement(t))}function At(e,t){if(t.nodeType!==1||!v.hasData(e))return;var n,r,i,s=v._data(e),o=v._data(t,s),u=s.events;if(u){delete o.handle,o.events={};for(n in u)for(r=0,i=u[n].length;r<i;r++)v.event.add(t,n,u[n][r])}o.data&&(o.data=v.extend({},o.data))}function Ot(e,t){var n;if(t.nodeType!==1)return;t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),n=t.nodeName.toLowerCase(),n==="object"?(t.parentNode&&(t.outerHTML=e.outerHTML),v.support.html5Clone&&e.innerHTML&&!v.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):n==="input"&&Et.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):n==="option"?t.selected=e.defaultSelected:n==="input"||n==="textarea"?t.defaultValue=e.defaultValue:n==="script"&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(v.expando)}function Mt(e){return typeof e.getElementsByTagName!="undefined"?e.getElementsByTagName("*"):typeof e.querySelectorAll!="undefined"?e.querySelectorAll("*"):[]}function _t(e){Et.test(e.type)&&(e.defaultChecked=e.checked)}function Qt(e,t){if(t in e)return t;var n=t.charAt(0).toUpperCase()+t.slice(1),r=t,i=Jt.length;while(i--){t=Jt[i]+n;if(t in e)return t}return r}function Gt(e,t){return e=t||e,v.css(e,"display")==="none"||!v.contains(e.ownerDocument,e)}function Yt(e,t){var n,r,i=[],s=0,o=e.length;for(;s<o;s++){n=e[s];if(!n.style)continue;i[s]=v._data(n,"olddisplay"),t?(!i[s]&&n.style.display==="none"&&(n.style.display=""),n.style.display===""&&Gt(n)&&(i[s]=v._data(n,"olddisplay",nn(n.nodeName)))):(r=Dt(n,"display"),!i[s]&&r!=="none"&&v._data(n,"olddisplay",r))}for(s=0;s<o;s++){n=e[s];if(!n.style)continue;if(!t||n.style.display==="none"||n.style.display==="")n.style.display=t?i[s]||"":"none"}return e}function Zt(e,t,n){var r=Rt.exec(t);return r?Math.max(0,r[1]-(n||0))+(r[2]||"px"):t}function en(e,t,n,r){var i=n===(r?"border":"content")?4:t==="width"?1:0,s=0;for(;i<4;i+=2)n==="margin"&&(s+=v.css(e,n+$t[i],!0)),r?(n==="content"&&(s-=parseFloat(Dt(e,"padding"+$t[i]))||0),n!=="margin"&&(s-=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0)):(s+=parseFloat(Dt(e,"padding"+$t[i]))||0,n!=="padding"&&(s+=parseFloat(Dt(e,"border"+$t[i]+"Width"))||0));return s}function tn(e,t,n){var r=t==="width"?e.offsetWidth:e.offsetHeight,i=!0,s=v.support.boxSizing&&v.css(e,"boxSizing")==="border-box";if(r<=0||r==null){r=Dt(e,t);if(r<0||r==null)r=e.style[t];if(Ut.test(r))return r;i=s&&(v.support.boxSizingReliable||r===e.style[t]),r=parseFloat(r)||0}return r+en(e,t,n||(s?"border":"content"),i)+"px"}function nn(e){if(Wt[e])return Wt[e];var t=v("<"+e+">").appendTo(i.body),n=t.css("display");t.remove();if(n==="none"||n===""){Pt=i.body.appendChild(Pt||v.extend(i.createElement("iframe"),{frameBorder:0,width:0,height:0}));if(!Ht||!Pt.createElement)Ht=(Pt.contentWindow||Pt.contentDocument).document,Ht.write("<!doctype html><html><body>"),Ht.close();t=Ht.body.appendChild(Ht.createElement(e)),n=Dt(t,"display"),i.body.removeChild(Pt)}return Wt[e]=n,n}function fn(e,t,n,r){var i;if(v.isArray(t))v.each(t,function(t,i){n||sn.test(e)?r(e,i):fn(e+"["+(typeof i=="object"?t:"")+"]",i,n,r)});else if(!n&&v.type(t)==="object")for(i in t)fn(e+"["+i+"]",t[i],n,r);else r(e,t)}function Cn(e){return function(t,n){typeof t!="string"&&(n=t,t="*");var r,i,s,o=t.toLowerCase().split(y),u=0,a=o.length;if(v.isFunction(n))for(;u<a;u++)r=o[u],s=/^\+/.test(r),s&&(r=r.substr(1)||"*"),i=e[r]=e[r]||[],i[s?"unshift":"push"](n)}}function kn(e,n,r,i,s,o){s=s||n.dataTypes[0],o=o||{},o[s]=!0;var u,a=e[s],f=0,l=a?a.length:0,c=e===Sn;for(;f<l&&(c||!u);f++)u=a[f](n,r,i),typeof u=="string"&&(!c||o[u]?u=t:(n.dataTypes.unshift(u),u=kn(e,n,r,i,u,o)));return(c||!u)&&!o["*"]&&(u=kn(e,n,r,i,"*",o)),u}function Ln(e,n){var r,i,s=v.ajaxSettings.flatOptions||{};for(r in n)n[r]!==t&&((s[r]?e:i||(i={}))[r]=n[r]);i&&v.extend(!0,e,i)}function An(e,n,r){var i,s,o,u,a=e.contents,f=e.dataTypes,l=e.responseFields;for(s in l)s in r&&(n[l[s]]=r[s]);while(f[0]==="*")f.shift(),i===t&&(i=e.mimeType||n.getResponseHeader("content-type"));if(i)for(s in a)if(a[s]&&a[s].test(i)){f.unshift(s);break}if(f[0]in r)o=f[0];else{for(s in r){if(!f[0]||e.converters[s+" "+f[0]]){o=s;break}u||(u=s)}o=o||u}if(o)return o!==f[0]&&f.unshift(o),r[o]}function On(e,t){var n,r,i,s,o=e.dataTypes.slice(),u=o[0],a={},f=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)a[n.toLowerCase()]=e.converters[n];for(;i=o[++f];)if(i!=="*"){if(u!=="*"&&u!==i){n=a[u+" "+i]||a["* "+i];if(!n)for(r in a){s=r.split(" ");if(s[1]===i){n=a[u+" "+s[0]]||a["* "+s[0]];if(n){n===!0?n=a[r]:a[r]!==!0&&(i=s[0],o.splice(f--,0,i));break}}}if(n!==!0)if(n&&e["throws"])t=n(t);else try{t=n(t)}catch(l){return{state:"parsererror",error:n?l:"No conversion from "+u+" to "+i}}}u=i}return{state:"success",data:t}}function Fn(){try{return new e.XMLHttpRequest}catch(t){}}function In(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function $n(){return setTimeout(function(){qn=t},0),qn=v.now()}function Jn(e,t){v.each(t,function(t,n){var r=(Vn[t]||[]).concat(Vn["*"]),i=0,s=r.length;for(;i<s;i++)if(r[i].call(e,t,n))return})}function Kn(e,t,n){var r,i=0,s=0,o=Xn.length,u=v.Deferred().always(function(){delete a.elem}),a=function(){var t=qn||$n(),n=Math.max(0,f.startTime+f.duration-t),r=n/f.duration||0,i=1-r,s=0,o=f.tweens.length;for(;s<o;s++)f.tweens[s].run(i);return u.notifyWith(e,[f,i,n]),i<1&&o?n:(u.resolveWith(e,[f]),!1)},f=u.promise({elem:e,props:v.extend({},t),opts:v.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:qn||$n(),duration:n.duration,tweens:[],createTween:function(t,n,r){var i=v.Tween(e,f.opts,t,n,f.opts.specialEasing[t]||f.opts.easing);return f.tweens.push(i),i},stop:function(t){var n=0,r=t?f.tweens.length:0;for(;n<r;n++)f.tweens[n].run(1);return t?u.resolveWith(e,[f,t]):u.rejectWith(e,[f,t]),this}}),l=f.props;Qn(l,f.opts.specialEasing);for(;i<o;i++){r=Xn[i].call(f,e,l,f.opts);if(r)return r}return Jn(f,l),v.isFunction(f.opts.start)&&f.opts.start.call(e,f),v.fx.timer(v.extend(a,{anim:f,queue:f.opts.queue,elem:e})),f.progress(f.opts.progress).done(f.opts.done,f.opts.complete).fail(f.opts.fail).always(f.opts.always)}function Qn(e,t){var n,r,i,s,o;for(n in e){r=v.camelCase(n),i=t[r],s=e[n],v.isArray(s)&&(i=s[1],s=e[n]=s[0]),n!==r&&(e[r]=s,delete e[n]),o=v.cssHooks[r];if(o&&"expand"in o){s=o.expand(s),delete e[r];for(n in s)n in e||(e[n]=s[n],t[n]=i)}else t[r]=i}}function Gn(e,t,n){var r,i,s,o,u,a,f,l,c,h=this,p=e.style,d={},m=[],g=e.nodeType&&Gt(e);n.queue||(l=v._queueHooks(e,"fx"),l.unqueued==null&&(l.unqueued=0,c=l.empty.fire,l.empty.fire=function(){l.unqueued||c()}),l.unqueued++,h.always(function(){h.always(function(){l.unqueued--,v.queue(e,"fx").length||l.empty.fire()})})),e.nodeType===1&&("height"in t||"width"in t)&&(n.overflow=[p.overflow,p.overflowX,p.overflowY],v.css(e,"display")==="inline"&&v.css(e,"float")==="none"&&(!v.support.inlineBlockNeedsLayout||nn(e.nodeName)==="inline"?p.display="inline-block":p.zoom=1)),n.overflow&&(p.overflow="hidden",v.support.shrinkWrapBlocks||h.done(function(){p.overflow=n.overflow[0],p.overflowX=n.overflow[1],p.overflowY=n.overflow[2]}));for(r in t){s=t[r];if(Un.exec(s)){delete t[r],a=a||s==="toggle";if(s===(g?"hide":"show"))continue;m.push(r)}}o=m.length;if(o){u=v._data(e,"fxshow")||v._data(e,"fxshow",{}),"hidden"in u&&(g=u.hidden),a&&(u.hidden=!g),g?v(e).show():h.done(function(){v(e).hide()}),h.done(function(){var t;v.removeData(e,"fxshow",!0);for(t in d)v.style(e,t,d[t])});for(r=0;r<o;r++)i=m[r],f=h.createTween(i,g?u[i]:0),d[i]=u[i]||v.style(e,i),i in u||(u[i]=f.start,g&&(f.end=f.start,f.start=i==="width"||i==="height"?1:0))}}function Yn(e,t,n,r,i){return new Yn.prototype.init(e,t,n,r,i)}function Zn(e,t){var n,r={height:e},i=0;t=t?1:0;for(;i<4;i+=2-t)n=$t[i],r["margin"+n]=r["padding"+n]=e;return t&&(r.opacity=r.width=e),r}function tr(e){return v.isWindow(e)?e:e.nodeType===9?e.defaultView||e.parentWindow:!1}var n,r,i=e.document,s=e.location,o=e.navigator,u=e.jQuery,a=e.$,f=Array.prototype.push,l=Array.prototype.slice,c=Array.prototype.indexOf,h=Object.prototype.toString,p=Object.prototype.hasOwnProperty,d=String.prototype.trim,v=function(e,t){return new v.fn.init(e,t,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,g=/\S/,y=/\s+/,b=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,w=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,E=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,S=/^[\],:{}\s]*$/,x=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,N=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,C=/^-ms-/,k=/-([\da-z])/gi,L=function(e,t){return(t+"").toUpperCase()},A=function(){i.addEventListener?(i.removeEventListener("DOMContentLoaded",A,!1),v.ready()):i.readyState==="complete"&&(i.detachEvent("onreadystatechange",A),v.ready())},O={};v.fn=v.prototype={constructor:v,init:function(e,n,r){var s,o,u,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if(typeof e=="string"){e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3?s=[null,e,null]:s=w.exec(e);if(s&&(s[1]||!n)){if(s[1])return n=n instanceof v?n[0]:n,a=n&&n.nodeType?n.ownerDocument||n:i,e=v.parseHTML(s[1],a,!0),E.test(s[1])&&v.isPlainObject(n)&&this.attr.call(e,n,!0),v.merge(this,e);o=i.getElementById(s[2]);if(o&&o.parentNode){if(o.id!==s[2])return r.find(e);this.length=1,this[0]=o}return this.context=i,this.selector=e,this}return!n||n.jquery?(n||r).find(e):this.constructor(n).find(e)}return v.isFunction(e)?r.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),v.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return l.call(this)},get:function(e){return e==null?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var r=v.merge(this.constructor(),e);return r.prevObject=this,r.context=this.context,t==="find"?r.selector=this.selector+(this.selector?" ":"")+n:t&&(r.selector=this.selector+"."+t+"("+n+")"),r},each:function(e,t){return v.each(this,e,t)},ready:function(e){return v.ready.promise().done(e),this},eq:function(e){return e=+e,e===-1?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(l.apply(this,arguments),"slice",l.call(arguments).join(","))},map:function(e){return this.pushStack(v.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:f,sort:[].sort,splice:[].splice},v.fn.init.prototype=v.fn,v.extend=v.fn.extend=function(){var e,n,r,i,s,o,u=arguments[0]||{},a=1,f=arguments.length,l=!1;typeof u=="boolean"&&(l=u,u=arguments[1]||{},a=2),typeof u!="object"&&!v.isFunction(u)&&(u={}),f===a&&(u=this,--a);for(;a<f;a++)if((e=arguments[a])!=null)for(n in e){r=u[n],i=e[n];if(u===i)continue;l&&i&&(v.isPlainObject(i)||(s=v.isArray(i)))?(s?(s=!1,o=r&&v.isArray(r)?r:[]):o=r&&v.isPlainObject(r)?r:{},u[n]=v.extend(l,o,i)):i!==t&&(u[n]=i)}return u},v.extend({noConflict:function(t){return e.$===v&&(e.$=a),t&&e.jQuery===v&&(e.jQuery=u),v},isReady:!1,readyWait:1,holdReady:function(e){e?v.readyWait++:v.ready(!0)},ready:function(e){if(e===!0?--v.readyWait:v.isReady)return;if(!i.body)return setTimeout(v.ready,1);v.isReady=!0;if(e!==!0&&--v.readyWait>0)return;r.resolveWith(i,[v]),v.fn.trigger&&v(i).trigger("ready").off("ready")},isFunction:function(e){return v.type(e)==="function"},isArray:Array.isArray||function(e){return v.type(e)==="array"},isWindow:function(e){return e!=null&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return e==null?String(e):O[h.call(e)]||"object"},isPlainObject:function(e){if(!e||v.type(e)!=="object"||e.nodeType||v.isWindow(e))return!1;try{if(e.constructor&&!p.call(e,"constructor")&&!p.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(n){return!1}var r;for(r in e);return r===t||p.call(e,r)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var r;return!e||typeof e!="string"?null:(typeof t=="boolean"&&(n=t,t=0),t=t||i,(r=E.exec(e))?[t.createElement(r[1])]:(r=v.buildFragment([e],t,n?null:[]),v.merge([],(r.cacheable?v.clone(r.fragment):r.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;t=v.trim(t);if(e.JSON&&e.JSON.parse)return e.JSON.parse(t);if(S.test(t.replace(T,"@").replace(N,"]").replace(x,"")))return(new Function("return "+t))();v.error("Invalid JSON: "+t)},parseXML:function(n){var r,i;if(!n||typeof n!="string")return null;try{e.DOMParser?(i=new DOMParser,r=i.parseFromString(n,"text/xml")):(r=new ActiveXObject("Microsoft.XMLDOM"),r.async="false",r.loadXML(n))}catch(s){r=t}return(!r||!r.documentElement||r.getElementsByTagName("parsererror").length)&&v.error("Invalid XML: "+n),r},noop:function(){},globalEval:function(t){t&&g.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(C,"ms-").replace(k,L)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,r){var i,s=0,o=e.length,u=o===t||v.isFunction(e);if(r){if(u){for(i in e)if(n.apply(e[i],r)===!1)break}else for(;s<o;)if(n.apply(e[s++],r)===!1)break}else if(u){for(i in e)if(n.call(e[i],i,e[i])===!1)break}else for(;s<o;)if(n.call(e[s],s,e[s++])===!1)break;return e},trim:d&&!d.call("\ufeff\u00a0")?function(e){return e==null?"":d.call(e)}:function(e){return e==null?"":(e+"").replace(b,"")},makeArray:function(e,t){var n,r=t||[];return e!=null&&(n=v.type(e),e.length==null||n==="string"||n==="function"||n==="regexp"||v.isWindow(e)?f.call(r,e):v.merge(r,e)),r},inArray:function(e,t,n){var r;if(t){if(c)return c.call(t,e,n);r=t.length,n=n?n<0?Math.max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var r=n.length,i=e.length,s=0;if(typeof r=="number")for(;s<r;s++)e[i++]=n[s];else while(n[s]!==t)e[i++]=n[s++];return e.length=i,e},grep:function(e,t,n){var r,i=[],s=0,o=e.length;n=!!n;for(;s<o;s++)r=!!t(e[s],s),n!==r&&i.push(e[s]);return i},map:function(e,n,r){var i,s,o=[],u=0,a=e.length,f=e instanceof v||a!==t&&typeof a=="number"&&(a>0&&e[0]&&e[a-1]||a===0||v.isArray(e));if(f)for(;u<a;u++)i=n(e[u],u,r),i!=null&&(o[o.length]=i);else for(s in e)i=n(e[s],s,r),i!=null&&(o[o.length]=i);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var r,i,s;return typeof n=="string"&&(r=e[n],n=e,e=r),v.isFunction(e)?(i=l.call(arguments,2),s=function(){return e.apply(n,i.concat(l.call(arguments)))},s.guid=e.guid=e.guid||v.guid++,s):t},access:function(e,n,r,i,s,o,u){var a,f=r==null,l=0,c=e.length;if(r&&typeof r=="object"){for(l in r)v.access(e,n,l,r[l],1,o,i);s=1}else if(i!==t){a=u===t&&v.isFunction(i),f&&(a?(a=n,n=function(e,t,n){return a.call(v(e),n)}):(n.call(e,i),n=null));if(n)for(;l<c;l++)n(e[l],r,a?i.call(e[l],l,n(e[l],r)):i,u);s=1}return s?e:f?n.call(e):c?n(e[0],r):o},now:function(){return(new Date).getTime()}}),v.ready.promise=function(t){if(!r){r=v.Deferred();if(i.readyState==="complete")setTimeout(v.ready,1);else if(i.addEventListener)i.addEventListener("DOMContentLoaded",A,!1),e.addEventListener("load",v.ready,!1);else{i.attachEvent("onreadystatechange",A),e.attachEvent("onload",v.ready);var n=!1;try{n=e.frameElement==null&&i.documentElement}catch(s){}n&&n.doScroll&&function o(){if(!v.isReady){try{n.doScroll("left")}catch(e){return setTimeout(o,50)}v.ready()}}()}}return r.promise(t)},v.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){O["[object "+t+"]"]=t.toLowerCase()}),n=v(i);var M={};v.Callbacks=function(e){e=typeof e=="string"?M[e]||_(e):v.extend({},e);var n,r,i,s,o,u,a=[],f=!e.once&&[],l=function(t){n=e.memory&&t,r=!0,u=s||0,s=0,o=a.length,i=!0;for(;a&&u<o;u++)if(a[u].apply(t[0],t[1])===!1&&e.stopOnFalse){n=!1;break}i=!1,a&&(f?f.length&&l(f.shift()):n?a=[]:c.disable())},c={add:function(){if(a){var t=a.length;(function r(t){v.each(t,function(t,n){var i=v.type(n);i==="function"?(!e.unique||!c.has(n))&&a.push(n):n&&n.length&&i!=="string"&&r(n)})})(arguments),i?o=a.length:n&&(s=t,l(n))}return this},remove:function(){return a&&v.each(arguments,function(e,t){var n;while((n=v.inArray(t,a,n))>-1)a.splice(n,1),i&&(n<=o&&o--,n<=u&&u--)}),this},has:function(e){return v.inArray(e,a)>-1},empty:function(){return a=[],this},disable:function(){return a=f=n=t,this},disabled:function(){return!a},lock:function(){return f=t,n||c.disable(),this},locked:function(){return!f},fireWith:function(e,t){return t=t||[],t=[e,t.slice?t.slice():t],a&&(!r||f)&&(i?f.push(t):l(t)),this},fire:function(){return c.fireWith(this,arguments),this},fired:function(){return!!r}};return c},v.extend({Deferred:function(e){var t=[["resolve","done",v.Callbacks("once memory"),"resolved"],["reject","fail",v.Callbacks("once memory"),"rejected"],["notify","progress",v.Callbacks("memory")]],n="pending",r={state:function(){return n},always:function(){return i.done(arguments).fail(arguments),this},then:function(){var e=arguments;return v.Deferred(function(n){v.each(t,function(t,r){var s=r[0],o=e[t];i[r[1]](v.isFunction(o)?function(){var e=o.apply(this,arguments);e&&v.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===i?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return e!=null?v.extend(e,r):r}},i={};return r.pipe=r.then,v.each(t,function(e,s){var o=s[2],u=s[3];r[s[1]]=o.add,u&&o.add(function(){n=u},t[e^1][2].disable,t[2][2].lock),i[s[0]]=o.fire,i[s[0]+"With"]=o.fireWith}),r.promise(i),e&&e.call(i,i),i},when:function(e){var t=0,n=l.call(arguments),r=n.length,i=r!==1||e&&v.isFunction(e.promise)?r:0,s=i===1?e:v.Deferred(),o=function(e,t,n){return function(r){t[e]=this,n[e]=arguments.length>1?l.call(arguments):r,n===u?s.notifyWith(t,n):--i||s.resolveWith(t,n)}},u,a,f;if(r>1){u=new Array(r),a=new Array(r),f=new Array(r);for(;t<r;t++)n[t]&&v.isFunction(n[t].promise)?n[t].promise().done(o(t,f,n)).fail(s.reject).progress(o(t,a,u)):--i}return i||s.resolveWith(f,n),s.promise()}}),v.support=function(){var t,n,r,s,o,u,a,f,l,c,h,p=i.createElement("div");p.setAttribute("className","t"),p.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=p.getElementsByTagName("*"),r=p.getElementsByTagName("a")[0];if(!n||!r||!n.length)return{};s=i.createElement("select"),o=s.appendChild(i.createElement("option")),u=p.getElementsByTagName("input")[0],r.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:p.firstChild.nodeType===3,tbody:!p.getElementsByTagName("tbody").length,htmlSerialize:!!p.getElementsByTagName("link").length,style:/top/.test(r.getAttribute("style")),hrefNormalized:r.getAttribute("href")==="/a",opacity:/^0.5/.test(r.style.opacity),cssFloat:!!r.style.cssFloat,checkOn:u.value==="on",optSelected:o.selected,getSetAttribute:p.className!=="t",enctype:!!i.createElement("form").enctype,html5Clone:i.createElement("nav").cloneNode(!0).outerHTML!=="<:nav></:nav>",boxModel:i.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},u.checked=!0,t.noCloneChecked=u.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete p.test}catch(d){t.deleteExpando=!1}!p.addEventListener&&p.attachEvent&&p.fireEvent&&(p.attachEvent("onclick",h=function(){t.noCloneEvent=!1}),p.cloneNode(!0).fireEvent("onclick"),p.detachEvent("onclick",h)),u=i.createElement("input"),u.value="t",u.setAttribute("type","radio"),t.radioValue=u.value==="t",u.setAttribute("checked","checked"),u.setAttribute("name","t"),p.appendChild(u),a=i.createDocumentFragment(),a.appendChild(p.lastChild),t.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=u.checked,a.removeChild(u),a.appendChild(p);if(p.attachEvent)for(l in{submit:!0,change:!0,focusin:!0})f="on"+l,c=f in p,c||(p.setAttribute(f,"return;"),c=typeof p[f]=="function"),t[l+"Bubbles"]=c;return v(function(){var n,r,s,o,u="padding:0;margin:0;border:0;display:block;overflow:hidden;",a=i.getElementsByTagName("body")[0];if(!a)return;n=i.createElement("div"),n.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",a.insertBefore(n,a.firstChild),r=i.createElement("div"),n.appendChild(r),r.innerHTML="<table><tr><td></td><td>t</td></tr></table>",s=r.getElementsByTagName("td"),s[0].style.cssText="padding:0;margin:0;border:0;display:none",c=s[0].offsetHeight===0,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=c&&s[0].offsetHeight===0,r.innerHTML="",r.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=r.offsetWidth===4,t.doesNotIncludeMarginInBodyOffset=a.offsetTop!==1,e.getComputedStyle&&(t.pixelPosition=(e.getComputedStyle(r,null)||{}).top!=="1%",t.boxSizingReliable=(e.getComputedStyle(r,null)||{width:"4px"}).width==="4px",o=i.createElement("div"),o.style.cssText=r.style.cssText=u,o.style.marginRight=o.style.width="0",r.style.width="1px",r.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),typeof r.style.zoom!="undefined"&&(r.innerHTML="",r.style.cssText=u+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=r.offsetWidth===3,r.style.display="block",r.style.overflow="visible",r.innerHTML="<div></div>",r.firstChild.style.width="5px",t.shrinkWrapBlocks=r.offsetWidth!==3,n.style.zoom=1),a.removeChild(n),n=r=s=o=null}),a.removeChild(p),n=r=s=o=u=a=p=null,t}();var D=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;v.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(v.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return e=e.nodeType?v.cache[e[v.expando]]:e[v.expando],!!e&&!B(e)},data:function(e,n,r,i){if(!v.acceptData(e))return;var s,o,u=v.expando,a=typeof n=="string",f=e.nodeType,l=f?v.cache:e,c=f?e[u]:e[u]&&u;if((!c||!l[c]||!i&&!l[c].data)&&a&&r===t)return;c||(f?e[u]=c=v.deletedIds.pop()||v.guid++:c=u),l[c]||(l[c]={},f||(l[c].toJSON=v.noop));if(typeof n=="object"||typeof n=="function")i?l[c]=v.extend(l[c],n):l[c].data=v.extend(l[c].data,n);return s=l[c],i||(s.data||(s.data={}),s=s.data),r!==t&&(s[v.camelCase(n)]=r),a?(o=s[n],o==null&&(o=s[v.camelCase(n)])):o=s,o},removeData:function(e,t,n){if(!v.acceptData(e))return;var r,i,s,o=e.nodeType,u=o?v.cache:e,a=o?e[v.expando]:v.expando;if(!u[a])return;if(t){r=n?u[a]:u[a].data;if(r){v.isArray(t)||(t in r?t=[t]:(t=v.camelCase(t),t in r?t=[t]:t=t.split(" ")));for(i=0,s=t.length;i<s;i++)delete r[t[i]];if(!(n?B:v.isEmptyObject)(r))return}}if(!n){delete u[a].data;if(!B(u[a]))return}o?v.cleanData([e],!0):v.support.deleteExpando||u!=u.window?delete u[a]:u[a]=null},_data:function(e,t,n){return v.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&v.noData[e.nodeName.toLowerCase()];return!t||t!==!0&&e.getAttribute("classid")===t}}),v.fn.extend({data:function(e,n){var r,i,s,o,u,a=this[0],f=0,l=null;if(e===t){if(this.length){l=v.data(a);if(a.nodeType===1&&!v._data(a,"parsedAttrs")){s=a.attributes;for(u=s.length;f<u;f++)o=s[f].name,o.indexOf("data-")||(o=v.camelCase(o.substring(5)),H(a,o,l[o]));v._data(a,"parsedAttrs",!0)}}return l}return typeof e=="object"?this.each(function(){v.data(this,e)}):(r=e.split(".",2),r[1]=r[1]?"."+r[1]:"",i=r[1]+"!",v.access(this,function(n){if(n===t)return l=this.triggerHandler("getData"+i,[r[0]]),l===t&&a&&(l=v.data(a,e),l=H(a,e,l)),l===t&&r[1]?this.data(r[0]):l;r[1]=n,this.each(function(){var t=v(this);t.triggerHandler("setData"+i,r),v.data(this,e,n),t.triggerHandler("changeData"+i,r)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){v.removeData(this,e)})}}),v.extend({queue:function(e,t,n){var r;if(e)return t=(t||"fx")+"queue",r=v._data(e,t),n&&(!r||v.isArray(n)?r=v._data(e,t,v.makeArray(n)):r.push(n)),r||[]},dequeue:function(e,t){t=t||"fx";var n=v.queue(e,t),r=n.length,i=n.shift(),s=v._queueHooks(e,t),o=function(){v.dequeue(e,t)};i==="inprogress"&&(i=n.shift(),r--),i&&(t==="fx"&&n.unshift("inprogress"),delete s.stop,i.call(e,o,s)),!r&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return v._data(e,n)||v._data(e,n,{empty:v.Callbacks("once memory").add(function(){v.removeData(e,t+"queue",!0),v.removeData(e,n,!0)})})}}),v.fn.extend({queue:function(e,n){var r=2;return typeof e!="string"&&(n=e,e="fx",r--),arguments.length<r?v.queue(this[0],e):n===t?this:this.each(function(){var t=v.queue(this,e,n);v._queueHooks(this,e),e==="fx"&&t[0]!=="inprogress"&&v.dequeue(this,e)})},dequeue:function(e){return this.each(function(){v.dequeue(this,e)})},delay:function(e,t){return e=v.fx?v.fx.speeds[e]||e:e,t=t||"fx",this.queue(t,function(t,n){var r=setTimeout(t,e);n.stop=function(){clearTimeout(r)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var r,i=1,s=v.Deferred(),o=this,u=this.length,a=function(){--i||s.resolveWith(o,[o])};typeof e!="string"&&(n=e,e=t),e=e||"fx";while(u--)r=v._data(o[u],e+"queueHooks"),r&&r.empty&&(i++,r.empty.add(a));return a(),s.promise(n)}});var j,F,I,q=/[\t\r\n]/g,R=/\r/g,U=/^(?:button|input)$/i,z=/^(?:button|input|object|select|textarea)$/i,W=/^a(?:rea|)$/i,X=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,V=v.support.getSetAttribute;v.fn.extend({attr:function(e,t){return v.access(this,v.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){v.removeAttr(this,e)})},prop:function(e,t){return v.access(this,v.prop,e,t,arguments.length>1)},removeProp:function(e){return e=v.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(n){}})},addClass:function(e){var t,n,r,i,s,o,u;if(v.isFunction(e))return this.each(function(t){v(this).addClass(e.call(this,t,this.className))});if(e&&typeof e=="string"){t=e.split(y);for(n=0,r=this.length;n<r;n++){i=this[n];if(i.nodeType===1)if(!i.className&&t.length===1)i.className=e;else{s=" "+i.className+" ";for(o=0,u=t.length;o<u;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");i.className=v.trim(s)}}}return this},removeClass:function(e){var n,r,i,s,o,u,a;if(v.isFunction(e))return this.each(function(t){v(this).removeClass(e.call(this,t,this.className))});if(e&&typeof e=="string"||e===t){n=(e||"").split(y);for(u=0,a=this.length;u<a;u++){i=this[u];if(i.nodeType===1&&i.className){r=(" "+i.className+" ").replace(q," ");for(s=0,o=n.length;s<o;s++)while(r.indexOf(" "+n[s]+" ")>=0)r=r.replace(" "+n[s]+" "," ");i.className=e?v.trim(r):""}}}return this},toggleClass:function(e,t){var n=typeof e,r=typeof t=="boolean";return v.isFunction(e)?this.each(function(n){v(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if(n==="string"){var i,s=0,o=v(this),u=t,a=e.split(y);while(i=a[s++])u=r?u:!o.hasClass(i),o[u?"addClass":"removeClass"](i)}else if(n==="undefined"||n==="boolean")this.className&&v._data(this,"__className__",this.className),this.className=this.className||e===!1?"":v._data(this,"__className__")||""})},hasClass:function(e){var t=" "+e+" ",n=0,r=this.length;for(;n<r;n++)if(this[n].nodeType===1&&(" "+this[n].className+" ").replace(q," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,r,i,s=this[0];if(!arguments.length){if(s)return n=v.valHooks[s.type]||v.valHooks[s.nodeName.toLowerCase()],n&&"get"in n&&(r=n.get(s,"value"))!==t?r:(r=s.value,typeof r=="string"?r.replace(R,""):r==null?"":r);return}return i=v.isFunction(e),this.each(function(r){var s,o=v(this);if(this.nodeType!==1)return;i?s=e.call(this,r,o.val()):s=e,s==null?s="":typeof s=="number"?s+="":v.isArray(s)&&(s=v.map(s,function(e){return e==null?"":e+""})),n=v.valHooks[this.type]||v.valHooks[this.nodeName.toLowerCase()];if(!n||!("set"in n)||n.set(this,s,"value")===t)this.value=s})}}),v.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){var t,n,r=e.options,i=e.selectedIndex,s=e.type==="select-one"||i<0,o=s?null:[],u=s?i+1:r.length,a=i<0?u:s?i:0;for(;a<u;a++){n=r[a];if((n.selected||a===i)&&(v.support.optDisabled?!n.disabled:n.getAttribute("disabled")===null)&&(!n.parentNode.disabled||!v.nodeName(n.parentNode,"optgroup"))){t=v(n).val();if(s)return t;o.push(t)}}return o},set:function(e,t){var n=v.makeArray(t);return v(e).find("option").each(function(){this.selected=v.inArray(v(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,r,i){var s,o,u,a=e.nodeType;if(!e||a===3||a===8||a===2)return;if(i&&v.isFunction(v.fn[n]))return v(e)[n](r);if(typeof e.getAttribute=="undefined")return v.prop(e,n,r);u=a!==1||!v.isXMLDoc(e),u&&(n=n.toLowerCase(),o=v.attrHooks[n]||(X.test(n)?F:j));if(r!==t){if(r===null){v.removeAttr(e,n);return}return o&&"set"in o&&u&&(s=o.set(e,r,n))!==t?s:(e.setAttribute(n,r+""),r)}return o&&"get"in o&&u&&(s=o.get(e,n))!==null?s:(s=e.getAttribute(n),s===null?t:s)},removeAttr:function(e,t){var n,r,i,s,o=0;if(t&&e.nodeType===1){r=t.split(y);for(;o<r.length;o++)i=r[o],i&&(n=v.propFix[i]||i,s=X.test(i),s||v.attr(e,i,""),e.removeAttribute(V?i:n),s&&n in e&&(e[n]=!1))}},attrHooks:{type:{set:function(e,t){if(U.test(e.nodeName)&&e.parentNode)v.error("type property can't be changed");else if(!v.support.radioValue&&t==="radio"&&v.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return j&&v.nodeName(e,"button")?j.get(e,t):t in e?e.value:null},set:function(e,t,n){if(j&&v.nodeName(e,"button"))return j.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,r){var i,s,o,u=e.nodeType;if(!e||u===3||u===8||u===2)return;return o=u!==1||!v.isXMLDoc(e),o&&(n=v.propFix[n]||n,s=v.propHooks[n]),r!==t?s&&"set"in s&&(i=s.set(e,r,n))!==t?i:e[n]=r:s&&"get"in s&&(i=s.get(e,n))!==null?i:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):z.test(e.nodeName)||W.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var r,i=v.prop(e,n);return i===!0||typeof i!="boolean"&&(r=e.getAttributeNode(n))&&r.nodeValue!==!1?n.toLowerCase():t},set:function(e,t,n){var r;return t===!1?v.removeAttr(e,n):(r=v.propFix[n]||n,r in e&&(e[r]=!0),e.setAttribute(n,n.toLowerCase())),n}},V||(I={name:!0,id:!0,coords:!0},j=v.valHooks.button={get:function(e,n){var r;return r=e.getAttributeNode(n),r&&(I[n]?r.value!=="":r.specified)?r.value:t},set:function(e,t,n){var r=e.getAttributeNode(n);return r||(r=i.createAttribute(n),e.setAttributeNode(r)),r.value=t+""}},v.each(["width","height"],function(e,t){v.attrHooks[t]=v.extend(v.attrHooks[t],{set:function(e,n){if(n==="")return e.setAttribute(t,"auto"),n}})}),v.attrHooks.contenteditable={get:j.get,set:function(e,t,n){t===""&&(t="false"),j.set(e,t,n)}}),v.support.hrefNormalized||v.each(["href","src","width","height"],function(e,n){v.attrHooks[n]=v.extend(v.attrHooks[n],{get:function(e){var r=e.getAttribute(n,2);return r===null?t:r}})}),v.support.style||(v.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),v.support.optSelected||(v.propHooks.selected=v.extend(v.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),v.support.enctype||(v.propFix.enctype="encoding"),v.support.checkOn||v.each(["radio","checkbox"],function(){v.valHooks[this]={get:function(e){return e.getAttribute("value")===null?"on":e.value}}}),v.each(["radio","checkbox"],function(){v.valHooks[this]=v.extend(v.valHooks[this],{set:function(e,t){if(v.isArray(t))return e.checked=v.inArray(v(e).val(),t)>=0}})});var $=/^(?:textarea|input|select)$/i,J=/^([^\.]*|)(?:\.(.+)|)$/,K=/(?:^|\s)hover(\.\S+|)\b/,Q=/^key/,G=/^(?:mouse|contextmenu)|click/,Y=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return v.event.special.hover?e:e.replace(K,"mouseenter$1 mouseleave$1")};v.event={add:function(e,n,r,i,s){var o,u,a,f,l,c,h,p,d,m,g;if(e.nodeType===3||e.nodeType===8||!n||!r||!(o=v._data(e)))return;r.handler&&(d=r,r=d.handler,s=d.selector),r.guid||(r.guid=v.guid++),a=o.events,a||(o.events=a={}),u=o.handle,u||(o.handle=u=function(e){return typeof v=="undefined"||!!e&&v.event.triggered===e.type?t:v.event.dispatch.apply(u.elem,arguments)},u.elem=e),n=v.trim(Z(n)).split(" ");for(f=0;f<n.length;f++){l=J.exec(n[f])||[],c=l[1],h=(l[2]||"").split(".").sort(),g=v.event.special[c]||{},c=(s?g.delegateType:g.bindType)||c,g=v.event.special[c]||{},p=v.extend({type:c,origType:l[1],data:i,handler:r,guid:r.guid,selector:s,needsContext:s&&v.expr.match.needsContext.test(s),namespace:h.join(".")},d),m=a[c];if(!m){m=a[c]=[],m.delegateCount=0;if(!g.setup||g.setup.call(e,i,h,u)===!1)e.addEventListener?e.addEventListener(c,u,!1):e.attachEvent&&e.attachEvent("on"+c,u)}g.add&&(g.add.call(e,p),p.handler.guid||(p.handler.guid=r.guid)),s?m.splice(m.delegateCount++,0,p):m.push(p),v.event.global[c]=!0}e=null},global:{},remove:function(e,t,n,r,i){var s,o,u,a,f,l,c,h,p,d,m,g=v.hasData(e)&&v._data(e);if(!g||!(h=g.events))return;t=v.trim(Z(t||"")).split(" ");for(s=0;s<t.length;s++){o=J.exec(t[s])||[],u=a=o[1],f=o[2];if(!u){for(u in h)v.event.remove(e,u+t[s],n,r,!0);continue}p=v.event.special[u]||{},u=(r?p.delegateType:p.bindType)||u,d=h[u]||[],l=d.length,f=f?new RegExp("(^|\\.)"+f.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null;for(c=0;c<d.length;c++)m=d[c],(i||a===m.origType)&&(!n||n.guid===m.guid)&&(!f||f.test(m.namespace))&&(!r||r===m.selector||r==="**"&&m.selector)&&(d.splice(c--,1),m.selector&&d.delegateCount--,p.remove&&p.remove.call(e,m));d.length===0&&l!==d.length&&((!p.teardown||p.teardown.call(e,f,g.handle)===!1)&&v.removeEvent(e,u,g.handle),delete h[u])}v.isEmptyObject(h)&&(delete g.handle,v.removeData(e,"events",!0))},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,r,s,o){if(!s||s.nodeType!==3&&s.nodeType!==8){var u,a,f,l,c,h,p,d,m,g,y=n.type||n,b=[];if(Y.test(y+v.event.triggered))return;y.indexOf("!")>=0&&(y=y.slice(0,-1),a=!0),y.indexOf(".")>=0&&(b=y.split("."),y=b.shift(),b.sort());if((!s||v.event.customEvent[y])&&!v.event.global[y])return;n=typeof n=="object"?n[v.expando]?n:new v.Event(y,n):new v.Event(y),n.type=y,n.isTrigger=!0,n.exclusive=a,n.namespace=b.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=y.indexOf(":")<0?"on"+y:"";if(!s){u=v.cache;for(f in u)u[f].events&&u[f].events[y]&&v.event.trigger(n,r,u[f].handle.elem,!0);return}n.result=t,n.target||(n.target=s),r=r!=null?v.makeArray(r):[],r.unshift(n),p=v.event.special[y]||{};if(p.trigger&&p.trigger.apply(s,r)===!1)return;m=[[s,p.bindType||y]];if(!o&&!p.noBubble&&!v.isWindow(s)){g=p.delegateType||y,l=Y.test(g+y)?s:s.parentNode;for(c=s;l;l=l.parentNode)m.push([l,g]),c=l;c===(s.ownerDocument||i)&&m.push([c.defaultView||c.parentWindow||e,g])}for(f=0;f<m.length&&!n.isPropagationStopped();f++)l=m[f][0],n.type=m[f][1],d=(v._data(l,"events")||{})[n.type]&&v._data(l,"handle"),d&&d.apply(l,r),d=h&&l[h],d&&v.acceptData(l)&&d.apply&&d.apply(l,r)===!1&&n.preventDefault();return n.type=y,!o&&!n.isDefaultPrevented()&&(!p._default||p._default.apply(s.ownerDocument,r)===!1)&&(y!=="click"||!v.nodeName(s,"a"))&&v.acceptData(s)&&h&&s[y]&&(y!=="focus"&&y!=="blur"||n.target.offsetWidth!==0)&&!v.isWindow(s)&&(c=s[h],c&&(s[h]=null),v.event.triggered=y,s[y](),v.event.triggered=t,c&&(s[h]=c)),n.result}return},dispatch:function(n){n=v.event.fix(n||e.event);var r,i,s,o,u,a,f,c,h,p,d=(v._data(this,"events")||{})[n.type]||[],m=d.delegateCount,g=l.call(arguments),y=!n.exclusive&&!n.namespace,b=v.event.special[n.type]||{},w=[];g[0]=n,n.delegateTarget=this;if(b.preDispatch&&b.preDispatch.call(this,n)===!1)return;if(m&&(!n.button||n.type!=="click"))for(s=n.target;s!=this;s=s.parentNode||this)if(s.disabled!==!0||n.type!=="click"){u={},f=[];for(r=0;r<m;r++)c=d[r],h=c.selector,u[h]===t&&(u[h]=c.needsContext?v(h,this).index(s)>=0:v.find(h,this,null,[s]).length),u[h]&&f.push(c);f.length&&w.push({elem:s,matches:f})}d.length>m&&w.push({elem:this,matches:d.slice(m)});for(r=0;r<w.length&&!n.isPropagationStopped();r++){a=w[r],n.currentTarget=a.elem;for(i=0;i<a.matches.length&&!n.isImmediatePropagationStopped();i++){c=a.matches[i];if(y||!n.namespace&&!c.namespace||n.namespace_re&&n.namespace_re.test(c.namespace))n.data=c.data,n.handleObj=c,o=((v.event.special[c.origType]||{}).handle||c.handler).apply(a.elem,g),o!==t&&(n.result=o,o===!1&&(n.preventDefault(),n.stopPropagation()))}}return b.postDispatch&&b.postDispatch.call(this,n),n.result},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return e.which==null&&(e.which=t.charCode!=null?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var r,s,o,u=n.button,a=n.fromElement;return e.pageX==null&&n.clientX!=null&&(r=e.target.ownerDocument||i,s=r.documentElement,o=r.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&a&&(e.relatedTarget=a===e.target?n.toElement:a),!e.which&&u!==t&&(e.which=u&1?1:u&2?3:u&4?2:0),e}},fix:function(e){if(e[v.expando])return e;var t,n,r=e,s=v.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;e=v.Event(r);for(t=o.length;t;)n=o[--t],e[n]=r[n];return e.target||(e.target=r.srcElement||i),e.target.nodeType===3&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,r):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){v.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,r){var i=v.extend(new v.Event,n,{type:e,isSimulated:!0,originalEvent:{}});r?v.event.trigger(i,null,t):v.event.dispatch.call(t,i),i.isDefaultPrevented()&&n.preventDefault()}},v.event.handle=v.event.dispatch,v.removeEvent=i.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var r="on"+t;e.detachEvent&&(typeof e[r]=="undefined"&&(e[r]=null),e.detachEvent(r,n))},v.Event=function(e,t){if(!(this instanceof v.Event))return new v.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||e.returnValue===!1||e.getPreventDefault&&e.getPreventDefault()?tt:et):this.type=e,t&&v.extend(this,t),this.timeStamp=e&&e.timeStamp||v.now(),this[v.expando]=!0},v.Event.prototype={preventDefault:function(){this.isDefaultPrevented=tt;var e=this.originalEvent;if(!e)return;e.preventDefault?e.preventDefault():e.returnValue=!1},stopPropagation:function(){this.isPropagationStopped=tt;var e=this.originalEvent;if(!e)return;e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=tt,this.stopPropagation()},isDefaultPrevented:et,isPropagationStopped:et,isImmediatePropagationStopped:et},v.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){v.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,r=this,i=e.relatedTarget,s=e.handleObj,o=s.selector;if(!i||i!==r&&!v.contains(r,i))e.type=s.origType,n=s.handler.apply(this,arguments),e.type=t;return n}}}),v.support.submitBubbles||(v.event.special.submit={setup:function(){if(v.nodeName(this,"form"))return!1;v.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,r=v.nodeName(n,"input")||v.nodeName(n,"button")?n.form:t;r&&!v._data(r,"_submit_attached")&&(v.event.add(r,"submit._submit",function(e){e._submit_bubble=!0}),v._data(r,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&v.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(v.nodeName(this,"form"))return!1;v.event.remove(this,"._submit")}}),v.support.changeBubbles||(v.event.special.change={setup:function(){if($.test(this.nodeName)){if(this.type==="checkbox"||this.type==="radio")v.event.add(this,"propertychange._change",function(e){e.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),v.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),v.event.simulate("change",this,e,!0)});return!1}v.event.add(this,"beforeactivate._change",function(e){var t=e.target;$.test(t.nodeName)&&!v._data(t,"_change_attached")&&(v.event.add(t,"change._change",function(e){this.parentNode&&!e.isSimulated&&!e.isTrigger&&v.event.simulate("change",this.parentNode,e,!0)}),v._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return e.handleObj.handler.apply(this,arguments)},teardown:function(){return v.event.remove(this,"._change"),!$.test(this.nodeName)}}),v.support.focusinBubbles||v.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,r=function(e){v.event.simulate(t,e.target,v.event.fix(e),!0)};v.event.special[t]={setup:function(){n++===0&&i.addEventListener(e,r,!0)},teardown:function(){--n===0&&i.removeEventListener(e,r,!0)}}}),v.fn.extend({on:function(e,n,r,i,s){var o,u;if(typeof e=="object"){typeof n!="string"&&(r=r||n,n=t);for(u in e)this.on(u,n,r,e[u],s);return this}r==null&&i==null?(i=n,r=n=t):i==null&&(typeof n=="string"?(i=r,r=t):(i=r,r=n,n=t));if(i===!1)i=et;else if(!i)return this;return s===1&&(o=i,i=function(e){return v().off(e),o.apply(this,arguments)},i.guid=o.guid||(o.guid=v.guid++)),this.each(function(){v.event.add(this,e,i,r,n)})},one:function(e,t,n,r){return this.on(e,t,n,r,1)},off:function(e,n,r){var i,s;if(e&&e.preventDefault&&e.handleObj)return i=e.handleObj,v(e.delegateTarget).off(i.namespace?i.origType+"."+i.namespace:i.origType,i.selector,i.handler),this;if(typeof e=="object"){for(s in e)this.off(s,n,e[s]);return this}if(n===!1||typeof n=="function")r=n,n=t;return r===!1&&(r=et),this.each(function(){v.event.remove(this,e,r,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return v(this.context).on(e,this.selector,t,n),this},die:function(e,t){return v(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,r){return this.on(t,e,n,r)},undelegate:function(e,t,n){return arguments.length===1?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){v.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return v.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||v.guid++,r=0,i=function(n){var i=(v._data(this,"lastToggle"+e.guid)||0)%r;return v._data(this,"lastToggle"+e.guid,i+1),n.preventDefault(),t[i].apply(this,arguments)||!1};i.guid=n;while(r<t.length)t[r++].guid=n;return this.click(i)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),v.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){v.fn[t]=function(e,n){return n==null&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},Q.test(t)&&(v.event.fixHooks[t]=v.event.keyHooks),G.test(t)&&(v.event.fixHooks[t]=v.event.mouseHooks)}),function(e,t){function nt(e,t,n,r){n=n||[],t=t||g;var i,s,a,f,l=t.nodeType;if(!e||typeof e!="string")return n;if(l!==1&&l!==9)return[];a=o(t);if(!a&&!r)if(i=R.exec(e))if(f=i[1]){if(l===9){s=t.getElementById(f);if(!s||!s.parentNode)return n;if(s.id===f)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(f))&&u(t,s)&&s.id===f)return n.push(s),n}else{if(i[2])return S.apply(n,x.call(t.getElementsByTagName(e),0)),n;if((f=i[3])&&Z&&t.getElementsByClassName)return S.apply(n,x.call(t.getElementsByClassName(f),0)),n}return vt(e.replace(j,"$1"),t,n,r,a)}function rt(e){return function(t){var n=t.nodeName.toLowerCase();return n==="input"&&t.type===e}}function it(e){return function(t){var n=t.nodeName.toLowerCase();return(n==="input"||n==="button")&&t.type===e}}function st(e){return N(function(t){return t=+t,N(function(n,r){var i,s=e([],n.length,t),o=s.length;while(o--)n[i=s[o]]&&(n[i]=!(r[i]=n[i]))})})}function ot(e,t,n){if(e===t)return n;var r=e.nextSibling;while(r){if(r===t)return-1;r=r.nextSibling}return 1}function ut(e,t){var n,r,s,o,u,a,f,l=L[d][e+" "];if(l)return t?0:l.slice(0);u=e,a=[],f=i.preFilter;while(u){if(!n||(r=F.exec(u)))r&&(u=u.slice(r[0].length)||u),a.push(s=[]);n=!1;if(r=I.exec(u))s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=r[0].replace(j," ");for(o in i.filter)(r=J[o].exec(u))&&(!f[o]||(r=f[o](r)))&&(s.push(n=new m(r.shift())),u=u.slice(n.length),n.type=o,n.matches=r);if(!n)break}return t?u.length:u?nt.error(e):L(e,a).slice(0)}function at(e,t,r){var i=t.dir,s=r&&t.dir==="parentNode",o=w++;return t.first?function(t,n,r){while(t=t[i])if(s||t.nodeType===1)return e(t,n,r)}:function(t,r,u){if(!u){var a,f=b+" "+o+" ",l=f+n;while(t=t[i])if(s||t.nodeType===1){if((a=t[d])===l)return t.sizset;if(typeof a=="string"&&a.indexOf(f)===0){if(t.sizset)return t}else{t[d]=l;if(e(t,r,u))return t.sizset=!0,t;t.sizset=!1}}}else while(t=t[i])if(s||t.nodeType===1)if(e(t,r,u))return t}}function ft(e){return e.length>1?function(t,n,r){var i=e.length;while(i--)if(!e[i](t,n,r))return!1;return!0}:e[0]}function lt(e,t,n,r,i){var s,o=[],u=0,a=e.length,f=t!=null;for(;u<a;u++)if(s=e[u])if(!n||n(s,r,i))o.push(s),f&&t.push(u);return o}function ct(e,t,n,r,i,s){return r&&!r[d]&&(r=ct(r)),i&&!i[d]&&(i=ct(i,s)),N(function(s,o,u,a){var f,l,c,h=[],p=[],d=o.length,v=s||dt(t||"*",u.nodeType?[u]:u,[]),m=e&&(s||!t)?lt(v,h,e,u,a):v,g=n?i||(s?e:d||r)?[]:o:m;n&&n(m,g,u,a);if(r){f=lt(g,p),r(f,[],u,a),l=f.length;while(l--)if(c=f[l])g[p[l]]=!(m[p[l]]=c)}if(s){if(i||e){if(i){f=[],l=g.length;while(l--)(c=g[l])&&f.push(m[l]=c);i(null,g=[],f,a)}l=g.length;while(l--)(c=g[l])&&(f=i?T.call(s,c):h[l])>-1&&(s[f]=!(o[f]=c))}}else g=lt(g===o?g.splice(d,g.length):g),i?i(null,o,g,a):S.apply(o,g)})}function ht(e){var t,n,r,s=e.length,o=i.relative[e[0].type],u=o||i.relative[" "],a=o?1:0,f=at(function(e){return e===t},u,!0),l=at(function(e){return T.call(t,e)>-1},u,!0),h=[function(e,n,r){return!o&&(r||n!==c)||((t=n).nodeType?f(e,n,r):l(e,n,r))}];for(;a<s;a++)if(n=i.relative[e[a].type])h=[at(ft(h),n)];else{n=i.filter[e[a].type].apply(null,e[a].matches);if(n[d]){r=++a;for(;r<s;r++)if(i.relative[e[r].type])break;return ct(a>1&&ft(h),a>1&&e.slice(0,a-1).join("").replace(j,"$1"),n,a<r&&ht(e.slice(a,r)),r<s&&ht(e=e.slice(r)),r<s&&e.join(""))}h.push(n)}return ft(h)}function pt(e,t){var r=t.length>0,s=e.length>0,o=function(u,a,f,l,h){var p,d,v,m=[],y=0,w="0",x=u&&[],T=h!=null,N=c,C=u||s&&i.find.TAG("*",h&&a.parentNode||a),k=b+=N==null?1:Math.E;T&&(c=a!==g&&a,n=o.el);for(;(p=C[w])!=null;w++){if(s&&p){for(d=0;v=e[d];d++)if(v(p,a,f)){l.push(p);break}T&&(b=k,n=++o.el)}r&&((p=!v&&p)&&y--,u&&x.push(p))}y+=w;if(r&&w!==y){for(d=0;v=t[d];d++)v(x,m,a,f);if(u){if(y>0)while(w--)!x[w]&&!m[w]&&(m[w]=E.call(l));m=lt(m)}S.apply(l,m),T&&!u&&m.length>0&&y+t.length>1&&nt.uniqueSort(l)}return T&&(b=k,c=N),x};return o.el=0,r?N(o):o}function dt(e,t,n){var r=0,i=t.length;for(;r<i;r++)nt(e,t[r],n);return n}function vt(e,t,n,r,s){var o,u,f,l,c,h=ut(e),p=h.length;if(!r&&h.length===1){u=h[0]=h[0].slice(0);if(u.length>2&&(f=u[0]).type==="ID"&&t.nodeType===9&&!s&&i.relative[u[1].type]){t=i.find.ID(f.matches[0].replace($,""),t,s)[0];if(!t)return n;e=e.slice(u.shift().length)}for(o=J.POS.test(e)?-1:u.length-1;o>=0;o--){f=u[o];if(i.relative[l=f.type])break;if(c=i.find[l])if(r=c(f.matches[0].replace($,""),z.test(u[0].type)&&t.parentNode||t,s)){u.splice(o,1),e=r.length&&u.join("");if(!e)return S.apply(n,x.call(r,0)),n;break}}}return a(e,h)(r,t,s,n,z.test(e)),n}function mt(){}var n,r,i,s,o,u,a,f,l,c,h=!0,p="undefined",d=("sizcache"+Math.random()).replace(".",""),m=String,g=e.document,y=g.documentElement,b=0,w=0,E=[].pop,S=[].push,x=[].slice,T=[].indexOf||function(e){var t=0,n=this.length;for(;t<n;t++)if(this[t]===e)return t;return-1},N=function(e,t){return e[d]=t==null||t,e},C=function(){var e={},t=[];return N(function(n,r){return t.push(n)>i.cacheLength&&delete e[t.shift()],e[n+" "]=r},e)},k=C(),L=C(),A=C(),O="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",_=M.replace("w","w#"),D="([*^$|!~]?=)",P="\\["+O+"*("+M+")"+O+"*(?:"+D+O+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+_+")|)|)"+O+"*\\]",H=":("+M+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+P+")|[^:]|\\\\.)*|.*))\\)|)",B=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+O+"*((?:-\\d)?\\d*)"+O+"*\\)|)(?=[^-]|$)",j=new RegExp("^"+O+"+|((?:^|[^\\\\])(?:\\\\.)*)"+O+"+$","g"),F=new RegExp("^"+O+"*,"+O+"*"),I=new RegExp("^"+O+"*([\\x20\\t\\r\\n\\f>+~])"+O+"*"),q=new RegExp(H),R=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,U=/^:not/,z=/[\x20\t\r\n\f]*[+~]/,W=/:not\($/,X=/h\d/i,V=/input|select|textarea|button/i,$=/\\(?!\\)/g,J={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),NAME:new RegExp("^\\[name=['\"]?("+M+")['\"]?\\]"),TAG:new RegExp("^("+M.replace("w","w*")+")"),ATTR:new RegExp("^"+P),PSEUDO:new RegExp("^"+H),POS:new RegExp(B,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+O+"*(even|odd|(([+-]|)(\\d*)n|)"+O+"*(?:([+-]|)"+O+"*(\\d+)|))"+O+"*\\)|)","i"),needsContext:new RegExp("^"+O+"*[>+~]|"+B,"i")},K=function(e){var t=g.createElement("div");try{return e(t)}catch(n){return!1}finally{t=null}},Q=K(function(e){return e.appendChild(g.createComment("")),!e.getElementsByTagName("*").length}),G=K(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&typeof e.firstChild.getAttribute!==p&&e.firstChild.getAttribute("href")==="#"}),Y=K(function(e){e.innerHTML="<select></select>";var t=typeof e.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),Z=K(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!e.getElementsByClassName||!e.getElementsByClassName("e").length?!1:(e.lastChild.className="e",e.getElementsByClassName("e").length===2)}),et=K(function(e){e.id=d+0,e.innerHTML="<a name='"+d+"'></a><div name='"+d+"'></div>",y.insertBefore(e,y.firstChild);var t=g.getElementsByName&&g.getElementsByName(d).length===2+g.getElementsByName(d+0).length;return r=!g.getElementById(d),y.removeChild(e),t});try{x.call(y.childNodes,0)[0].nodeType}catch(tt){x=function(e){var t,n=[];for(;t=this[e];e++)n.push(t);return n}}nt.matches=function(e,t){return nt(e,null,null,t)},nt.matchesSelector=function(e,t){return nt(t,null,null,[e]).length>0},s=nt.getText=function(e){var t,n="",r=0,i=e.nodeType;if(i){if(i===1||i===9||i===11){if(typeof e.textContent=="string")return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(i===3||i===4)return e.nodeValue}else for(;t=e[r];r++)n+=s(t);return n},o=nt.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return t?t.nodeName!=="HTML":!1},u=nt.contains=y.contains?function(e,t){var n=e.nodeType===9?e.documentElement:e,r=t&&t.parentNode;return e===r||!!(r&&r.nodeType===1&&n.contains&&n.contains(r))}:y.compareDocumentPosition?function(e,t){return t&&!!(e.compareDocumentPosition(t)&16)}:function(e,t){while(t=t.parentNode)if(t===e)return!0;return!1},nt.attr=function(e,t){var n,r=o(e);return r||(t=t.toLowerCase()),(n=i.attrHandle[t])?n(e):r||Y?e.getAttribute(t):(n=e.getAttributeNode(t),n?typeof e[t]=="boolean"?e[t]?t:null:n.specified?n.value:null:null)},i=nt.selectors={cacheLength:50,createPseudo:N,match:J,attrHandle:G?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:r?function(e,t,n){if(typeof t.getElementById!==p&&!n){var r=t.getElementById(e);return r&&r.parentNode?[r]:[]}}:function(e,n,r){if(typeof n.getElementById!==p&&!r){var i=n.getElementById(e);return i?i.id===e||typeof i.getAttributeNode!==p&&i.getAttributeNode("id").value===e?[i]:t:[]}},TAG:Q?function(e,t){if(typeof t.getElementsByTagName!==p)return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if(e==="*"){var r,i=[],s=0;for(;r=n[s];s++)r.nodeType===1&&i.push(r);return i}return n},NAME:et&&function(e,t){if(typeof t.getElementsByName!==p)return t.getElementsByName(name)},CLASS:Z&&function(e,t,n){if(typeof t.getElementsByClassName!==p&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace($,""),e[3]=(e[4]||e[5]||"").replace($,""),e[2]==="~="&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),e[1]==="nth"?(e[2]||nt.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*(e[2]==="even"||e[2]==="odd")),e[4]=+(e[6]+e[7]||e[2]==="odd")):e[2]&&nt.error(e[0]),e},PSEUDO:function(e){var t,n;if(J.CHILD.test(e[0]))return null;if(e[3])e[2]=e[3];else if(t=e[4])q.test(t)&&(n=ut(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t;return e.slice(0,3)}},filter:{ID:r?function(e){return e=e.replace($,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace($,""),function(t){var n=typeof t.getAttributeNode!==p&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return e==="*"?function(){return!0}:(e=e.replace($,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=k[d][e+" "];return t||(t=new RegExp("(^|"+O+")"+e+"("+O+"|$)"))&&k(e,function(e){return t.test(e.className||typeof e.getAttribute!==p&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(r,i){var s=nt.attr(r,e);return s==null?t==="!=":t?(s+="",t==="="?s===n:t==="!="?s!==n:t==="^="?n&&s.indexOf(n)===0:t==="*="?n&&s.indexOf(n)>-1:t==="$="?n&&s.substr(s.length-n.length)===n:t==="~="?(" "+s+" ").indexOf(n)>-1:t==="|="?s===n||s.substr(0,n.length+1)===n+"-":!1):!0}},CHILD:function(e,t,n,r){return e==="nth"?function(e){var t,i,s=e.parentNode;if(n===1&&r===0)return!0;if(s){i=0;for(t=s.firstChild;t;t=t.nextSibling)if(t.nodeType===1){i++;if(e===t)break}}return i-=r,i===n||i%n===0&&i/n>=0}:function(t){var n=t;switch(e){case"only":case"first":while(n=n.previousSibling)if(n.nodeType===1)return!1;if(e==="first")return!0;n=t;case"last":while(n=n.nextSibling)if(n.nodeType===1)return!1;return!0}}},PSEUDO:function(e,t){var n,r=i.pseudos[e]||i.setFilters[e.toLowerCase()]||nt.error("unsupported pseudo: "+e);return r[d]?r(t):r.length>1?(n=[e,e,"",t],i.setFilters.hasOwnProperty(e.toLowerCase())?N(function(e,n){var i,s=r(e,t),o=s.length;while(o--)i=T.call(e,s[o]),e[i]=!(n[i]=s[o])}):function(e){return r(e,0,n)}):r}},pseudos:{not:N(function(e){var t=[],n=[],r=a(e.replace(j,"$1"));return r[d]?N(function(e,t,n,i){var s,o=r(e,null,i,[]),u=e.length;while(u--)if(s=o[u])e[u]=!(t[u]=s)}):function(e,i,s){return t[0]=e,r(t,null,s,n),!n.pop()}}),has:N(function(e){return function(t){return nt(e,t).length>0}}),contains:N(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return e.disabled===!1},disabled:function(e){return e.disabled===!0},checked:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&!!e.checked||t==="option"&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,e.selected===!0},parent:function(e){return!i.pseudos.empty(e)},empty:function(e){var t;e=e.firstChild;while(e){if(e.nodeName>"@"||(t=e.nodeType)===3||t===4)return!1;e=e.nextSibling}return!0},header:function(e){return X.test(e.nodeName)},text:function(e){var t,n;return e.nodeName.toLowerCase()==="input"&&(t=e.type)==="text"&&((n=e.getAttribute("type"))==null||n.toLowerCase()===t)},radio:rt("radio"),checkbox:rt("checkbox"),file:rt("file"),password:rt("password"),image:rt("image"),submit:it("submit"),reset:it("reset"),button:function(e){var t=e.nodeName.toLowerCase();return t==="input"&&e.type==="button"||t==="button"},input:function(e){return V.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:st(function(){return[0]}),last:st(function(e,t){return[t-1]}),eq:st(function(e,t,n){return[n<0?n+t:n]}),even:st(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:st(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:st(function(e,t,n){for(var r=n<0?n+t:n;--r>=0;)e.push(r);return e}),gt:st(function(e,t,n){for(var r=n<0?n+t:n;++r<t;)e.push(r);return e})}},f=y.compareDocumentPosition?function(e,t){return e===t?(l=!0,0):(!e.compareDocumentPosition||!t.compareDocumentPosition?e.compareDocumentPosition:e.compareDocumentPosition(t)&4)?-1:1}:function(e,t){if(e===t)return l=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,r,i=[],s=[],o=e.parentNode,u=t.parentNode,a=o;if(o===u)return ot(e,t);if(!o)return-1;if(!u)return 1;while(a)i.unshift(a),a=a.parentNode;a=u;while(a)s.unshift(a),a=a.parentNode;n=i.length,r=s.length;for(var f=0;f<n&&f<r;f++)if(i[f]!==s[f])return ot(i[f],s[f]);return f===n?ot(e,s[f],-1):ot(i[f],t,1)},[0,0].sort(f),h=!l,nt.uniqueSort=function(e){var t,n=[],r=1,i=0;l=h,e.sort(f);if(l){for(;t=e[r];r++)t===e[r-1]&&(i=n.push(r));while(i--)e.splice(n[i],1)}return e},nt.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},a=nt.compile=function(e,t){var n,r=[],i=[],s=A[d][e+" "];if(!s){t||(t=ut(e)),n=t.length;while(n--)s=ht(t[n]),s[d]?r.push(s):i.push(s);s=A(e,pt(i,r))}return s},g.querySelectorAll&&function(){var e,t=vt,n=/'|\\/g,r=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,i=[":focus"],s=[":active"],u=y.matchesSelector||y.mozMatchesSelector||y.webkitMatchesSelector||y.oMatchesSelector||y.msMatchesSelector;K(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||i.push("\\["+O+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||i.push(":checked")}),K(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&i.push("[*^$]="+O+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||i.push(":enabled",":disabled")}),i=new RegExp(i.join("|")),vt=function(e,r,s,o,u){if(!o&&!u&&!i.test(e)){var a,f,l=!0,c=d,h=r,p=r.nodeType===9&&e;if(r.nodeType===1&&r.nodeName.toLowerCase()!=="object"){a=ut(e),(l=r.getAttribute("id"))?c=l.replace(n,"\\$&"):r.setAttribute("id",c),c="[id='"+c+"'] ",f=a.length;while(f--)a[f]=c+a[f].join("");h=z.test(e)&&r.parentNode||r,p=a.join(",")}if(p)try{return S.apply(s,x.call(h.querySelectorAll(p),0)),s}catch(v){}finally{l||r.removeAttribute("id")}}return t(e,r,s,o,u)},u&&(K(function(t){e=u.call(t,"div");try{u.call(t,"[test!='']:sizzle"),s.push("!=",H)}catch(n){}}),s=new RegExp(s.join("|")),nt.matchesSelector=function(t,n){n=n.replace(r,"='$1']");if(!o(t)&&!s.test(n)&&!i.test(n))try{var a=u.call(t,n);if(a||e||t.document&&t.document.nodeType!==11)return a}catch(f){}return nt(n,null,null,[t]).length>0})}(),i.pseudos.nth=i.pseudos.eq,i.filters=mt.prototype=i.pseudos,i.setFilters=new mt,nt.attr=v.attr,v.find=nt,v.expr=nt.selectors,v.expr[":"]=v.expr.pseudos,v.unique=nt.uniqueSort,v.text=nt.getText,v.isXMLDoc=nt.isXML,v.contains=nt.contains}(e);var nt=/Until$/,rt=/^(?:parents|prev(?:Until|All))/,it=/^.[^:#\[\.,]*$/,st=v.expr.match.needsContext,ot={children:!0,contents:!0,next:!0,prev:!0};v.fn.extend({find:function(e){var t,n,r,i,s,o,u=this;if(typeof e!="string")return v(e).filter(function(){for(t=0,n=u.length;t<n;t++)if(v.contains(u[t],this))return!0});o=this.pushStack("","find",e);for(t=0,n=this.length;t<n;t++){r=o.length,v.find(e,this[t],o);if(t>0)for(i=r;i<o.length;i++)for(s=0;s<r;s++)if(o[s]===o[i]){o.splice(i--,1);break}}return o},has:function(e){var t,n=v(e,this),r=n.length;return this.filter(function(){for(t=0;t<r;t++)if(v.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(ft(this,e,!1),"not",e)},filter:function(e){return this.pushStack(ft(this,e,!0),"filter",e)},is:function(e){return!!e&&(typeof e=="string"?st.test(e)?v(e,this.context).index(this[0])>=0:v.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){var n,r=0,i=this.length,s=[],o=st.test(e)||typeof e!="string"?v(e,t||this.context):0;for(;r<i;r++){n=this[r];while(n&&n.ownerDocument&&n!==t&&n.nodeType!==11){if(o?o.index(n)>-1:v.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}}return s=s.length>1?v.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?typeof e=="string"?v.inArray(this[0],v(e)):v.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n=typeof e=="string"?v(e,t):v.makeArray(e&&e.nodeType?[e]:e),r=v.merge(this.get(),n);return this.pushStack(ut(n[0])||ut(r[0])?r:v.unique(r))},addBack:function(e){return this.add(e==null?this.prevObject:this.prevObject.filter(e))}}),v.fn.andSelf=v.fn.addBack,v.each({parent:function(e){var t=e.parentNode;return t&&t.nodeType!==11?t:null},parents:function(e){return v.dir(e,"parentNode")},parentsUntil:function(e,t,n){return v.dir(e,"parentNode",n)},next:function(e){return at(e,"nextSibling")},prev:function(e){return at(e,"previousSibling")},nextAll:function(e){return v.dir(e,"nextSibling")},prevAll:function(e){return v.dir(e,"previousSibling")},nextUntil:function(e,t,n){return v.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return v.dir(e,"previousSibling",n)},siblings:function(e){return v.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return v.sibling(e.firstChild)},contents:function(e){return v.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:v.merge([],e.childNodes)}},function(e,t){v.fn[e]=function(n,r){var i=v.map(this,t,n);return nt.test(e)||(r=n),r&&typeof r=="string"&&(i=v.filter(r,i)),i=this.length>1&&!ot[e]?v.unique(i):i,this.length>1&&rt.test(e)&&(i=i.reverse()),this.pushStack(i,e,l.call(arguments).join(","))}}),v.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),t.length===1?v.find.matchesSelector(t[0],e)?[t[0]]:[]:v.find.matches(e,t)},dir:function(e,n,r){var i=[],s=e[n];while(s&&s.nodeType!==9&&(r===t||s.nodeType!==1||!v(s).is(r)))s.nodeType===1&&i.push(s),s=s[n];return i},sibling:function(e,t){var n=[];for(;e;e=e.nextSibling)e.nodeType===1&&e!==t&&n.push(e);return n}});var ct="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",ht=/ jQuery\d+="(?:null|\d+)"/g,pt=/^\s+/,dt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,vt=/<([\w:]+)/,mt=/<tbody/i,gt=/<|&#?\w+;/,yt=/<(?:script|style|link)/i,bt=/<(?:script|object|embed|option|style)/i,wt=new RegExp("<(?:"+ct+")[\\s/>]","i"),Et=/^(?:checkbox|radio)$/,St=/checked\s*(?:[^=]|=\s*.checked.)/i,xt=/\/(java|ecma)script/i,Tt=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Nt={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},Ct=lt(i),kt=Ct.appendChild(i.createElement("div"));Nt.optgroup=Nt.option,Nt.tbody=Nt.tfoot=Nt.colgroup=Nt.caption=Nt.thead,Nt.th=Nt.td,v.support.htmlSerialize||(Nt._default=[1,"X<div>","</div>"]),v.fn.extend({text:function(e){return v.access(this,function(e){return e===t?v.text(this):this.empty().append((this[0]&&this[0].ownerDocument||i).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(v.isFunction(e))return this.each(function(t){v(this).wrapAll(e.call(this,t))});if(this[0]){var t=v(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){var e=this;while(e.firstChild&&e.firstChild.nodeType===1)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return v.isFunction(e)?this.each(function(t){v(this).wrapInner(e.call(this,t))}):this.each(function(){var t=v(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=v.isFunction(e);return this.each(function(n){v(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){v.nodeName(this,"body")||v(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(e,this.firstChild)})},before:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(e,this),"before",this.selector)}},after:function(){if(!ut(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=v.clean(arguments);return this.pushStack(v.merge(this,e),"after",this.selector)}},remove:function(e,t){var n,r=0;for(;(n=this[r])!=null;r++)if(!e||v.filter(e,[n]).length)!t&&n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),v.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n);return this},empty:function(){var e,t=0;for(;(e=this[t])!=null;t++){e.nodeType===1&&v.cleanData(e.getElementsByTagName("*"));while(e.firstChild)e.removeChild(e.firstChild)}return this},clone:function(e,t){return e=e==null?!1:e,t=t==null?e:t,this.map(function(){return v.clone(this,e,t)})},html:function(e){return v.access(this,function(e){var n=this[0]||{},r=0,i=this.length;if(e===t)return n.nodeType===1?n.innerHTML.replace(ht,""):t;if(typeof e=="string"&&!yt.test(e)&&(v.support.htmlSerialize||!wt.test(e))&&(v.support.leadingWhitespace||!pt.test(e))&&!Nt[(vt.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(dt,"<$1></$2>");try{for(;r<i;r++)n=this[r]||{},n.nodeType===1&&(v.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(s){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ut(this[0])?this.length?this.pushStack(v(v.isFunction(e)?e():e),"replaceWith",e):this:v.isFunction(e)?this.each(function(t){var n=v(this),r=n.html();n.replaceWith(e.call(this,t,r))}):(typeof e!="string"&&(e=v(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;v(this).remove(),t?v(t).before(e):v(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,r){e=[].concat.apply([],e);var i,s,o,u,a=0,f=e[0],l=[],c=this.length;if(!v.support.checkClone&&c>1&&typeof f=="string"&&St.test(f))return this.each(function(){v(this).domManip(e,n,r)});if(v.isFunction(f))return this.each(function(i){var s=v(this);e[0]=f.call(this,i,n?s.html():t),s.domManip(e,n,r)});if(this[0]){i=v.buildFragment(e,this,l),o=i.fragment,s=o.firstChild,o.childNodes.length===1&&(o=s);if(s){n=n&&v.nodeName(s,"tr");for(u=i.cacheable||c-1;a<c;a++)r.call(n&&v.nodeName(this[a],"table")?Lt(this[a],"tbody"):this[a],a===u?o:v.clone(o,!0,!0))}o=s=null,l.length&&v.each(l,function(e,t){t.src?v.ajax?v.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0}):v.error("no ajax"):v.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Tt,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),v.buildFragment=function(e,n,r){var s,o,u,a=e[0];return n=n||i,n=!n.nodeType&&n[0]||n,n=n.ownerDocument||n,e.length===1&&typeof a=="string"&&a.length<512&&n===i&&a.charAt(0)==="<"&&!bt.test(a)&&(v.support.checkClone||!St.test(a))&&(v.support.html5Clone||!wt.test(a))&&(o=!0,s=v.fragments[a],u=s!==t),s||(s=n.createDocumentFragment(),v.clean(e,n,s,r),o&&(v.fragments[a]=u&&s)),{fragment:s,cacheable:o}},v.fragments={},v.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){v.fn[e]=function(n){var r,i=0,s=[],o=v(n),u=o.length,a=this.length===1&&this[0].parentNode;if((a==null||a&&a.nodeType===11&&a.childNodes.length===1)&&u===1)return o[t](this[0]),this;for(;i<u;i++)r=(i>0?this.clone(!0):this).get(),v(o[i])[t](r),s=s.concat(r);return this.pushStack(s,e,o.selector)}}),v.extend({clone:function(e,t,n){var r,i,s,o;v.support.html5Clone||v.isXMLDoc(e)||!wt.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(kt.innerHTML=e.outerHTML,kt.removeChild(o=kt.firstChild));if((!v.support.noCloneEvent||!v.support.noCloneChecked)&&(e.nodeType===1||e.nodeType===11)&&!v.isXMLDoc(e)){Ot(e,o),r=Mt(e),i=Mt(o);for(s=0;r[s];++s)i[s]&&Ot(r[s],i[s])}if(t){At(e,o);if(n){r=Mt(e),i=Mt(o);for(s=0;r[s];++s)At(r[s],i[s])}}return r=i=null,o},clean:function(e,t,n,r){var s,o,u,a,f,l,c,h,p,d,m,g,y=t===i&&Ct,b=[];if(!t||typeof t.createDocumentFragment=="undefined")t=i;for(s=0;(u=e[s])!=null;s++){typeof u=="number"&&(u+="");if(!u)continue;if(typeof u=="string")if(!gt.test(u))u=t.createTextNode(u);else{y=y||lt(t),c=t.createElement("div"),y.appendChild(c),u=u.replace(dt,"<$1></$2>"),a=(vt.exec(u)||["",""])[1].toLowerCase(),f=Nt[a]||Nt._default,l=f[0],c.innerHTML=f[1]+u+f[2];while(l--)c=c.lastChild;if(!v.support.tbody){h=mt.test(u),p=a==="table"&&!h?c.firstChild&&c.firstChild.childNodes:f[1]==="<table>"&&!h?c.childNodes:[];for(o=p.length-1;o>=0;--o)v.nodeName(p[o],"tbody")&&!p[o].childNodes.length&&p[o].parentNode.removeChild(p[o])}!v.support.leadingWhitespace&&pt.test(u)&&c.insertBefore(t.createTextNode(pt.exec(u)[0]),c.firstChild),u=c.childNodes,c.parentNode.removeChild(c)}u.nodeType?b.push(u):v.merge(b,u)}c&&(u=c=y=null);if(!v.support.appendChecked)for(s=0;(u=b[s])!=null;s++)v.nodeName(u,"input")?_t(u):typeof u.getElementsByTagName!="undefined"&&v.grep(u.getElementsByTagName("input"),_t);if(n){m=function(e){if(!e.type||xt.test(e.type))return r?r.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)};for(s=0;(u=b[s])!=null;s++)if(!v.nodeName(u,"script")||!m(u))n.appendChild(u),typeof u.getElementsByTagName!="undefined"&&(g=v.grep(v.merge([],u.getElementsByTagName("script")),m),b.splice.apply(b,[s+1,0].concat(g)),s+=g.length)}return b},cleanData:function(e,t){var n,r,i,s,o=0,u=v.expando,a=v.cache,f=v.support.deleteExpando,l=v.event.special;for(;(i=e[o])!=null;o++)if(t||v.acceptData(i)){r=i[u],n=r&&a[r];if(n){if(n.events)for(s in n.events)l[s]?v.event.remove(i,s):v.removeEvent(i,s,n.handle);a[r]&&(delete a[r],f?delete i[u]:i.removeAttribute?i.removeAttribute(u):i[u]=null,v.deletedIds.push(r))}}}}),function(){var e,t;v.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},e=v.uaMatch(o.userAgent),t={},e.browser&&(t[e.browser]=!0,t.version=e.version),t.chrome?t.webkit=!0:t.webkit&&(t.safari=!0),v.browser=t,v.sub=function(){function e(t,n){return new e.fn.init(t,n)}v.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(r,i){return i&&i instanceof v&&!(i instanceof e)&&(i=e(i)),v.fn.init.call(this,r,i,t)},e.fn.init.prototype=e.fn;var t=e(i);return e}}();var Dt,Pt,Ht,Bt=/alpha\([^)]*\)/i,jt=/opacity=([^)]*)/,Ft=/^(top|right|bottom|left)$/,It=/^(none|table(?!-c[ea]).+)/,qt=/^margin/,Rt=new RegExp("^("+m+")(.*)$","i"),Ut=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),zt=new RegExp("^([-+])=("+m+")","i"),Wt={BODY:"block"},Xt={position:"absolute",visibility:"hidden",display:"block"},Vt={letterSpacing:0,fontWeight:400},$t=["Top","Right","Bottom","Left"],Jt=["Webkit","O","Moz","ms"],Kt=v.fn.toggle;v.fn.extend({css:function(e,n){return v.access(this,function(e,n,r){return r!==t?v.style(e,n,r):v.css(e,n)},e,n,arguments.length>1)},show:function(){return Yt(this,!0)},hide:function(){return Yt(this)},toggle:function(e,t){var n=typeof e=="boolean";return v.isFunction(e)&&v.isFunction(t)?Kt.apply(this,arguments):this.each(function(){(n?e:Gt(this))?v(this).show():v(this).hide()})}}),v.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Dt(e,"opacity");return n===""?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":v.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,r,i){if(!e||e.nodeType===3||e.nodeType===8||!e.style)return;var s,o,u,a=v.camelCase(n),f=e.style;n=v.cssProps[a]||(v.cssProps[a]=Qt(f,a)),u=v.cssHooks[n]||v.cssHooks[a];if(r===t)return u&&"get"in u&&(s=u.get(e,!1,i))!==t?s:f[n];o=typeof r,o==="string"&&(s=zt.exec(r))&&(r=(s[1]+1)*s[2]+parseFloat(v.css(e,n)),o="number");if(r==null||o==="number"&&isNaN(r))return;o==="number"&&!v.cssNumber[a]&&(r+="px");if(!u||!("set"in u)||(r=u.set(e,r,i))!==t)try{f[n]=r}catch(l){}},css:function(e,n,r,i){var s,o,u,a=v.camelCase(n);return n=v.cssProps[a]||(v.cssProps[a]=Qt(e.style,a)),u=v.cssHooks[n]||v.cssHooks[a],u&&"get"in u&&(s=u.get(e,!0,i)),s===t&&(s=Dt(e,n)),s==="normal"&&n in Vt&&(s=Vt[n]),r||i!==t?(o=parseFloat(s),r||v.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var r,i,s={};for(i in t)s[i]=e.style[i],e.style[i]=t[i];r=n.call(e);for(i in t)e.style[i]=s[i];return r}}),e.getComputedStyle?Dt=function(t,n){var r,i,s,o,u=e.getComputedStyle(t,null),a=t.style;return u&&(r=u.getPropertyValue(n)||u[n],r===""&&!v.contains(t.ownerDocument,t)&&(r=v.style(t,n)),Ut.test(r)&&qt.test(n)&&(i=a.width,s=a.minWidth,o=a.maxWidth,a.minWidth=a.maxWidth=a.width=r,r=u.width,a.width=i,a.minWidth=s,a.maxWidth=o)),r}:i.documentElement.currentStyle&&(Dt=function(e,t){var n,r,i=e.currentStyle&&e.currentStyle[t],s=e.style;return i==null&&s&&s[t]&&(i=s[t]),Ut.test(i)&&!Ft.test(t)&&(n=s.left,r=e.runtimeStyle&&e.runtimeStyle.left,r&&(e.runtimeStyle.left=e.currentStyle.left),s.left=t==="fontSize"?"1em":i,i=s.pixelLeft+"px",s.left=n,r&&(e.runtimeStyle.left=r)),i===""?"auto":i}),v.each(["height","width"],function(e,t){v.cssHooks[t]={get:function(e,n,r){if(n)return e.offsetWidth===0&&It.test(Dt(e,"display"))?v.swap(e,Xt,function(){return tn(e,t,r)}):tn(e,t,r)},set:function(e,n,r){return Zt(e,n,r?en(e,t,r,v.support.boxSizing&&v.css(e,"boxSizing")==="border-box"):0)}}}),v.support.opacity||(v.cssHooks.opacity={get:function(e,t){return jt.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,r=e.currentStyle,i=v.isNumeric(t)?"alpha(opacity="+t*100+")":"",s=r&&r.filter||n.filter||"";n.zoom=1;if(t>=1&&v.trim(s.replace(Bt,""))===""&&n.removeAttribute){n.removeAttribute("filter");if(r&&!r.filter)return}n.filter=Bt.test(s)?s.replace(Bt,i):s+" "+i}}),v(function(){v.support.reliableMarginRight||(v.cssHooks.marginRight={get:function(e,t){return v.swap(e,{display:"inline-block"},function(){if(t)return Dt(e,"marginRight")})}}),!v.support.pixelPosition&&v.fn.position&&v.each(["top","left"],function(e,t){v.cssHooks[t]={get:function(e,n){if(n){var r=Dt(e,t);return Ut.test(r)?v(e).position()[t]+"px":r}}}})}),v.expr&&v.expr.filters&&(v.expr.filters.hidden=function(e){return e.offsetWidth===0&&e.offsetHeight===0||!v.support.reliableHiddenOffsets&&(e.style&&e.style.display||Dt(e,"display"))==="none"},v.expr.filters.visible=function(e){return!v.expr.filters.hidden(e)}),v.each({margin:"",padding:"",border:"Width"},function(e,t){v.cssHooks[e+t]={expand:function(n){var r,i=typeof n=="string"?n.split(" "):[n],s={};for(r=0;r<4;r++)s[e+$t[r]+t]=i[r]||i[r-2]||i[0];return s}},qt.test(e)||(v.cssHooks[e+t].set=Zt)});var rn=/%20/g,sn=/\[\]$/,on=/\r?\n/g,un=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,an=/^(?:select|textarea)/i;v.fn.extend({serialize:function(){return v.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?v.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||an.test(this.nodeName)||un.test(this.type))}).map(function(e,t){var n=v(this).val();return n==null?null:v.isArray(n)?v.map(n,function(e,n){return{name:t.name,value:e.replace(on,"\r\n")}}):{name:t.name,value:n.replace(on,"\r\n")}}).get()}}),v.param=function(e,n){var r,i=[],s=function(e,t){t=v.isFunction(t)?t():t==null?"":t,i[i.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};n===t&&(n=v.ajaxSettings&&v.ajaxSettings.traditional);if(v.isArray(e)||e.jquery&&!v.isPlainObject(e))v.each(e,function(){s(this.name,this.value)});else for(r in e)fn(r,e[r],n,s);return i.join("&").replace(rn,"+")};var ln,cn,hn=/#.*$/,pn=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,dn=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,vn=/^(?:GET|HEAD)$/,mn=/^\/\//,gn=/\?/,yn=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,bn=/([?&])_=[^&]*/,wn=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,En=v.fn.load,Sn={},xn={},Tn=["*/"]+["*"];try{cn=s.href}catch(Nn){cn=i.createElement("a"),cn.href="",cn=cn.href}ln=wn.exec(cn.toLowerCase())||[],v.fn.load=function(e,n,r){if(typeof e!="string"&&En)return En.apply(this,arguments);if(!this.length)return this;var i,s,o,u=this,a=e.indexOf(" ");return a>=0&&(i=e.slice(a,e.length),e=e.slice(0,a)),v.isFunction(n)?(r=n,n=t):n&&typeof n=="object"&&(s="POST"),v.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){r&&u.each(r,o||[e.responseText,t,e])}}).done(function(e){o=arguments,u.html(i?v("<div>").append(e.replace(yn,"")).find(i):e)}),this},v.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){v.fn[t]=function(e){return this.on(t,e)}}),v.each(["get","post"],function(e,n){v[n]=function(e,r,i,s){return v.isFunction(r)&&(s=s||i,i=r,r=t),v.ajax({type:n,url:e,data:r,success:i,dataType:s})}}),v.extend({getScript:function(e,n){return v.get(e,t,n,"script")},getJSON:function(e,t,n){return v.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Ln(e,v.ajaxSettings):(t=e,e=v.ajaxSettings),Ln(e,t),e},ajaxSettings:{url:cn,isLocal:dn.test(ln[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":Tn},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":v.parseJSON,"text xml":v.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Cn(Sn),ajaxTransport:Cn(xn),ajax:function(e,n){function T(e,n,s,a){var l,y,b,w,S,T=n;if(E===2)return;E=2,u&&clearTimeout(u),o=t,i=a||"",x.readyState=e>0?4:0,s&&(w=An(c,x,s));if(e>=200&&e<300||e===304)c.ifModified&&(S=x.getResponseHeader("Last-Modified"),S&&(v.lastModified[r]=S),S=x.getResponseHeader("Etag"),S&&(v.etag[r]=S)),e===304?(T="notmodified",l=!0):(l=On(c,w),T=l.state,y=l.data,b=l.error,l=!b);else{b=T;if(!T||e)T="error",e<0&&(e=0)}x.status=e,x.statusText=(n||T)+"",l?d.resolveWith(h,[y,T,x]):d.rejectWith(h,[x,T,b]),x.statusCode(g),g=t,f&&p.trigger("ajax"+(l?"Success":"Error"),[x,c,l?y:b]),m.fireWith(h,[x,T]),f&&(p.trigger("ajaxComplete",[x,c]),--v.active||v.event.trigger("ajaxStop"))}typeof e=="object"&&(n=e,e=t),n=n||{};var r,i,s,o,u,a,f,l,c=v.ajaxSetup({},n),h=c.context||c,p=h!==c&&(h.nodeType||h instanceof v)?v(h):v.event,d=v.Deferred(),m=v.Callbacks("once memory"),g=c.statusCode||{},b={},w={},E=0,S="canceled",x={readyState:0,setRequestHeader:function(e,t){if(!E){var n=e.toLowerCase();e=w[n]=w[n]||e,b[e]=t}return this},getAllResponseHeaders:function(){return E===2?i:null},getResponseHeader:function(e){var n;if(E===2){if(!s){s={};while(n=pn.exec(i))s[n[1].toLowerCase()]=n[2]}n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return E||(c.mimeType=e),this},abort:function(e){return e=e||S,o&&o.abort(e),T(0,e),this}};d.promise(x),x.success=x.done,x.error=x.fail,x.complete=m.add,x.statusCode=function(e){if(e){var t;if(E<2)for(t in e)g[t]=[g[t],e[t]];else t=e[x.status],x.always(t)}return this},c.url=((e||c.url)+"").replace(hn,"").replace(mn,ln[1]+"//"),c.dataTypes=v.trim(c.dataType||"*").toLowerCase().split(y),c.crossDomain==null&&(a=wn.exec(c.url.toLowerCase()),c.crossDomain=!(!a||a[1]===ln[1]&&a[2]===ln[2]&&(a[3]||(a[1]==="http:"?80:443))==(ln[3]||(ln[1]==="http:"?80:443)))),c.data&&c.processData&&typeof c.data!="string"&&(c.data=v.param(c.data,c.traditional)),kn(Sn,c,n,x);if(E===2)return x;f=c.global,c.type=c.type.toUpperCase(),c.hasContent=!vn.test(c.type),f&&v.active++===0&&v.event.trigger("ajaxStart");if(!c.hasContent){c.data&&(c.url+=(gn.test(c.url)?"&":"?")+c.data,delete c.data),r=c.url;if(c.cache===!1){var N=v.now(),C=c.url.replace(bn,"$1_="+N);c.url=C+(C===c.url?(gn.test(c.url)?"&":"?")+"_="+N:"")}}(c.data&&c.hasContent&&c.contentType!==!1||n.contentType)&&x.setRequestHeader("Content-Type",c.contentType),c.ifModified&&(r=r||c.url,v.lastModified[r]&&x.setRequestHeader("If-Modified-Since",v.lastModified[r]),v.etag[r]&&x.setRequestHeader("If-None-Match",v.etag[r])),x.setRequestHeader("Accept",c.dataTypes[0]&&c.accepts[c.dataTypes[0]]?c.accepts[c.dataTypes[0]]+(c.dataTypes[0]!=="*"?", "+Tn+"; q=0.01":""):c.accepts["*"]);for(l in c.headers)x.setRequestHeader(l,c.headers[l]);if(!c.beforeSend||c.beforeSend.call(h,x,c)!==!1&&E!==2){S="abort";for(l in{success:1,error:1,complete:1})x[l](c[l]);o=kn(xn,c,n,x);if(!o)T(-1,"No Transport");else{x.readyState=1,f&&p.trigger("ajaxSend",[x,c]),c.async&&c.timeout>0&&(u=setTimeout(function(){x.abort("timeout")},c.timeout));try{E=1,o.send(b,T)}catch(k){if(!(E<2))throw k;T(-1,k)}}return x}return x.abort()},active:0,lastModified:{},etag:{}});var Mn=[],_n=/\?/,Dn=/(=)\?(?=&|$)|\?\?/,Pn=v.now();v.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=Mn.pop()||v.expando+"_"+Pn++;return this[e]=!0,e}}),v.ajaxPrefilter("json jsonp",function(n,r,i){var s,o,u,a=n.data,f=n.url,l=n.jsonp!==!1,c=l&&Dn.test(f),h=l&&!c&&typeof a=="string"&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Dn.test(a);if(n.dataTypes[0]==="jsonp"||c||h)return s=n.jsonpCallback=v.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],c?n.url=f.replace(Dn,"$1"+s):h?n.data=a.replace(Dn,"$1"+s):l&&(n.url+=(_n.test(f)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return u||v.error(s+" was not called"),u[0]},n.dataTypes[0]="json",e[s]=function(){u=arguments},i.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=r.jsonpCallback,Mn.push(s)),u&&v.isFunction(o)&&o(u[0]),u=o=t}),"script"}),v.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return v.globalEval(e),e}}}),v.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),v.ajaxTransport("script",function(e){if(e.crossDomain){var n,r=i.head||i.getElementsByTagName("head")[0]||i.documentElement;return{send:function(s,o){n=i.createElement("script"),n.async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,i){if(i||!n.readyState||/loaded|complete/.test(n.readyState))n.onload=n.onreadystatechange=null,r&&n.parentNode&&r.removeChild(n),n=t,i||o(200,"success")},r.insertBefore(n,r.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Hn,Bn=e.ActiveXObject?function(){for(var e in Hn)Hn[e](0,1)}:!1,jn=0;v.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Fn()||In()}:Fn,function(e){v.extend(v.support,{ajax:!!e,cors:!!e&&"withCredentials"in e})}(v.ajaxSettings.xhr()),v.support.ajax&&v.ajaxTransport(function(n){if(!n.crossDomain||v.support.cors){var r;return{send:function(i,s){var o,u,a=n.xhr();n.username?a.open(n.type,n.url,n.async,n.username,n.password):a.open(n.type,n.url,n.async);if(n.xhrFields)for(u in n.xhrFields)a[u]=n.xhrFields[u];n.mimeType&&a.overrideMimeType&&a.overrideMimeType(n.mimeType),!n.crossDomain&&!i["X-Requested-With"]&&(i["X-Requested-With"]="XMLHttpRequest");try{for(u in i)a.setRequestHeader(u,i[u])}catch(f){}a.send(n.hasContent&&n.data||null),r=function(e,i){var u,f,l,c,h;try{if(r&&(i||a.readyState===4)){r=t,o&&(a.onreadystatechange=v.noop,Bn&&delete Hn[o]);if(i)a.readyState!==4&&a.abort();else{u=a.status,l=a.getAllResponseHeaders(),c={},h=a.responseXML,h&&h.documentElement&&(c.xml=h);try{c.text=a.responseText}catch(p){}try{f=a.statusText}catch(p){f=""}!u&&n.isLocal&&!n.crossDomain?u=c.text?200:404:u===1223&&(u=204)}}}catch(d){i||s(-1,d)}c&&s(u,f,c,l)},n.async?a.readyState===4?setTimeout(r,0):(o=++jn,Bn&&(Hn||(Hn={},v(e).unload(Bn)),Hn[o]=r),a.onreadystatechange=r):r()},abort:function(){r&&r(0,1)}}}});var qn,Rn,Un=/^(?:toggle|show|hide)$/,zn=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),Wn=/queueHooks$/,Xn=[Gn],Vn={"*":[function(e,t){var n,r,i=this.createTween(e,t),s=zn.exec(t),o=i.cur(),u=+o||0,a=1,f=20;if(s){n=+s[2],r=s[3]||(v.cssNumber[e]?"":"px");if(r!=="px"&&u){u=v.css(i.elem,e,!0)||n||1;do a=a||".5",u/=a,v.style(i.elem,e,u+r);while(a!==(a=i.cur()/o)&&a!==1&&--f)}i.unit=r,i.start=u,i.end=s[1]?u+(s[1]+1)*n:n}return i}]};v.Animation=v.extend(Kn,{tweener:function(e,t){v.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");var n,r=0,i=e.length;for(;r<i;r++)n=e[r],Vn[n]=Vn[n]||[],Vn[n].unshift(t)},prefilter:function(e,t){t?Xn.unshift(e):Xn.push(e)}}),v.Tween=Yn,Yn.prototype={constructor:Yn,init:function(e,t,n,r,i,s){this.elem=e,this.prop=n,this.easing=i||"swing",this.options=t,this.start=this.now=this.cur(),this.end=r,this.unit=s||(v.cssNumber[n]?"":"px")},cur:function(){var e=Yn.propHooks[this.prop];return e&&e.get?e.get(this):Yn.propHooks._default.get(this)},run:function(e){var t,n=Yn.propHooks[this.prop];return this.options.duration?this.pos=t=v.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Yn.propHooks._default.set(this),this}},Yn.prototype.init.prototype=Yn.prototype,Yn.propHooks={_default:{get:function(e){var t;return e.elem[e.prop]==null||!!e.elem.style&&e.elem.style[e.prop]!=null?(t=v.css(e.elem,e.prop,!1,""),!t||t==="auto"?0:t):e.elem[e.prop]},set:function(e){v.fx.step[e.prop]?v.fx.step[e.prop](e):e.elem.style&&(e.elem.style[v.cssProps[e.prop]]!=null||v.cssHooks[e.prop])?v.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Yn.propHooks.scrollTop=Yn.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},v.each(["toggle","show","hide"],function(e,t){var n=v.fn[t];v.fn[t]=function(r,i,s){return r==null||typeof r=="boolean"||!e&&v.isFunction(r)&&v.isFunction(i)?n.apply(this,arguments):this.animate(Zn(t,!0),r,i,s)}}),v.fn.extend({fadeTo:function(e,t,n,r){return this.filter(Gt).css("opacity",0).show().end().animate({opacity:t},e,n,r)},animate:function(e,t,n,r){var i=v.isEmptyObject(e),s=v.speed(t,n,r),o=function(){var t=Kn(this,v.extend({},e),s);i&&t.stop(!0)};return i||s.queue===!1?this.each(o):this.queue(s.queue,o)},stop:function(e,n,r){var i=function(e){var t=e.stop;delete e.stop,t(r)};return typeof e!="string"&&(r=n,n=e,e=t),n&&e!==!1&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=e!=null&&e+"queueHooks",s=v.timers,o=v._data(this);if(n)o[n]&&o[n].stop&&i(o[n]);else for(n in o)o[n]&&o[n].stop&&Wn.test(n)&&i(o[n]);for(n=s.length;n--;)s[n].elem===this&&(e==null||s[n].queue===e)&&(s[n].anim.stop(r),t=!1,s.splice(n,1));(t||!r)&&v.dequeue(this,e)})}}),v.each({slideDown:Zn("show"),slideUp:Zn("hide"),slideToggle:Zn("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){v.fn[e]=function(e,n,r){return this.animate(t,e,n,r)}}),v.speed=function(e,t,n){var r=e&&typeof e=="object"?v.extend({},e):{complete:n||!n&&t||v.isFunction(e)&&e,duration:e,easing:n&&t||t&&!v.isFunction(t)&&t};r.duration=v.fx.off?0:typeof r.duration=="number"?r.duration:r.duration in v.fx.speeds?v.fx.speeds[r.duration]:v.fx.speeds._default;if(r.queue==null||r.queue===!0)r.queue="fx";return r.old=r.complete,r.complete=function(){v.isFunction(r.old)&&r.old.call(this),r.queue&&v.dequeue(this,r.queue)},r},v.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},v.timers=[],v.fx=Yn.prototype.init,v.fx.tick=function(){var e,n=v.timers,r=0;qn=v.now();for(;r<n.length;r++)e=n[r],!e()&&n[r]===e&&n.splice(r--,1);n.length||v.fx.stop(),qn=t},v.fx.timer=function(e){e()&&v.timers.push(e)&&!Rn&&(Rn=setInterval(v.fx.tick,v.fx.interval))},v.fx.interval=13,v.fx.stop=function(){clearInterval(Rn),Rn=null},v.fx.speeds={slow:600,fast:200,_default:400},v.fx.step={},v.expr&&v.expr.filters&&(v.expr.filters.animated=function(e){return v.grep(v.timers,function(t){return e===t.elem}).length});var er=/^(?:body|html)$/i;v.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){v.offset.setOffset(this,e,t)});var n,r,i,s,o,u,a,f={top:0,left:0},l=this[0],c=l&&l.ownerDocument;if(!c)return;return(r=c.body)===l?v.offset.bodyOffset(l):(n=c.documentElement,v.contains(n,l)?(typeof l.getBoundingClientRect!="undefined"&&(f=l.getBoundingClientRect()),i=tr(c),s=n.clientTop||r.clientTop||0,o=n.clientLeft||r.clientLeft||0,u=i.pageYOffset||n.scrollTop,a=i.pageXOffset||n.scrollLeft,{top:f.top+u-s,left:f.left+a-o}):f)},v.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return v.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(v.css(e,"marginTop"))||0,n+=parseFloat(v.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var r=v.css(e,"position");r==="static"&&(e.style.position="relative");var i=v(e),s=i.offset(),o=v.css(e,"top"),u=v.css(e,"left"),a=(r==="absolute"||r==="fixed")&&v.inArray("auto",[o,u])>-1,f={},l={},c,h;a?(l=i.position(),c=l.top,h=l.left):(c=parseFloat(o)||0,h=parseFloat(u)||0),v.isFunction(t)&&(t=t.call(e,n,s)),t.top!=null&&(f.top=t.top-s.top+c),t.left!=null&&(f.left=t.left-s.left+h),"using"in t?t.using.call(e,f):i.css(f)}},v.fn.extend({position:function(){if(!this[0])return;var e=this[0],t=this.offsetParent(),n=this.offset(),r=er.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(v.css(e,"marginTop"))||0,n.left-=parseFloat(v.css(e,"marginLeft"))||0,r.top+=parseFloat(v.css(t[0],"borderTopWidth"))||0,r.left+=parseFloat(v.css(t[0],"borderLeftWidth"))||0,{top:n.top-r.top,left:n.left-r.left}},offsetParent:function(){return this.map(function(){var e=this.offsetParent||i.body;while(e&&!er.test(e.nodeName)&&v.css(e,"position")==="static")e=e.offsetParent;return e||i.body})}}),v.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var r=/Y/.test(n);v.fn[e]=function(i){return v.access(this,function(e,i,s){var o=tr(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[i]:e[i];o?o.scrollTo(r?v(o).scrollLeft():s,r?s:v(o).scrollTop()):e[i]=s},e,i,arguments.length,null)}}),v.each({Height:"height",Width:"width"},function(e,n){v.each({padding:"inner"+e,content:n,"":"outer"+e},function(r,i){v.fn[i]=function(i,s){var o=arguments.length&&(r||typeof i!="boolean"),u=r||(i===!0||s===!0?"margin":"border");return v.access(this,function(n,r,i){var s;return v.isWindow(n)?n.document.documentElement["client"+e]:n.nodeType===9?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):i===t?v.css(n,r,i,u):v.style(n,r,i,u)},n,o?i:t,o,null)}})}),e.jQuery=e.$=v,typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return v})})(window);
//]]>
</script>
<script id="jqueryArea" type="text/javascript">
//<![CDATA[
/*
jQuery.encoding.digests.sha1.js

SHA-1 digest and associated utility functions

Copyright (c) UnaMesa Association 2009

Dual licensed under the MIT and GPL licenses:
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

if(!$.encoding)
	$.encoding = {};
	$.extend($.encoding,{
		strToBe32s: function(str) {
			// Convert a string to an array of big-endian 32-bit words
			var be=[];
			var len=Math.floor(str.length/4);
			var i, j;
			for(i=0, j=0; i<len; i++, j+=4) {
				be[i]=((str.charCodeAt(j)&0xff) << 24)|((str.charCodeAt(j+1)&0xff) << 16)|((str.charCodeAt(j+2)&0xff) << 8)|(str.charCodeAt(j+3)&0xff);
			}
			while(j<str.length) {
				be[j>>2] |= (str.charCodeAt(j)&0xff)<<(24-(j*8)%32);
				j++;
			}
			return be;
		},
		be32sToStr: function(be) {
			// Convert an array of big-endian 32-bit words to a string
			var str='';
			for(var i=0;i<be.length*32;i+=8) {
				str += String.fromCharCode((be[i>>5]>>>(24-i%32)) & 0xff);
			}
			return str;
		},
		be32sToHex: function(be) {
			// Convert an array of big-endian 32-bit words to a hex string
			var hex='0123456789ABCDEF';
			var str='';
			for(var i=0;i<be.length*4;i++) {
				str += hex.charAt((be[i>>2]>>((3-i%4)*8+4))&0xF) + hex.charAt((be[i>>2]>>((3-i%4)*8))&0xF);
			}
			return str;
		}
	});
})(jQuery);


(function($) {

if(!$.encoding.digests)
	$.encoding.digests = {};
	$.extend($.encoding.digests,{
		hexSha1Str: function(str) {
			// Return, in hex, the SHA-1 hash of a string
			return $.encoding.be32sToHex($.encoding.digests.sha1Str(str));
		},
		sha1Str: function(str) {
			// Return the SHA-1 hash of a string
			return sha1($.encoding.strToBe32s(str),str.length);
		},
		sha1: function(x,blen) {
			// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
			return sha1($.encoding.strToBe32s(str),str.length);
		}
	});

	// Private functions.
	function sha1(x,blen) {
		// Calculate the SHA-1 hash of an array of blen bytes of big-endian 32-bit words
		function add32(a,b) {
			// Add 32-bit integers, wrapping at 32 bits
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			var lsw=(a&0xFFFF)+(b&0xFFFF);
			var msw=(a>>16)+(b>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function AA(a,b,c,d,e) {
			// Cryptographic round helper function. Add five 32-bit integers, wrapping at 32 bits, second parameter is rotated left 5 bits before the addition
			// Uses 16-bit operations internally to work around bugs in some JavaScript interpreters.
			b=(b>>>27)|(b<<5);
			var lsw=(a&0xFFFF)+(b&0xFFFF)+(c&0xFFFF)+(d&0xFFFF)+(e&0xFFFF);
			var msw=(a>>16)+(b>>16)+(c>>16)+(d>>16)+(e>>16)+(lsw>>16);
			return (msw<<16)|(lsw&0xFFFF);
		}
		function RR(w,j) {
			// Cryptographic round helper function.
			var n=w[j-3]^w[j-8]^w[j-14]^w[j-16];
			return (n>>>31)|(n<<1);
		}

		var len=blen*8;
		x[len>>5] |= 0x80 << (24-len%32);
		x[((len+64>>9)<<4)+15]=len;
		var w=new Array(80);

		var k1=0x5A827999;
		var k2=0x6ED9EBA1;
		var k3=0x8F1BBCDC;
		var k4=0xCA62C1D6;

		var h0=0x67452301;
		var h1=0xEFCDAB89;
		var h2=0x98BADCFE;
		var h3=0x10325476;
		var h4=0xC3D2E1F0;

		for(var i=0;i<x.length;i+=16) {
			var j=0;
			var t;
			var a=h0;
			var b=h1;
			var c=h2;
			var d=h3;
			var e=h4;
			while(j<16) {
				w[j]=x[i+j];
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<20) {
				w[j]=RR(w,j);
				t=AA(e,a,d^(b&(c^d)),w[j],k1);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<40) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k2);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<60) {
				w[j]=RR(w,j);
				t=AA(e,a,(b&c)|(d&(b|c)),w[j],k3);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			while(j<80) {
				w[j]=RR(w,j);
				t=AA(e,a,b^c^d,w[j],k4);
				e=d; d=c; c=(b>>>2)|(b<<30); b=a; a=t; j++;
			}
			h0=add32(h0,a);
			h1=add32(h1,b);
			h2=add32(h2,c);
			h3=add32(h3,d);
			h4=add32(h4,e);
		}
		return [h0,h1,h2,h3,h4];
	}
})(jQuery);
/*
jQuery.twStylesheet.js

jQuery plugin to dynamically insert CSS rules into a document

Usage:
  jQuery.twStylesheet applies style definitions
  jQuery.twStylesheet.remove neutralizes style definitions

Copyright (c) UnaMesa Association 2009

Triple licensed under the BSD, MIT and GPL licenses:
  http://www.opensource.org/licenses/bsd-license.php
  http://www.opensource.org/licenses/mit-license.php
  http://www.gnu.org/licenses/gpl.html
*/

(function($) {

var defaultId = "customStyleSheet"; // XXX: rename to dynamicStyleSheet?

// Add or replace a style sheet
// css argument is a string of CSS rule sets
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
// N.B.: Uses DOM methods instead of jQuery to ensure cross-browser comaptibility.
$.twStylesheet = function(css, options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(doc.createStyleSheet) { // IE-specific handling
		if(el) {
			el.parentNode.removeChild(el);
		}
		doc.getElementsByTagName("head")[0].insertAdjacentHTML("beforeEnd",
			'&nbsp;<style id="' + id + '" type="text/css">' + css + '</style>'); // fails without &nbsp;
	} else { // modern browsers
		if(el) {
			el.replaceChild(doc.createTextNode(css), el.firstChild);
		} else {
			el = doc.createElement("style");
			el.type = "text/css";
			el.id = id;
			el.appendChild(doc.createTextNode(css));
			doc.getElementsByTagName("head")[0].appendChild(el);
		}
	}
};

// Remove existing style sheet
// options.id is an optional name identifying the style sheet
// options.doc is an optional document reference
$.twStylesheet.remove = function(options) {
	options = options || {};
	var id = options.id || defaultId;
	var doc = options.doc || document;
	var el = doc.getElementById(id);
	if(el) {
		el.parentNode.removeChild(el);
	}
};

})(jQuery);

//]]>
</script>
<script type="text/javascript">
//<![CDATA[
if(useJavaSaver)
	document.write("<applet style='position:absolute;left:-1px' name='TiddlySaver' code='TiddlySaver.class' archive='TiddlySaver.jar' width='1' height='1'></applet>");
//]]>
</script>
<!--POST-SCRIPT-START-->
<script>
/*
 * Treeview 1.4 - jQuery plugin to hide and show branches of a tree
 * 
 * http://bassistance.de/jquery-plugins/jquery-plugin-treeview/
 * http://docs.jquery.com/Plugins/Treeview
 *
 * Copyright (c) 2007 JÃ¶rn Zaefferer
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
 * Revision: $Id: jquery.treeview.js 4684 2008-02-07 19:08:06Z joern.zaefferer $
 *
 */


;(function($) {

	$.extend($.fn, {
		swapClass: function(c1, c2) {
			var c1Elements = this.filter('.' + c1);
			this.filter('.' + c2).removeClass(c2).addClass(c1);
			c1Elements.removeClass(c1).addClass(c2);
			return this;
		},
		replaceClass: function(c1, c2) {
			return this.filter('.' + c1).removeClass(c1).addClass(c2).end();
		},
		hoverClass: function(className) {
			className = className || "hover";
			return this.hover(function() {
				$(this).addClass(className);
			}, function() {
				$(this).removeClass(className);
			});
		},
		heightToggle: function(animated, callback) {
			animated ?
				this.animate({ height: "toggle" }, animated, callback) :
				this.each(function(){
					jQuery(this)[ jQuery(this).is(":hidden") ? "show" : "hide" ]();
					if(callback)
						callback.apply(this, arguments);
				});
		},
		heightHide: function(animated, callback) {
			if (animated) {
				this.animate({ height: "hide" }, animated, callback);
			} else {
				this.hide();
				if (callback)
					this.each(callback);				
			}
		},
		prepareBranches: function(settings) {
			if (!settings.prerendered) {
				// mark last tree items
				this.filter(":last-child:not(ul)").addClass(CLASSES.last);
				// collapse whole tree, or only those marked as closed, anyway except those marked as open
				this.filter((settings.collapsed ? "" : "." + CLASSES.closed) + ":not(." + CLASSES.open + ")").find(">ul").hide();
			}
			// return all items with sublists
			return this.filter(":has(>ul)");
		},
		applyClasses: function(settings, toggler) {
			this.filter(":has(>ul):not(:has(>a))").find(">span").click(function(event) {
				toggler.apply($(this).next());
			}).add( $("a", this) ).hoverClass();
			
			if (!settings.prerendered) {
				// handle closed ones first
				this.filter(":has(>ul:hidden)")
						.addClass(CLASSES.expandable)
						.replaceClass(CLASSES.last, CLASSES.lastExpandable);
						
				// handle open ones
				this.not(":has(>ul:hidden)")
						.addClass(CLASSES.collapsable)
						.replaceClass(CLASSES.last, CLASSES.lastCollapsable);
						
	            // create hitarea
				this.prepend("<div class=\"" + CLASSES.hitarea + "\"/>").find("div." + CLASSES.hitarea).each(function() {
					var classes = "";
					$.each($(this).parent().attr("class").split(" "), function() {
						classes += this + "-hitarea ";
					});
					$(this).addClass( classes );
				});
			}
			
			// apply event to hitarea
			this.find("div." + CLASSES.hitarea).click( toggler );
		},
		treeview: function(settings) {
			
			settings = $.extend({
				cookieId: "treeview"
			}, settings);
			
			if (settings.add) {
				return this.trigger("add", [settings.add]);
			}
			
			if ( settings.toggle ) {
				var callback = settings.toggle;
				settings.toggle = function() {
					return callback.apply($(this).parent()[0], arguments);
				};
			}
		
			// factory for treecontroller
			function treeController(tree, control) {
				// factory for click handlers
				function handler(filter) {
					return function() {
						// reuse toggle event handler, applying the elements to toggle
						// start searching for all hitareas
						toggler.apply( $("div." + CLASSES.hitarea, tree).filter(function() {
							// for plain toggle, no filter is provided, otherwise we need to check the parent element
							return filter ? $(this).parent("." + filter).length : true;
						}) );
						return false;
					};
				}
				// click on first element to collapse tree
				$("a:eq(0)", control).click( handler(CLASSES.collapsable) );
				// click on second to expand tree
				$("a:eq(1)", control).click( handler(CLASSES.expandable) );
				// click on third to toggle tree
				$("a:eq(2)", control).click( handler() ); 
			}
		
			// handle toggle event
			function toggler() {
				$(this)
					.parent()
					// swap classes for hitarea
					.find(">.hitarea")
						.swapClass( CLASSES.collapsableHitarea, CLASSES.expandableHitarea )
						.swapClass( CLASSES.lastCollapsableHitarea, CLASSES.lastExpandableHitarea )
					.end()
					// swap classes for parent li
					.swapClass( CLASSES.collapsable, CLASSES.expandable )
					.swapClass( CLASSES.lastCollapsable, CLASSES.lastExpandable )
					// find child lists
					.find( ">ul" )
					// toggle them
					.heightToggle( settings.animated, settings.toggle );
				if ( settings.unique ) {
					$(this).parent()
						.siblings()
						// swap classes for hitarea
						.find(">.hitarea")
							.replaceClass( CLASSES.collapsableHitarea, CLASSES.expandableHitarea )
							.replaceClass( CLASSES.lastCollapsableHitarea, CLASSES.lastExpandableHitarea )
						.end()
						.replaceClass( CLASSES.collapsable, CLASSES.expandable )
						.replaceClass( CLASSES.lastCollapsable, CLASSES.lastExpandable )
						.find( ">ul" )
						.heightHide( settings.animated, settings.toggle );
				}
			}
			
			function serialize() {
				function binary(arg) {
					return arg ? 1 : 0;
				}
				var data = [];
				branches.each(function(i, e) {
					data[i] = $(e).is(":has(>ul:visible)") ? 1 : 0;
				});
				$.cookie(settings.cookieId, data.join("") );
			}
			
			function deserialize() {
				var stored = $.cookie(settings.cookieId);
				if ( stored ) {
					var data = stored.split("");
					branches.each(function(i, e) {
						$(e).find(">ul")[ parseInt(data[i]) ? "show" : "hide" ]();
					});
				}
			}
			
			// add treeview class to activate styles
			this.addClass("treeview");
			
			// prepare branches and find all tree items with child lists
			var branches = this.find("li").prepareBranches(settings);
			
			switch(settings.persist) {
			case "cookie":
				var toggleCallback = settings.toggle;
				settings.toggle = function() {
					serialize();
					if (toggleCallback) {
						toggleCallback.apply(this, arguments);
					}
				};
				deserialize();
				break;
			case "location":
				var current = this.find("a").filter(function() { return this.href.toLowerCase() == location.href.toLowerCase(); });
				if ( current.length ) {
					current.addClass("selected").parents("ul, li").add( current.next() ).show();
				}
				break;
			}
			
			branches.applyClasses(settings, toggler);
				
			// if control option is set, create the treecontroller and show it
			if ( settings.control ) {
				treeController(this, settings.control);
				$(settings.control).show();
			}
			
			return this.bind("add", function(event, branches) {
				$(branches).prev()
					.removeClass(CLASSES.last)
					.removeClass(CLASSES.lastCollapsable)
					.removeClass(CLASSES.lastExpandable)
				.find(">.hitarea")
					.removeClass(CLASSES.lastCollapsableHitarea)
					.removeClass(CLASSES.lastExpandableHitarea);
				$(branches).find("li").andSelf().prepareBranches(settings).applyClasses(settings, toggler);
			});
		}
	});



	// classes used by the plugin
	// need to be styled via external stylesheet, see first example
	var CLASSES = $.fn.treeview.classes = {
		open: "open",
		closed: "closed",
		expandable: "expandable",
		expandableHitarea: "expandable-hitarea",
		lastExpandableHitarea: "lastExpandable-hitarea",
		collapsable: "collapsable",
		collapsableHitarea: "collapsable-hitarea",
		lastCollapsableHitarea: "lastCollapsable-hitarea",
		lastCollapsable: "lastCollapsable",
		lastExpandable: "lastExpandable",
		last: "last",
		hitarea: "hitarea"
	};
	
	// provide backwards compability
	$.fn.Treeview = $.fn.treeview;


	
})(jQuery);
</script>



<script>
var sc_project=4838317; 
var sc_invisible=1; 
var sc_partition=56; 
var sc_click_stat=1; 
var sc_security="9ff8d9d0"; 
</script>
<!--POST-SCRIPT-END-->
</body>
</html>
